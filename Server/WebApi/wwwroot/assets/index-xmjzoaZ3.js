import{c as bt,u as wn,j as e,D as de,a as he,b as ue,d as $n,e as me,B as k,f as Xn,r as l,g as Ct,h as bn,C as Yn,L as kt,i as _n,R as Zn,A as Jn,M as et,k as vt,l as It,S as Tt,Q as St,m as $e,y as A,n as Nt,o as qt,p as Lt,O as Cn,q as Pt,s as We,T as P,t as Ee,G as U,v as kn,w as At,x as Wt,z as Me,E as ye,F as ne,H as Dt,I as Je,J as Ft,N as Rt,K as Ht,P as F,U as J,V as z,W as Kt,X as Mt,Y as Et,Z as Ne,_ as Y,$ as un,a0 as dn,a1 as Se,a2 as nt,a3 as Fe,a4 as ce,a5 as Be,a6 as B,a7 as xn,a8 as fn,a9 as yn,aa as qe,ab as Bt,ac as Z,ad as Ce,ae as ke,af as Ut,ag as zt,ah as tt,ai as xe,aj as Ve,ak as Oe,al as ve,am as Ue,an as _e,ao as Ze,ap as Xe,aq as st,ar as vn,as as Vt,at as Kn,au as Mn,av as Ot,aw as Gt,ax as Qt,ay as $t,az as Xt,aA as En,aB as ze,aC as Yt,aD as De,aE as en,aF as _t,aG as Zt,aH as Jt,aI as Bn,aJ as Pe,aK as es,aL as Un,aM as zn,aN as Vn,aO as On,aP as ns,aQ as ts,aR as ss,aS as Qe,aT as Gn,aU as rs,aV as is,aW as as,aX as os,aY as ls,aZ as cs,a_ as hn,a$ as rt,b0 as ds,b1 as hs,b2 as us,b3 as ms,b4 as gs}from"./vendor-DNgxha1C.js";function aa(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))o(h);new MutationObserver(h=>{for(const p of h)if(p.type==="childList")for(const f of p.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&o(f)}).observe(document,{childList:!0,subtree:!0});function s(h){const p={};return h.integrity&&(p.integrity=h.integrity),h.referrerPolicy&&(p.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?p.credentials="include":h.crossOrigin==="anonymous"?p.credentials="omit":p.credentials="same-origin",p}function o(h){if(h.ep)return;h.ep=!0;const p=s(h);fetch(h.href,p)}})();const ps=bt({cssVariables:{colorSchemeSelector:"data-toolpad-color-scheme"},colorSchemes:{light:!0,dark:!0}});function xs(n){const t=["-","","Unknown"];return t.includes(n.email)||t.includes(n.phoneNumber)||t.includes(n.specialization)||t.includes(n.academicTitle)||t.includes(n.officerRank)||t.includes(n.fieldName)||n.fieldId==="00000000-0000-0000-0000-000000000000"}function fs({open:n,onClose:t}){return wn().pathname==="/cap-nhat-thong-tin"?null:e.jsxs(de,{open:n,onClose:t,children:[e.jsx(he,{children:"Câp nhật thông tin"}),e.jsx(ue,{children:e.jsx($n,{children:"Vui lòng cập nhật thông tin trước khi sử dụng hệ thống."})}),e.jsx(me,{children:e.jsx(k,{onClick:t,autoFocus:!0,children:"Câp nhật thông tin"})})]})}function ys({open:n,onClose:t}){return e.jsxs(de,{open:n,onClose:t,children:[e.jsx(he,{children:"Phiên đăng nhập đã hết hạn"}),e.jsx(ue,{children:e.jsx($n,{children:"Vui lòng đăng nhập lại để tiếp tục sử dụng hệ thống."})}),e.jsx(me,{children:e.jsx(k,{onClick:t,autoFocus:!0,children:"Đăng nhập lại"})})]})}const M=Xn.create({baseURL:"/api",headers:{"Content-Type":"application/json"},timeout:1e4});M.interceptors.request.use(n=>{const t=localStorage.getItem("token");return t&&(n.headers.Authorization="Bearer ".concat(t)),n},n=>Promise.reject(n));const js=async n=>(await M.get("/users/search?searchTerm=".concat(encodeURIComponent(n)))).data,Ye=async n=>(await M.get("/users/".concat(n))).data,ws=async()=>(await M.get("/users")).data,it=async()=>(await M.get("/users/me")).data,bs=async(n,t)=>(await M.put("/users/".concat(n),t)).data,Cs=async(n,t)=>(await M.put("/users/admin/".concat(n),t)).data,ks=async n=>(await M.delete("/users/".concat(n))).data,at=async n=>(await M.get("/users/department/".concat(n))).data,vs=async n=>{const t=new FormData;return t.append("file",n),(await M.post("/users/import",t,{headers:{"Content-Type":"multipart/form-data"}})).data},ot=l.createContext(void 0),Is=({children:n})=>{const[t,s]=l.useState(null),[o,h]=l.useState(!0),p=async()=>{const T=localStorage.getItem("token");if(!T){s(null),h(!1);return}try{const g=await it();if(g.success){const w=g.data;w.role=Ct(T)["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"],s(w)}}catch(g){console.error("Failed to fetch user info:",g),localStorage.removeItem("token"),localStorage.removeItem("expiration"),s(null)}finally{h(!1)}};l.useEffect(()=>{p()},[]);const f=()=>{localStorage.removeItem("token"),localStorage.removeItem("expiration"),s(null),window.location.href="/dang-nhap"};return e.jsx(ot.Provider,{value:{user:t,setUser:s,signOut:f,loading:o,refreshUserInfo:p},children:n})},Re=()=>{const n=l.useContext(ot);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},Ts=[{kind:"header",title:"Chính"},{title:"Trang chủ",icon:e.jsx(bn,{})},{segment:"cong-trinh",title:"Công trình",icon:e.jsx(Yn,{})},{segment:"dang-ky-quy-doi",title:"Đăng ký quy đổi",icon:e.jsx(kt,{})},{kind:"header",title:"Báo cáo"},{segment:"bao-cao",title:"Báo cáo",icon:e.jsx(_n,{})}],Ss=[{kind:"header",title:"Chính"},{title:"Trang chủ",icon:e.jsx(bn,{})},{segment:"cong-trinh",title:"Công trình",icon:e.jsx(Yn,{})},{segment:"cham-diem",title:"Chấm điểm công trình",icon:e.jsx(Zn,{})},{kind:"header",title:"Báo cáo"},{segment:"bao-cao",title:"Báo cáo",icon:e.jsx(_n,{})},{segment:"thong-ke",title:"Thống kê",icon:e.jsx(Jn,{})},{kind:"header",title:"Hệ thống"},{segment:"quan-ly-tai-khoan",title:"Quản lý tài khoản",icon:e.jsx(et,{})}],Ns=[{kind:"header",title:"Chính"},{title:"Trang chủ",icon:e.jsx(bn,{})},{segment:"cham-diem",title:"Chấm điểm công trình",icon:e.jsx(Zn,{})},{segment:"phan-cong",title:"Phân công chấm điểm",icon:e.jsx(vt,{})},{kind:"header",title:"Báo cáo"},{segment:"thong-ke",title:"Thống kê",icon:e.jsx(Jn,{})},{kind:"header",title:"Hệ thống"},{segment:"quan-ly-tai-khoan",title:"Quản lý tài khoản",icon:e.jsx(et,{})},{segment:"cau-hinh-he-thong",title:"Cấu hình hệ thống",icon:e.jsx(It,{})},{segment:"cai-dat",title:"Quản lý danh mục",icon:e.jsx(Tt,{}),children:[{segment:"he-so-quy-doi",title:"Hệ số quy đổi"},{segment:"muc-dich-quy-doi",title:"Mục đích quy đổi"},{segment:"vai-tro-tac-gia",title:"Vai trò tác giả"},{kind:"divider"},{segment:"loai-cong-trinh",title:"Loại công trình"},{segment:"cap-cong-trinh",title:"Cấp công trình"},{segment:"nganh-scimago",title:"Ngành SCImago"},{kind:"divider"},{segment:"don-vi",title:"Đơn vị"},{segment:"nganh",title:"Ngành"},{segment:"nam-hoc",title:"Năm học"}]}],qs={logo:e.jsx("img",{src:"/logo.png",alt:"SGU"}),title:"SGU - NCKH"};function Ls(){const[n,t]=l.useState(null),[s,o]=l.useState(!1),[h,p]=l.useState(!1),{user:f,loading:T}=Re(),g=f==null?void 0:f.role,w=l.useMemo(()=>{switch(g){case"Admin":return Ns;case"Manager":return Ss;case"User":return Ts;default:return[]}},[g]),d=new St,C=wn(),j=$e();l.useEffect(()=>{A.dismiss()},[C]);const u=l.useMemo(()=>({signIn:()=>{j("/dang-nhap")},signOut:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t(null),j("/dang-nhap")}}),[]);return l.useEffect(()=>{f?(xs(f)&&C.pathname!=="/cap-nhat-thong-tin"?p(!0):p(!1),t({user:f})):T||t(null)},[f,T,C.pathname]),l.useEffect(()=>{const v=localStorage.getItem("expiration");if(!v)return;const L=new Date(v).getTime()-Date.now();if(L>0){const q=setTimeout(()=>{o(!0),u.signOut()},L);return()=>clearTimeout(q)}else o(!0),u.signOut()},[]),e.jsx(Nt,{navigation:w,branding:qs,session:n,authentication:u,children:e.jsxs(qt,{client:d,children:[e.jsx(Lt,{position:"top-right",autoClose:2e3}),e.jsx(Cn,{}),e.jsx(ys,{open:s,onClose:()=>j("/dang-nhap")}),e.jsx(fs,{open:h,onClose:()=>j("/cap-nhat-thong-tin")})]})})}const Ps={CN:"Cử nhân",ThS:"Thạc sĩ",TS:"Tiến sĩ",PGS_TS:"Phó Giáo sư, Tiến sĩ",GS_TS:"Giáo sư, Tiến sĩ",Unknown:"-"},nn=n=>Ps[n]||"-",As={GiaoVien:"Giáo viên",ChuyenVien:"Chuyên viên",ChuyenVienChinh:"Chuyên viên chính",ChuyenVienCaoCap:"Chuyên viên cao cấp",TroGiang:"Trợ giảng",GiangVien:"Giảng viên",GiangVienChinh:"Giảng viên chính",GiangVienCaoCap:"Giảng viên cao cấp",Unknown:"-"},tn=n=>As[n]||"-";function Ws(){const n=Pt();return!n||!n.user?null:e.jsxs(We,{sx:{maxWidth:350,padding:2},children:[n.user&&e.jsxs(We,{mb:1,children:[e.jsx(P,{variant:"h6",fontWeight:600,children:n.user.fullName}),e.jsx(P,{variant:"body2",children:n.user.fieldName}),e.jsx(P,{variant:"body2",fontWeight:300,children:n.user.userName}),e.jsx(Ee,{sx:{my:1}}),e.jsxs(U,{container:!0,spacing:2,children:[e.jsx(U,{item:!0,xs:6,children:e.jsx(P,{variant:"body2",children:"Email:"})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(P,{variant:"body2",children:n.user.email})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(P,{variant:"body2",children:"Học vị:"})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(P,{variant:"body2",children:nn(n.user.academicTitle)})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(P,{variant:"body2",children:"Ngạch viên chức:"})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(P,{variant:"body2",children:tn(n.user.officerRank)})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(P,{variant:"body2",children:"Đơn vị công tác:"})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(P,{variant:"body2",children:n.user.departmentName})})]}),e.jsx(kn,{href:"/cap-nhat-thong-tin",sx:{marginTop:2},children:"Chỉnh sửa thông tin"})]}),e.jsx(Ee,{}),e.jsx(At,{children:e.jsx(Wt,{})})]})}const Ds=async()=>(await M.get("/notifications/global")).data,Fs=async()=>(await M.get("/notifications/me")).data,Rs=async n=>(await M.put("/notifications/".concat(n))).data;function jn(n){return Me.fromISO(n,{zone:"utc"}).setZone("Asia/Saigon").setLocale("vi").toFormat("d LLLL yyyy, HH:mm")}function Hs(){const[n,t]=l.useState(null),s=!!n,o=ye(),{data:h,isLoading:p,refetch:f}=ne({queryKey:["notifications"],queryFn:Fs});l.useEffect(()=>{const j=new Dt().withUrl("/notification-hub?access_token=".concat(localStorage.getItem("token"))).withAutomaticReconnect().build();return j.on("ReceiveNotification",()=>{f()}),j.start().catch(console.error),()=>{j.stop()}},[f]);const T=(h==null?void 0:h.data)||[],g=T.filter(j=>!j.isRead).length,w=j=>{t(j.currentTarget)},d=()=>{t(null)},C=async j=>{try{await Rs(j),o.invalidateQueries({queryKey:["notifications"]}),f()}catch(u){console.error("Error marking notification as read",u)}finally{d()}};return e.jsxs(e.Fragment,{children:[e.jsx(Je,{id:"notification-button","aria-controls":s?"notification-menu":void 0,"aria-haspopup":"true","aria-expanded":s?"true":void 0,onClick:w,children:e.jsx(Ft,{badgeContent:g,color:"error",children:e.jsx(Rt,{color:"primary"})})}),e.jsx(Ht,{id:"notification-menu",anchorEl:n,open:s,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{minWidth:300,maxHeight:400}},MenuListProps:{"aria-labelledby":"notification-button"},children:p?e.jsx(F,{sx:{p:1},children:e.jsx(J,{size:20})}):T.length>0?[...T].sort((j,u)=>j.isRead===u.isRead?0:j.isRead?1:-1).map(j=>e.jsxs(F,{sx:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start",backgroundColor:j.isRead?"transparent":"action.selected"},children:[e.jsx(P,{variant:"body2",sx:{fontWeight:j.isRead?"normal":"bold",mr:1,flex:1},children:j.content}),e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",gap:2,children:[e.jsx(P,{variant:"body2",sx:{whiteSpace:"nowrap",fontSize:"0.7rem",color:"text.secondary"},children:jn(j.createdDate.toString())}),e.jsx(k,{size:"small",variant:"outlined",color:"primary",disabled:j.isRead,onClick:()=>C(j.id),children:j.isRead?"Đã đọc":"Đánh dấu đã đọc"})]})]},j.id)):e.jsx(F,{onClick:d,sx:{p:1},children:e.jsx(P,{variant:"body2",children:"Không có thông báo nào để hiển thị."})})})]})}function Ks(){return e.jsxs(z,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(Hs,{}),e.jsx(Kt,{slots:{popoverContent:Ws},localeText:{signOutLabel:"Đăng xuất"}})]})}function Ms(){return e.jsx(Mt,{slots:{toolbarAccount:Ks},children:e.jsx(Et,{children:e.jsx(Cn,{})})})}const Es=async n=>(await M.post("/auth/register",n)).data,Bs=async n=>(await M.post("/auth/login",n)).data,Us=async(n,t)=>(await M.post("/auth/change-password",{currentPassword:n,newPassword:t})).data,zs=Ne({username:Y().min(1,"Mã số giảng viên là bắt buộc").max(9,"Mã số giảng viên không hợp lệ"),password:Y().min(6,"Mật khẩu phải có ít nhất 6 ký tự")}),Vs=un(dn)(({theme:n})=>({display:"flex",flexDirection:"column",alignSelf:"center",width:"100%",padding:n.spacing(6),gap:n.spacing(2),margin:"auto",boxShadow:"0px 5px 15px rgba(0,0,0,0.05)",[n.breakpoints.up("sm")]:{width:"450px"}})),Os=un(We)(({theme:n})=>({padding:n.spacing(2),[n.breakpoints.up("sm")]:{padding:n.spacing(4)},"&::before":{content:'""',display:"block",position:"absolute",zIndex:-1,inset:0,backgroundImage:"radial-gradient(ellipse at 50% 50%, hsl(210, 100%, 97%), hsl(0, 0%, 100%))",backgroundRepeat:"no-repeat",...n.applyStyles("dark",{backgroundImage:"radial-gradient(at 50% 50%, hsla(210, 100%, 16%, 0.5), hsl(220, 30%, 5%))"})}}));function Gs(){var q,W;const{register:n,handleSubmit:t,formState:{errors:s}}=Se({resolver:qe(zs),mode:"onTouched",shouldUnregister:!0}),{refreshUserInfo:o}=Re(),[h,p]=l.useState(!1),[f,T]=l.useState(null),[g,w]=l.useState(!1),d=$e(),C=wn(),u=new URLSearchParams(C.search).get("registered")==="true",v=async S=>{var c,H;p(!0),T(null);try{const m=await Bs({username:S.username,password:S.password});if(m.success){const b=m.data.token;localStorage.setItem("token",b),localStorage.setItem("expiration",m.data.expiration),await o(),d("/")}}catch(m){(H=(c=m.response)==null?void 0:c.data)!=null&&H.message?T(m.response.data.message):T("Đăng nhập thất bại: "+m.message)}finally{p(!1)}},L=()=>{w(S=>!S)};return e.jsxs(e.Fragment,{children:[e.jsx(nt,{enableColorScheme:!0}),e.jsx(Os,{direction:"column",justifyContent:"space-between",sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:e.jsx("form",{onSubmit:t(v),children:e.jsxs(Vs,{variant:"outlined",children:[e.jsx("img",{src:"/logo.png",height:36,width:36,alt:"logo"}),e.jsx(P,{component:"h1",variant:"h4",fontWeight:600,children:"Đăng nhập"}),u&&e.jsx(Fe,{severity:"success",children:"Đăng ký thành công"}),f&&e.jsx(Fe,{severity:"error",children:f}),e.jsxs(ce,{fullWidth:!0,children:[e.jsx(Be,{htmlFor:"username",children:"Mã số giảng viên"}),e.jsx(B,{fullWidth:!0,id:"username",placeholder:"Nhập mã số giảng viên",...n("username"),error:!!s.username,helperText:(q=s.username)==null?void 0:q.message})]},"username"),e.jsxs(ce,{fullWidth:!0,children:[e.jsx(Be,{htmlFor:"password",children:"Mật khẩu"}),e.jsx(B,{fullWidth:!0,id:"password",placeholder:"Nhập mật khẩu",type:g?"text":"password",...n("password"),error:!!s.password,helperText:(W=s.password)==null?void 0:W.message,InputProps:{endAdornment:e.jsx(xn,{position:"end",children:e.jsx(Je,{onClick:L,edge:"end","aria-label":"toggle password visibility",children:g?e.jsx(fn,{}):e.jsx(yn,{})})})}})]},"password"),e.jsx(z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:2,marginTop:3},children:e.jsx(k,{type:"submit",fullWidth:!0,variant:"contained",disabled:h,children:h?e.jsx(J,{size:24}):"Đăng nhập"})}),e.jsx(Ee,{sx:{marginY:2}}),e.jsxs(P,{sx:{textAlign:"center"},children:["Chưa có tài khoản?"," ",e.jsx(kn,{href:"/dang-ky",variant:"body2",sx:{alignSelf:"center"},children:"Đăng ký"})]})]})})})]})}const Ge=async()=>(await M.get("/departments")).data,lt=async n=>(await M.get("/departments/by-manager/".concat(n))).data,Qs=async n=>(await M.post("/departments",n)).data,$s=async(n,t)=>(await M.put("/departments/".concat(n),t)).data,Xs=async n=>(await M.delete("/departments/".concat(n))).data,sn=async()=>(await M.get("/fields")).data,Ys=async n=>(await M.post("/fields",n)).data,_s=async(n,t)=>(await M.put("/fields/".concat(n),t)).data,Zs=async n=>(await M.delete("/fields/".concat(n))).data;var mn=(n=>(n[n.Unknown=0]="Unknown",n[n.CN=1]="CN",n[n.ThS=2]="ThS",n[n.TS=3]="TS",n[n.PGS_TS=4]="PGS_TS",n[n.GS_TS=5]="GS_TS",n))(mn||{}),gn=(n=>(n[n.Unknown=0]="Unknown",n[n.ChuyenVien=1]="ChuyenVien",n[n.ChuyenVienChinh=2]="ChuyenVienChinh",n[n.ChuyenVienCaoCap=3]="ChuyenVienCaoCap",n[n.TroGiang=4]="TroGiang",n[n.GiangVien=5]="GiangVien",n[n.GiangVienChinh=6]="GiangVienChinh",n[n.GiangVienCaoCap=7]="GiangVienCaoCap",n[n.GiaoVien=8]="GiaoVien",n))(gn||{});const Js=un(dn)(({theme:n})=>({display:"flex",flexDirection:"column",alignSelf:"center",width:"100%",padding:n.spacing(6),gap:n.spacing(2),margin:"auto",boxShadow:"0px 5px 15px rgba(0,0,0,0.05)",[n.breakpoints.up("sm")]:{width:"450px"}})),er=un(We)(({theme:n})=>({padding:n.spacing(2),[n.breakpoints.up("sm")]:{padding:n.spacing(4)},"&::before":{content:'""',display:"block",position:"absolute",zIndex:-1,inset:0,backgroundImage:"radial-gradient(ellipse at 50% 50%, hsl(210, 100%, 97%), hsl(0, 0%, 100%))",backgroundRepeat:"no-repeat",...n.applyStyles("dark",{backgroundImage:"radial-gradient(at 50% 50%, hsla(210, 100%, 16%, 0.5), hsl(220, 30%, 5%))"})}})),nr=Ne({username:Y().regex(/^\d{9}$/,"Mã số giảng viên phải gồm 9 số"),password:Y().min(6,"Mật khẩu phải có ít nhất 6 ký tự"),confirmPassword:Y().min(6,"Vui lòng xác nhận mật khẩu")}).refine(n=>n.password===n.confirmPassword,{message:"Mật khẩu không khớp",path:["confirmPassword"]}),tr=Ne({email:Y().email("Email không hợp lệ"),fullname:Y().min(2,"Họ và tên là bắt buộc"),phoneNumber:Y().regex(/^(0|\+84)(3[2-9]|5[689]|7[06-9]|8[1-9]|9[0-9])\d{7}$/,"Vui lòng nhập số điện thoại"),specialization:Y().min(1,"Chuyên ngành là bắt buộc"),academicTitle:Y().min(1,"Vui lòng chọn học hàm / học vị"),officerRank:Y().min(1,"Vui lòng chọn ngạch viên chức"),departmentId:Y().min(1,"Vui lòng chọn phòng ban"),fieldId:Y().min(1,"Vui lòng chọn lĩnh vực")}),sr=()=>{const[n,t]=l.useState(1),[s,o]=l.useState([]),[h,p]=l.useState([]),[f,T]=l.useState(null),[g,w]=l.useState(!1),[d,C]=l.useState(!1),[j,u]=l.useState(!1),v=n===1?0:50,L=Se({resolver:qe(nr),defaultValues:{username:"",password:"",confirmPassword:""}}),q=Se({resolver:qe(tr),defaultValues:{email:"",fullname:"",phoneNumber:"",specialization:"",academicTitle:"",officerRank:"",departmentId:"",fieldId:""}});l.useEffect(()=>{async function b(){const r=await Ge();o(r.data||[]);const a=await sn();p(a.data||[])}b()},[]);const W=()=>{t(2)},S=async b=>{w(!0),T(null);try{const r=L.getValues(),a={username:r.username,password:r.password,email:b.email,fullname:b.fullname,phoneNumber:b.phoneNumber,specialization:b.specialization,academicTitle:b.academicTitle||"",officerRank:b.officerRank||"",departmentId:b.departmentId,fieldId:b.fieldId},y=await Es(a);y.success?window.location.href="/dang-nhap?registered=true":T(y.message||"Đăng ký không thành công. Vui lòng thử lại.")}catch(r){T("Có lỗi xảy ra. Vui lòng thử lại sau.")}finally{w(!1)}},c=()=>{t(1)},H=()=>{C(!d)},m=()=>{u(!j)};return e.jsxs(e.Fragment,{children:[e.jsx(nt,{enableColorScheme:!0}),e.jsx(er,{direction:"column",justifyContent:"space-between",sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2,minHeight:"100vh"},children:e.jsxs(Js,{variant:"outlined",children:[e.jsx("img",{src:"/logo.png",height:36,width:36,alt:"logo"}),e.jsx(P,{component:"h1",variant:"h4",fontWeight:600,children:"Đăng ký"}),e.jsx(Bt,{variant:"determinate",value:v,sx:{width:"100%",maxWidth:450}}),f&&e.jsx(Fe,{severity:"error",children:f}),n===1?e.jsx("form",{onSubmit:L.handleSubmit(W),children:e.jsxs(We,{spacing:3,sx:{mt:2},children:[e.jsx(Z,{name:"username",control:L.control,render:({field:b,fieldState:r})=>{var a;return e.jsxs(ce,{fullWidth:!0,error:!!r.error,children:[e.jsx(Be,{htmlFor:"username",children:"Mã số giảng viên"}),e.jsx(B,{...b,id:"username",placeholder:"Nhập mã số giảng viên",fullWidth:!0,error:!!r.error,helperText:(a=r.error)==null?void 0:a.message})]})}},"username"),e.jsx(Z,{name:"password",control:L.control,render:({field:b,fieldState:r})=>{var a;return e.jsxs(ce,{fullWidth:!0,error:!!r.error,children:[e.jsx(Be,{htmlFor:"password",children:"Mật khẩu"}),e.jsx(B,{...b,id:"password",placeholder:"Nhập mật khẩu",type:d?"text":"password",fullWidth:!0,error:!!r.error,helperText:(a=r.error)==null?void 0:a.message,InputProps:{endAdornment:e.jsx(xn,{position:"end",children:e.jsx(Je,{onClick:H,edge:"end",children:d?e.jsx(fn,{}):e.jsx(yn,{})})})}})]})}},"password"),e.jsx(Z,{name:"confirmPassword",control:L.control,render:({field:b,fieldState:r})=>{var a;return e.jsxs(ce,{fullWidth:!0,error:!!r.error,children:[e.jsx(Be,{htmlFor:"confirmPassword",children:"Xác nhận mật khẩu"}),e.jsx(B,{...b,id:"confirmPassword",placeholder:"Nhập lại mật khẩu",type:j?"text":"password",fullWidth:!0,error:!!r.error,helperText:(a=r.error)==null?void 0:a.message,InputProps:{endAdornment:e.jsx(xn,{position:"end",children:e.jsx(Je,{onClick:m,edge:"end",children:j?e.jsx(fn,{}):e.jsx(yn,{})})})}})]})}},"confirmPassword"),e.jsx(k,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:g,children:"Tiếp tục"})]})}):e.jsx("form",{onSubmit:q.handleSubmit(S),children:e.jsxs(We,{spacing:3,sx:{mt:2},children:[e.jsx(Z,{name:"fullname",control:q.control,render:({field:b,fieldState:r})=>{var a;return e.jsxs(ce,{fullWidth:!0,error:!!r.error,children:[e.jsx(Be,{htmlFor:"fullname",children:"Họ và tên"}),e.jsx(B,{...b,id:"fullname",placeholder:"Nhập họ và tên",fullWidth:!0,error:!!r.error,helperText:(a=r.error)==null?void 0:a.message})]})}},"fullname"),e.jsx(Z,{name:"email",control:q.control,render:({field:b,fieldState:r})=>{var a;return e.jsxs(ce,{fullWidth:!0,error:!!r.error,children:[e.jsx(Be,{htmlFor:"email",children:"Email"}),e.jsx(B,{...b,id:"email",placeholder:"Nhập email",type:"email",fullWidth:!0,error:!!r.error,helperText:(a=r.error)==null?void 0:a.message})]})}},"email"),e.jsx(Z,{name:"phoneNumber",control:q.control,render:({field:b,fieldState:r})=>{var a;return e.jsxs(ce,{fullWidth:!0,error:!!r.error,children:[e.jsx(Be,{htmlFor:"phoneNumber",children:"SĐT"}),e.jsx(B,{...b,id:"phoneNumber",placeholder:"Nhập số điện thoại",fullWidth:!0,error:!!r.error,helperText:(a=r.error)==null?void 0:a.message})]})}},"phoneNumber"),e.jsx(Z,{name:"specialization",control:q.control,render:({field:b,fieldState:r})=>{var a;return e.jsxs(ce,{fullWidth:!0,error:!!r.error,children:[e.jsx(Be,{htmlFor:"specialization",children:"Chuyên ngành"}),e.jsx(B,{...b,id:"specialization",placeholder:"Nhập chuyên ngành",fullWidth:!0,error:!!r.error,helperText:(a=r.error)==null?void 0:a.message})]})}},"specialization"),e.jsx(Z,{name:"fieldId",control:q.control,render:({field:b,fieldState:r})=>e.jsxs(ce,{fullWidth:!0,error:!!r.error,children:[e.jsx(Ce,{children:"Ngành"}),e.jsx(ke,{...b,label:"Ngành",children:h.map(a=>e.jsx(F,{value:a.id,children:a.name},a.id))}),r.error&&e.jsx(P,{color:"error",variant:"caption",children:r.error.message})]})},"fieldId"),e.jsx(Z,{name:"departmentId",control:q.control,render:({field:b,fieldState:r})=>e.jsxs(ce,{fullWidth:!0,error:!!r.error,children:[e.jsx(Ce,{children:"Đơn vị công tác"}),e.jsx(ke,{...b,label:"Đơn vị công tác",children:s.map(a=>e.jsx(F,{value:a.id,children:a.name},a.id))}),r.error&&e.jsx(P,{color:"error",variant:"caption",children:r.error.message})]})},"departmentId"),e.jsx(Z,{name:"academicTitle",control:q.control,render:({field:b,fieldState:r})=>e.jsxs(ce,{fullWidth:!0,error:!!r.error,children:[e.jsx(Ce,{children:"Học hàm / học vị"}),e.jsx(ke,{...b,label:"Học hàm / học vị",children:Object.entries(mn).filter(([a])=>isNaN(Number(a))).map(([a])=>e.jsx(F,{value:a,children:nn(a)},a))}),r.error&&e.jsx(P,{color:"error",variant:"caption",children:r.error.message})]})},"academicTitle"),e.jsx(Z,{name:"officerRank",control:q.control,render:({field:b,fieldState:r})=>e.jsxs(ce,{fullWidth:!0,error:!!r.error,children:[e.jsx(Ce,{children:"Ngạch viên chức"}),e.jsx(ke,{...b,label:"Ngạch viên chức",children:Object.entries(gn).filter(([a])=>isNaN(Number(a))).map(([a])=>e.jsx(F,{value:a,children:tn(a)},a))}),r.error&&e.jsx(P,{color:"error",variant:"caption",children:r.error.message})]})},"officerRank"),e.jsxs(We,{direction:"row",spacing:2,children:[e.jsx(k,{variant:"outlined",onClick:c,fullWidth:!0,disabled:g,children:"Quay lại"}),e.jsx(k,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:g,children:g?e.jsx(J,{size:24}):"Đăng ký"})]})]})}),e.jsx(Ee,{sx:{marginY:2}}),e.jsxs(P,{sx:{textAlign:"center"},children:["Đã có tài khoản?"," ",e.jsx(kn,{href:"/dang-nhap",variant:"body2",sx:{alignSelf:"center"},children:"Đăng nhập"})]})]})})]})};function rr(){const{data:n,isLoading:t,isSuccess:s,error:o}=ne({queryKey:["global-notifications"],queryFn:Ds});return l.useEffect(()=>{s&&n&&A.success(n.message,{toastId:"fetch-global-notifications-success"})},[]),l.useEffect(()=>{o&&A.error("Có lỗi đã xảy ra: "+o.message)},[o]),t?e.jsx(J,{}):!(n!=null&&n.data)||!Array.isArray(n.data)?e.jsx("div",{children:"Không có thông báo nào để hiển thị."}):e.jsx(e.Fragment,{children:n.data.map(h=>e.jsx(Fe,{severity:"info",sx:{mb:2},children:e.jsx(P,{variant:"body1",children:h.content})},h.id))})}function ir(){const n=$e();return e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",gap:2,mb:4,children:[e.jsx(k,{variant:"outlined",onClick:()=>n("/settings/factors"),size:"large",sx:{width:250},children:"Hệ số chấm điểm"}),e.jsx(k,{variant:"outlined",onClick:()=>n("/settings/author-roles"),size:"large",sx:{width:250},children:"Vai trò tác giả"}),e.jsx(k,{variant:"outlined",onClick:()=>n("/settings/purposes"),size:"large",sx:{width:250},children:"Mục đích quy đổi"}),e.jsx(k,{variant:"outlined",onClick:()=>n("/settings/system-config"),size:"large",sx:{width:250},children:"Cấu hình hệ thống"})]}),e.jsxs(z,{display:"flex",gap:2,mb:4,children:[e.jsx(k,{variant:"outlined",onClick:()=>n("/settings/work-types"),size:"large",sx:{width:250},children:"Loại công trình"}),e.jsx(k,{variant:"outlined",onClick:()=>n("/settings/work-levels"),size:"large",sx:{width:250},children:"Cấp công trình"}),e.jsx(k,{variant:"outlined",onClick:()=>n("/settings/scimago-fields"),size:"large",sx:{width:250},children:"Ngành SCImago"})]}),e.jsxs(z,{display:"flex",gap:2,mb:4,children:[e.jsx(k,{variant:"outlined",onClick:()=>n("/settings/fields"),size:"large",sx:{width:250},children:"Ngành"}),e.jsx(k,{variant:"outlined",onClick:()=>n("/settings/departments"),size:"large",sx:{width:250},children:"Đơn vị"})]})]})}const Te=({columns:n,data:t})=>{const s={page:0,pageSize:10};return e.jsx(Ut,{rows:t,columns:n,initialState:{pagination:{paginationModel:s}},pageSizeOptions:[10,15,25],disableRowSelectionOnClick:!0,localeText:zt.components.MuiDataGrid.defaultProps.localeText})},ct=async()=>(await M.get("/authorroles")).data,In=async n=>(await M.get("/authorroles/work-type/".concat(n))).data,ar=async n=>(await M.post("/authorroles",n)).data,or=async(n,t)=>(await M.put("/authorroles/".concat(n),t)).data,lr=async n=>(await M.delete("/authorroles/".concat(n))).data,He=async()=>(await M.get("/worktypes")).data,cr=async()=>(await M.get("/worktypes/with-details")).data,dr=async n=>(await M.post("/worktypes",n)).data,hr=async(n,t)=>(await M.put("/worktypes/".concat(n),t)).data,ur=async n=>(await M.delete("/worktypes/".concat(n))).data,mr=Ne({name:Y().min(2,"Tên vai trò tác giả phải có ít nhất 2 ký tự"),workTypeId:Y().uuid("Vui lòng chọn loại công trình"),isMainAuthor:tt()});function gr({open:n,handleClose:t,data:s}){const o=ye(),{data:h,isLoading:p}=ne({queryKey:["workTypes"],queryFn:He}),{control:f,handleSubmit:T,setValue:g,reset:w,formState:{errors:d}}=Se({resolver:qe(mr),defaultValues:{name:"",workTypeId:"",isMainAuthor:!1}});l.useEffect(()=>{s?(g("name",s.name),g("workTypeId",s.workTypeId),g("isMainAuthor",s.isMainAuthor)):w()},[s,g,w]);const C=xe({mutationFn:async u=>s!=null&&s.id?or(s.id,u):ar(u),onSuccess:()=>{o.invalidateQueries({queryKey:["authorRoles"]}),A.success(s!=null&&s.id?"Vai trò tác giả đã được cập nhật":"Vai trò tác giả đã được thêm"),t()},onError:u=>{console.error("API Error:",u),A.error("Đã xảy ra lỗi: "+u.message)}}),j=async u=>{await C.mutateAsync(u)};return e.jsxs(de,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[e.jsx(he,{children:s?"Cập nhật Vai trò tác giả":"Thêm Vai trò tác giả"}),e.jsx(ue,{children:e.jsxs(U,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"name",control:f,render:({field:u})=>{var v;return e.jsx(B,{...u,label:"Tên vai trò tác giả",error:!!d.name,helperText:(v=d.name)==null?void 0:v.message,fullWidth:!0,disabled:C.isPending})}})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"workTypeId",control:f,render:({field:u})=>{var v,L;return e.jsx(B,{...u,select:!0,label:"Loại công trình",error:!!d.workTypeId,helperText:(v=d.workTypeId)==null?void 0:v.message,fullWidth:!0,disabled:C.isPending||p,children:p?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(L=h==null?void 0:h.data)==null?void 0:L.map(q=>e.jsx(F,{value:q.id,children:q.name},q.id))})}})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"isMainAuthor",control:f,render:({field:u})=>e.jsx(Ve,{control:e.jsx(Oe,{checked:u.value,onChange:u.onChange,disabled:C.isPending}),label:"Là tác giả chính"})})})]})}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,disabled:C.isPending,children:"Hủy"}),e.jsx(k,{onClick:T(j),variant:"contained",color:"primary",disabled:C.isPending||p,children:C.isPending?e.jsx(J,{size:24}):s?"Cập nhật":"Thêm mới"})]})]})}function pr(){var I;const n=ye(),[t,s]=l.useState(""),{data:o,isLoading:h}=ne({queryKey:["workTypes"],queryFn:He}),{data:p,error:f,isPending:T,isSuccess:g,dataUpdatedAt:w}=ne({queryKey:["authorRoles",t],queryFn:()=>t?In(t):ct()});l.useEffect(()=>{g&&p&&A.success(p.message,{toastId:"fetch-author-roles-success"})},[w,g,p]),l.useEffect(()=>{f&&A.error("Có lỗi đã xảy ra: "+f.message)},[f]);const d=i=>{s(i.target.value)},[C,j]=l.useState(!1),[u,v]=l.useState(null),L=i=>{v(i),j(!0)},q=()=>j(!1),W=i=>{L(i)},[S,c]=l.useState(!1),[H,m]=l.useState(null),b=i=>{m(i),c(!0)},r=()=>{m(null),c(!1)},a=xe({mutationFn:i=>lr(i),onSuccess:()=>{A.success("Xóa vai trò tác giả thành công!"),n.invalidateQueries({queryKey:["authorRoles"]}),c(!1)},onError:i=>{A.error("Lỗi khi xóa: "+i.message)}}),y=()=>{H&&a.mutate(H)},x=[{field:"stt",headerName:"STT",width:70,renderCell:i=>{const D=Array.from(i.api.getAllRowIds()).findIndex(V=>V===i.row.id);return e.jsx("div",{children:D+1})}},{field:"name",headerName:"Tên vai trò tác giả",type:"string",width:300},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:300},{field:"isMainAuthor",headerName:"Tác giả chính",width:150,renderCell:i=>i.row.isMainAuthor?e.jsx(Ue,{icon:e.jsx(_e,{}),label:"Tác giả chính",color:"success",variant:"outlined"}):e.jsx(Ue,{icon:e.jsx(Ze,{}),label:"Thành viên",color:"default",variant:"outlined"})},{field:"actions",headerName:"Thao tác",width:200,renderCell:i=>e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>W(i.row),sx:{marginRight:1},disabled:a.isPending,children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>b(i.row.id),disabled:a.isPending,children:"Xóa"})]})}];return T&&h?e.jsx(J,{}):f?e.jsxs("p",{children:["Lỗi: ",f.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:2},children:[e.jsx(P,{variant:"h4",children:"Quản lý vai trò tác giả"}),e.jsxs(z,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(ce,{sx:{minWidth:220},children:[e.jsx(Ce,{id:"work-type-filter-label",children:"Lọc theo loại công trình"}),e.jsxs(ke,{labelId:"work-type-filter-label",id:"work-type-filter",value:t,onChange:d,label:"Lọc theo loại công trình",children:[e.jsx(F,{value:"",children:"Tất cả"}),(I=o==null?void 0:o.data)==null?void 0:I.map(i=>e.jsx(F,{value:i.id,children:i.name},i.id))]})]}),e.jsx(k,{variant:"contained",onClick:()=>L(null),children:"Thêm vai trò tác giả"})]})]}),e.jsx(ve,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(Te,{columns:x,data:(p==null?void 0:p.data)||[]})}),e.jsx(gr,{open:C,handleClose:q,data:u}),e.jsxs(de,{open:S,onClose:r,children:[e.jsx(he,{children:"Xác nhận xóa"}),e.jsx(ue,{children:e.jsx(P,{children:"Bạn có chắc chắn muốn xóa vai trò tác giả này?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:r,disabled:a.isPending,children:"Hủy"}),e.jsx(k,{onClick:y,color:"error",variant:"contained",disabled:a.isPending,children:a.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const xr=Ne({name:Y().min(2,"Tên phòng ban phải có ít nhất 2 ký tự")});function fr({open:n,handleClose:t,data:s}){var j;const o=ye(),{register:h,handleSubmit:p,setValue:f,reset:T,formState:{errors:g,isSubmitting:w}}=Se({resolver:qe(xr),defaultValues:{name:""}});l.useEffect(()=>{s?f("name",s.name):T()},[s,n,f,T]);const d=xe({mutationFn:async u=>s!=null&&s.id?$s(s.id,u):Qs(u),onSuccess:()=>{o.invalidateQueries({queryKey:["departments"]}),A.success(s!=null&&s.id?"Phòng ban đã được cập nhật":"Phòng ban đã được thêm"),t()},onError:u=>{console.error("API Error:",u)}}),C=async u=>{await d.mutateAsync(u)};return e.jsxs(de,{open:n,onClose:t,children:[e.jsx(he,{children:s?"Cập nhật Phòng Ban":"Thêm Phòng Ban"}),e.jsx(ue,{children:e.jsx(B,{label:"Tên phòng ban",...h("name"),error:!!g.name,helperText:(j=g.name)==null?void 0:j.message,fullWidth:!0,margin:"dense",disabled:w})}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,disabled:w,children:"Hủy"}),e.jsx(k,{onClick:p(C),variant:"contained",color:"primary",disabled:w,children:w?"Đang lưu...":"Lưu"})]})]})}function yr(){const n=ye(),{data:t,error:s,isPending:o,isSuccess:h,dataUpdatedAt:p}=ne({queryKey:["departments"],queryFn:Ge});l.useEffect(()=>{h&&t&&A.success(t.message,{toastId:"fetch-departments-success"})},[p]),l.useEffect(()=>{s&&A.error("Có lỗi đã xảy ra: "+s.message)},[s]);const[f,T]=l.useState(!1),[g,w]=l.useState(null),d=b=>{w(b),T(!0)},C=()=>T(!1),j=b=>{d(b)},[u,v]=l.useState(!1),[L,q]=l.useState(null),W=b=>{q(b),v(!0)},S=()=>{q(null),v(!1)},c=xe({mutationFn:b=>Xs(b),onSuccess:()=>{A.success("Xóa đơn vị thành công!"),n.invalidateQueries({queryKey:["departments"]}),v(!1)},onError:b=>{A.error("Lỗi khi xóa: "+b.message)}}),H=()=>{L&&c.mutate(L)},m=[{field:"name",headerName:"Tên đơn vị",type:"string",width:500},{field:"actions",headerName:"",width:500,renderCell:b=>e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>j(b.row),sx:{marginRight:1},disabled:c.isPending,children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>W(b.row.id),disabled:c.isPending,children:"Xóa"})]})}];return o?e.jsx(J,{}):s?e.jsxs("p",{children:["Error: ",s.message]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{display:"flex",flexDirection:"column-reverse",alignItems:"flex-end",sx:{marginBottom:2},children:e.jsx(k,{variant:"contained",onClick:()=>d(null),children:"Thêm đơn vị"})}),e.jsx(ve,{sx:{width:1010,marginX:"auto"},children:e.jsx(Te,{columns:m,data:(t==null?void 0:t.data)||[]})}),e.jsx(fr,{open:f,handleClose:C,data:g}),e.jsxs(de,{open:u,onClose:S,children:[e.jsx(he,{children:"Xác nhận xóa"}),e.jsx(ue,{children:e.jsx(P,{children:"Bạn có chắc chắn muốn xóa đơn vị này?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:S,disabled:c.isPending,children:"Hủy"}),e.jsx(k,{onClick:H,color:"error",variant:"contained",disabled:c.isPending,children:c.isPending?"Đang xóa...":"Xóa"})]})]})]})}const jr=async()=>(await M.get("/factors")).data,wr=async n=>(await M.get("/factors/work-type/".concat(n))).data,br=async n=>(await M.post("/factors",n)).data,Cr=async(n,t)=>(await M.put("/factors/".concat(n),t)).data,kr=async n=>(await M.delete("/factors/".concat(n))).data;var te=(n=>(n[n.BaiBaoTopMuoi=1]="BaiBaoTopMuoi",n[n.BaiBaoTopBaMuoi=2]="BaiBaoTopBaMuoi",n[n.BaiBaoTopNamMuoi=3]="BaiBaoTopNamMuoi",n[n.BaiBaoTopConLai=4]="BaiBaoTopConLai",n[n.BaiBaoMotDiem=5]="BaiBaoMotDiem",n[n.BaiBaoNuaDiem=6]="BaiBaoNuaDiem",n[n.BaiBaoKhongBayNamDiem=7]="BaiBaoKhongBayNamDiem",n[n.HDSVDatGiaiKK=8]="HDSVDatGiaiKK",n[n.HDSVDatGiaiBa=9]="HDSVDatGiaiBa",n[n.HDSVDatGiaiNhi=10]="HDSVDatGiaiNhi",n[n.HDSVDatGiaiNhat=11]="HDSVDatGiaiNhat",n[n.HDSVConLai=12]="HDSVConLai",n[n.TacPhamNgheThuatCapTruong=13]="TacPhamNgheThuatCapTruong",n[n.TacPhamNgheThuatCapTinhThanhPho=14]="TacPhamNgheThuatCapTinhThanhPho",n[n.TacPhamNgheThuatCapQuocGia=15]="TacPhamNgheThuatCapQuocGia",n[n.TacPhamNgheThuatCapQuocTe=16]="TacPhamNgheThuatCapQuocTe",n[n.ThanhTichHuanLuyenCapQuocGia=17]="ThanhTichHuanLuyenCapQuocGia",n[n.ThanhTichHuanLuyenCapQuocTe=18]="ThanhTichHuanLuyenCapQuocTe",n[n.GiaiPhapHuuIchCapTinhThanhPho=19]="GiaiPhapHuuIchCapTinhThanhPho",n[n.GiaiPhapHuuIchCapQuocGia=20]="GiaiPhapHuuIchCapQuocGia",n[n.GiaiPhapHuuIchCapQuocTe=21]="GiaiPhapHuuIchCapQuocTe",n[n.KetQuaNghienCuu=22]="KetQuaNghienCuu",n[n.Sach=23]="Sach",n))(te||{});const rn=n=>{if(n==null)return"-";switch(n){case te.BaiBaoTopMuoi:return"Top 10%";case te.BaiBaoTopBaMuoi:return"Top 30%";case te.BaiBaoTopNamMuoi:return"Top 50%";case te.BaiBaoTopConLai:return"Top còn lại";case te.BaiBaoMotDiem:return"Bài báo 1 điểm";case te.BaiBaoNuaDiem:return"Bài báo 0.5 điểm";case te.BaiBaoKhongBayNamDiem:return"Bài báo 0.75 điểm";case te.HDSVDatGiaiKK:return"HDSV đạt giải KK";case te.HDSVDatGiaiBa:return"HDSV đạt giải Ba";case te.HDSVDatGiaiNhi:return"HDSV đạt giải Nhì";case te.HDSVDatGiaiNhat:return"HDSV đạt giải Nhất";case te.HDSVConLai:return"HDSV còn lại";case te.TacPhamNgheThuatCapTruong:return"Tác phẩm nghệ thuật cấp trường";case te.TacPhamNgheThuatCapTinhThanhPho:return"Tác phẩm nghệ thuật cấp tỉnh/thành phố";case te.TacPhamNgheThuatCapQuocGia:return"Tác phẩm nghệ thuật cấp quốc gia";case te.TacPhamNgheThuatCapQuocTe:return"Tác phẩm nghệ thuật cấp quốc tế";case te.ThanhTichHuanLuyenCapQuocGia:return"Thành tích huấn luyện cấp quốc gia";case te.ThanhTichHuanLuyenCapQuocTe:return"Thành tích huấn luyện cấp quốc tế";case te.GiaiPhapHuuIchCapTinhThanhPho:return"Giải pháp hữu ích cấp tỉnh/thành phố";case te.GiaiPhapHuuIchCapQuocGia:return"Giải pháp hữu ích cấp quốc gia";case te.GiaiPhapHuuIchCapQuocTe:return"Giải pháp hữu ích cấp quốc tế";case te.KetQuaNghienCuu:return"Kết quả nghiên cứu";case te.Sach:return"Sách";default:return"-"}},dt=n=>{if(n==null)return"Chưa có mức điểm";switch(n){case te.BaiBaoTopMuoi:return"Bài báo khoa học thuộc top 10% tạp chí hàng đầu";case te.BaiBaoTopBaMuoi:return"Bài báo khoa học thuộc top 30% tạp chí hàng đầu";case te.BaiBaoTopNamMuoi:return"Bài báo khoa học thuộc top 50% tạp chí hàng đầu";case te.BaiBaoTopConLai:return"Bài báo khoa học thuộc top còn lại tạp chí hàng đầu";case te.BaiBaoMotDiem:return"Bài báo 1 điểm";case te.BaiBaoNuaDiem:return"Bài báo 0.5 điểm";case te.BaiBaoKhongBayNamDiem:return"Bài báo 0.75 điểm";case te.HDSVDatGiaiKK:return"Hướng dẫn đề tài NCKH đạt giải Khuyến khích";case te.HDSVDatGiaiBa:return"Hướng dẫn đề tài NCKH đạt giải Ba";case te.HDSVDatGiaiNhi:return"Hướng dẫn đề tài NCKH đạt giải Nhì";case te.HDSVDatGiaiNhat:return"Hướng dẫn đề tài NCKH đạt giải Nhất";case te.HDSVConLai:return"Hướng dẫn sinh viên NCKH còn lại";case te.TacPhamNgheThuatCapTruong:return"Tác phẩm nghệ thuật cấp trường";case te.TacPhamNgheThuatCapTinhThanhPho:return"Tác phẩm nghệ thuật cấp tỉnh/thành phố";case te.TacPhamNgheThuatCapQuocGia:return"Tác phẩm nghệ thuật cấp quốc gia";case te.TacPhamNgheThuatCapQuocTe:return"Tác phẩm nghệ thuật cấp quốc tế";case te.ThanhTichHuanLuyenCapQuocGia:return"Thành tích huấn luyện cấp quốc gia";case te.ThanhTichHuanLuyenCapQuocTe:return"Thành tích huấn luyện cấp quốc tế";case te.GiaiPhapHuuIchCapTinhThanhPho:return"Giải pháp hữu ích cấp tỉnh/thành phố";case te.GiaiPhapHuuIchCapQuocGia:return"Giải pháp hữu ích cấp quốc gia";case te.GiaiPhapHuuIchCapQuocTe:return"Giải pháp hữu ích cấp quốc tế";case te.KetQuaNghienCuu:return"Kết quả nghiên cứu";case te.Sach:return"Sách";default:return"-"}},ht=async()=>(await M.get("/worklevels")).data,Tn=async n=>(await M.get("/worklevels/work-type/".concat(n))).data,vr=async n=>(await M.post("/worklevels",n)).data,Ir=async(n,t)=>(await M.put("/worklevels/".concat(n),t)).data,Tr=async n=>(await M.delete("/worklevels/".concat(n))).data,ut=async()=>(await M.get("/purposes")).data,Sn=async n=>(await M.get("/purposes/work-type/".concat(n))).data,Sr=async n=>(await M.post("/purposes",n)).data,Nr=async(n,t)=>(await M.put("/purposes/".concat(n),t)).data,qr=async n=>(await M.delete("/purposes/".concat(n))).data,Lr=Ne({name:Y().min(1,"Tên hệ số không được để trống"),workTypeId:Y().uuid("Vui lòng chọn loại công trình"),workLevelId:Y().uuid("Vui lòng chọn cấp công trình").optional().nullable(),purposeId:Y().uuid("Vui lòng chọn mục đích quy đổi"),authorRoleId:Y().uuid("Vui lòng chọn vai trò tác giả").optional().nullable(),scoreLevel:Xe().int().min(1,"Vui lòng chọn mức điểm"),convertHour:Xe().min(0,"Giờ quy đổi phải là số dương"),maxAllowed:Xe().min(0,"Số tối đa phải là số dương")});function Pr({open:n,handleClose:t,data:s}){const o=ye(),[h,p]=l.useState(""),{data:f,isLoading:T}=ne({queryKey:["workTypes"],queryFn:He}),{data:g,isLoading:w}=ne({queryKey:["workLevels",h],queryFn:()=>Tn(h),enabled:!!h}),{data:d,isLoading:C}=ne({queryKey:["purposes",h],queryFn:()=>Sn(h),enabled:!!h}),{data:j,isLoading:u}=ne({queryKey:["authorRoles",h],queryFn:()=>In(h),enabled:!!h}),{control:v,handleSubmit:L,setValue:q,reset:W,watch:S,formState:{errors:c}}=Se({resolver:qe(Lr),defaultValues:{name:"",workTypeId:"",workLevelId:null,purposeId:"",authorRoleId:null,scoreLevel:te.BaiBaoTopMuoi,convertHour:0,maxAllowed:0}}),H=S("workTypeId");l.useEffect(()=>{H!==h&&p(H)},[H,h]),l.useEffect(()=>{s?(q("name",s.name||""),q("workTypeId",s.workTypeId),q("workLevelId",s.workLevelId),q("purposeId",s.purposeId),q("authorRoleId",s.authorRoleId||null),q("scoreLevel",s.scoreLevel),q("convertHour",s.convertHour),q("maxAllowed",s.maxAllowed),p(s.workTypeId)):W()},[s,q,W]),l.useEffect(()=>{h&&!s&&(q("workLevelId",null),q("purposeId",""),q("authorRoleId",null))},[h,q,s]);const m=xe({mutationFn:async r=>{const a={...r,workLevelId:r.workLevelId||void 0,authorRoleId:r.authorRoleId||void 0,name:r.name};return s!=null&&s.id?Cr(s.id,a):br(a)},onSuccess:()=>{o.invalidateQueries({queryKey:["factors"]}),A.success(s!=null&&s.id?"Hệ số quy đổi đã được cập nhật":"Hệ số quy đổi đã được thêm"),t()},onError:r=>{console.error("API Error:",r),A.error("Đã xảy ra lỗi: "+r.message)}}),b=async r=>{await m.mutateAsync(r)};return e.jsxs(de,{open:n,onClose:t,maxWidth:"md",fullWidth:!0,children:[e.jsx(he,{children:s?"Cập nhật Hệ số quy đổi":"Thêm Hệ số quy đổi"}),e.jsx(ue,{children:e.jsxs(U,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"name",control:v,render:({field:r})=>{var a;return e.jsx(B,{...r,label:"Tên hệ số",error:!!c.name,helperText:(a=c.name)==null?void 0:a.message,fullWidth:!0,disabled:m.isPending})}})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"workTypeId",control:v,render:({field:r})=>{var a,y;return e.jsx(B,{...r,select:!0,label:"Loại công trình",error:!!c.workTypeId,helperText:(a=c.workTypeId)==null?void 0:a.message,fullWidth:!0,disabled:m.isPending||T,children:T?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(y=f==null?void 0:f.data)==null?void 0:y.map(x=>e.jsx(F,{value:x.id,children:x.name},x.id))})}})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(Z,{name:"workLevelId",control:v,render:({field:r})=>{var a,y;return e.jsxs(B,{...r,select:!0,label:"Cấp công trình",error:!!c.workLevelId,helperText:(a=c.workLevelId)==null?void 0:a.message,fullWidth:!0,disabled:!h||m.isPending||w,value:r.value||"",children:[e.jsx(F,{value:"",children:"Không chọn"}),w?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(y=g==null?void 0:g.data)==null?void 0:y.map(x=>e.jsx(F,{value:x.id,children:x.name},x.id))]})}})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(Z,{name:"purposeId",control:v,render:({field:r})=>{var a,y;return e.jsx(B,{...r,select:!0,label:"Mục đích quy đổi",error:!!c.purposeId,helperText:(a=c.purposeId)==null?void 0:a.message,fullWidth:!0,disabled:!h||m.isPending||C,children:C?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(y=d==null?void 0:d.data)==null?void 0:y.map(x=>e.jsx(F,{value:x.id,children:x.name},x.id))})}})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(Z,{name:"authorRoleId",control:v,render:({field:r})=>{var a,y;return e.jsxs(B,{...r,select:!0,label:"Vai trò tác giả",error:!!c.authorRoleId,helperText:(a=c.authorRoleId)==null?void 0:a.message,fullWidth:!0,disabled:!h||m.isPending||u,value:r.value||"",children:[e.jsx(F,{value:"",children:"Không chọn"}),u?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(y=j==null?void 0:j.data)==null?void 0:y.map(x=>e.jsx(F,{value:x.id,children:x.name},x.id))]})}})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(Z,{name:"scoreLevel",control:v,render:({field:r})=>{var a;return e.jsx(B,{...r,select:!0,label:"Mức điểm",error:!!c.scoreLevel,helperText:(a=c.scoreLevel)==null?void 0:a.message,fullWidth:!0,disabled:m.isPending,onChange:y=>r.onChange(Number(y.target.value)),value:r.value,children:Object.values(te).filter(y=>typeof y=="number").map(y=>e.jsx(F,{value:y,children:dt(y)},y))})}})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(Z,{name:"convertHour",control:v,render:({field:r})=>{var a;return e.jsx(B,{...r,label:"Giờ quy đổi",type:"number",error:!!c.convertHour,helperText:(a=c.convertHour)==null?void 0:a.message,fullWidth:!0,disabled:m.isPending,inputProps:{step:.5,min:0},onChange:y=>r.onChange(Number(y.target.value))})}})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(Z,{name:"maxAllowed",control:v,render:({field:r})=>{var a;return e.jsx(B,{...r,label:"Số công trình tối đa được phép quy đổi",type:"number",error:!!c.maxAllowed,helperText:(a=c.maxAllowed)==null?void 0:a.message,fullWidth:!0,disabled:m.isPending,inputProps:{step:1,min:0},onChange:y=>r.onChange(Number(y.target.value))})}})})]})}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,disabled:m.isPending,children:"Hủy"}),e.jsx(k,{onClick:L(b),variant:"contained",color:"primary",disabled:m.isPending||T||!!h&&(w||C||u),children:m.isPending?e.jsx(J,{size:24}):s?"Cập nhật":"Thêm mới"})]})]})}function Ar(){var I;const n=ye(),[t,s]=l.useState(""),{data:o,isLoading:h}=ne({queryKey:["workTypes"],queryFn:He}),{data:p,error:f,isPending:T,isSuccess:g,dataUpdatedAt:w}=ne({queryKey:["factors",t],queryFn:()=>t?wr(t):jr()});l.useEffect(()=>{g&&p&&A.success(p.message,{toastId:"fetch-factors-success"})},[w,g,p]),l.useEffect(()=>{f&&A.error("Có lỗi đã xảy ra: "+f.message)},[f]);const d=i=>{s(i.target.value)},[C,j]=l.useState(!1),[u,v]=l.useState(null),L=i=>{v(i),j(!0)},q=()=>j(!1),W=i=>{L(i)},[S,c]=l.useState(!1),[H,m]=l.useState(null),b=i=>{m(i),c(!0)},r=()=>{m(null),c(!1)},a=xe({mutationFn:i=>kr(i),onSuccess:()=>{A.success("Xóa hệ số quy đổi thành công!"),n.invalidateQueries({queryKey:["factors"]}),c(!1)},onError:i=>{A.error("Lỗi khi xóa: "+i.message)}}),y=()=>{H&&a.mutate(H)},x=[{field:"stt",headerName:"STT",width:70,renderCell:i=>{const D=Array.from(i.api.getAllRowIds()).findIndex(V=>V===i.row.id);return e.jsx("div",{children:D+1})}},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:180},{field:"workLevelName",headerName:"Cấp công trình",type:"string",width:150},{field:"purposeName",headerName:"Mục đích quy đổi",type:"string",width:150},{field:"name",headerName:"Tên hệ số",type:"string",width:200},{field:"scoreLevel",headerName:"Mức điểm",width:160,renderCell:i=>e.jsx("div",{children:rn(i.row.scoreLevel)})},{field:"convertHour",headerName:"Giờ quy đổi",type:"number",width:120},{field:"maxAllowed",headerName:"Giới hạn đánh dấu",type:"number",width:150},{field:"actions",headerName:"Thao tác",width:200,renderCell:i=>e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>W(i.row),sx:{marginRight:1},disabled:a.isPending,children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>b(i.row.id),disabled:a.isPending,children:"Xóa"})]})}];return T&&h?e.jsx(J,{}):f?e.jsxs("p",{children:["Lỗi: ",f.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:2},children:[e.jsx(P,{variant:"h4",children:"Quản lý hệ số quy đổi"}),e.jsxs(z,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(ce,{sx:{minWidth:220},children:[e.jsx(Ce,{id:"work-type-filter-label",children:"Lọc theo loại công trình"}),e.jsxs(ke,{labelId:"work-type-filter-label",id:"work-type-filter",value:t,onChange:d,label:"Lọc theo loại công trình",children:[e.jsx(F,{value:"",children:"Tất cả"}),(I=o==null?void 0:o.data)==null?void 0:I.map(i=>e.jsx(F,{value:i.id,children:i.name},i.id))]})]}),e.jsx(k,{variant:"contained",onClick:()=>L(null),children:"Thêm hệ số quy đổi"})]})]}),e.jsx(ve,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(Te,{columns:x,data:(p==null?void 0:p.data)||[]})}),e.jsx(Pr,{open:C,handleClose:q,data:u}),e.jsxs(de,{open:S,onClose:r,children:[e.jsx(he,{children:"Xác nhận xóa"}),e.jsx(ue,{children:e.jsx(P,{children:"Bạn có chắc chắn muốn xóa hệ số quy đổi này?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:r,disabled:a.isPending,children:"Hủy"}),e.jsx(k,{onClick:y,color:"error",variant:"contained",disabled:a.isPending,children:a.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const Wr=Ne({name:Y().min(2,"Tên ngành phải có ít nhất 2 ký tự")});function Dr({open:n,handleClose:t,data:s}){var j;const o=ye(),{register:h,handleSubmit:p,setValue:f,reset:T,formState:{errors:g,isSubmitting:w}}=Se({resolver:qe(Wr),defaultValues:{name:""}});l.useEffect(()=>{s?f("name",s.name):T()},[s,n,f,T]);const d=xe({mutationFn:async u=>s!=null&&s.id?_s(s.id,u):Ys(u),onSuccess:()=>{o.invalidateQueries({queryKey:["fields"]}),A.success(s!=null&&s.id?"Ngành đã được cập nhật":"Ngành đã được thêm"),t()},onError:u=>{console.error("API Error:",u)}}),C=async u=>{await d.mutateAsync(u)};return e.jsxs(de,{open:n,onClose:t,children:[e.jsx(he,{children:s?"Cập nhật Ngành":"Thêm Ngành"}),e.jsx(ue,{children:e.jsx(B,{label:"Tên ngành",...h("name"),error:!!g.name,helperText:(j=g.name)==null?void 0:j.message,fullWidth:!0,margin:"dense",disabled:w})}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,disabled:w,children:"Hủy"}),e.jsx(k,{onClick:p(C),variant:"contained",color:"primary",disabled:w,children:w?"Đang lưu...":"Lưu"})]})]})}function Fr(){const n=ye(),{data:t,error:s,isPending:o,isSuccess:h,dataUpdatedAt:p}=ne({queryKey:["fields"],queryFn:sn});l.useEffect(()=>{h&&t&&A.success(t.message,{toastId:"fetch-fields-success"})},[p]),l.useEffect(()=>{s&&A.error("Có lỗi đã xảy ra: "+s.message)},[s]);const[f,T]=l.useState(!1),[g,w]=l.useState(null),d=b=>{w(b),T(!0)},C=()=>T(!1),j=b=>{d(b)},[u,v]=l.useState(!1),[L,q]=l.useState(null),W=b=>{q(b),v(!0)},S=()=>{q(null),v(!1)},c=xe({mutationFn:b=>Zs(b),onSuccess:()=>{A.success("Xóa ngành thành công!"),n.invalidateQueries({queryKey:["fields"]}),v(!1)},onError:b=>{A.error("Lỗi khi xóa: "+b.message)}}),H=()=>{L&&c.mutate(L)},m=[{field:"name",headerName:"Tên ngành",type:"string",width:500},{field:"actions",headerName:"",width:500,renderCell:b=>e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>j(b.row),sx:{marginRight:1},disabled:c.isPending,children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>W(b.row.id),disabled:c.isPending,children:"Xóa"})]})}];return o?e.jsx(J,{}):s?e.jsxs("p",{children:["Error: ",s.message]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{display:"flex",flexDirection:"column-reverse",alignItems:"flex-end",sx:{marginBottom:2},children:e.jsx(k,{variant:"contained",onClick:()=>d(null),children:"Thêm ngành"})}),e.jsx(ve,{sx:{width:1010,marginX:"auto"},children:e.jsx(Te,{columns:m,data:(t==null?void 0:t.data)||[]})}),e.jsx(Dr,{open:f,handleClose:C,data:g}),e.jsxs(de,{open:u,onClose:S,children:[e.jsx(he,{children:"Xác nhận xóa"}),e.jsx(ue,{children:e.jsx(P,{children:"Bạn có chắc chắn muốn xóa ngành này?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:S,disabled:c.isPending,children:"Hủy"}),e.jsx(k,{onClick:H,color:"error",variant:"contained",disabled:c.isPending,children:c.isPending?"Đang xóa...":"Xóa"})]})]})]})}const an=async n=>(await M.get("/works/filter",{params:n})).data,Rr=async n=>(await M.post("/works",n)).data,Hr=async n=>(await M.delete("/works/".concat(n))).data,Kr=async(n,t,s)=>(await M.patch("/works/".concat(n,"/admin-update/").concat(t),s)).data,Mr=async(n,t)=>(await M.patch("/works/".concat(n),t)).data,Er=async(n,t)=>(await M.patch("/works/authors/".concat(n,"/register"),t)).data,mt=n=>{if(!n)return"-";try{const t=typeof n=="string"?new Date(n):n;return st(t,"MM/yyyy",{locale:vn})}catch(t){return"-"}};var oe=(n=>(n[n.HopLe=0]="HopLe",n[n.KhongHopLe=1]="KhongHopLe",n[n.ChuaXuLy=2]="ChuaXuLy",n))(oe||{});const gt=async()=>(await M.get("/scimagofields")).data,Br=async n=>(await M.post("/scimagofields",n)).data,Ur=async(n,t)=>(await M.put("/scimagofields/".concat(n),t)).data,zr=async n=>(await M.delete("/scimagofields/".concat(n))).data,pt=async n=>(await M.get("/scimagofields/work-type/".concat(n))).data;function Nn(){var g,w,d,C,j,u,v,L,q,W,S,c;const n=ne({queryKey:["workTypes"],queryFn:He}),t=ne({queryKey:["workLevels"],queryFn:ht}),s=ne({queryKey:["authorRoles"],queryFn:ct}),o=ne({queryKey:["purposes"],queryFn:ut}),h=ne({queryKey:["scimagoFields"],queryFn:gt}),p=ne({queryKey:["fields"],queryFn:sn}),f=n.isLoading||t.isLoading||s.isLoading||o.isLoading||h.isLoading||p.isLoading,T=((g=n.data)==null?void 0:g.data)&&((w=t.data)==null?void 0:w.data)&&((d=s.data)==null?void 0:d.data)&&((C=o.data)==null?void 0:C.data)&&((j=h.data)==null?void 0:j.data)&&((u=p.data)==null?void 0:u.data);return{workTypes:((v=n.data)==null?void 0:v.data)||[],workLevels:((L=t.data)==null?void 0:L.data)||[],authorRoles:((q=s.data)==null?void 0:q.data)||[],purposes:((W=o.data)==null?void 0:W.data)||[],scimagoFields:((S=h.data)==null?void 0:S.data)||[],fields:((c=p.data)==null?void 0:c.data)||[],isLoading:f,isDataReady:T}}function xt({userId:n,worksData:t,refetchWorks:s,isAuthorPage:o=!1}){const h=ye(),[p,f]=l.useState(null),[T,g]=l.useState(!1),[w,d]=l.useState(!1),[C,j]=l.useState(!1),[u,v]=l.useState(oe.ChuaXuLy),[L,q]=l.useState(""),[W,S]=l.useState(0),c=xe({mutationFn:N=>o?Mr(N.workId,N.data):Kr(N.workId,N.userId,N.data),onSuccess:N=>{console.log("Dữ liệu trả về từ API:",N),console.log("Cập nhật thành công, đang invalidate queries"),o?h.invalidateQueries({queryKey:["works","my-works"]}):n&&h.invalidateQueries({queryKey:["works","user",n]})},onError:N=>{A.error("Lỗi khi cập nhật công trình: "+N.message)}}),H=xe({mutationFn:N=>Rr(N),onSuccess:()=>{A.success("Đã thêm công trình mới thành công"),h.invalidateQueries({queryKey:["works","my-works"]}),g(!1),s&&setTimeout(()=>{s()},100)},onError:N=>{A.error("Lỗi khi thêm công trình mới: "+N.message)}});return{selectedWork:p,openUpdateDialog:T,openStatusDialog:w,openNoteDialog:C,newStatus:u,newNote:L,activeTab:W,updateWorkMutation:c,createWorkMutation:H,handleOpenUpdateDialog:N=>{if(N){const O=localStorage.getItem("userId")||"",_=N.authors&&N.authors.length>0?{authorRoleId:N.authors[0].authorRoleId,purposeId:N.authors[0].purposeId,position:N.authors[0].position||1,scoreLevel:N.authors[0].scoreLevel,scImagoFieldId:N.authors[0].scImagoFieldId||"",fieldId:N.authors[0].fieldId||"",proofStatus:N.authors[0].proofStatus,note:N.authors[0].note||""}:N.author||{authorRoleId:"",purposeId:"",position:1,scoreLevel:void 0,scImagoFieldId:"",fieldId:"",proofStatus:oe.ChuaXuLy,note:""},K={...N,details:N.details||{},totalAuthors:N.totalAuthors||1,totalMainAuthors:N.totalMainAuthors||1,author:_,coAuthorUserIds:Array.isArray(N.coAuthorUserIds)?N.coAuthorUserIds.filter(E=>E.toString()!==O).map(E=>E.toString()):[]};f(K)}else f(null);S(0),g(!0)},handleCloseUpdateDialog:()=>{f(null),g(!1)},handleOpenStatusDialog:N=>{f(N),N.authors&&N.authors.length>0&&v(N.authors[0].proofStatus||oe.ChuaXuLy),d(!0)},handleCloseStatusDialog:()=>{f(null),d(!1)},handleOpenNoteDialog:N=>{f(N),N.authors&&N.authors.length>0&&q(N.authors[0].note||""),j(!0)},handleCloseNoteDialog:()=>{f(null),q(""),j(!1)},handleStatusChange:N=>{v(N)},handleNoteChange:N=>{q(N)},handleStatusSubmit:()=>{if(p&&p.authors&&p.authors.length>0&&n){console.log("Cập nhật trạng thái:",u);const N={workRequest:null,authorRequest:{proofStatus:u}};c.mutate({workId:p.id,userId:n,data:N},{onSuccess:O=>{var _;if(O.data&&t){const K=((_=t==null?void 0:t.data)==null?void 0:_.map(E=>E.id===O.data.id?O.data:E))||[];t&&(t.data=K),A.success("Cập nhật trạng thái thành công"),d(!1),s&&s()}}})}},handleNoteSubmit:()=>{if(p&&p.authors&&p.authors.length>0&&n){console.log("Cập nhật ghi chú:",L);const N=p.authors[0].proofStatus,O={workRequest:null,authorRequest:{note:L,proofStatus:N}};c.mutate({workId:p.id,userId:n,data:O},{onSuccess:_=>{var K;if(_.data&&t){const E=((K=t==null?void 0:t.data)==null?void 0:K.map(Q=>Q.id===_.data.id?_.data:Q))||[];t&&(t.data=E),A.success("Cập nhật ghi chú thành công"),j(!1),s&&s()}}})}},handleUpdateSubmit:N=>{var je;let O;if(N.timePublished)try{O=new Date(N.timePublished).toISOString().split("T")[0]}catch($){console.error("Lỗi khi chuyển đổi ngày tháng:",$)}const _=N.author.sCImagoFieldId||N.author.scImagoFieldId,K=Array.isArray(N.coAuthorUserIds)?N.coAuthorUserIds.filter($=>$):[],E=N.author.authorRoleId===""?null:N.author.authorRoleId,Q={workRequest:{title:(je=N.title)==null?void 0:je.trim(),timePublished:O,totalAuthors:N.totalAuthors?Number(N.totalAuthors):void 0,totalMainAuthors:N.totalMainAuthors?Number(N.totalMainAuthors):void 0,source:Number(N.source),workTypeId:N.workTypeId,workLevelId:N.workLevelId||null,details:N.details||{},coAuthorUserIds:K},authorRequest:{authorRoleId:E,purposeId:N.author.purposeId,position:N.author.position?parseInt(String(N.author.position)):void 0,scoreLevel:N.author.scoreLevel?Number(N.author.scoreLevel):null,scImagoFieldId:_||null,fieldId:N.author.fieldId||null,proofStatus:N.author.proofStatus,note:N.author.note}};if(p&&p.id)c.mutate({workId:p.id,userId:n||"",data:Q},{onSuccess:$=>{var le;if($.data&&t){const G=((le=t==null?void 0:t.data)==null?void 0:le.map(ee=>ee.id===$.data.id?$.data:ee))||[];t&&(t.data=G),A.success("Cập nhật công trình thành công"),g(!1),s&&s()}}});else if(o){const $={title:Q.workRequest.title,timePublished:Q.workRequest.timePublished,totalAuthors:Q.workRequest.totalAuthors,totalMainAuthors:Q.workRequest.totalMainAuthors,source:Q.workRequest.source,workTypeId:Q.workRequest.workTypeId,workLevelId:Q.workRequest.workLevelId,details:Q.workRequest.details,coAuthorUserIds:Q.workRequest.coAuthorUserIds,author:{authorRoleId:Q.authorRequest.authorRoleId,purposeId:Q.authorRequest.purposeId,position:Q.authorRequest.position,scoreLevel:Q.authorRequest.scoreLevel,scImagoFieldId:Q.authorRequest.scImagoFieldId,fieldId:Q.authorRequest.fieldId}};H.mutate($)}},setActiveTab:S}}const Vr=async(n,t,s,o)=>{try{const h=new URLSearchParams;return h.append("workTypeId",n),t&&h.append("workLevelId",t),s&&h.append("authorRoleId",s),o&&h.append("purposeId",o),(await M.get("/scorelevels?".concat(h.toString()))).data.data}catch(h){return console.error("Lỗi khi lấy danh sách score levels:",h),[]}};var Ae=(n=>(n[n.QuanLyNhap=0]="QuanLyNhap",n[n.NguoiDungKeKhai=1]="NguoiDungKeKhai",n))(Ae||{});const Or={"bài báo khoa học":{WoS:[{key:"Tên tạp chí khoa học",label:"Tên tạp chí khoa học",required:!0},{key:"Tên tạp chí khoa học",label:"Tên tạp chí khoa học",required:!0},{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!1},{key:"Số trang",label:"Số trang",required:!1},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!1},{key:"Cơ quản xuất bản",label:"Cơ quan xuất bản",required:!1},{key:"Loại WoS",label:"Loại WoS",required:!0},{key:"Xếp hạng tạp chí",label:"Xếp hạng tạp chí",required:!1}],Scopus:[{key:"Tên tạp chí khoa học",label:"Tên tạp chí khoa học",required:!0},{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!1},{key:"Số trang",label:"Số trang",required:!1},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!1},{key:"Cơ quản xuất bản",label:"Cơ quan xuất bản",required:!1},{key:"Xếp hạng tạp chí",label:"Xếp hạng tạp chí",required:!1}],default:[{key:"Tên tạp chí khoa học",label:"Tên tạp chí khoa học",required:!0},{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!1},{key:"Số trang",label:"Số trang",required:!1},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!1},{key:"Cơ quản xuất bản",label:"Cơ quan xuất bản",required:!1}]},"báo cáo khoa học":{WoS:[{key:"Tên ấn phẩm",label:"Tên ấn phẩm",required:!0},{key:"Tên ấn phẩm",label:"Tên ấn phẩm",required:!0},{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!1},{key:"Số trang",label:"Số trang",required:!1},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!1},{key:"Cơ quản xuất bản",label:"Cơ quan xuất bản",required:!1},{key:"Loại WoS",label:"Loại WoS",required:!0},{key:"Xếp hạng tạp chí",label:"Xếp hạng tạp chí",required:!1}],Scopus:[{key:"Tên ấn phẩm",label:"Tên ấn phẩm",required:!0},{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!1},{key:"Số trang",label:"Số trang",required:!1},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!1},{key:"Cơ quản xuất bản",label:"Cơ quan xuất bản",required:!1},{key:"Xếp hạng tạp chí",label:"Xếp hạng tạp chí",required:!1}],default:[{key:"Tên ấn phẩm",label:"Tên ấn phẩm",required:!0},{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!1},{key:"Số trang",label:"Số trang",required:!1},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!1},{key:"Cơ quản xuất bản",label:"Cơ quan xuất bản",required:!1}]},"đề tài":{default:[{key:"Mã số đề tài",label:"Mã số đề tài",required:!0},{key:"Sản phẩm thuộc đề tài",label:"Sản phẩm thuộc đề tài",required:!0},{key:"Xếp loại",label:"Xếp loại",required:!1}]},"giáo trình":{default:[{key:"Mã số giáo trình",label:"Mã số giáo trình",required:!0},{key:"Xếp loại",label:"Xếp loại",required:!1}]},"tài liệu giảng dạy":{default:[{key:"Mã số tài liệu",label:"Mã số tài liệu",required:!0},{key:"Xếp loại",label:"Xếp loại",required:!1}]},"hội thảo, hội nghị":{default:[{key:"Chi tiết",label:"Chi tiết",required:!0}]},"hướng dẫn sv nckh":{default:[{key:"Mã số đề tài của sinh viên",label:"Mã số đề tài của sinh viên",required:!0}]},"chương sách":{default:[{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quan xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Dạng tài liệu",label:"Dạng tài liệu",required:!0}]},"chuyên khảo":{default:[{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quan xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Dạng tài liệu",label:"Dạng tài liệu",required:!0}]},"giáo trình - sách":{default:[{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quan xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Dạng tài liệu",label:"Dạng tài liệu",required:!0}]},"tài liệu hướng dẫn":{default:[{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quan xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Dạng tài liệu",label:"Dạng tài liệu",required:!0}]},"tham khảo":{default:[{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quan xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Dạng tài liệu",label:"Dạng tài liệu",required:!0}]},khác:{default:[{key:"Chi tiết",label:"Chi tiết",required:!0}]}},Gr=Ne({title:Y().min(2,"Tên công trình phải có ít nhất 2 ký tự"),timePublished:Kn().optional().nullable(),totalAuthors:Mn.number().min(1,"Số tác giả phải lớn hơn 0").optional().nullable(),totalMainAuthors:Mn.number().min(1,"Số tác giả chính phải lớn hơn 0").optional().nullable(),details:Kn().optional(),source:Xe(),workTypeId:Y().uuid("ID loại công trình không hợp lệ"),workLevelId:Y().uuid("ID cấp độ công trình không hợp lệ").optional().nullable(),coAuthorUserIds:Vt(Y().uuid("ID đồng tác giả không hợp lệ")).optional().default([]),author:Ne({authorRoleId:Y().uuid("ID vai trò tác giả không hợp lệ").optional().nullable(),purposeId:Y().uuid("ID mục đích không hợp lệ"),position:Xe().min(1,"Vị trí tác giả phải lớn hơn 0").optional().nullable(),scoreLevel:Xe().min(0,"Mức điểm không hợp lệ").optional().nullable(),sCImagoFieldId:Y().uuid("ID lĩnh vực SCImago không hợp lệ").optional().nullable(),fieldId:Y().uuid("ID lĩnh vực không hợp lệ").optional().nullable()})});function Qr({initialData:n,onSubmit:t,isLoading:s,workTypes:o,fields:h,activeTab:p,setActiveTab:f}){var qn,Ln,Pn,An,Wn,Dn,Fn,Rn;const[T,g]=l.useState(""),[w,d]=l.useState([]),[C,j]=l.useState({}),[u,v]=l.useState(!1),[L,q]=l.useState([]),{user:W}=Re(),S=W==null?void 0:W.id,{control:c,handleSubmit:H,formState:{errors:m},reset:b,setValue:r,watch:a}=Se({resolver:qe(Gr),mode:"onSubmit",defaultValues:n?{...n,timePublished:n.timePublished?new Date(n.timePublished):null,details:n.details||{},source:n.source,coAuthorUserIds:((qn=n.coAuthorUserIds)==null?void 0:qn.filter(R=>R.toString()!==S))||[],author:{authorRoleId:((Ln=n.author)==null?void 0:Ln.authorRoleId)||null,purposeId:((Pn=n.author)==null?void 0:Pn.purposeId)||"",position:((An=n.author)==null?void 0:An.position)||1,scoreLevel:(Dn=(Wn=n.author)==null?void 0:Wn.scoreLevel)!=null?Dn:null,sCImagoFieldId:((Fn=n.author)==null?void 0:Fn.scImagoFieldId)||null,fieldId:((Rn=n.author)==null?void 0:Rn.fieldId)||null}}:{title:"",timePublished:null,totalAuthors:null,totalMainAuthors:null,details:{},source:Ae.NguoiDungKeKhai,workTypeId:"",workLevelId:null,coAuthorUserIds:[],author:{authorRoleId:null,purposeId:"",position:1,scoreLevel:null,sCImagoFieldId:null,fieldId:null}}}),{workTypes:y,workLevels:x}=Nn(),I=a("workTypeId"),i=a("workLevelId"),D=a("author.authorRoleId"),V=a("author.purposeId");l.useEffect(()=>{n!=null&&n.details?j(n.details):j({})},[n]);const fe=l.useMemo(()=>{var R;return(R=y.find(X=>X.id===I))==null?void 0:R.name},[I,y]),N=l.useMemo(()=>{var R;return(R=x.find(X=>X.id===i))==null?void 0:R.name},[i,x]),O=l.useMemo(()=>{if(!fe)return[];const R=Or[fe.toLowerCase()];return R?R[N]||R.default:[]},[fe,N]),_=(R,X)=>{const se={...C,[R]:X};j(se),r("details",se)},{data:K}=ne({queryKey:["workLevels",I],queryFn:()=>Tn(I),enabled:!!I}),{data:E}=ne({queryKey:["authorRoles",I],queryFn:()=>In(I),enabled:!!I}),{data:Q}=ne({queryKey:["purposes",I],queryFn:()=>Sn(I),enabled:!!I}),{data:je}=ne({queryKey:["scimagoFields",I],queryFn:()=>pt(I),enabled:!!I}),{data:$,isLoading:le}=ne({queryKey:["searchUsers",T],queryFn:async()=>{const R=await js(T);return console.log("Kết quả tìm kiếm người dùng:",R),R},enabled:T.length>0}),G=l.useMemo(()=>$!=null&&$.data?$.data.filter(R=>R.id!==S):[],[$==null?void 0:$.data,S]);l.useEffect(()=>{var R,X,se,re,ie,ge,we,pe;n&&(console.log("initialData đã thay đổi:",n),console.log("coAuthorUserIds:",n.coAuthorUserIds),b({...n,timePublished:n.timePublished?new Date(n.timePublished):null,details:n.details||{},source:n.source,coAuthorUserIds:((R=n.coAuthorUserIds)==null?void 0:R.filter(Ke=>Ke.toString()!==S))||[],author:{authorRoleId:((X=n.author)==null?void 0:X.authorRoleId)||null,purposeId:((se=n.author)==null?void 0:se.purposeId)||"",position:((re=n.author)==null?void 0:re.position)||1,scoreLevel:(ge=(ie=n.author)==null?void 0:ie.scoreLevel)!=null?ge:null,sCImagoFieldId:((we=n.author)==null?void 0:we.scImagoFieldId)||null,fieldId:((pe=n.author)==null?void 0:pe.fieldId)||null}}),(async()=>{if(n.coAuthorUserIds&&n.coAuthorUserIds.length>0){v(!0);try{const Ke=[];for(const Hn of n.coAuthorUserIds)if(Hn.toString()!==S){const pn=await Ye(Hn);pn.success&&pn.data&&Ke.push(pn.data)}d(Ke)}catch(Ke){console.error("Lỗi khi tải dữ liệu đồng tác giả:",Ke)}finally{v(!1)}}else d([])})())},[n,b,S]),l.useEffect(()=>{if(!I){q([]);return}(async()=>{try{const X=await Vr(I,i||void 0,D||void 0,V||void 0);console.log("Đã lấy được danh sách mức điểm:",X),q(X),X.length===0&&r("author.scoreLevel",null)}catch(X){console.error("Lỗi khi lấy danh sách mức điểm:",X),q([]),r("author.scoreLevel",null)}})()},[I,i,D,V,r]);const[ee,ae]=l.useState(!0);l.useEffect(()=>{I&&(K!=null&&K.data&&Array.isArray(K.data)?(ae(K.data.length>0),K.data.length===0&&r("workLevelId",null)):ae(!0))},[I,K,r]),l.useEffect(()=>{I&&!n&&(r("workLevelId",null),r("author.authorRoleId",null),r("author.purposeId",""),r("author.sCImagoFieldId",null))},[I,r,n]),l.useEffect(()=>{if(!w)return;console.log("Cập nhật coAuthorUserIds với:",w);const R=w.map(X=>X.id);console.log("Danh sách ID đồng tác giả cập nhật:",R),r("coAuthorUserIds",R,{shouldValidate:!0})},[w,r]),l.useEffect(()=>{const R=a("totalAuthors"),X=a("totalMainAuthors");R!==null&&typeof R=="string"&&r("totalAuthors",Number(R)),X!==null&&typeof X=="string"&&r("totalMainAuthors",Number(X))},[a,r]),l.useEffect(()=>{if(n!=null&&n.details)try{j(n.details)}catch(R){console.error("Lỗi khi parse details:",R),j({})}else j({})},[n]);const Le=(R,X)=>{console.log("Đã chọn đồng tác giả:",X);const se=X.filter(ie=>ie.id!==S);d(se);const re=se.map(ie=>ie.id);console.log("Danh sách ID đồng tác giả cập nhật:",re),r("coAuthorUserIds",re,{shouldValidate:!0})},wt=R=>{console.warn("Validation failed:",R);const X=["title","timePublished","totalAuthors","totalMainAuthors","workTypeId","workLevelId","coAuthorUserIds","details"],se=["author"],re=Object.keys(R).some(ge=>X.includes(ge)),ie=Object.keys(R).some(ge=>se.includes(ge));re&&p!==0?(alert("Có lỗi ở tab Thông tin công trình. Vui lòng kiểm tra lại."),f(0)):ie&&p!==1&&(alert("Có lỗi ở tab Tác giả. Vui lòng kiểm tra lại."),f(1))};return e.jsx("form",{onSubmit:H(t,wt),children:e.jsxs(U,{container:!0,spacing:2,children:[p===0&&e.jsxs(e.Fragment,{children:[e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"title",control:c,render:({field:R})=>{var X,se;return e.jsx(B,{...R,label:"Tên công trình",fullWidth:!0,error:!!m.title,helperText:(se=(X=m.title)==null?void 0:X.message)==null?void 0:se.toString(),disabled:n==null?void 0:n.isLocked})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"timePublished",control:c,render:({field:R})=>{var X,se;return e.jsx(Ot,{dateAdapter:Gt,adapterLocale:vn,children:e.jsx(Qt,{label:"Thời gian xuất bản",value:R.value?new Date(R.value):null,onChange:re=>R.onChange(re),disabled:n==null?void 0:n.isLocked,slotProps:{textField:{fullWidth:!0,error:!!m.timePublished,helperText:(se=(X=m.timePublished)==null?void 0:X.message)==null?void 0:se.toString()}}})})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"workTypeId",control:c,render:({field:R})=>{var X,se;return e.jsx(B,{...R,select:!0,label:"Loại công trình",fullWidth:!0,error:!!m.workTypeId,helperText:(se=(X=m.workTypeId)==null?void 0:X.message)==null?void 0:se.toString(),disabled:n==null?void 0:n.isLocked,children:o.map(re=>e.jsx(F,{value:re.id,children:re.name},re.id))})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"workLevelId",control:c,render:({field:R})=>{var X,se,re;return e.jsx(B,{...R,select:!0,label:"Cấp công trình",fullWidth:!0,error:!!m.workLevelId,helperText:(se=(X=m.workLevelId)==null?void 0:X.message)==null?void 0:se.toString(),disabled:!I||!ee||(n==null?void 0:n.isLocked),children:(re=K==null?void 0:K.data)==null?void 0:re.map(ie=>e.jsx(F,{value:ie.id,children:ie.name},ie.id))})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"totalAuthors",control:c,render:({field:{value:R,onChange:X,onBlur:se,...re}})=>{var ie,ge;return e.jsx(B,{...re,label:"Tổng số tác giả",type:"number",inputProps:{min:1,step:1},fullWidth:!0,error:!!m.totalAuthors,helperText:(ge=(ie=m.totalAuthors)==null?void 0:ie.message)==null?void 0:ge.toString(),value:R===null?"":R,onChange:we=>{const pe=we.target.value;X(pe===""?null:Number(pe))},onBlur:se,disabled:n==null?void 0:n.isLocked})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"totalMainAuthors",control:c,render:({field:{value:R,onChange:X,onBlur:se,...re}})=>{var ie,ge;return e.jsx(B,{...re,label:"Số tác giả chính",type:"number",inputProps:{min:1,step:1},fullWidth:!0,error:!!m.totalMainAuthors,helperText:(ge=(ie=m.totalMainAuthors)==null?void 0:ie.message)==null?void 0:ge.toString(),value:R===null?"":R,onChange:we=>{const pe=we.target.value;X(pe===""?null:Number(pe))},onBlur:se,disabled:n==null?void 0:n.isLocked})}})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"coAuthorUserIds",control:c,render:()=>e.jsx($t,{multiple:!0,id:"coAuthorUserIds",options:G,getOptionLabel:R=>typeof R=="string"?R:"".concat(R.fullName," - ").concat(R.userName).concat(R.departmentName?" - ".concat(R.departmentName):""),isOptionEqualToValue:(R,X)=>R.id===X.id,value:w,onChange:Le,loading:le||u,disabled:n==null?void 0:n.isLocked,renderTags:(R,X)=>R.map((se,re)=>{const ie=X({index:re});return e.jsx(Ue,{...ie,label:"".concat(se.fullName," - ").concat(se.userName).concat(se.departmentName?" - ".concat(se.departmentName):""),size:"medium"})}),renderInput:R=>{var X;return e.jsx(B,{...R,label:"Đồng tác giả",variant:"outlined",onChange:se=>g(se.target.value),placeholder:"Tìm kiếm đồng tác giả",error:!!m.coAuthorUserIds,helperText:((X=m.coAuthorUserIds)==null?void 0:X.message)||"Thêm các đồng tác giả (không bao gồm bạn)",InputProps:{...R.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[le||u?e.jsx(J,{color:"inherit",size:20}):null,R.InputProps.endAdornment]})}})}})})}),O.length>0&&e.jsx(U,{item:!0,xs:12,children:e.jsx(U,{container:!0,spacing:2,children:O.map(R=>e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(B,{label:R.label,fullWidth:!0,value:C[R.key]||"",onChange:X=>_(R.key,X.target.value),required:R.required,error:R.required&&(!C[R.key]||C[R.key].trim()===""),helperText:R.required&&(!C[R.key]||C[R.key].trim()==="")?"Trường này là bắt buộc":"",disabled:n==null?void 0:n.isLocked})},R.key))})})]}),p===1&&e.jsxs(e.Fragment,{children:[e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"author.authorRoleId",control:c,render:({field:{value:R,onChange:X,...se}})=>{var re,ie,ge,we,pe;return e.jsxs(B,{...se,select:!0,label:"Vai trò tác giả",fullWidth:!0,error:!!((re=m.author)!=null&&re.authorRoleId),helperText:(we=(ge=(ie=m.author)==null?void 0:ie.authorRoleId)==null?void 0:ge.message)==null?void 0:we.toString(),disabled:!I,value:R!=null?R:"",onChange:Ie=>{const Ke=Ie.target.value===""?null:Ie.target.value;X(Ke)},children:[e.jsx(F,{value:"",children:"Chọn vai trò tác giả"}),(pe=E==null?void 0:E.data)==null?void 0:pe.map(Ie=>e.jsx(F,{value:Ie.id,children:Ie.name},Ie.id))]})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"author.purposeId",control:c,render:({field:R})=>{var X,se,re,ie,ge;return e.jsx(B,{...R,select:!0,label:"Mục đích quy đổi",fullWidth:!0,error:!!((X=m.author)!=null&&X.purposeId),helperText:(ie=(re=(se=m.author)==null?void 0:se.purposeId)==null?void 0:re.message)==null?void 0:ie.toString(),disabled:!I,children:(ge=Q==null?void 0:Q.data)==null?void 0:ge.map(we=>e.jsx(F,{value:we.id,children:we.name},we.id))})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"author.position",control:c,render:({field:{value:R,onChange:X,...se}})=>{var re,ie,ge,we;return e.jsx(B,{...se,label:"Vị trí tác giả",type:"number",fullWidth:!0,error:!!((re=m.author)!=null&&re.position),helperText:(we=(ge=(ie=m.author)==null?void 0:ie.position)==null?void 0:ge.message)==null?void 0:we.toString(),value:R===null?"":R,onChange:pe=>{const Ie=pe.target.value;X(Ie===""?null:Number(Ie))}})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"author.scoreLevel",control:c,render:({field:{value:R,onChange:X,...se}})=>{var re,ie,ge,we;return e.jsxs(B,{...se,select:!0,label:"Mức điểm",fullWidth:!0,error:!!((re=m.author)!=null&&re.scoreLevel),helperText:(we=(ge=(ie=m.author)==null?void 0:ie.scoreLevel)==null?void 0:ge.message)==null?void 0:we.toString(),disabled:L.length===0,value:R!=null?R:"",onChange:pe=>{const Ie=pe.target.value===""?null:Number(pe.target.value);X(Ie)},children:[e.jsx(F,{value:"",children:"Chọn mức điểm"}),L.map(pe=>e.jsx(F,{value:pe,children:dt(pe)},pe))]})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"author.sCImagoFieldId",control:c,render:({field:{value:R,onChange:X,...se}})=>{var re,ie,ge,we,pe;return e.jsxs(B,{...se,select:!0,label:"Ngành SCImago",fullWidth:!0,error:!!((re=m.author)!=null&&re.sCImagoFieldId),helperText:(we=(ge=(ie=m.author)==null?void 0:ie.sCImagoFieldId)==null?void 0:ge.message)==null?void 0:we.toString(),disabled:!I,value:R!=null?R:"",onChange:Ie=>{const Ke=Ie.target.value===""?null:Ie.target.value;X(Ke)},children:[e.jsx(F,{value:"",children:"Chọn ngành SCImago"}),(pe=je==null?void 0:je.data)==null?void 0:pe.map(Ie=>e.jsx(F,{value:Ie.id,children:Ie.name},Ie.id))]})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"author.fieldId",control:c,render:({field:{value:R,onChange:X,...se}})=>{var re,ie,ge,we;return e.jsxs(B,{...se,select:!0,label:"Ngành tính điểm",fullWidth:!0,error:!!((re=m.author)!=null&&re.fieldId),helperText:(we=(ge=(ie=m.author)==null?void 0:ie.fieldId)==null?void 0:ge.message)==null?void 0:we.toString(),value:R!=null?R:"",onChange:pe=>{const Ie=pe.target.value===""?null:pe.target.value;X(Ie)},disabled:!1,children:[e.jsx(F,{value:"",children:"Chọn ngành tính điểm"}),h.map(pe=>e.jsx(F,{value:pe.id,children:pe.name},pe.id))]})}})})]}),e.jsx(U,{item:!0,xs:12,sx:{mt:2},children:e.jsx(k,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:s,children:s?e.jsx(J,{size:24}):n?"Cập nhật":"Thêm mới"})})]})})}function ft({open:n,onClose:t,selectedWork:s,activeTab:o,setActiveTab:h,onSubmit:p,isPending:f,workTypes:T,workLevels:g,authorRoles:w,purposes:d,scimagoFields:C,fields:j}){var W;const{user:u}=Re(),v=(W=s==null?void 0:s.authors)==null?void 0:W.find(S=>S.userId===(u==null?void 0:u.id)),L=v==null?void 0:v.proofStatus,q=s==null?void 0:s.isLocked;return l.useEffect(()=>{q&&L!==0&&h(1)},[q,L,h]),e.jsxs(de,{open:n,onClose:t,fullWidth:!0,maxWidth:"md",children:[e.jsx(he,{children:s?"Cập nhật công trình":"Thêm công trình mới"}),e.jsxs(ue,{children:[e.jsx(z,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(Xt,{value:o,onChange:(S,c)=>{q&&L!==0&&c===0||h(c)},children:[e.jsx(En,{label:"Thông tin công trình",disabled:q&&L!==0,sx:{color:q&&L!==0?"text.disabled":"inherit","&.Mui-disabled":{color:"text.disabled"}}}),e.jsx(En,{label:"Thông tin tác giả"})]})}),T.length>0?e.jsx(Qr,{initialData:s,onSubmit:p,isLoading:f,workTypes:T,workLevels:g,authorRoles:w,purposes:d,scimagoFields:C,fields:j,activeTab:o,setActiveTab:h}):e.jsx(z,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(J,{})})]}),e.jsx(me,{children:e.jsx(k,{onClick:t,color:"inherit",children:"Đóng"})})]})}const $r=async()=>(await M.get("/systemConfigs/check")).data,Xr=async n=>(await M.get("/systemConfigs/year/".concat(n))).data,Yr=async n=>(await M.post("/systemConfigs",n)).data,_r=async(n,t)=>(await M.post("/systemConfigs/notify/".concat(t),n)).data,Zr=async(n,t)=>(await M.put("/systemConfigs/".concat(n),t)).data,Jr=async n=>(await M.delete("/systemConfigs/".concat(n))).data;function ei(){const{data:n,isLoading:t}=ne({queryKey:["systemConfig"],queryFn:$r}),s=n==null?void 0:n.data,o=l.useMemo(()=>{if(!s)return!1;const f=Me.now().setZone("Asia/Saigon"),T=Me.fromISO(s.openTime,{zone:"utc"}).setZone("Asia/Saigon"),g=Me.fromISO(s.closeTime,{zone:"utc"}).setZone("Asia/Saigon");return f>=T&&f<=g},[s]);return{systemConfig:s,isLoading:t,isSystemOpen:o,canEditWork:(f,T)=>T||o?f!==0:f===1,canDeleteWork:(f,T,g=!1)=>g?!1:T||o?f!==0:f===1}}const on=async()=>(await M.get("/academicYears")).data,ln=async()=>(await M.get("/academicYears/current")).data,ni=async n=>(await M.post("/academicYears",n)).data,ti=async(n,t)=>(await M.put("/academicYears/".concat(n),t)).data,si=async n=>(await M.delete("/academicYears/".concat(n))).data;function ri(){var fe,N;const n=ye(),[t,s]=l.useState({}),{user:o}=Re(),{isSystemOpen:h,canEditWork:p,canDeleteWork:f}=ei(),{data:T}=ne({queryKey:["current-academic-year"],queryFn:ln}),{data:g,error:w,isPending:d,refetch:C}=ne({queryKey:["works","my-works"],queryFn:async()=>{var _;const O={academicYearId:(_=T==null?void 0:T.data)==null?void 0:_.id,isCurrentUser:!0};return an(O)},enabled:!!((fe=T==null?void 0:T.data)!=null&&fe.id),staleTime:0}),j=Nn(),{selectedWork:u,openUpdateDialog:v,activeTab:L,createWorkMutation:q,updateWorkMutation:W,handleOpenUpdateDialog:S,handleCloseUpdateDialog:c,handleUpdateSubmit:H,setActiveTab:m}=xt({userId:(N=o==null?void 0:o.id)!=null?N:"",worksData:g,refetchWorks:C,isAuthorPage:!0});l.useEffect(()=>{g!=null&&g.data&&g.data.length>0&&(async()=>{const _={};for(const K of g.data)if(K.coAuthorUserIds&&K.coAuthorUserIds.length>0){const E=[];for(const Q of K.coAuthorUserIds)try{const je=await Ye(Q);je.success&&je.data&&E.push(je.data)}catch(je){console.error("Lỗi khi lấy thông tin đồng tác giả:",je)}_[K.id]=E}s(_)})()},[g]),l.useEffect(()=>{g&&g.message&&A.success(g.message,{toastId:"fetch-works-success"})},[g]),l.useEffect(()=>{w&&A.error("Có lỗi đã xảy ra: "+w.message,{toastId:"fetch-works-error"})},[w]);const[b,r]=l.useState(!1),[a,y]=l.useState(null),x=O=>{y(O),r(!0)},I=()=>{y(null),r(!1)},i=xe({mutationFn:O=>Hr(O),onSuccess:()=>{A.success("Xóa công trình thành công!"),n.invalidateQueries({queryKey:["works","my-works"]}),setTimeout(()=>{C()},100),r(!1)},onError:O=>{A.error("Lỗi khi xóa công trình: "+O.message)}}),D=async()=>{if(a)try{await i.mutateAsync(a)}catch(O){}},V=[{field:"stt",headerName:"STT",width:70,renderCell:O=>{const K=O.api.getAllRowIds().indexOf(O.id);return e.jsx("div",{children:K+1})}},{field:"title",headerName:"Tên công trình",type:"string",width:250},{field:"timePublished",headerName:"Thời gian xuất bản",type:"string",width:150,renderCell:O=>O.value?e.jsx("div",{children:mt(O.value)}):e.jsx("div",{children:"-"})},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:170},{field:"workLevelName",headerName:"Cấp công trình",type:"string",width:150},{field:"details",headerName:"Thông tin chi tiết",type:"string",width:300,renderCell:O=>{if(!O.row.details)return e.jsx("div",{children:"-"});const _=O.row.details,K=Object.entries(_).map(([E,Q])=>"".concat(E,": ").concat(String(Q))).join("\n");return e.jsx(De,{title:e.jsx("div",{style:{whiteSpace:"pre-line",fontSize:"0.8rem"},children:K}),arrow:!0,children:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%"},children:Object.entries(_).map(([E,Q],je)=>e.jsxs("span",{children:[je>0&&"; ",e.jsx("b",{children:E}),": ",String(Q)]},je))})})}},{field:"totalAuthors",headerName:"Số tác giả",type:"number",width:140,align:"center",headerAlign:"left"},{field:"totalMainAuthors",headerName:"Số tác giả chính",type:"number",width:140,align:"center",headerAlign:"left"},{field:"coAuthors",headerName:"Đồng tác giả",type:"string",width:140,renderCell:O=>{const _=O.row.id,K=t[_]||[];if(K.length===0)return e.jsx("div",{children:"-"});const E="".concat(K.length," tác giả");return e.jsx(De,{title:e.jsxs("div",{children:[e.jsx(P,{variant:"subtitle2",children:"Danh sách đồng tác giả:"}),K.map((Q,je)=>e.jsxs(P,{variant:"body2",children:["• ",Q.fullName," - ",Q.userName," - ",Q.departmentName||"Chưa có phòng ban"]},je))]}),children:e.jsx("div",{children:E})})}},{field:"authorRoleName",headerName:"Vai trò tác giả",type:"string",width:150,renderCell:O=>{var E;const K=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(o==null?void 0:o.id));return e.jsx("div",{children:K?K.authorRoleName:"-"})}},{field:"position",headerName:"Vị trí",type:"string",width:80,renderCell:O=>{var E;const K=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(o==null?void 0:o.id));return e.jsx("div",{children:(K==null?void 0:K.position)!==void 0&&(K==null?void 0:K.position)!==null?K.position:"-"})}},{field:"purposeName",headerName:"Mục đích quy đổi",type:"string",width:180,renderCell:O=>{var E;const K=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(o==null?void 0:o.id));return e.jsx("div",{children:K?K.purposeName:"-"})}},{field:"fieldName",headerName:"Ngành tính điểm",type:"string",width:150,renderCell:O=>{var E;const K=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(o==null?void 0:o.id));return e.jsx("div",{children:K?K.fieldName:"-"})}},{field:"scImagoFieldName",headerName:"Ngành SCImago",type:"string",width:180,renderCell:O=>{var E;const K=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(o==null?void 0:o.id));return e.jsx("div",{children:K?K.scImagoFieldName:"-"})}},{field:"scoreLevel",headerName:"Mức điểm",type:"string",width:150,renderCell:O=>{var E;const K=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(o==null?void 0:o.id));return!K||K.scoreLevel===void 0||K.scoreLevel===null?e.jsx("div",{children:"-"}):e.jsx("div",{children:rn(K.scoreLevel)})}},{field:"workHour",headerName:"Giờ công trình",type:"string",width:120,renderCell:O=>{var E;const K=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(o==null?void 0:o.id));return e.jsx("div",{children:(K==null?void 0:K.workHour)!==void 0&&(K==null?void 0:K.workHour)!==null?K.workHour:"-"})}},{field:"authorHour",headerName:"Giờ tác giả",type:"string",width:120,renderCell:O=>{var E;const K=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(o==null?void 0:o.id));return e.jsx("div",{children:(K==null?void 0:K.authorHour)!==void 0&&(K==null?void 0:K.authorHour)!==null?K.authorHour:"-"})}},{field:"note",headerName:"Ghi chú",type:"string",width:150,renderCell:O=>{var Q;const K=(Q=O.row.authors)==null?void 0:Q.find(je=>je.userId===(o==null?void 0:o.id)),E=(K==null?void 0:K.note)||"";return E?e.jsx(De,{title:e.jsx("div",{style:{whiteSpace:"pre-line",fontSize:"0.8rem"},children:E}),arrow:!0,children:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%"},children:E})}):e.jsx("div",{children:"-"})}},{field:"proofStatus",headerName:"Trạng thái",type:"string",width:140,renderCell:O=>{var Q;const K=(Q=O.row.authors)==null?void 0:Q.find(je=>je.userId===(o==null?void 0:o.id)),E=K==null?void 0:K.proofStatus;return E==null?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"}):E===oe.HopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(_e,{color:"success"}),"Hợp lệ"]}):E===oe.KhongHopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Ze,{color:"error"}),"Không hợp lệ"]}):E===oe.ChuaXuLy?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(en,{color:"action"}),"Chưa xử lý"]}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"})}},{field:"actions",headerName:"Thao tác",width:200,renderCell:O=>{var le,G;const _=O.row,K=(le=_.authors)==null?void 0:le.find(ee=>ee.userId===(o==null?void 0:o.id)),E=K==null?void 0:K.proofStatus,Q=_.isLocked,je=(G=_.authors)==null?void 0:G.some(ee=>ee.userId!==(o==null?void 0:o.id)&&ee.proofStatus===0);if(Q&&E===0)return e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>S(_),disabled:!0,sx:{mr:1},children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>x(_.id),disabled:!0,children:"Xóa"})]});if(Q)return e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>S(_),disabled:!1,sx:{mr:1},children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>x(_.id),disabled:!f(E,Q,je),children:"Xóa"})]});const $=p(E,Q);return e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>S(_),disabled:!$,sx:{mr:1},children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>x(_.id),disabled:!f(E,Q,je),children:"Xóa"})]})}}];return d?e.jsx(J,{}):w?e.jsxs("p",{children:["Lỗi: ",w.message]}):e.jsxs(ze,{maxWidth:"xl",children:[e.jsxs(z,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(P,{variant:"h6",children:"Danh sách công trình"}),e.jsx(z,{sx:{display:"flex",gap:2},children:e.jsx(k,{variant:"contained",color:"primary",onClick:()=>S(void 0),startIcon:e.jsx(Yt,{}),disabled:!h,children:"Thêm công trình"})})]}),d?e.jsx(z,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(J,{})}):e.jsx(Te,{columns:V,data:g.data||[]}),e.jsx(ft,{open:v,onClose:c,selectedWork:u,activeTab:L,setActiveTab:m,onSubmit:H,isPending:q.isPending||W.isPending,workTypes:j.workTypes,workLevels:j.workLevels,authorRoles:j.authorRoles,purposes:j.purposes,scimagoFields:j.scimagoFields,fields:j.fields}),e.jsxs(de,{open:b,onClose:I,children:[e.jsx(he,{children:"Xác nhận xóa"}),e.jsx(ue,{children:e.jsx(P,{children:"Bạn có chắc chắn muốn xóa công trình này không?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:I,color:"inherit",children:"Hủy"}),e.jsx(k,{onClick:D,color:"error",variant:"contained",disabled:i.isPending,children:i.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const cn=Xn.create({baseURL:"/api",headers:{"Content-Type":"application/json"},timeout:3e4});cn.interceptors.request.use(n=>{const t=localStorage.getItem("token");return t&&(n.headers.Authorization="Bearer ".concat(t)),n},n=>Promise.reject(n));const ii=async n=>{const t=new URLSearchParams;return n.userId&&t.append("userId",n.userId),n.departmentId&&t.append("departmentId",n.departmentId),n.academicYearId&&t.append("academicYearId",n.academicYearId),n.proofStatus!==void 0&&t.append("proofStatus",n.proofStatus.toString()),n.source!==void 0&&t.append("source",n.source.toString()),t.append("onlyRegisteredWorks",n.onlyRegisteredWorks.toString()),t.append("onlyRegisterableWorks",n.onlyRegisterableWorks.toString()),t.append("isCurrentUser",n.isCurrentUser.toString()),console.log("Gọi API với params:",t.toString()),(await cn.get("/works/filter?".concat(t.toString()))).data},ai=async()=>(await cn.get("/works/my-works")).data,oi=async n=>{console.log("Gọi API getWorkById:",n);const t=await cn.get("/works/".concat(n));return console.log("Response from getWorkById:",t.data),t.data},li=async()=>(await cn.get("/works/all-my-works")).data,ci=()=>{var x,I;const[n,t]=l.useState(!1),[s,o]=l.useState(null),[h,p]=l.useState([]),[f,T]=l.useState([]),[g,w]=l.useState([]),[d,C]=l.useState(null),[j,u]=l.useState(null),[v,L]=l.useState({userId:"",departmentId:"",academicYearId:"",proofStatus:void 0,source:void 0,onlyRegisteredWorks:!1,onlyRegisterableWorks:!1,isCurrentUser:!0});l.useEffect(()=>{(async()=>{try{const[D,V]=await Promise.all([on(),Ge()]);T(D.data||[]),w(V.data||[])}catch(D){o("Lỗi khi tải dữ liệu ban đầu"),console.error("Error fetching initial data:",D)}})()},[]);const q=i=>{const{name:D,value:V}=i.target;L(fe=>({...fe,[D]:V}))},W=i=>{const{name:D,checked:V}=i.target;L(fe=>({...fe,[D]:V}))},S=i=>{const{name:D,value:V}=i.target;L(D==="proofStatus"||D==="source"?fe=>({...fe,[D]:V===""?void 0:Number(V)}):fe=>({...fe,[D]:V}))},c=async()=>{var i;t(!0),o(null),u(null);try{const D=await ii(v);p(D.data||[]),u(JSON.stringify({success:D.success,message:D.message,count:((i=D.data)==null?void 0:i.length)||0},null,2))}catch(D){console.error("Error fetching works:",D),o("Lỗi khi tải danh sách công trình")}finally{t(!1)}},H=async()=>{var i;t(!0),o(null),u(null);try{const D=await ai();p(D.data||[]),u(JSON.stringify({success:D.success,message:D.message,count:((i=D.data)==null?void 0:i.length)||0},null,2))}catch(D){console.error("Error fetching my works:",D),o("Lỗi khi tải danh sách công trình của tôi")}finally{t(!1)}},m=async()=>{var i;t(!0),o(null),u(null);try{const D=await li();p(D.data||[]),u(JSON.stringify({success:D.success,message:D.message,count:((i=D.data)==null?void 0:i.length)||0},null,2))}catch(D){console.error("Error fetching all my works:",D),o("Lỗi khi tải tất cả công trình của tôi")}finally{t(!1)}},b=async i=>{var D,V,fe,N,O;t(!0),o(null),u(null);try{const _=await oi(i);C(_.data),u(JSON.stringify({success:_.success,message:_.message,data:{id:(D=_.data)==null?void 0:D.id,title:(V=_.data)==null?void 0:V.title,authorsCount:((N=(fe=_.data)==null?void 0:fe.authors)==null?void 0:N.length)||0,coAuthorUserIds:((O=_.data)==null?void 0:O.coAuthorUserIds)||[]}},null,2))}catch(_){console.error("Error fetching work details:",_),o("Lỗi khi tải chi tiết công trình")}finally{t(!1)}},r=i=>i?new Date(i).toLocaleDateString("vi-VN"):"N/A",a=i=>{if(i===void 0)return"Không xác định";switch(i){case oe.ChuaXuLy:return"Chưa xử lý";case oe.HopLe:return"Hợp lệ";case oe.KhongHopLe:return"Không hợp lệ";default:return"Không xác định"}},y=i=>{if(i===void 0)return"Không xác định";switch(i){case Ae.NguoiDungKeKhai:return"Người dùng kê khai";case Ae.QuanLyNhap:return"Quản lý nhập";default:return"Không xác định"}};return e.jsxs(ze,{maxWidth:"xl",sx:{mt:4,mb:4},children:[e.jsx(P,{variant:"h4",gutterBottom:!0,children:"Kiểm thử API Works Controller"}),e.jsx(z,{mb:4,children:e.jsx(Fe,{severity:"info",children:"Trang này sử dụng để kiểm thử các API của WorksController. Nếu bạn đã đăng nhập với token hợp lệ, các API sẽ tự động sử dụng thông tin người dùng hiện tại."})}),e.jsxs(U,{container:!0,spacing:3,children:[e.jsx(U,{item:!0,xs:12,md:4,children:e.jsxs(ve,{sx:{p:2,height:"100%"},children:[e.jsx(P,{variant:"h6",gutterBottom:!0,children:"Bộ lọc"}),e.jsx(Ve,{control:e.jsx(Oe,{checked:v.isCurrentUser,onChange:W,name:"isCurrentUser"}),label:"Sử dụng người dùng hiện tại"}),!v.isCurrentUser&&e.jsx(B,{fullWidth:!0,margin:"normal",label:"User ID",name:"userId",value:v.userId||"",onChange:q,size:"small",disabled:v.isCurrentUser}),e.jsxs(ce,{fullWidth:!0,margin:"normal",size:"small",children:[e.jsx(Ce,{children:"Khoa/Phòng ban"}),e.jsxs(ke,{name:"departmentId",value:v.departmentId||"",onChange:S,label:"Khoa/Phòng ban",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),g.map(i=>e.jsx(F,{value:i.id,children:i.name},i.id))]})]}),e.jsxs(ce,{fullWidth:!0,margin:"normal",size:"small",children:[e.jsx(Ce,{children:"Năm học"}),e.jsxs(ke,{name:"academicYearId",value:v.academicYearId||"",onChange:S,label:"Năm học",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),f.map(i=>e.jsx(F,{value:i.id,children:i.name},i.id))]})]}),e.jsxs(ce,{fullWidth:!0,margin:"normal",size:"small",children:[e.jsx(Ce,{children:"Trạng thái minh chứng"}),e.jsxs(ke,{name:"proofStatus",value:v.proofStatus!==void 0?v.proofStatus:"",onChange:S,label:"Trạng thái minh chứng",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),e.jsx(F,{value:oe.ChuaXuLy,children:"Chưa xử lý"}),e.jsx(F,{value:oe.HopLe,children:"Hợp lệ"}),e.jsx(F,{value:oe.KhongHopLe,children:"Không hợp lệ"})]})]}),e.jsxs(ce,{fullWidth:!0,margin:"normal",size:"small",children:[e.jsx(Ce,{children:"Nguồn"}),e.jsxs(ke,{name:"source",value:v.source!==void 0?v.source:"",onChange:S,label:"Nguồn",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),e.jsx(F,{value:Ae.NguoiDungKeKhai,children:"Người dùng kê khai"}),e.jsx(F,{value:Ae.QuanLyNhap,children:"Quản lý nhập"})]})]}),e.jsx(Ve,{control:e.jsx(Oe,{checked:v.onlyRegisteredWorks,onChange:W,name:"onlyRegisteredWorks"}),label:"Chỉ lấy công trình đăng ký quy đổi"}),e.jsx(Ve,{control:e.jsx(Oe,{checked:v.onlyRegisterableWorks,onChange:W,name:"onlyRegisterableWorks"}),label:"Chỉ lấy công trình có thể đăng ký quy đổi"}),e.jsxs(z,{mt:3,children:[e.jsx(k,{variant:"contained",color:"primary",fullWidth:!0,onClick:c,disabled:n,children:n?e.jsx(J,{size:24}):"Tìm kiếm theo bộ lọc"}),e.jsxs(z,{display:"flex",mt:2,gap:2,children:[e.jsx(k,{variant:"outlined",color:"primary",onClick:H,disabled:n,fullWidth:!0,children:"Lấy công trình của tôi"}),e.jsx(k,{variant:"outlined",color:"secondary",onClick:m,disabled:n,fullWidth:!0,children:"Tất cả công trình"})]})]})]})}),e.jsxs(U,{item:!0,xs:12,md:8,children:[e.jsxs(ve,{sx:{p:2,mb:3},children:[e.jsxs(P,{variant:"h6",gutterBottom:!0,display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs("span",{children:["Kết quả (",h.length," công trình)"]}),n&&e.jsx(J,{size:24})]}),s&&e.jsx(Fe,{severity:"error",sx:{mb:2},children:s}),j&&e.jsx(Fe,{severity:"success",sx:{mb:2},children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",margin:0},children:j})}),h.length===0&&!n?e.jsx(Fe,{severity:"info",children:"Không có công trình nào được tìm thấy. Vui lòng thay đổi bộ lọc hoặc thử lại."}):e.jsx(_t,{children:e.jsxs(Zt,{size:"small",children:[e.jsx(Jt,{children:e.jsxs(Bn,{children:[e.jsx(Pe,{children:"STT"}),e.jsx(Pe,{children:"Tiêu đề"}),e.jsx(Pe,{children:"Loại công trình"}),e.jsx(Pe,{children:"Năm học"}),e.jsx(Pe,{children:"Nguồn"}),e.jsx(Pe,{children:"Đồng tác giả"}),e.jsx(Pe,{children:"Thao tác"})]})}),e.jsx(es,{children:h.map((i,D)=>{var V;return e.jsxs(Bn,{hover:!0,children:[e.jsx(Pe,{children:D+1}),e.jsx(Pe,{children:i.title}),e.jsx(Pe,{children:i.workTypeName||"N/A"}),e.jsx(Pe,{children:i.academicYearName||"N/A"}),e.jsx(Pe,{children:y(i.source)}),e.jsx(Pe,{children:((V=i.coAuthorUserIds)==null?void 0:V.length)||0}),e.jsx(Pe,{children:e.jsx(k,{size:"small",onClick:()=>b(i.id),children:"Chi tiết"})})]},i.id)})})]})})]}),d&&e.jsxs(ve,{sx:{p:2},children:[e.jsx(P,{variant:"h6",gutterBottom:!0,children:"Chi tiết công trình"}),e.jsxs(U,{container:!0,spacing:2,children:[e.jsx(U,{item:!0,xs:12,children:e.jsx(P,{variant:"h5",children:d.title})}),e.jsxs(U,{item:!0,xs:12,sm:6,children:[e.jsx(P,{variant:"subtitle2",children:"Loại công trình:"}),e.jsx(P,{variant:"body2",children:d.workTypeName||"N/A"})]}),e.jsxs(U,{item:!0,xs:12,sm:6,children:[e.jsx(P,{variant:"subtitle2",children:"Cấp công trình:"}),e.jsx(P,{variant:"body2",children:d.workLevelName||"N/A"})]}),e.jsxs(U,{item:!0,xs:12,sm:6,children:[e.jsx(P,{variant:"subtitle2",children:"Năm học:"}),e.jsx(P,{variant:"body2",children:d.academicYearName||"N/A"})]}),e.jsxs(U,{item:!0,xs:12,sm:6,children:[e.jsx(P,{variant:"subtitle2",children:"Ngày xuất bản:"}),e.jsx(P,{variant:"body2",children:r(d.timePublished)})]}),e.jsxs(U,{item:!0,xs:12,sm:6,children:[e.jsx(P,{variant:"subtitle2",children:"Nguồn:"}),e.jsx(P,{variant:"body2",children:y(d.source)})]}),e.jsxs(U,{item:!0,xs:12,sm:6,children:[e.jsx(P,{variant:"subtitle2",children:"Ngày tạo:"}),e.jsx(P,{variant:"body2",children:r(d.createdDate)})]}),e.jsxs(U,{item:!0,xs:12,children:[e.jsx(Ee,{sx:{my:2}}),e.jsx(P,{variant:"subtitle1",fontWeight:"bold",children:"Thông tin tác giả và đồng tác giả"})]}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(dn,{variant:"outlined",children:e.jsxs(Un,{children:[e.jsxs(P,{variant:"subtitle2",gutterBottom:!0,children:["Đồng tác giả (",((x=d.coAuthorUserIds)==null?void 0:x.length)||0,"):"]}),d.coAuthorUserIds&&d.coAuthorUserIds.length>0?e.jsx(zn,{dense:!0,children:d.coAuthorUserIds.map((i,D)=>e.jsx(Vn,{divider:D<d.coAuthorUserIds.length-1,children:e.jsx(On,{primary:"Đồng tác giả ".concat(D+1),secondary:i})},i))}):e.jsx(P,{variant:"body2",color:"text.secondary",children:"Không có đồng tác giả"})]})})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(dn,{variant:"outlined",children:e.jsxs(Un,{children:[e.jsxs(P,{variant:"subtitle2",gutterBottom:!0,children:["Tác giả (",((I=d.authors)==null?void 0:I.length)||0,"):"]}),d.authors&&d.authors.length>0?e.jsx(zn,{dense:!0,children:d.authors.map((i,D)=>{var V;return e.jsxs(Vn,{divider:D<d.authors.length-1,children:[e.jsx(On,{primary:i.authorRoleName||"Chưa có tên vai trò",secondary:"UserId: ".concat(i.userId||"N/A",", Trạng thái: ").concat(a(i.proofStatus))}),((V=i.authorRoleName)==null?void 0:V.includes("Chính"))&&e.jsx(Ue,{size:"small",color:"primary",label:"Tác giả chính"})]},i.id)})}):e.jsx(P,{variant:"body2",color:"text.secondary",children:"Không có thông tin tác giả"})]})})})]}),e.jsx(z,{mt:2,children:e.jsx(k,{variant:"outlined",onClick:()=>C(null),children:"Đóng chi tiết"})})]})]})]}),e.jsx(ns,{open:!!s,autoHideDuration:6e3,onClose:()=>o(null),message:s})]})},di=Ne({name:Y().min(2,"Tên mục đích quy đổi phải có ít nhất 2 ký tự"),workTypeId:Y().uuid("Vui lòng chọn loại công trình")});function hi({open:n,handleClose:t,data:s}){var v,L,q;const o=ye(),{data:h,isLoading:p}=ne({queryKey:["workTypes"],queryFn:He}),{register:f,handleSubmit:T,setValue:g,reset:w,formState:{errors:d,isSubmitting:C}}=Se({resolver:qe(di),defaultValues:{name:"",workTypeId:""}});l.useEffect(()=>{s?(g("name",s.name),g("workTypeId",s.workTypeId||"")):w()},[s,n,g,w]);const j=xe({mutationFn:async W=>s!=null&&s.id?Nr(s.id,W):Sr(W),onSuccess:()=>{o.invalidateQueries({queryKey:["purposes"]}),A.success(s!=null&&s.id?"Mục đích quy đổi đã được cập nhật":"Mục đích quy đổi đã được thêm"),t()},onError:W=>{console.error("API Error:",W),A.error("Đã xảy ra lỗi: "+W.message)}}),u=async W=>{await j.mutateAsync(W)};return e.jsxs(de,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[e.jsx(he,{children:s?"Cập nhật Mục đích quy đổi":"Thêm Mục đích quy đổi"}),e.jsxs(ue,{children:[e.jsx(B,{label:"Tên mục đích quy đổi",...f("name"),error:!!d.name,helperText:(v=d.name)==null?void 0:v.message,fullWidth:!0,margin:"dense",disabled:C}),e.jsx(B,{select:!0,label:"Loại công trình",...f("workTypeId"),error:!!d.workTypeId,helperText:(L=d.workTypeId)==null?void 0:L.message,fullWidth:!0,margin:"dense",disabled:C||p,children:p?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(q=h==null?void 0:h.data)==null?void 0:q.map(W=>e.jsx(F,{value:W.id,children:W.name},W.id))})]}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,disabled:C,children:"Hủy"}),e.jsx(k,{onClick:T(u),variant:"contained",color:"primary",disabled:C||p,children:C?e.jsx(J,{size:24}):s?"Cập nhật":"Thêm mới"})]})]})}function ui(){var I;const n=ye(),[t,s]=l.useState(""),{data:o,isLoading:h}=ne({queryKey:["workTypes"],queryFn:He}),{data:p,error:f,isPending:T,isSuccess:g,dataUpdatedAt:w}=ne({queryKey:["purposes",t],queryFn:()=>t?Sn(t):ut()});l.useEffect(()=>{g&&p&&A.success(p.message,{toastId:"fetch-purposes-success"})},[w,g,p]),l.useEffect(()=>{f&&A.error("Có lỗi đã xảy ra: "+f.message)},[f]);const d=i=>{s(i.target.value)},[C,j]=l.useState(!1),[u,v]=l.useState(null),L=i=>{v(i),j(!0)},q=()=>j(!1),W=i=>{L(i)},[S,c]=l.useState(!1),[H,m]=l.useState(null),b=i=>{m(i),c(!0)},r=()=>{m(null),c(!1)},a=xe({mutationFn:i=>qr(i),onSuccess:()=>{A.success("Xóa mục đích quy đổi thành công!"),n.invalidateQueries({queryKey:["purposes"]}),c(!1)},onError:i=>{A.error("Lỗi khi xóa: "+i.message)}}),y=()=>{H&&a.mutate(H)},x=[{field:"stt",headerName:"STT",width:70,renderCell:i=>{const D=Array.from(i.api.getAllRowIds()).findIndex(V=>V===i.row.id);return e.jsx("div",{children:D+1})}},{field:"name",headerName:"Tên mục đích quy đổi",type:"string",width:400},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:400},{field:"actions",headerName:"Thao tác",width:200,renderCell:i=>e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>W(i.row),sx:{marginRight:1},disabled:a.isPending,children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>b(i.row.id),disabled:a.isPending,children:"Xóa"})]})}];return T&&h?e.jsx(J,{}):f?e.jsxs("p",{children:["Lỗi: ",f.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:2},children:[e.jsx(P,{variant:"h4",children:"Quản lý mục đích quy đổi"}),e.jsxs(z,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(ce,{sx:{minWidth:220},children:[e.jsx(Ce,{id:"work-type-filter-label",children:"Lọc theo loại công trình"}),e.jsxs(ke,{labelId:"work-type-filter-label",id:"work-type-filter",value:t,onChange:d,label:"Lọc theo loại công trình",children:[e.jsx(F,{value:"",children:"Tất cả"}),(I=o==null?void 0:o.data)==null?void 0:I.map(i=>e.jsx(F,{value:i.id,children:i.name},i.id))]})]}),e.jsx(k,{variant:"contained",onClick:()=>L(null),children:"Thêm mục đích quy đổi"})]})]}),e.jsx(ve,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(Te,{columns:x,data:(p==null?void 0:p.data)||[]})}),e.jsx(hi,{open:C,handleClose:q,data:u}),e.jsxs(de,{open:S,onClose:r,children:[e.jsx(he,{children:"Xác nhận xóa"}),e.jsx(ue,{children:e.jsx(P,{children:"Bạn có chắc chắn muốn xóa mục đích quy đổi này?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:r,disabled:a.isPending,children:"Hủy"}),e.jsx(k,{onClick:y,color:"error",variant:"contained",disabled:a.isPending,children:a.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const mi=Ne({name:Y().min(2,"Tên ngành SCImago phải có ít nhất 2 ký tự"),workTypeId:Y().uuid("Vui lòng chọn loại công trình")});function gi({open:n,handleClose:t,data:s}){var v,L,q;const o=ye(),{data:h,isLoading:p}=ne({queryKey:["workTypes"],queryFn:He}),{register:f,handleSubmit:T,setValue:g,reset:w,formState:{errors:d,isSubmitting:C}}=Se({resolver:qe(mi),defaultValues:{name:"",workTypeId:""}});l.useEffect(()=>{s?(g("name",s.name),g("workTypeId",s.workTypeId||"")):w()},[s,n,g,w]);const j=xe({mutationFn:async W=>s!=null&&s.id?Ur(s.id,W):Br(W),onSuccess:()=>{o.invalidateQueries({queryKey:["scimagoFields"]}),A.success(s!=null&&s.id?"Ngành SCImago đã được cập nhật":"Ngành SCImago đã được thêm"),t()},onError:W=>{console.error("API Error:",W),A.error("Đã xảy ra lỗi: "+W.message)}}),u=async W=>{await j.mutateAsync(W)};return e.jsxs(de,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[e.jsx(he,{children:s?"Cập nhật Ngành SCImago":"Thêm Ngành SCImago"}),e.jsxs(ue,{children:[e.jsx(B,{label:"Tên ngành SCImago",...f("name"),error:!!d.name,helperText:(v=d.name)==null?void 0:v.message,fullWidth:!0,margin:"dense",disabled:C}),e.jsx(B,{select:!0,label:"Loại công trình",...f("workTypeId"),error:!!d.workTypeId,helperText:(L=d.workTypeId)==null?void 0:L.message,fullWidth:!0,margin:"dense",disabled:C||p,children:p?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(q=h==null?void 0:h.data)==null?void 0:q.map(W=>e.jsx(F,{value:W.id,children:W.name},W.id))})]}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,disabled:C,children:"Hủy"}),e.jsx(k,{onClick:T(u),variant:"contained",color:"primary",disabled:C||p,children:C?e.jsx(J,{size:24}):s?"Cập nhật":"Thêm mới"})]})]})}function pi(){var I;const n=ye(),[t,s]=l.useState(""),{data:o,isLoading:h}=ne({queryKey:["workTypes"],queryFn:He}),{data:p,error:f,isPending:T,isSuccess:g,dataUpdatedAt:w}=ne({queryKey:["scimagoFields",t],queryFn:()=>t?pt(t):gt()});l.useEffect(()=>{g&&p&&A.success(p.message,{toastId:"fetch-scimago-fields-success"})},[w,g,p]),l.useEffect(()=>{f&&A.error("Có lỗi đã xảy ra: "+f.message)},[f]);const d=i=>{s(i.target.value)},[C,j]=l.useState(!1),[u,v]=l.useState(null),L=i=>{v(i),j(!0)},q=()=>j(!1),W=i=>{L(i)},[S,c]=l.useState(!1),[H,m]=l.useState(null),b=i=>{m(i),c(!0)},r=()=>{m(null),c(!1)},a=xe({mutationFn:i=>zr(i),onSuccess:()=>{A.success("Xóa ngành SCImago thành công!"),n.invalidateQueries({queryKey:["scimagoFields"]}),c(!1)},onError:i=>{A.error("Lỗi khi xóa: "+i.message)}}),y=()=>{H&&a.mutate(H)},x=[{field:"stt",headerName:"STT",width:70,renderCell:i=>{const D=Array.from(i.api.getAllRowIds()).findIndex(V=>V===i.row.id);return e.jsx("div",{children:D+1})}},{field:"name",headerName:"Tên ngành SCImago",type:"string",width:400},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:400},{field:"actions",headerName:"Thao tác",width:200,renderCell:i=>e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>W(i.row),sx:{marginRight:1},disabled:a.isPending,children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>b(i.row.id),disabled:a.isPending,children:"Xóa"})]})}];return T&&h?e.jsx(J,{}):f?e.jsxs("p",{children:["Lỗi: ",f.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:2},children:[e.jsx(P,{variant:"h4",children:"Quản lý ngành SCImago"}),e.jsxs(z,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(ce,{sx:{minWidth:220},children:[e.jsx(Ce,{id:"work-type-filter-label",children:"Lọc theo loại công trình"}),e.jsxs(ke,{labelId:"work-type-filter-label",id:"work-type-filter",value:t,onChange:d,label:"Lọc theo loại công trình",children:[e.jsx(F,{value:"",children:"Tất cả"}),(I=o==null?void 0:o.data)==null?void 0:I.map(i=>e.jsx(F,{value:i.id,children:i.name},i.id))]})]}),e.jsx(k,{variant:"contained",onClick:()=>L(null),children:"Thêm ngành SCImago"})]})]}),e.jsx(ve,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(Te,{columns:x,data:(p==null?void 0:p.data)||[]})}),e.jsx(gi,{open:C,handleClose:q,data:u}),e.jsxs(de,{open:S,onClose:r,children:[e.jsx(he,{children:"Xác nhận xóa"}),e.jsx(ue,{children:e.jsx(P,{children:"Bạn có chắc chắn muốn xóa ngành SCImago này?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:r,disabled:a.isPending,children:"Hủy"}),e.jsx(k,{onClick:y,color:"error",variant:"contained",disabled:a.isPending,children:a.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const xi=Ne({name:Y().min(2,"Tên cấp công trình phải có ít nhất 2 ký tự"),workTypeId:Y().uuid("Vui lòng chọn loại công trình")});function fi({open:n,handleClose:t,data:s}){const o=ye(),{data:h,isLoading:p}=ne({queryKey:["workTypes"],queryFn:He}),{control:f,handleSubmit:T,setValue:g,reset:w,formState:{errors:d}}=Se({resolver:qe(xi),defaultValues:{name:"",workTypeId:""}});l.useEffect(()=>{s?(g("name",s.name),g("workTypeId",s.workTypeId)):w()},[s,g,w]);const C=xe({mutationFn:async u=>s!=null&&s.id?Ir(s.id,u):vr(u),onSuccess:()=>{o.invalidateQueries({queryKey:["workLevels"]}),A.success(s!=null&&s.id?"Cấp công trình đã được cập nhật":"Cấp công trình đã được thêm"),t()},onError:u=>{console.error("API Error:",u),A.error("Đã xảy ra lỗi: "+u.message)}}),j=async u=>{await C.mutateAsync(u)};return e.jsxs(de,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[e.jsx(he,{children:s?"Cập nhật cấp công trình":"Thêm cấp công trình"}),e.jsx(ue,{children:e.jsx("form",{onSubmit:T(j),children:e.jsxs(U,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"name",control:f,render:({field:u})=>{var v;return e.jsx(B,{...u,label:"Tên cấp công trình",error:!!d.name,helperText:(v=d.name)==null?void 0:v.message,fullWidth:!0,disabled:C.isPending})}})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"workTypeId",control:f,render:({field:u})=>{var v,L;return e.jsx(B,{...u,select:!0,label:"Loại công trình",error:!!d.workTypeId,helperText:(v=d.workTypeId)==null?void 0:v.message,fullWidth:!0,disabled:C.isPending||p,children:p?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(L=h==null?void 0:h.data)==null?void 0:L.map(q=>e.jsx(F,{value:q.id,children:q.name},q.id))})}})})]})})}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,disabled:C.isPending,children:"Hủy"}),e.jsx(k,{onClick:T(j),disabled:C.isPending,variant:"contained",color:"primary",children:C.isPending?e.jsx(J,{size:24}):s?"Cập nhật":"Thêm mới"})]})]})}function yi(){var I;const n=ye(),[t,s]=l.useState(""),{data:o,isLoading:h}=ne({queryKey:["workTypes"],queryFn:He}),{data:p,error:f,isPending:T,isSuccess:g,dataUpdatedAt:w}=ne({queryKey:["workLevels",t],queryFn:()=>t?Tn(t):ht()});l.useEffect(()=>{g&&p&&A.success(p.message,{toastId:"fetch-work-levels-success"})},[w,g,p]),l.useEffect(()=>{f&&A.error("Có lỗi đã xảy ra: "+f.message)},[f]);const d=i=>{s(i.target.value)},[C,j]=l.useState(!1),[u,v]=l.useState(null),L=i=>{v(i),j(!0)},q=()=>j(!1),W=i=>{L(i)},[S,c]=l.useState(!1),[H,m]=l.useState(null),b=i=>{m(i),c(!0)},r=()=>{m(null),c(!1)},a=xe({mutationFn:i=>Tr(i),onSuccess:()=>{A.success("Xóa cấp công trình thành công!"),n.invalidateQueries({queryKey:["workLevels"]}),c(!1)},onError:i=>{A.error("Lỗi khi xóa: "+i.message)}}),y=()=>{H&&a.mutate(H)},x=[{field:"stt",headerName:"STT",width:70,renderCell:i=>{const D=Array.from(i.api.getAllRowIds()).findIndex(V=>V===i.row.id);return e.jsx("div",{children:D+1})}},{field:"name",headerName:"Tên cấp công trình",type:"string",width:300},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:300},{field:"actions",headerName:"Thao tác",width:200,renderCell:i=>e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>W(i.row),sx:{marginRight:1},disabled:a.isPending,children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>b(i.row.id),disabled:a.isPending,children:"Xóa"})]})}];return T&&h?e.jsx(J,{}):f?e.jsxs("p",{children:["Lỗi: ",f.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:2},children:[e.jsx(P,{variant:"h4",children:"Quản lý cấp công trình"}),e.jsxs(z,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(ce,{sx:{minWidth:220},children:[e.jsx(Ce,{id:"work-type-filter-label",children:"Lọc theo loại công trình"}),e.jsxs(ke,{labelId:"work-type-filter-label",id:"work-type-filter",value:t,onChange:d,label:"Lọc theo loại công trình",children:[e.jsx(F,{value:"",children:"Tất cả"}),(I=o==null?void 0:o.data)==null?void 0:I.map(i=>e.jsx(F,{value:i.id,children:i.name},i.id))]})]}),e.jsx(k,{variant:"contained",onClick:()=>L(null),children:"Thêm cấp công trình"})]})]}),e.jsx(ve,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(Te,{columns:x,data:(p==null?void 0:p.data)||[]})}),e.jsx(fi,{open:C,handleClose:q,data:u}),e.jsxs(de,{open:S,onClose:r,children:[e.jsx(he,{children:"Xác nhận xóa"}),e.jsx(ue,{children:e.jsx(P,{children:"Bạn có chắc chắn muốn xóa cấp công trình này?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:r,disabled:a.isPending,children:"Hủy"}),e.jsx(k,{onClick:y,disabled:a.isPending,color:"error",variant:"contained",children:a.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const ji=Ne({name:Y().min(2,"Tên loại công trình phải có ít nhất 2 ký tự")});function wi({open:n,handleClose:t,data:s}){const o=ye(),{control:h,handleSubmit:p,setValue:f,reset:T,formState:{errors:g}}=Se({resolver:qe(ji),defaultValues:{name:""}});l.useEffect(()=>{s?f("name",s.name):T()},[s,f,T]);const w=xe({mutationFn:async C=>s!=null&&s.id?hr(s.id,C):dr(C),onSuccess:()=>{o.invalidateQueries({queryKey:["workTypes"]}),A.success(s!=null&&s.id?"Loại công trình đã được cập nhật":"Loại công trình đã được thêm"),t()},onError:C=>{console.error("API Error:",C),A.error("Đã xảy ra lỗi: "+C.message)}}),d=async C=>{await w.mutateAsync(C)};return e.jsxs(de,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[e.jsx(he,{children:s?"Cập nhật loại công trình":"Thêm loại công trình"}),e.jsx(ue,{children:e.jsxs(U,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"name",control:h,render:({field:C})=>{var j;return e.jsx(B,{...C,label:"Tên loại công trình",error:!!g.name,helperText:(j=g.name)==null?void 0:j.message,fullWidth:!0,disabled:w.isPending})}})}),s&&e.jsxs(U,{item:!0,xs:12,children:[e.jsx(P,{fontSize:12,fontStyle:"italic",sx:{fontWeight:"300"},children:"- Chỉnh sửa tên loại công trình chỉ ảnh hưởng đến tên hiển thị"}),e.jsx(P,{fontSize:12,fontStyle:"italic",sx:{fontWeight:"300"},children:"- Các cấp công trình, mục đích, và vai trò tác giả thuộc loại này không bị ảnh hưởng"})]})]})}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,disabled:w.isPending,children:"Hủy"}),e.jsx(k,{onClick:p(d),variant:"contained",color:"primary",disabled:w.isPending,children:w.isPending?e.jsx(J,{size:24}):s?"Cập nhật":"Thêm mới"})]})]})}function bi(){const n=ye(),{data:t,error:s,isPending:o,isSuccess:h,dataUpdatedAt:p}=ne({queryKey:["workTypes","details"],queryFn:async()=>{const x=await cr();return x!=null&&x.data&&(console.log("WorkTypes with details:",x.data),x.data.forEach(I=>{console.log("WorkType ".concat(I.name," has ").concat(I.scImagoFieldCount," Scimago fields:"),I.scImagoFields)})),x}});l.useEffect(()=>{h&&(t!=null&&t.message)&&A.success(t.message)},[p,h,t]),l.useEffect(()=>{s&&A.error("Có lỗi đã xảy ra: "+s.message)},[s]);const[f,T]=l.useState(!1),[g,w]=l.useState(null),d=x=>{w(x),T(!0)},C=()=>T(!1),j=x=>{d(x)},[u,v]=l.useState(!1),[L,q]=l.useState(null),W=x=>{q(x),v(!0)},S=()=>{q(null),v(!1)},c=xe({mutationFn:x=>ur(x),onSuccess:()=>{A.success("Xóa loại công trình thành công!"),n.invalidateQueries({queryKey:["workTypes"]}),v(!1)},onError:x=>{A.error("Lỗi khi xóa: "+x.message)}}),H=()=>{L&&c.mutate(L)},m=(x,I)=>"".concat(x," ").concat(I),b=x=>!x||x.length===0?"Không có cấp công trình nào":x.map(I=>I.name).join("; "),r=x=>!x||x.length===0?"Không có mục đích quy đổi nào":x.map(I=>I.name).join("; "),a=x=>!x||x.length===0?"Không có vai trò tác giả nào":x.map(I=>I.name).join("; "),y=[{field:"stt",headerName:"STT",width:70,renderCell:x=>{const I=Array.from(x.api.getAllRowIds()).findIndex(i=>i===x.row.id);return e.jsx("div",{children:I+1})}},{field:"name",headerName:"Tên loại công trình",type:"string",width:200},{field:"workLevelCount",headerName:"Cấp công trình",width:130,renderCell:x=>{const I=x.row.workLevelCount||0;return e.jsx(De,{title:b(x.row.workLevels),arrow:!0,children:e.jsx("span",{children:m(I,"cấp")})})}},{field:"purposeCount",headerName:"Mục đích quy đổi",width:150,renderCell:x=>{const I=x.row.purposeCount||0;return e.jsx(De,{title:r(x.row.purposes),arrow:!0,children:e.jsx("span",{children:m(I,"mục đích")})})}},{field:"authorRoleCount",headerName:"Vai trò tác giả",width:140,renderCell:x=>{const I=x.row.authorRoleCount||0;return e.jsx(De,{title:a(x.row.authorRoles),arrow:!0,children:e.jsx("span",{children:m(I,"vai trò")})})}},{field:"factorCount",headerName:"Hệ số quy đổi",width:140,renderCell:x=>{const I=x.row.factorCount||0;return e.jsx("span",{children:m(I,"hệ số")})}},{field:"scImagoFieldCount",headerName:"Ngành SCImago",width:140,renderCell:x=>{const I=x.row.scImagoFieldCount||0;return e.jsx("span",{children:m(I,"ngành")})}},{field:"actions",headerName:"Thao tác",width:200,renderCell:x=>e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>j(x.row),sx:{marginRight:1},disabled:c.isPending,children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>W(x.row.id),disabled:c.isPending,children:"Xóa"})]})}];return o?e.jsx(J,{}):s?e.jsxs("p",{children:["Error: ",s.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:2},children:[e.jsx(P,{variant:"h4",children:"Quản lý loại công trình"}),e.jsx(k,{variant:"contained",onClick:()=>d(null),children:"Thêm loại công trình"})]}),e.jsx(ve,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(Te,{columns:y,data:(t==null?void 0:t.data)||[]})}),e.jsx(wi,{open:f,handleClose:C,data:g}),e.jsxs(de,{open:u,onClose:S,children:[e.jsx(he,{children:"Xác nhận xóa"}),e.jsx(ue,{children:e.jsx(P,{children:"Bạn có chắc chắn muốn xóa loại công trình này?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:S,disabled:c.isPending,children:"Hủy"}),e.jsx(k,{onClick:H,color:"error",variant:"contained",disabled:c.isPending,children:c.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const Ci=async()=>(await M.get("/assignments")).data,ki=async n=>(await M.get("/assignments/user/".concat(n))).data,vi=async n=>(await M.post("/assignments",n)).data,Ii=async n=>(await M.put("/assignments",n)).data,Ti=async n=>(await M.delete("/assignments/user/".concat(n))).data;function Si({open:n,handleClose:t,manager:s,onSuccess:o}){const{control:h,handleSubmit:p,reset:f}=Se({defaultValues:{assignments:[]}}),{fields:T,append:g,remove:w}=ts({control:h,name:"assignments"}),[d,C]=l.useState([]),[j,u]=l.useState(!1),[v,L]=l.useState(!1);l.useEffect(()=>{if(n){u(!0);async function W(){try{const S=await Ge();C(S.data||[])}catch(S){A.error("Lỗi khi tải đơn vị: "+S.message)}try{const S=await ki(s.managerId);if(!S||!S.data||Array.isArray(S.data)&&S.data.length===0)f({assignments:[]}),L(!0);else{const c=S.data.map(H=>({departmentId:H.departmentId}));f({assignments:c}),L(!1)}}catch(S){f({assignments:[]}),L(!0)}u(!1)}W()}},[n,s.managerId,f]);const q=async W=>{const S=W.assignments.map(c=>c.departmentId).filter(Boolean);if(S.length===0){A.error("Vui lòng chọn ít nhất 1 đơn vị");return}try{v?(await vi({managerId:s.managerId,departmentIds:S}),A.success("Phân công thành công")):(await Ii({managerId:s.managerId,departmentIds:S}),A.success("Cập nhật phân công thành công")),o(),t()}catch(c){A.error("Lỗi khi lưu phân công: "+c.message)}};return e.jsxs(de,{open:n,onClose:t,fullWidth:!0,children:[e.jsx(he,{children:"Phân công cho quản lý"}),e.jsx(ue,{children:j?e.jsx(z,{sx:{display:"flex",justifyContent:"center",my:4},children:e.jsx(J,{})}):e.jsxs(e.Fragment,{children:[e.jsx(B,{label:"Họ và tên",value:s.managerFullName,fullWidth:!0,margin:"dense",disabled:!0}),e.jsx(B,{label:"Đơn vị công tác",value:s.managerDepartmentName,fullWidth:!0,margin:"dense",disabled:!0}),T.map((W,S)=>e.jsxs(z,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(Z,{control:h,name:"assignments.".concat(S,".departmentId"),defaultValue:W.departmentId,render:({field:c})=>e.jsxs(B,{select:!0,label:"Chọn đơn vị",value:c.value,onChange:c.onChange,fullWidth:!0,margin:"dense",children:[e.jsx(F,{value:"",children:"-- Chọn đơn vị --"}),d.map(H=>e.jsx(F,{value:H.id,children:H.name},H.id))]})}),e.jsx(Je,{onClick:()=>w(S),sx:{ml:1},"aria-label":"delete",children:e.jsx(ss,{})})]},W.id)),e.jsx(k,{onClick:()=>g({departmentId:""}),sx:{mt:2},variant:"outlined",disabled:j,children:"Thêm đơn vị"})]})}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,children:"Hủy"}),e.jsx(k,{onClick:p(q),variant:"contained",children:"Lưu"})]})]})}function Ni(){const n=ye(),{data:t,error:s,isPending:o,isSuccess:h,dataUpdatedAt:p,refetch:f}=ne({queryKey:["assignments"],queryFn:Ci});l.useEffect(()=>{h&&t&&A.success(t.message||"Lấy dữ liệu phân công thành công",{toastId:"fetch-assignments-success"})},[p,h,t]),l.useEffect(()=>{s&&A.error("Có lỗi xảy ra: "+s.message)},[s]);const T=t!=null&&t.data?qi(t.data):[],[g,w]=l.useState(!1),[d,C]=l.useState(null),[j,u]=l.useState(!1),[v,L]=l.useState(null),q=r=>{C(r),w(!0)},W=()=>{w(!1),C(null)},S=xe({mutationFn:r=>Ti(r),onSuccess:()=>{A.success("Đã bỏ phân công thành công"),n.invalidateQueries({queryKey:["assignments"]}),f()},onError:r=>{A.error("Có lỗi xảy ra khi bỏ phân công: "+r.message)}}),c=r=>{L(r),u(!0)},H=()=>{v&&(S.mutate(v),u(!1))},m=[{field:"managerFullName",headerName:"Họ và tên quản lý",width:200},{field:"managerDepartmentName",headerName:"Đơn vị công tác",width:200},{field:"assignedCount",headerName:"Số phân công",width:150},{field:"actions",headerName:"",width:300,renderCell:r=>e.jsxs(z,{children:[e.jsx(k,{variant:"contained",size:"small",onClick:()=>q(r.row),children:"Phân công"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>c(r.row.managerId),disabled:r.row.assignedCount===0,sx:{ml:1},children:"Bỏ phân công"})]})}];if(o)return e.jsx(J,{});if(s)return e.jsxs(P,{variant:"body1",children:["Error: ",s.message]});const b=T.map(r=>({id:r.managerId,...r}));return e.jsxs(e.Fragment,{children:[e.jsx(ve,{sx:{width:"100%",marginX:"auto",padding:2},children:e.jsx(Te,{columns:m,data:b})}),d&&e.jsx(Si,{open:g,handleClose:W,manager:d,onSuccess:()=>{n.invalidateQueries({queryKey:["assignments"]}),f()}}),e.jsxs(de,{open:j,onClose:()=>u(!1),children:[e.jsx(he,{children:"Xác nhận bỏ phân công"}),e.jsx(ue,{children:e.jsxs(P,{children:["Bạn có chắc chắn muốn bỏ ",e.jsx("strong",{children:"tất cả"})," phân công cho quản lý này?"]})}),e.jsxs(me,{children:[e.jsx(k,{onClick:()=>u(!1),children:"Hủy"}),e.jsx(k,{onClick:H,color:"error",variant:"contained",children:S.isPending?"Đang xóa...":"Xóa"})]})]})]})}function qi(n){const t=new Map;return n.forEach(s=>{const{managerId:o,managerFullName:h,managerDepartmentName:p,departmentId:f,assignedDepartmentName:T}=s;t.has(o)||t.set(o,{managerId:o,managerFullName:h,managerDepartmentName:p,assignedDepartments:[],assignedCount:0}),f!=="00000000-0000-0000-0000-000000000000"&&T!=="Chưa phân công"&&t.get(o).assignedDepartments.push({departmentId:f,assignedDepartmentName:T})}),Array.from(t.values()).map(s=>({...s,assignedCount:s.assignedDepartments.length}))}const Li=Ne({name:Y().min(2,"Tên năm học phải có ít nhất 2 ký tự"),startDate:Y(),endDate:Y()}).refine(n=>new Date(n.endDate)>new Date(n.startDate),{message:"Ngày kết thúc phải sau ngày bắt đầu",path:["endDate"]});function Pi({open:n,handleClose:t,data:s}){var j,u,v;const o=ye(),{register:h,handleSubmit:p,setValue:f,reset:T,formState:{errors:g,isSubmitting:w}}=Se({resolver:qe(Li),defaultValues:{name:"",startDate:"",endDate:""}});l.useEffect(()=>{s?(f("name",s.name),f("startDate",new Date(s.startDate).toISOString().split("T")[0]),f("endDate",new Date(s.endDate).toISOString().split("T")[0])):T()},[s,n,f,T]);const d=xe({mutationFn:async L=>s!=null&&s.id?ti(s.id,L):ni(L),onSuccess:()=>{o.invalidateQueries({queryKey:["academic-years"]}),A.success(s!=null&&s.id?"Cập nhật thành công":"Thêm mới thành công"),t()},onError:L=>{A.error("Lỗi khi lưu: "+L.message)}}),C=async L=>{await d.mutateAsync({name:L.name,startDate:L.startDate,endDate:L.endDate})};return e.jsxs(de,{open:n,onClose:t,children:[e.jsx(he,{children:s?"Cập nhật Năm Học":"Thêm Năm Học"}),e.jsxs(ue,{children:[e.jsx(B,{label:"Tên năm học",...h("name"),error:!!g.name,helperText:(j=g.name)==null?void 0:j.message,fullWidth:!0,margin:"dense"}),e.jsx(B,{label:"Ngày bắt đầu",type:"date",...h("startDate"),fullWidth:!0,margin:"dense",InputLabelProps:{shrink:!0},error:!!g.startDate,helperText:(u=g.startDate)==null?void 0:u.message}),e.jsx(B,{label:"Ngày kết thúc",type:"date",...h("endDate"),fullWidth:!0,margin:"dense",InputLabelProps:{shrink:!0},error:!!g.endDate,helperText:(v=g.endDate)==null?void 0:v.message})]}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,disabled:w,children:"Hủy"}),e.jsx(k,{onClick:p(C),variant:"contained",disabled:w,children:w?"Đang lưu...":"Lưu"})]})]})}function Ai(){const n=ye(),{data:t,error:s,isPending:o,isSuccess:h,dataUpdatedAt:p,refetch:f}=ne({queryKey:["academic-years"],queryFn:on});l.useEffect(()=>{h&&t&&A.success(t.message,{toastId:"fetch-academic-years-success"})},[p]),l.useEffect(()=>{s&&A.error("Có lỗi xảy ra: "+s.message)},[s]);const[T,g]=l.useState(!1),[w,d]=l.useState(null),C=b=>{d(b),g(!0)},j=()=>{g(!1),f()},[u,v]=l.useState(!1),[L,q]=l.useState(null),W=b=>{q(b),v(!0)},S=()=>{q(null),v(!1)},c=xe({mutationFn:b=>si(b),onSuccess:()=>{A.success("Xóa năm học thành công!"),n.invalidateQueries({queryKey:["academic-years"]}),v(!1),f()},onError:b=>{A.error("Lỗi khi xóa: "+b.message)}}),H=()=>{L&&c.mutate(L)},m=[{field:"name",headerName:"Tên năm học",width:200},{field:"startDate",headerName:"Bắt đầu",valueFormatter:b=>new Date(b).toLocaleDateString(),width:150},{field:"endDate",headerName:"Kết thúc",valueFormatter:b=>new Date(b).toLocaleDateString(),width:150},{field:"actions",headerName:"Hành động",width:300,renderCell:b=>e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>C(b.row),sx:{marginRight:1},children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>W(b.row.id),children:"Xóa"})]})}];return o?e.jsx(J,{}):s?e.jsxs("p",{children:["Error: ",s.message]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{display:"flex",justifyContent:"flex-end",mb:2,children:e.jsx(k,{variant:"contained",onClick:()=>C(null),children:"Thêm năm học"})}),e.jsx(ve,{sx:{width:1010,marginX:"auto"},children:e.jsx(Te,{columns:m,data:((t==null?void 0:t.data)||[]).slice().sort((b,r)=>r.name.localeCompare(b.name))})}),e.jsx(Pi,{open:T,handleClose:j,data:w}),e.jsxs(de,{open:u,onClose:S,children:[e.jsx(he,{children:"Xác nhận xóa"}),e.jsx(ue,{children:e.jsx(P,{children:"Bạn có chắc chắn muốn xóa năm học này?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:S,children:"Hủy"}),e.jsx(k,{onClick:H,color:"error",variant:"contained",children:c.isPending?"Đang xóa...":"Xóa"})]})]})]})}const Wi=n=>{const t=Me.now().setZone("Asia/Saigon"),s=Me.fromISO(n.openTime,{zone:"utc"}).setZone("Asia/Saigon"),o=Me.fromISO(n.closeTime,{zone:"utc"}).setZone("Asia/Saigon");return t>=s&&t<=o},Di=Qe.object({name:Qe.string().min(2,"Tên cấu hình là bắt buộc"),openTime:Qe.string().min(1,"Thời gian mở là bắt buộc"),openDate:Qe.string().min(1,"Ngày mở là bắt buộc"),closeTime:Qe.string().min(1,"Thời gian đóng là bắt buộc"),closeDate:Qe.string().min(1,"Ngày đóng là bắt buộc"),academicYearId:Qe.string()}).refine(n=>{const t=new Date("".concat(n.openDate,"T").concat(n.openTime));return new Date("".concat(n.closeDate,"T").concat(n.closeTime))>t},{message:"Thời gian kết thúc phải sau Thời gian bắt đầu",path:["closeDate"]});function Fi({open:n,handleClose:t,data:s}){var W;const o=ye(),{data:h,isLoading:p}=ne({queryKey:["academic-years"],queryFn:on}),{register:f,handleSubmit:T,setValue:g,reset:w,control:d,formState:{errors:C,isSubmitting:j}}=Se({resolver:qe(Di),defaultValues:{name:"",openTime:"",closeTime:"",academicYearId:""}}),[u,v]=l.useState(null);l.useEffect(()=>{(async()=>{const c=await ln();c&&c.data&&(v(c.data),g("academicYearId",c.data.id))})()},[g]),l.useEffect(()=>{var S;if(s){const c=Me.fromISO(s.openTime,{zone:"utc"}).setZone("Asia/Saigon"),H=Me.fromISO(s.closeTime,{zone:"utc"}).setZone("Asia/Saigon");g("name",s.name),g("openDate",c.toFormat("yyyy-LL-dd")),g("openTime",c.toFormat("HH:mm")),g("closeDate",H.toFormat("yyyy-LL-dd")),g("closeTime",H.toFormat("HH:mm")),g("academicYearId",(S=u==null?void 0:u.id)!=null?S:s.academicYearId)}else w(),u&&g("academicYearId",u.id)},[s,n,g,w,u]);const L=xe({mutationFn:async S=>s!=null&&s.id?Zr(s.id,S):Yr(S),onSuccess:()=>{o.invalidateQueries({queryKey:["system-configs"]}),A.success(s!=null&&s.id?"Cập nhật thành công":"Thêm mới thành công"),t()},onError:S=>{A.error("Lỗi khi lưu: "+S.message)}}),q=async S=>{const c=u==null?void 0:u.id;if(!c){A.error("Không tìm thấy năm học hiện tại, vui lòng thử lại sau.");return}await L.mutateAsync({name:S.name,openTime:Qn(S.openDate,S.openTime),closeTime:Qn(S.closeDate,S.closeTime),academicYearId:c})};return e.jsxs(de,{open:n,onClose:t,children:[e.jsx(he,{children:s?"Cập nhật Cấu hình":"Thêm Cấu hình"}),e.jsxs(ue,{children:[e.jsx(B,{label:"Tên Cấu hình",...f("name"),error:!!C.name,helperText:(W=C.name)==null?void 0:W.message,fullWidth:!0,margin:"dense"}),e.jsx(Ee,{sx:{marginY:2}}),e.jsxs(z,{display:"flex",gap:2,alignItems:"center",marginBottom:2,children:[e.jsx(P,{minWidth:120,children:"Thời gian mở"}),e.jsx(Z,{control:d,name:"openTime",render:({field:S})=>{var c;return e.jsx(B,{...S,type:"time",error:!!C.openTime,helperText:(c=C.openTime)==null?void 0:c.message,fullWidth:!0,margin:"dense"})}}),e.jsx(Z,{control:d,name:"openDate",render:({field:S})=>{var c;return e.jsx(B,{...S,type:"date",error:!!C.openDate,helperText:(c=C.openDate)==null?void 0:c.message,fullWidth:!0,margin:"dense"})}})]}),e.jsxs(z,{display:"flex",gap:2,alignItems:"center",marginBottom:2,children:[e.jsx(P,{minWidth:120,children:"Thời gian đóng"}),e.jsx(Z,{control:d,name:"closeTime",render:({field:S})=>{var c;return e.jsx(B,{...S,type:"time",error:!!C.closeTime,helperText:(c=C.closeTime)==null?void 0:c.message,fullWidth:!0,margin:"dense"})}}),e.jsx(Z,{control:d,name:"closeDate",render:({field:S})=>{var c;return e.jsx(B,{...S,type:"date",error:!!C.closeDate,helperText:(c=C.closeDate)==null?void 0:c.message,fullWidth:!0,margin:"dense"})}})]}),e.jsx(Ee,{sx:{marginY:2}}),e.jsx(Z,{control:d,name:"academicYearId",render:({field:S})=>{var c,H;return e.jsx(B,{...S,select:!0,label:"Năm học",error:!!C.academicYearId,helperText:(c=C.academicYearId)==null?void 0:c.message,fullWidth:!0,disabled:!0,children:p?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(H=h==null?void 0:h.data)==null?void 0:H.map(m=>e.jsx(F,{value:m.id,children:m.name},m.id))})}})]}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,disabled:j,children:"Hủy"}),e.jsx(k,{onClick:T(q),variant:"contained",disabled:j,children:j?"Đang lưu...":"Lưu"})]})]})}const Qn=(n,t)=>Me.fromFormat("".concat(n," ").concat(t),"yyyy-LL-dd HH:mm",{zone:"Asia/Saigon"}).toUTC().toISO();function Ri(){const n=ye(),[t,s]=l.useState(null);l.useEffect(()=>{(async()=>{const O=await ln();O&&O.data&&s(O.data)})()},[]);const{data:o,error:h,isPending:p,isSuccess:f,dataUpdatedAt:T,refetch:g}=ne({queryKey:["system-configs"],queryFn:()=>Xr((t==null?void 0:t.id)||""),enabled:!!(t!=null&&t.id)});l.useEffect(()=>{f&&o&&A.success(o.message,{toastId:"fetch-system-configs-success"})},[T]),l.useEffect(()=>{h&&A.error("Có lỗi xảy ra: "+h.message)},[h]);const w=l.useMemo(()=>!o||!o.data?!1:o.data.some(N=>Wi(N)),[o]),[d,C]=l.useState(!1),[j,u]=l.useState(null),v=N=>{u(N),C(!0)},L=()=>{C(!1),g()},[q,W]=l.useState(!1),[S,c]=l.useState(null),H=N=>{c(N),W(!0)},m=()=>{c(null),W(!1)},b=xe({mutationFn:N=>Jr(N),onSuccess:()=>{A.success("Xóa cấu hình thành công!"),n.invalidateQueries({queryKey:["system-configs"]}),g(),W(!1)},onError:N=>{A.error("Lỗi khi xóa: "+N.message)}}),r=()=>{S&&b.mutate(S)},[a,y]=l.useState(!1),[x,I]=l.useState(null),i=N=>{I(N),y(!0)},D=()=>{y(!1),I(null)},V=xe({mutationFn:()=>_r(x,x==null?void 0:x.id),onSuccess:()=>{A.success("Đã tạo thông báo thành công."),y(!1),I(null),n.invalidateQueries({queryKey:["system-configs"]}),g()},onError:N=>{A.error("Lỗi khi tạo thông báo: "+N.message)}}),fe=[{field:"name",headerName:"Tên cấu hình",width:200},{field:"academicYearName",headerName:"Năm học",width:200},{field:"openTime",headerName:"Thời gian mở",width:200,valueFormatter:N=>jn(N)},{field:"closeTime",headerName:"Thời gian đóng",width:200,valueFormatter:N=>jn(N)},{field:"isNotified",headerName:"Đã thông báo",type:"boolean",width:120},{field:"actions",headerName:"Hành động",width:400,renderCell:N=>{const O=N.row.isNotified;return e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>v(N.row),sx:{marginRight:1},disabled:O,children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>H(N.row.id),sx:{marginRight:1},disabled:O,children:"Xóa"}),e.jsx(k,{variant:"contained",color:"secondary",size:"small",onClick:()=>i(N.row),disabled:O,children:"Thông báo"})]})}}];return p?e.jsx(J,{}):h?e.jsxs("p",{children:["Error: ",h.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsxs(P,{variant:"body1",children:["Năm học hiện tại:"," ",e.jsx(P,{component:"span",variant:"body1",sx:{fontWeight:"bold"},color:"primary",children:t==null?void 0:t.name})]}),e.jsx(k,{variant:"contained",onClick:()=>v(null),children:"Thêm cấu hình"})]}),e.jsx(ve,{sx:{width:1010,marginX:"auto"},children:e.jsx(Te,{columns:fe,data:(o==null?void 0:o.data)||[]})}),w!==void 0&&e.jsx(z,{my:4,children:e.jsxs(P,{fontSize:24,variant:"body1",children:["Trạng thái hệ thống:"," ",e.jsx(P,{fontSize:24,component:"span",fontWeight:500,color:w?"primary":"red",children:w?"Đang mở":"Đang đóng"})]})}),e.jsx(Fi,{open:d,handleClose:L,data:j}),e.jsxs(de,{open:q,onClose:m,children:[e.jsx(he,{children:"Xác nhận xóa"}),e.jsx(ue,{children:e.jsx(P,{children:"Bạn có chắc chắn muốn xóa cấu hình này?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:m,children:"Hủy"}),e.jsx(k,{onClick:r,color:"error",variant:"contained",children:b.isPending?"Đang xóa...":"Xóa"})]})]}),e.jsxs(de,{open:a,onClose:D,children:[e.jsx(he,{children:"Xác nhận gửi thông báo"}),e.jsx(ue,{children:e.jsx(P,{children:"Sau khi thông báo, cấu hình này sẽ không thể chỉnh sửa hoặc xóa. Bạn có chắc chắn muốn tiếp tục?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:D,children:"Hủy"}),e.jsx(k,{onClick:()=>{x&&V.mutate()},variant:"contained",color:"secondary",children:V.isPending?"Đang gửi...":"Thông báo"})]})]})]})}const Hi={User:"Người dùng",Manager:"Quản lý",Admin:"Admin"},yt=n=>Hi[n]||"-";var jt=(n=>(n[n.User=1]="User",n[n.Manager=2]="Manager",n[n.Admin=3]="Admin",n))(jt||{});const Ki=Ne({userName:Y().nonempty("Mã số viên chức không được để trống"),email:Y().email("Email không hợp lệ"),phoneNumber:Y().nonempty("Số điện thoại không được để trống"),fullName:Y().nonempty("Họ và tên không được để trống"),academicTitle:Y().nonempty("Học hàm không được để trống"),officerRank:Y().nonempty("Ngạch công chức không được để trống"),departmentId:Y().optional(),fieldId:Y().optional(),specialization:Y().optional(),role:Y().nonempty("Quyền hạn không được để trống"),isApproved:tt()});function Mi({open:n,handleClose:t,data:s}){var W,S,c,H,m,b;const o=ye(),[h,p]=l.useState([]),[f,T]=l.useState([]);l.useEffect(()=>{async function r(){const a=await Ge();p(a.data||[]);const y=await sn();T(y.data||[])}r()},[]);const{register:g,handleSubmit:w,setValue:d,reset:C,control:j,formState:{errors:u,isSubmitting:v}}=Se({resolver:qe(Ki),defaultValues:{userName:"",email:"",phoneNumber:"",fullName:"",academicTitle:"",officerRank:"",departmentId:"",fieldId:"",specialization:"",role:"",isApproved:!1}});l.useEffect(()=>{var r,a,y,x,I,i;s?(d("userName",s.userName||""),d("email",s.email||""),d("phoneNumber",s.phoneNumber||""),d("fullName",s.fullName||""),d("academicTitle",(r=s.academicTitle)!=null?r:""),d("officerRank",(a=s.officerRank)!=null?a:""),d("departmentId",(y=s.departmentId)!=null?y:""),d("fieldId",(x=s.fieldId)!=null?x:""),d("specialization",s.specialization||""),d("role",(I=s.role)!=null?I:""),d("isApproved",(i=s.isApproved)!=null?i:!1)):C()},[s,n,d,C]);const L=xe({mutationFn:async r=>{if(s!=null&&s.id)return Cs(s.id,r)},onSuccess:()=>{o.invalidateQueries({queryKey:["users"]}),A.success("Người dùng đã được cập nhật"),t()},onError:r=>{console.error("API Error:",r),A.error("Lỗi khi cập nhật người dùng: "+r.message)}}),q=async r=>{await L.mutateAsync(r)};return e.jsxs(de,{open:n,onClose:t,fullWidth:!0,children:[e.jsx(he,{children:"Cập nhật Người Dùng"}),e.jsxs(ue,{children:[e.jsx(B,{label:"Mã số viên chức",...g("userName"),error:!!u.userName,helperText:(W=u.userName)==null?void 0:W.message,fullWidth:!0,margin:"dense",disabled:!0}),e.jsx(B,{label:"Email",...g("email"),error:!!u.email,helperText:(S=u.email)==null?void 0:S.message,fullWidth:!0,margin:"dense",disabled:v}),e.jsx(B,{label:"Số điện thoại",...g("phoneNumber"),error:!!u.phoneNumber,helperText:(c=u.phoneNumber)==null?void 0:c.message,fullWidth:!0,margin:"dense",disabled:v}),e.jsx(B,{label:"Họ và tên",...g("fullName"),error:!!u.fullName,helperText:(H=u.fullName)==null?void 0:H.message,fullWidth:!0,margin:"dense",disabled:v}),e.jsx(Z,{name:"academicTitle",control:j,defaultValue:(m=s==null?void 0:s.academicTitle)!=null?m:"",render:({field:r})=>{var a;return e.jsx(B,{select:!0,label:"Học hàm",...r,error:!!u.academicTitle,helperText:(a=u.academicTitle)==null?void 0:a.message,fullWidth:!0,margin:"dense",disabled:v,children:Object.entries(mn).filter(([y])=>isNaN(Number(y))).map(([y])=>e.jsx(F,{value:y,children:nn(y)},y))})}}),e.jsx(Z,{name:"officerRank",control:j,render:({field:r})=>{var a;return e.jsx(B,{select:!0,label:"Ngạch công chức",...r,error:!!u.officerRank,helperText:(a=u.officerRank)==null?void 0:a.message,fullWidth:!0,margin:"dense",disabled:v,children:Object.entries(gn).filter(([y])=>isNaN(Number(y))).map(([y])=>e.jsx(F,{value:y,children:tn(y)},y))})}}),e.jsx(Z,{name:"departmentId",control:j,render:({field:r})=>{var a;return e.jsxs(B,{select:!0,label:"Đơn vị công tác",...r,error:!!u.departmentId,helperText:(a=u.departmentId)==null?void 0:a.message,fullWidth:!0,margin:"dense",disabled:v,children:[e.jsx(F,{value:"",children:"-- Chọn đơn vị --"}),h.map(y=>e.jsx(F,{value:y.id,children:y.name},y.id))]})}}),e.jsx(Z,{name:"fieldId",control:j,render:({field:r})=>{var a;return e.jsxs(B,{select:!0,label:"Ngành",...r,error:!!u.fieldId,helperText:(a=u.fieldId)==null?void 0:a.message,fullWidth:!0,margin:"dense",disabled:v,children:[e.jsx(F,{value:"",children:"-- Chọn ngành --"}),f.map(y=>e.jsx(F,{value:y.id,children:y.name},y.id))]})}}),e.jsx(B,{label:"Chuyên ngành",...g("specialization"),error:!!u.specialization,helperText:(b=u.specialization)==null?void 0:b.message,fullWidth:!0,margin:"dense",disabled:v}),e.jsx(Z,{name:"role",control:j,render:({field:r})=>{var a;return e.jsx(B,{select:!0,label:"Quyền hạn",...r,error:!!u.role,helperText:(a=u.role)==null?void 0:a.message,fullWidth:!0,margin:"dense",disabled:v,children:Object.entries(jt).filter(([y])=>isNaN(Number(y))).map(([y])=>e.jsx(F,{value:y,children:yt(y)},y))})}}),e.jsx(Z,{name:"isApproved",control:j,render:({field:r})=>e.jsx(Ve,{control:e.jsx(Oe,{...r,checked:r.value,onChange:a=>r.onChange(a.target.checked),color:"primary",disabled:v}),label:"Cho phép truy cập hệ thống"})})]}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,disabled:v,children:"Hủy"}),e.jsx(k,{onClick:w(q),variant:"contained",color:"primary",disabled:v,children:v?"Đang lưu...":"Lưu"})]})]})}function Ei(){const n=ye(),t=l.useRef(null),{data:s,error:o,isPending:h,isSuccess:p,dataUpdatedAt:f,refetch:T}=ne({queryKey:["users"],queryFn:ws});l.useEffect(()=>{p&&s&&A.success(s.message,{toastId:"fetch-users-success"})},[f]),l.useEffect(()=>{o&&A.error("Có lỗi đã xảy ra: "+o.message)},[o]);const[g,w]=l.useState(!1),[d,C]=l.useState(null),j=y=>{C(y),w(!0)},u=()=>{w(!1),T()},[v,L]=l.useState(!1),[q,W]=l.useState(null),S=y=>{W(y),L(!0)},c=()=>{W(null),L(!1)},H=xe({mutationFn:y=>ks(y),onSuccess:()=>{A.success("Xóa người dùng thành công!"),n.invalidateQueries({queryKey:["users"]}),T(),L(!1)},onError:y=>{A.error("Lỗi khi xóa: "+y.message)}}),m=()=>{q&&H.mutate(q)},b=()=>{var y;(y=t.current)==null||y.click()},r=async y=>{if(y.target.files&&y.target.files.length>0){const x=y.target.files[0];try{const I=await vs(x);A.success(I.message),n.invalidateQueries({queryKey:["users"]}),T()}catch(I){A.error("Lỗi khi nhập file: "+I.message)}}},a=[{field:"userName",headerName:"Mã số viên chức",type:"string",width:150},{field:"fullName",headerName:"Họ và tên",type:"string",width:200},{field:"email",headerName:"Email",type:"string",width:200},{field:"departmentName",headerName:"Đơn vị công tác",type:"string",width:180},{field:"fieldName",headerName:"Ngành",type:"string",width:180},{field:"phoneNumber",headerName:"Số điện thoại",type:"string",width:150},{field:"academicTitle",headerName:"Học hàm",type:"string",width:180,valueFormatter:y=>nn(y)},{field:"officerRank",headerName:"Ngạch công chức",type:"string",width:180,valueFormatter:y=>tn(y)},{field:"role",headerName:"Quyền hạn",type:"string",width:150,valueFormatter:y=>yt(y)},{field:"isApproved",headerName:"Đã duyệt",type:"boolean",width:120},{field:"actions",headerName:"",width:300,renderCell:y=>e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>j(y.row),sx:{marginRight:1},disabled:H.isPending,children:"Sửa"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>S(y.row.id),disabled:H.isPending,children:"Xóa"})]})}];return h?e.jsx(J,{}):o?e.jsxs("p",{children:["Error: ",o.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{sx:{marginBottom:2,display:"flex",justifyContent:"flex-end"},children:[e.jsx(k,{variant:"contained",color:"primary",onClick:b,children:"Nhập người dùng từ Excel"}),e.jsx("input",{type:"file",accept:".xls,.xlsx",style:{display:"none"},ref:t,onChange:r})]}),e.jsx(ve,{sx:{width:"100%",marginX:"auto",padding:2},children:e.jsx(Te,{columns:a,data:(s==null?void 0:s.data)||[]})}),e.jsx(Mi,{open:g,handleClose:u,data:d}),e.jsxs(de,{open:v,onClose:c,children:[e.jsx(he,{children:"Xác nhận xóa"}),e.jsx(ue,{children:e.jsx(P,{children:"Bạn có chắc chắn muốn xóa người dùng này?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:c,disabled:H.isPending,children:"Hủy"}),e.jsx(k,{onClick:m,color:"error",variant:"contained",disabled:H.isPending,children:H.isPending?"Đang xóa...":"Xóa"})]})]})]})}const Bi=()=>{const n=localStorage.getItem("token"),t=localStorage.getItem("expiration");return!n||!t?!1:new Date(t).getTime()>Date.now()};function be({allowedRoles:n,children:t}){const{user:s,loading:o}=Re();if(!o)return!Bi()||!s?e.jsx(Gn,{to:"/dang-nhap",replace:!0}):n&&!n.includes(s==null?void 0:s.role)?e.jsx(Gn,{to:"/unauthorized",replace:!0}):t?e.jsx(e.Fragment,{children:t}):e.jsx(Cn,{})}const Ui=()=>{const n=$e(),t=()=>{n("/")};return e.jsxs(ze,{maxWidth:"md",sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",textAlign:"center"},children:[e.jsx(P,{variant:"h1",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"404"}),e.jsx(P,{variant:"h5",gutterBottom:!0,children:"Tài nguyên bạn yêu cầu không tồn tại."}),e.jsx(k,{variant:"contained",color:"primary",onClick:t,children:"Trở về trang chủ"})]})},zi=()=>{const n=$e(),t=()=>{n("/")};return e.jsxs(ze,{maxWidth:"md",sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",textAlign:"center"},children:[e.jsx(P,{variant:"h1",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"401"}),e.jsx(P,{variant:"h5",gutterBottom:!0,children:"Bạn không có quyền truy cập tài nguyên này."}),e.jsx(k,{variant:"contained",color:"primary",onClick:t,children:"Trở về trang chủ"})]})};function Vi(){var r;const n=ye(),[t,s]=l.useState({}),{user:o}=Re(),[h,p]=l.useState([]),[f,T]=l.useState(new Map),{data:g}=ne({queryKey:["current-academic-year"],queryFn:ln}),{data:w,error:d,isPending:C,refetch:j}=ne({queryKey:["works","registerable-works"],queryFn:async()=>{var x;const a={academicYearId:(x=g==null?void 0:g.data)==null?void 0:x.id,isCurrentUser:!0},y=await an(a);return console.log("Dữ liệu từ API:",y.data),y},enabled:!!((r=g==null?void 0:g.data)!=null&&r.id),staleTime:0});l.useEffect(()=>{w!=null&&w.data&&w.data.length>0&&(async()=>{const y={};for(const x of w.data)if(x.coAuthorUserIds&&x.coAuthorUserIds.length>0){const I=[];for(const i of x.coAuthorUserIds)try{const D=await Ye(i);D.success&&D.data&&I.push(D.data)}catch(D){console.error("Lỗi khi lấy thông tin đồng tác giả:",D)}y[x.id]=I}s(y)})()},[w]),l.useEffect(()=>{w!=null&&w.data&&(console.log("Cập nhật localWorks với dữ liệu:",w.data),p(w.data))},[w]);const u=l.useCallback(a=>a?f.has(a.id)?f.get(a.id):(console.log("Kiểm tra trạng thái đăng ký của author:",a),a.authorRegistration!=null):!1,[f]);l.useEffect(()=>{w&&w.message&&A.success(w.message,{toastId:"fetch-works-success"})},[w]),l.useEffect(()=>{d&&A.error("Có lỗi đã xảy ra: "+d.message,{toastId:"fetch-works-error"})},[d]);const[v,L]=l.useState(!1),[q,W]=l.useState(null),S=async a=>{var I;const y=h.find(i=>i.id===a),x=(I=y==null?void 0:y.authors)==null?void 0:I.find(i=>i.userId===(o==null?void 0:o.id));if(!x){A.error("Không tìm thấy thông tin tác giả");return}T(i=>{const D=new Map(i);return D.set(x.id,!1),D});try{await H.mutateAsync({authorId:x.id,registered:!1})}catch(i){}},c=()=>{W(null),L(!1)},H=xe({mutationFn:({authorId:a,registered:y})=>Er(a,y),onSuccess:(a,y)=>{const{authorId:x,registered:I}=y;A.success(I?"Đăng ký công trình thành công!":"Hủy đăng ký công trình thành công!"),p(i=>{const D=i.map(V=>{if(V.authors&&V.authors.length>0){const fe=V.authors.findIndex(N=>N.id===x);if(fe>=0){const N=[...V.authors];return N[fe]={...N[fe],registered:I},{...V,authors:N}}}return V});return console.log("Dữ liệu sau khi cập nhật:",D),D}),n.invalidateQueries({queryKey:["works","registerable-works"]}),setTimeout(()=>{j(),T(i=>{const D=new Map(i);return D.delete(x),D})},300)},onError:(a,y)=>{const{authorId:x}=y;T(I=>{const i=new Map(I);return i.delete(x),i}),A.error("Lỗi khi cập nhật trạng thái đăng ký: "+a.message),j()}}),m=async a=>{var x;const y=(x=a.authors)==null?void 0:x.find(I=>I.userId===(o==null?void 0:o.id));if(!y){A.error("Không tìm thấy thông tin tác giả");return}T(I=>{const i=new Map(I);return i.set(y.id,!0),i});try{await H.mutateAsync({authorId:y.id,registered:!0})}catch(I){}},b=[{field:"stt",headerName:"STT",width:70,renderCell:a=>{const x=a.api.getAllRowIds().indexOf(a.id);return e.jsx("div",{children:x+1})}},{field:"title",headerName:"Tên công trình",type:"string",width:150},{field:"timePublished",headerName:"Thời gian xuất bản",type:"string",width:150,renderCell:a=>a.value?e.jsx("div",{children:mt(a.value)}):e.jsx("div",{children:"-"})},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:170},{field:"workLevelName",headerName:"Cấp công trình",type:"string",width:150},{field:"totalAuthors",headerName:"Số tác giả",type:"number",width:140,align:"center",headerAlign:"left"},{field:"coAuthors",headerName:"Đồng tác giả",type:"string",width:140,renderCell:a=>{const y=a.row.id,x=t[y]||[];if(x.length===0)return e.jsx("div",{children:"-"});const I="".concat(x.length," tác giả");return e.jsx(De,{title:e.jsxs("div",{children:[e.jsx(P,{variant:"subtitle2",children:"Danh sách đồng tác giả:"}),x.map((i,D)=>e.jsxs(P,{variant:"body2",children:["• ",i.fullName," - ",i.userName," - ",i.departmentName||"Chưa có phòng ban"]},D))]}),children:e.jsx("div",{children:I})})}},{field:"authorRoleName",headerName:"Vai trò tác giả",type:"string",width:150,renderCell:a=>{var I;const x=(I=a.row.authors)==null?void 0:I.find(i=>i.userId===(o==null?void 0:o.id));return e.jsx("div",{children:x?x.authorRoleName:"-"})}},{field:"position",headerName:"Vị trí",type:"string",width:80,renderCell:a=>{var I;const x=(I=a.row.authors)==null?void 0:I.find(i=>i.userId===(o==null?void 0:o.id));return e.jsx("div",{children:(x==null?void 0:x.position)!==void 0&&(x==null?void 0:x.position)!==null?x.position:"-"})}},{field:"purposeName",headerName:"Mục đích quy đổi",type:"string",width:180,renderCell:a=>{var I;const x=(I=a.row.authors)==null?void 0:I.find(i=>i.userId===(o==null?void 0:o.id));return e.jsx("div",{children:x?x.purposeName:"-"})}},{field:"scoreLevel",headerName:"Mức điểm",type:"string",width:150,renderCell:a=>{var I;const x=(I=a.row.authors)==null?void 0:I.find(i=>i.userId===(o==null?void 0:o.id));return!x||x.scoreLevel===void 0||x.scoreLevel===null?e.jsx("div",{children:"-"}):e.jsx("div",{children:rn(x.scoreLevel)})}},{field:"authorHour",headerName:"Giờ tác giả",type:"string",width:120,renderCell:a=>{var I;const x=(I=a.row.authors)==null?void 0:I.find(i=>i.userId===(o==null?void 0:o.id));return e.jsx("div",{children:(x==null?void 0:x.authorHour)!==void 0&&(x==null?void 0:x.authorHour)!==null?x.authorHour:"-"})}},{field:"proofStatus",headerName:"Trạng thái",type:"string",width:140,renderCell:a=>{var i;const x=(i=a.row.authors)==null?void 0:i.find(D=>D.userId===(o==null?void 0:o.id)),I=x==null?void 0:x.proofStatus;return I==null?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"}):I===oe.HopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(_e,{color:"success"}),"Hợp lệ"]}):I===oe.KhongHopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Ze,{color:"error"}),"Không hợp lệ"]}):I===oe.ChuaXuLy?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(en,{color:"action"}),"Chưa xử lý"]}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"})}},{field:"actions",headerName:"Thao tác",width:250,renderCell:a=>{var D;const y=a.row,x=(D=y.authors)==null?void 0:D.find(V=>V.userId===(o==null?void 0:o.id)),I=u(x),i=f.has(x==null?void 0:x.id);return e.jsxs(z,{children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>m(y),disabled:I||i,sx:{marginRight:1,"&.Mui-disabled":{backgroundColor:"rgba(0, 0, 0, 0.12)",color:"rgba(0, 0, 0, 0.26)"}},children:i?e.jsx(J,{size:24}):"Đăng ký"}),e.jsx(k,{variant:"contained",color:"error",size:"small",onClick:()=>{W(y.id),L(!0)},disabled:!I||i,sx:{"&.Mui-disabled":{backgroundColor:"rgba(0, 0, 0, 0.12)",color:"rgba(0, 0, 0, 0.26)"}},children:i?e.jsx(J,{size:24}):"Hủy đăng ký"})]})}}];return C?e.jsx(J,{}):d?e.jsxs("p",{children:["Lỗi: ",d.message]}):e.jsxs(ze,{maxWidth:"xl",children:[e.jsxs(z,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(P,{variant:"h6",children:"Danh sách công trình có thể đăng ký"}),e.jsx(z,{sx:{display:"flex",gap:2}})]}),C?e.jsx(z,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(J,{})}):e.jsx(Te,{columns:b,data:h}),e.jsxs(de,{open:v,onClose:c,children:[e.jsx(he,{children:"Xác nhận hủy đăng ký"}),e.jsx(ue,{children:e.jsx(P,{children:"Bạn có chắc chắn muốn hủy đăng ký công trình này không?"})}),e.jsxs(me,{children:[e.jsx(k,{onClick:c,color:"inherit",children:"Hủy"}),e.jsx(k,{onClick:()=>{q&&(S(q),c())},color:"error",variant:"contained",disabled:H.isPending,children:H.isPending?e.jsx(J,{size:24}):"Hủy đăng ký"})]})]})]})}function Oi({open:n,onClose:t,status:s,onStatusChange:o,onSubmit:h,isPending:p}){return e.jsxs(de,{open:n,onClose:t,children:[e.jsx(he,{children:"Cập nhật trạng thái công trình"}),e.jsxs(ue,{children:[e.jsxs(ce,{fullWidth:!0,margin:"normal",children:[e.jsx(Ce,{id:"status-select-label",children:"Trạng thái"}),e.jsxs(ke,{labelId:"status-select-label",value:s,onChange:o,label:"Trạng thái",children:[e.jsx(F,{value:oe.HopLe,children:"Hợp lệ"}),e.jsx(F,{value:oe.KhongHopLe,children:"Không hợp lệ"}),e.jsx(F,{value:oe.ChuaXuLy,children:"Chưa xử lý"})]})]}),e.jsx(P,{variant:"caption",color:"textSecondary",sx:{mt:1,display:"block"},children:"Dialog sẽ tự động đóng sau khi cập nhật thành công."})]}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,children:"Hủy"}),e.jsx(k,{onClick:h,variant:"contained",color:"primary",disabled:p,children:p?e.jsx(J,{size:24}):"Cập nhật"})]})]})}function Gi({open:n,onClose:t,note:s,onNoteChange:o,onSubmit:h,isPending:p}){return e.jsxs(de,{open:n,onClose:t,fullWidth:!0,maxWidth:"sm",children:[e.jsx(he,{children:"Cập nhật ghi chú"}),e.jsxs(ue,{children:[e.jsx(B,{fullWidth:!0,multiline:!0,rows:4,margin:"normal",label:"Ghi chú",value:s,onChange:o}),e.jsx(P,{variant:"caption",color:"textSecondary",sx:{mt:1,display:"block"},children:"Dialog sẽ tự động đóng sau khi cập nhật thành công."})]}),e.jsxs(me,{children:[e.jsx(k,{onClick:t,children:"Hủy"}),e.jsx(k,{onClick:h,variant:"contained",color:"primary",disabled:p,children:p?e.jsx(J,{size:24}):"Cập nhật"})]})]})}function Qi(){var je;const{userId:n}=rs(),t=$e(),[s,o]=l.useState({}),h=Nn(),{data:p}=ne({queryKey:["current-academic-year"],queryFn:ln}),{data:f,isLoading:T,error:g}=ne({queryKey:["users",n],queryFn:()=>Ye(n||""),enabled:!!n}),{data:w,isLoading:d,error:C,refetch:j}=ne({queryKey:["works","user",n],queryFn:async()=>{var le;const $={userId:n,academicYearId:(le=p==null?void 0:p.data)==null?void 0:le.id,isCurrentUser:!1};return an($)},enabled:!!n&&!!((je=p==null?void 0:p.data)!=null&&je.id)});l.useEffect(()=>{w!=null&&w.data&&w.data.length>0&&(async()=>{const le={};for(const G of w.data)if(G.coAuthorUserIds&&G.coAuthorUserIds.length>0){const ee=[];for(const ae of G.coAuthorUserIds)try{const Le=await Ye(ae);Le.success&&Le.data&&ee.push(Le.data)}catch(Le){console.error("Lỗi khi lấy thông tin đồng tác giả:",Le)}le[G.id]=ee}o(le)})()},[w]);const{selectedWork:u,openUpdateDialog:v,openStatusDialog:L,openNoteDialog:q,newStatus:W,newNote:S,activeTab:c,updateWorkMutation:H,createWorkMutation:m,handleOpenUpdateDialog:b,handleCloseUpdateDialog:r,handleOpenStatusDialog:a,handleCloseStatusDialog:y,handleOpenNoteDialog:x,handleCloseNoteDialog:I,handleStatusChange:i,handleNoteChange:D,handleStatusSubmit:V,handleNoteSubmit:fe,handleUpdateSubmit:N,setActiveTab:O}=xt({userId:n,worksData:w,refetchWorks:j,isAuthorPage:!1}),_=()=>{t(-1)},K=[{field:"stt",headerName:"STT",width:70,renderCell:$=>{const G=$.api.getAllRowIds().indexOf($.id);return e.jsx("div",{children:G+1})}},{field:"title",headerName:"Tên công trình",type:"string",width:250},{field:"timePublished",headerName:"Thời gian xuất bản",type:"string",width:150,renderCell:$=>{if(!$.value)return e.jsx("div",{children:"-"});try{const le=st(new Date($.value),"dd/MM/yyyy",{locale:vn});return e.jsx("div",{children:le})}catch(le){return e.jsx("div",{children:$.value})}}},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:150},{field:"workLevelName",headerName:"Cấp công trình",type:"string",width:150},{field:"details",headerName:"Thông tin chi tiết",type:"string",width:300,renderCell:$=>{if(!$.row.details)return e.jsx("div",{children:"-"});const le=$.row.details,G=Object.entries(le).map(([ee,ae])=>"".concat(ee,": ").concat(String(ae))).join("\n");return e.jsx(De,{title:e.jsx("div",{style:{whiteSpace:"pre-line",fontSize:"0.8rem"},children:G}),arrow:!0,children:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%"},children:Object.entries(le).map(([ee,ae],Le)=>e.jsxs("span",{children:[Le>0&&"; ",e.jsx("b",{children:ee}),": ",String(ae)]},Le))})})}},{field:"totalAuthors",headerName:"Số tác giả",type:"number",width:140,align:"center",headerAlign:"left"},{field:"totalMainAuthors",headerName:"Số tác giả chính",type:"number",width:140,align:"center",headerAlign:"left"},{field:"coAuthors",headerName:"Đồng tác giả",type:"string",width:140,renderCell:$=>{const le=$.row.id,G=s[le]||[];if(G.length===0)return e.jsx("div",{children:"-"});const ee="".concat(G.length," tác giả");return e.jsx(De,{title:e.jsxs("div",{children:[e.jsx(P,{variant:"subtitle2",children:"Danh sách đồng tác giả:"}),G.map((ae,Le)=>e.jsxs(P,{variant:"body2",children:["• ",ae.fullName," - ",ae.userName," - ",ae.departmentName||"Chưa có phòng ban"]},Le))]}),children:e.jsx("div",{children:ee})})}},{field:"authorRoleName",headerName:"Vai trò tác giả",type:"string",width:150,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:G?G.authorRoleName:"-"})}},{field:"position",headerName:"Vị trí",type:"string",width:80,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:(G==null?void 0:G.position)!==void 0&&(G==null?void 0:G.position)!==null?G.position:"-"})}},{field:"purposeName",headerName:"Mục đích quy đổi",type:"string",width:180,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:G?G.purposeName:"-"})}},{field:"fieldName",headerName:"Ngành tính điểm",type:"string",width:150,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:G?G.fieldName:"-"})}},{field:"scImagoFieldName",headerName:"Ngành SCImago",type:"string",width:180,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:G?G.scImagoFieldName:"-"})}},{field:"scoreLevel",headerName:"Mức điểm",type:"string",width:120,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return!G||G.scoreLevel===void 0||G.scoreLevel===null?e.jsx("div",{children:"-"}):e.jsx("div",{children:rn(G.scoreLevel)})}},{field:"workHour",headerName:"Giờ công trình",type:"string",width:120,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:(G==null?void 0:G.workHour)!==void 0&&(G==null?void 0:G.workHour)!==null?G.workHour:"-"})}},{field:"authorHour",headerName:"Giờ tác giả",type:"string",width:120,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:(G==null?void 0:G.authorHour)!==void 0&&(G==null?void 0:G.authorHour)!==null?G.authorHour:"-"})}},{field:"note",headerName:"Ghi chú",type:"string",width:150,renderCell:$=>{var ae;const G=(ae=$.row.authors)==null?void 0:ae.find(Le=>Le.userId===n),ee=(G==null?void 0:G.note)||"";return ee?e.jsx(De,{title:e.jsx("div",{style:{whiteSpace:"pre-line",fontSize:"0.8rem"},children:ee}),arrow:!0,children:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%"},children:ee})}):e.jsx("div",{children:"-"})}},{field:"proofStatus",headerName:"Trạng thái",type:"string",width:140,renderCell:$=>{var ae;const G=(ae=$.row.authors)==null?void 0:ae.find(Le=>Le.userId===n),ee=G==null?void 0:G.proofStatus;return ee==null?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"}):ee===oe.HopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(_e,{color:"success"}),"Hợp lệ"]}):ee===oe.KhongHopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Ze,{color:"error"}),"Không hợp lệ"]}):ee===oe.ChuaXuLy?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(en,{color:"action"}),"Chưa xử lý"]}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"})}},{field:"actions",headerName:"Thao tác",width:350,renderCell:$=>e.jsxs(z,{display:"flex",gap:1,alignItems:"center",height:"100%",children:[e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>b($.row),startIcon:e.jsx(as,{}),children:"Cập nhật"}),e.jsx(k,{variant:"contained",color:"info",size:"small",onClick:()=>a($.row),startIcon:e.jsx(os,{}),children:"Trạng thái"}),e.jsx(k,{variant:"contained",color:"secondary",size:"small",onClick:()=>x($.row),startIcon:e.jsx(ls,{}),children:"Ghi chú"})]})}];if(T||d)return e.jsx(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(J,{})});if(g||C)return e.jsx(z,{p:3,children:e.jsxs(P,{color:"error",children:[g?"Lỗi khi tải thông tin người dùng: "+g.message:"",C?"Lỗi khi tải danh sách công trình: "+C.message:""]})});const E=f==null?void 0:f.data,Q=(w==null?void 0:w.data)||[];return e.jsxs(ze,{maxWidth:"xl",children:[e.jsxs(z,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(k,{variant:"outlined",startIcon:e.jsx(is,{}),onClick:_,sx:{mr:2},children:"Quay lại"}),e.jsxs(P,{variant:"h4",children:["Chấm điểm công trình - ",E==null?void 0:E.fullName]})]}),e.jsx(z,{sx:{mb:3},children:e.jsxs(ve,{sx:{p:2},children:[e.jsx(P,{variant:"h6",gutterBottom:!0,children:"Thông tin người dùng"}),e.jsxs(z,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[e.jsxs(P,{variant:"body1",children:[e.jsx("strong",{children:"Mã số viên chức:"})," ",E==null?void 0:E.userName]}),e.jsxs(P,{variant:"body1",children:[e.jsx("strong",{children:"Họ và tên:"})," ",E==null?void 0:E.fullName]}),e.jsxs(P,{variant:"body1",children:[e.jsx("strong",{children:"Đơn vị công tác:"})," ",(E==null?void 0:E.departmentName)||"Chưa có phòng ban"]}),e.jsxs(P,{variant:"body1",children:[e.jsx("strong",{children:"Ngành:"})," ",(E==null?void 0:E.fieldName)||"Chưa phân ngành"]})]})]})}),e.jsxs(z,{sx:{mb:2},children:[e.jsx(P,{variant:"h6",gutterBottom:!0,children:"Danh sách công trình"}),e.jsx(ve,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(z,{sx:{height:600},children:e.jsx(Te,{columns:K,data:Q})})})]}),e.jsx(Oi,{open:L,onClose:y,status:W,onStatusChange:$=>i(Number($.target.value)),onSubmit:V,isPending:H.isPending}),e.jsx(Gi,{open:q,onClose:I,note:S,onNoteChange:$=>D($.target.value),onSubmit:fe,isPending:H.isPending}),e.jsx(ft,{open:v,onClose:r,selectedWork:u,activeTab:c,setActiveTab:O,onSubmit:N,isPending:m.isPending||H.isPending,workTypes:h.workTypes,workLevels:h.workLevels,authorRoles:h.authorRoles,purposes:h.purposes,scimagoFields:h.scimagoFields,fields:h.fields})]})}const $i=Ne({fullName:Y().min(1,"Họ tên không được để trống"),email:Y().email("Email không hợp lệ"),phoneNumber:Y().min(1,"Số điện thoại không được để trống").max(10,"Số điện thoại không hợp lệ"),specialization:Y().min(1,"Chuyên ngành không được để trống"),departmentId:Y().min(1,"Đơn vị công tác không được để trống"),fieldId:Y().min(1,"Ngành không được để trống"),academicTitle:Y().min(1,"Học hàm không được để trống"),officerRank:Y().min(1,"Ngạch công chức không được để trống")}),Xi=Ne({currentPassword:Y().min(1,"Mật khẩu hiện tại không được để trống"),newPassword:Y().min(1,"Mật khẩu mới không được để trống"),confirmNewPassword:Y().min(1,"Xác nhận mật khẩu mới không được để trống")}).refine(n=>n.newPassword===n.confirmNewPassword,{message:"Mật khẩu mới không khớp",path:["confirmNewPassword"]});function Yi(){var r,a,y,x,I;const[n,t]=l.useState(null),{setUser:s,refreshUserInfo:o}=Re(),[h,p]=l.useState([]),[f,T]=l.useState([]),{control:g,register:w,handleSubmit:d,reset:C,formState:{errors:j,isSubmitting:u}}=Se({resolver:qe($i)}),{register:v,handleSubmit:L,reset:q,formState:{errors:W,isSubmitting:S}}=Se({resolver:qe(Xi)}),{data:c,isLoading:H}=ne({queryKey:["user"],queryFn:it});l.useEffect(()=>{c!=null&&c.success&&c.data&&(t(c.data),C({departmentId:c.data.departmentId==="00000000-0000-0000-0000-000000000000"?"":c.data.departmentId,fieldId:c.data.fieldId==="00000000-0000-0000-0000-000000000000"?"":c.data.fieldId,academicTitle:c.data.academicTitle==="Unknown"?"":c.data.academicTitle,officerRank:c.data.officerRank==="Unknown"?"":c.data.officerRank,fullName:c.data.fullName,email:c.data.email==="-"?"":c.data.email,phoneNumber:c.data.phoneNumber==="-"?"":c.data.phoneNumber,specialization:c.data.specialization==="-"?"":c.data.specialization}))},[c,C]),l.useEffect(()=>{async function i(){const D=await Ge();p(D.data||[]);const V=await sn();T(V.data||[])}i()},[]);const m=async i=>{try{if(!n)return;if((await bs(n.id,i)).success){const fe=(await Ye(n.id)).data;s(fe)}await o(),A.success("Cập nhật hồ sơ thành công")}catch(D){A.error("Lỗi khi cập nhật hồ sơ")}},b=async i=>{try{await Us(i.currentPassword,i.newPassword),A.success("Đổi mật khẩu thành công"),q()}catch(D){A.error("Lỗi khi đổi mật khẩu")}};return!n||H?e.jsx(J,{}):e.jsxs(e.Fragment,{children:[e.jsx(P,{variant:"h4",fontWeight:500,sx:{my:3},children:"Cập nhật thông tin cá nhân"}),e.jsx(z,{maxWidth:"sm",children:e.jsxs("form",{onSubmit:d(m),noValidate:!0,children:[e.jsx(B,{label:"Họ và tên",fullWidth:!0,margin:"dense",...w("fullName"),error:!!j.fullName,helperText:(r=j.fullName)==null?void 0:r.message,disabled:u}),e.jsx(B,{label:"Email",fullWidth:!0,margin:"dense",...w("email"),error:!!j.email,helperText:(a=j.email)==null?void 0:a.message,disabled:u}),e.jsx(B,{label:"Số điện thoại",fullWidth:!0,margin:"dense",...w("phoneNumber"),disabled:u}),e.jsx(B,{label:"Chuyên ngành",fullWidth:!0,margin:"dense",...w("specialization"),disabled:u}),e.jsx(Z,{name:"departmentId",control:g,render:({field:i})=>{var D;return e.jsxs(B,{select:!0,label:"Đơn vị công tác",...i,error:!!j.departmentId,helperText:(D=j.departmentId)==null?void 0:D.message,fullWidth:!0,margin:"dense",disabled:u,children:[e.jsx(F,{value:"",children:"Chọn đơn vị"}),h.map(V=>e.jsx(F,{value:V.id,children:V.name},V.id))]})}}),e.jsx(Z,{name:"fieldId",control:g,render:({field:i})=>{var D;return e.jsxs(B,{select:!0,label:"Ngành",...i,error:!!j.fieldId,helperText:(D=j.fieldId)==null?void 0:D.message,fullWidth:!0,margin:"dense",disabled:u,children:[e.jsx(F,{value:"",children:"Chọn ngành"}),f.map(V=>e.jsx(F,{value:V.id,children:V.name},V.id))]})}}),e.jsx(Z,{name:"academicTitle",control:g,render:({field:i})=>{var D;return e.jsx(B,{select:!0,label:"Học hàm",...i,error:!!j.academicTitle,helperText:(D=j.academicTitle)==null?void 0:D.message,fullWidth:!0,margin:"dense",disabled:u,children:Object.entries(mn).filter(([V])=>isNaN(Number(V))).map(([V])=>e.jsx(F,{value:V,children:nn(V)},V))})}}),e.jsx(Z,{name:"officerRank",control:g,render:({field:i})=>{var D;return e.jsx(B,{select:!0,label:"Ngạch công chức",...i,error:!!j.officerRank,helperText:(D=j.officerRank)==null?void 0:D.message,fullWidth:!0,margin:"dense",disabled:u,children:Object.entries(gn).filter(([V])=>isNaN(Number(V))).map(([V])=>e.jsx(F,{value:V,children:tn(V)},V))})}}),e.jsx(k,{variant:"contained",type:"submit",fullWidth:!0,sx:{mt:2},disabled:u,children:u?"Đang tải...":"Cập nhật thông tin"})]})}),e.jsx(Ee,{sx:{my:3}}),e.jsxs(z,{maxWidth:"sm",sx:{mt:3},children:[e.jsx(P,{variant:"h4",fontWeight:500,sx:{mb:2},children:"Đổi mật khẩu"}),e.jsxs("form",{onSubmit:L(b),noValidate:!0,children:[e.jsx(B,{label:"Mật khẩu hiện tại",fullWidth:!0,margin:"dense",type:"password",...v("currentPassword"),error:!!W.currentPassword,helperText:(y=W.currentPassword)==null?void 0:y.message,disabled:S}),e.jsx(B,{label:"Mật khẩu mới",fullWidth:!0,margin:"dense",type:"password",...v("newPassword"),error:!!W.newPassword,helperText:(x=W.newPassword)==null?void 0:x.message,disabled:S}),e.jsx(B,{label:"Xác nhận mật khẩu mới",fullWidth:!0,margin:"dense",type:"password",...v("confirmNewPassword"),error:!!W.confirmNewPassword,helperText:(I=W.confirmNewPassword)==null?void 0:I.message,disabled:S}),e.jsx(k,{variant:"contained",type:"submit",fullWidth:!0,sx:{mt:2},disabled:S,children:S?"Đang tải...":"Đổi mật khẩu"})]})]})]})}function _i(){const n=$e(),[t,s]=l.useState(""),{user:o}=Re(),{data:h,isLoading:p,error:f}=ne({queryKey:["departments",o==null?void 0:o.role,o==null?void 0:o.id],queryFn:async()=>(o==null?void 0:o.role)==="Manager"?await lt(o.id):await Ge(),enabled:!!o}),{data:T,isLoading:g,error:w}=ne({queryKey:["users","department",t],queryFn:()=>at(t),enabled:!!t}),d=v=>{s(v.target.value)},C=v=>{n("/cham-diem/user/".concat(v))},j=[{field:"userName",headerName:"Mã số viên chức",width:150},{field:"fullName",headerName:"Họ và tên",width:250},{field:"departmentName",headerName:"Đơn vị công tác",width:250},{field:"fieldName",headerName:"Ngành",width:200,renderCell:v=>e.jsx("div",{children:v.row.fieldName||"Chưa phân ngành"})},{field:"actions",headerName:"Thao tác",width:170,renderCell:v=>e.jsx(k,{variant:"contained",color:"primary",size:"small",onClick:()=>C(v.row.id),startIcon:e.jsx(cs,{}),children:"Xem công trình"})}];if(p)return e.jsx(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(J,{})});if(f)return e.jsx(z,{p:3,children:e.jsxs(P,{color:"error",children:["Lỗi khi tải danh sách phòng ban: ",f.message]})});const u=(h==null?void 0:h.data)||[];return e.jsxs(ze,{maxWidth:"xl",children:[e.jsxs(z,{sx:{mb:4},children:[e.jsx(P,{variant:"h5",gutterBottom:!0,children:"Danh sách người dùng theo phòng ban"}),e.jsxs(ce,{fullWidth:!0,sx:{mt:2},children:[e.jsx(Ce,{id:"department-select-label",children:"Chọn phòng ban"}),e.jsxs(ke,{labelId:"department-select-label",id:"department-select",value:t,label:"Chọn phòng ban",onChange:d,children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Chọn phòng ban"})}),u.map(v=>e.jsx(F,{value:v.id,children:v.name},v.id))]})]})]}),t?g?e.jsx(z,{display:"flex",justifyContent:"center",py:4,children:e.jsx(J,{})}):w?e.jsxs(P,{color:"error",children:["Lỗi khi tải danh sách người dùng: ",w.message]}):e.jsxs(e.Fragment,{children:[e.jsx(P,{variant:"h6",mb:2,children:"Danh sách người dùng thuộc phòng ban"}),e.jsx(ve,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(z,{sx:{height:500},children:e.jsx(Te,{columns:j,data:(T==null?void 0:T.data)||[]})})})]}):e.jsx(P,{variant:"subtitle1",color:"text.secondary",textAlign:"center",py:4,children:"Vui lòng chọn phòng ban để xem danh sách người dùng"})]})}const Zi=async()=>(await M.get("/cache/keys")).data,Ji=async n=>(await M.delete("/cache/clear/".concat(n))).data,ea=async()=>(await M.delete("/cache/clear-all")).data;function na(){const n=ye(),{data:t,error:s,isPending:o,isSuccess:h,dataUpdatedAt:p,refetch:f}=ne({queryKey:["cache-keys"],queryFn:Zi});l.useEffect(()=>{h&&t&&A.success("Tải danh sách cache thành công",{toastId:"fetch-caches"})},[p]),l.useEffect(()=>{s&&A.error("Lỗi khi fetch cache: "+s.message)},[s]);const T=xe({mutationFn:d=>Ji(d),onSuccess:()=>{A.success("Đã xóa cache"),n.invalidateQueries({queryKey:["cache-keys"]}),f()},onError:d=>{A.error("Xóa thất bại: "+d.message)}}),g=xe({mutationFn:ea,onSuccess:()=>{A.success("Xóa tất cả cache thành công"),n.invalidateQueries({queryKey:["cache-keys"]}),f()},onError:d=>{A.error("Xóa toàn bộ cache thất bại: "+d.message)}}),w=[{field:"key",headerName:"Cache Key",width:600},{field:"actions",headerName:"Hành động",width:200,renderCell:d=>e.jsx(k,{variant:"outlined",color:"error",size:"small",onClick:()=>T.mutate(d.row.key),disabled:T.isPending,children:"Xóa"})}];return o?e.jsx(J,{}):s?e.jsxs("p",{children:["Error: ",s.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsx(P,{variant:"h6",children:"Quản lý Cache"}),e.jsx(k,{variant:"contained",color:"error",onClick:()=>g.mutate(),disabled:g.isPending,children:g.isPending?"Đang xóa...":"Xóa tất cả"})]}),e.jsx(ve,{sx:{width:900,margin:"auto"},children:e.jsx(Te,{columns:w,data:((t==null?void 0:t.data)||[]).map(d=>({id:d,key:d}))})})]})}const ta=async n=>(console.log("Đang gọi API xuất Excel với filter:",n),(await M.get("/excel/export-by-user",{params:{academicYearId:n.academicYearId,proofStatus:n.proofStatus,source:n.source,onlyRegisteredWorks:n.onlyRegisteredWorks,onlyRegisterableWorks:n.onlyRegisterableWorks},responseType:"blob"})).data),sa=()=>{const[n,t]=l.useState(!1),[s,o]=l.useState(null),[h,p]=l.useState([]),[f,T]=l.useState([]),{user:g}=Re(),[w,d]=l.useState({academicYearId:"",proofStatus:void 0,source:void 0,onlyRegisteredWorks:!1,onlyRegisterableWorks:!1,isCurrentUser:!0});l.useEffect(()=>{(async()=>{try{const H=await on();T(H.data||[])}catch(H){o("Lỗi khi tải dữ liệu ban đầu"),console.error("Error fetching initial data:",H)}})()},[]);const C=c=>{const{name:H,checked:m}=c.target;d(b=>({...b,[H]:m}))},j=c=>{const{name:H,value:m}=c.target;d(H==="proofStatus"||H==="source"?b=>({...b,[H]:m===""?void 0:Number(m)}):b=>({...b,[H]:m}))},u=async()=>{t(!0),o(null);try{const c=await an(w);p(c.data||[])}catch(c){console.error("Error fetching works:",c),o("Lỗi khi tải danh sách công trình")}finally{t(!1)}},v=()=>{d({academicYearId:"",proofStatus:void 0,source:void 0,onlyRegisteredWorks:!1,onlyRegisterableWorks:!1,isCurrentUser:!0})},L=c=>{switch(c){case Ae.NguoiDungKeKhai:return"Người dùng kê khai";case Ae.QuanLyNhap:return"Quản lý nhập";default:return"N/A"}},q=c=>{switch(c){case oe.HopLe:return e.jsx(De,{title:"Hợp lệ",children:e.jsx(Ue,{icon:e.jsx(_e,{}),label:"Hợp lệ",color:"success",size:"small"})});case oe.KhongHopLe:return e.jsx(De,{title:"Không hợp lệ",children:e.jsx(Ue,{icon:e.jsx(Ze,{}),label:"Không hợp lệ",color:"error",size:"small"})});case oe.ChuaXuLy:return e.jsx(De,{title:"Chưa xử lý",children:e.jsx(Ue,{icon:e.jsx(en,{}),label:"Chưa xử lý",color:"warning",size:"small"})});default:return null}},W=[{field:"stt",headerName:"STT",width:70,renderCell:c=>{const m=c.api.getAllRowIds().indexOf(c.id);return e.jsx("div",{children:m+1})}},{field:"title",headerName:"Tên công trình",type:"string",width:250},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:170},{field:"workLevelName",headerName:"Cấp công trình",type:"string",width:150},{field:"source",headerName:"Nguồn",type:"string",width:150,renderCell:c=>e.jsx("div",{children:L(c.value)})},{field:"academicYearName",headerName:"Năm học",type:"string",width:150},{field:"proofStatus",headerName:"Trạng thái xác minh",type:"string",width:150,renderCell:c=>{var b;const m=(b=c.row.authors)==null?void 0:b.find(r=>r.userId===(g==null?void 0:g.id));return m?q(m.proofStatus):null}},{field:"isRegistered",headerName:"Trạng thái đăng ký",type:"string",width:150,renderCell:c=>{var r;const m=(r=c.row.authors)==null?void 0:r.find(a=>a.userId===(g==null?void 0:g.id)),b=(m==null?void 0:m.authorRegistration)!=null;return e.jsx(Ue,{label:b?"Đã đăng ký":"Chưa đăng ký",color:b?"success":"default",size:"small"})}}],S=async()=>{try{t(!0);const c=await ta(w),H=window.URL.createObjectURL(c),m=document.createElement("a");m.href=H,m.setAttribute("download","KeKhaiCongTrinh_".concat(new Date().toISOString().slice(0,10),".xlsx")),document.body.appendChild(m),m.click(),document.body.removeChild(m),window.URL.revokeObjectURL(H)}catch(c){console.error("Lỗi khi export:",c),o("Lỗi khi xuất file Excel")}finally{t(!1)}};return e.jsxs(ze,{maxWidth:"xl",sx:{mt:4,mb:4},children:[e.jsxs(ve,{sx:{p:3,mb:3,borderRadius:2,boxShadow:3},children:[e.jsxs(We,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(P,{variant:"h6",display:"flex",alignItems:"center",color:"primary",children:[e.jsx(hn,{sx:{mr:1}}),"Bộ lọc"]}),e.jsxs(We,{direction:"row",spacing:2,children:[e.jsx(k,{variant:"outlined",color:"primary",onClick:v,startIcon:e.jsx(rt,{}),children:"Đặt lại"}),e.jsx(k,{variant:"contained",color:"primary",onClick:u,disabled:n,startIcon:n?e.jsx(J,{size:20}):e.jsx(hn,{}),children:"Tìm kiếm"})]})]}),e.jsx(Ee,{sx:{mb:3}}),e.jsxs(U,{container:!0,spacing:3,children:[e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ce,{fullWidth:!0,size:"small",children:[e.jsx(Ce,{children:"Năm học"}),e.jsxs(ke,{name:"academicYearId",value:w.academicYearId||"",onChange:j,label:"Năm học",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),f.map(c=>e.jsx(F,{value:c.id,children:c.name},c.id))]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ce,{fullWidth:!0,size:"small",children:[e.jsx(Ce,{children:"Trạng thái xác minh"}),e.jsxs(ke,{name:"proofStatus",value:w.proofStatus!==void 0?w.proofStatus:"",onChange:j,label:"Trạng thái xác minh",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),e.jsx(F,{value:oe.HopLe,children:"Hợp lệ"}),e.jsx(F,{value:oe.KhongHopLe,children:"Không hợp lệ"}),e.jsx(F,{value:oe.ChuaXuLy,children:"Chưa xử lý"})]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ce,{fullWidth:!0,size:"small",children:[e.jsx(Ce,{children:"Nguồn"}),e.jsxs(ke,{name:"source",value:w.source!==void 0?w.source:"",onChange:j,label:"Nguồn",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),e.jsx(F,{value:Ae.NguoiDungKeKhai,children:"Người dùng kê khai"}),e.jsx(F,{value:Ae.QuanLyNhap,children:"Quản lý nhập"})]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(Ve,{control:e.jsx(Oe,{checked:w.onlyRegisteredWorks,onChange:C,name:"onlyRegisteredWorks"}),label:"Công trình đã đăng ký"}),e.jsx(Ve,{control:e.jsx(Oe,{checked:w.onlyRegisterableWorks,onChange:C,name:"onlyRegisterableWorks"}),label:"Công trình có thể đăng ký"})]})})]})]}),e.jsxs(ve,{sx:{p:3,borderRadius:2,boxShadow:3},children:[e.jsxs(We,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(P,{variant:"h6",display:"flex",alignItems:"center",children:[e.jsxs("span",{children:["Kết quả (",h.length," công trình)"]}),n&&e.jsx(J,{size:24,sx:{ml:2}})]}),e.jsx(k,{variant:"outlined",color:"primary",onClick:S,startIcon:e.jsx(ds,{}),disabled:h.length===0,children:"Xuất Excel"})]}),s&&e.jsx(Fe,{severity:"error",sx:{mb:2},children:s}),h.length===0&&!n?e.jsx(Fe,{severity:"info",children:"Không có công trình nào được tìm thấy. Vui lòng thay đổi bộ lọc hoặc thử lại."}):e.jsx(Te,{columns:W,data:h})]})]})},ra=()=>{const[n,t]=l.useState(!1),[s,o]=l.useState(null),[h,p]=l.useState([]),[f,T]=l.useState([]),[g,w]=l.useState([]),{user:d}=Re(),[C,j]=l.useState({academicYearId:"",departmentId:"",userId:"",proofStatus:void 0,source:void 0,onlyRegisteredWorks:!1});l.useEffect(()=>{(async()=>{try{const[b,r]=await Promise.all([on(),(d==null?void 0:d.role)==="Manager"?lt(d.id):Ge()]);T(b.data||[]),w(r.data||[])}catch(b){o("Lỗi khi tải dữ liệu ban đầu"),console.error("Error fetching initial data:",b)}})()},[d]);const{data:u}=ne({queryKey:["users","department",C.departmentId],queryFn:()=>at(C.departmentId||""),enabled:!!C.departmentId}),v=(u==null?void 0:u.data)||[],L=m=>{const{name:b,checked:r}=m.target;j(a=>({...a,[b]:r}))},q=m=>{const{name:b,value:r}=m.target;j(b==="proofStatus"||b==="source"?a=>({...a,[b]:r===""?void 0:Number(r)}):a=>({...a,[b]:r})),b==="departmentId"&&j(a=>({...a,userId:""}))},W=async()=>{t(!0),o(null);try{const m=await an({...C,isCurrentUser:!1});p(m.data||[])}catch(m){console.error("Error fetching works:",m),o("Lỗi khi tải danh sách công trình")}finally{t(!1)}},S=()=>{j({academicYearId:"",departmentId:"",userId:"",proofStatus:void 0,source:void 0,onlyRegisteredWorks:!1})},c=m=>{switch(m){case Ae.NguoiDungKeKhai:return"Người dùng kê khai";case Ae.QuanLyNhap:return"Quản lý nhập";default:return"N/A"}},H=[{field:"stt",headerName:"STT",width:70,renderCell:m=>{const r=m.api.getAllRowIds().indexOf(m.id);return e.jsx("div",{children:r+1})}},{field:"title",headerName:"Tên công trình",type:"string",width:250},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:170},{field:"workLevelName",headerName:"Cấp công trình",type:"string",width:150},{field:"source",headerName:"Nguồn",type:"string",width:150,renderCell:m=>e.jsx("div",{children:c(m.value)})},{field:"academicYearName",headerName:"Năm học",type:"string",width:150},{field:"departmentName",headerName:"Phòng ban",type:"string",width:200},{field:"authorRoleName",headerName:"Vai trò tác giả",type:"string",width:150,renderCell:m=>{var a;const r=(a=m.row.authors)==null?void 0:a.find(y=>y.userId===(d==null?void 0:d.id));return e.jsx("div",{children:r?r.authorRoleName:"-"})}},{field:"position",headerName:"Vị trí",type:"string",width:80,renderCell:m=>{var a;const r=(a=m.row.authors)==null?void 0:a.find(y=>y.userId===(d==null?void 0:d.id));return e.jsx("div",{children:(r==null?void 0:r.position)!==void 0&&(r==null?void 0:r.position)!==null?r.position:"-"})}},{field:"purposeName",headerName:"Mục đích quy đổi",type:"string",width:180,renderCell:m=>{var a;const r=(a=m.row.authors)==null?void 0:a.find(y=>y.userId===(d==null?void 0:d.id));return e.jsx("div",{children:r?r.purposeName:"-"})}},{field:"fieldName",headerName:"Ngành tính điểm",type:"string",width:150,renderCell:m=>{var a;const r=(a=m.row.authors)==null?void 0:a.find(y=>y.userId===(d==null?void 0:d.id));return e.jsx("div",{children:r?r.fieldName:"-"})}},{field:"scImagoFieldName",headerName:"Ngành SCImago",type:"string",width:180,renderCell:m=>{var a;const r=(a=m.row.authors)==null?void 0:a.find(y=>y.userId===(d==null?void 0:d.id));return e.jsx("div",{children:r?r.scImagoFieldName:"-"})}},{field:"scoreLevel",headerName:"Mức điểm",type:"string",width:150,renderCell:m=>{var a;const r=(a=m.row.authors)==null?void 0:a.find(y=>y.userId===(d==null?void 0:d.id));return!r||r.scoreLevel===void 0||r.scoreLevel===null?e.jsx("div",{children:"-"}):e.jsx("div",{children:rn(r.scoreLevel)})}},{field:"workHour",headerName:"Giờ công trình",type:"string",width:120,renderCell:m=>{var a;const r=(a=m.row.authors)==null?void 0:a.find(y=>y.userId===(d==null?void 0:d.id));return e.jsx("div",{children:(r==null?void 0:r.workHour)!==void 0&&(r==null?void 0:r.workHour)!==null?r.workHour:"-"})}},{field:"authorHour",headerName:"Giờ tác giả",type:"string",width:120,renderCell:m=>{var a;const r=(a=m.row.authors)==null?void 0:a.find(y=>y.userId===(d==null?void 0:d.id));return e.jsx("div",{children:(r==null?void 0:r.authorHour)!==void 0&&(r==null?void 0:r.authorHour)!==null?r.authorHour:"-"})}},{field:"proofStatus",headerName:"Trạng thái",type:"string",width:140,renderCell:m=>{var y;const r=(y=m.row.authors)==null?void 0:y.find(x=>x.userId===(d==null?void 0:d.id)),a=r==null?void 0:r.proofStatus;return a==null?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"}):a===oe.HopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(_e,{color:"success"}),"Hợp lệ"]}):a===oe.KhongHopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Ze,{color:"error"}),"Không hợp lệ"]}):a===oe.ChuaXuLy?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(en,{color:"action"}),"Chưa xử lý"]}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"})}},{field:"isRegistered",headerName:"Trạng thái đăng ký",type:"string",width:150,renderCell:m=>{const b=m.row.authors&&m.row.authors[0],r=(b==null?void 0:b.authorRegistration)!=null;return e.jsx(Ue,{label:r?"Đã đăng ký":"Chưa đăng ký",color:r?"success":"default",size:"small"})}}];return e.jsxs(ze,{maxWidth:"xl",sx:{mt:4,mb:4},children:[e.jsxs(ve,{sx:{p:3,mb:3,borderRadius:2,boxShadow:3},children:[e.jsxs(We,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(P,{variant:"h6",display:"flex",alignItems:"center",color:"primary",children:[e.jsx(hn,{sx:{mr:1}}),"Bộ lọc"]}),e.jsxs(We,{direction:"row",spacing:2,children:[e.jsx(k,{variant:"outlined",color:"primary",onClick:S,startIcon:e.jsx(rt,{}),children:"Đặt lại"}),e.jsx(k,{variant:"contained",color:"primary",onClick:W,disabled:n,startIcon:n?e.jsx(J,{size:20}):e.jsx(hn,{}),children:"Tìm kiếm"})]})]}),e.jsx(Ee,{sx:{mb:3}}),e.jsxs(U,{container:!0,spacing:3,children:[e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ce,{fullWidth:!0,size:"small",children:[e.jsx(Ce,{children:"Năm học"}),e.jsxs(ke,{name:"academicYearId",value:C.academicYearId||"",onChange:q,label:"Năm học",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),f.map(m=>e.jsx(F,{value:m.id,children:m.name},m.id))]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ce,{fullWidth:!0,size:"small",children:[e.jsx(Ce,{children:"Phòng ban"}),e.jsxs(ke,{name:"departmentId",value:C.departmentId||"",onChange:q,label:"Phòng ban",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),g.map(m=>e.jsx(F,{value:m.id,children:m.name},m.id))]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ce,{fullWidth:!0,size:"small",children:[e.jsx(Ce,{children:"Người dùng"}),e.jsxs(ke,{name:"userId",value:C.userId||"",onChange:q,label:"Người dùng",disabled:!C.departmentId,children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),v.map(m=>e.jsxs(F,{value:m.id,children:[m.userName," - ",m.fullName]},m.id))]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ce,{fullWidth:!0,size:"small",children:[e.jsx(Ce,{children:"Trạng thái xác minh"}),e.jsxs(ke,{name:"proofStatus",value:C.proofStatus!==void 0?C.proofStatus:"",onChange:q,label:"Trạng thái xác minh",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),e.jsx(F,{value:oe.HopLe,children:"Hợp lệ"}),e.jsx(F,{value:oe.KhongHopLe,children:"Không hợp lệ"}),e.jsx(F,{value:oe.ChuaXuLy,children:"Chưa xử lý"})]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(ce,{fullWidth:!0,size:"small",children:[e.jsx(Ce,{children:"Nguồn"}),e.jsxs(ke,{name:"source",value:C.source!==void 0?C.source:"",onChange:q,label:"Nguồn",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),e.jsx(F,{value:Ae.NguoiDungKeKhai,children:"Người dùng kê khai"}),e.jsx(F,{value:Ae.QuanLyNhap,children:"Quản lý nhập"})]})]})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(Ve,{control:e.jsx(Oe,{checked:C.onlyRegisteredWorks,onChange:L,name:"onlyRegisteredWorks"}),label:"Chỉ hiển thị công trình đã đăng ký"})})]})]}),e.jsxs(ve,{sx:{p:3,borderRadius:2,boxShadow:3},children:[e.jsx(We,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:e.jsxs(P,{variant:"h6",display:"flex",alignItems:"center",children:[e.jsxs("span",{children:["Kết quả (",h.length," công trình)"]}),n&&e.jsx(J,{size:24,sx:{ml:2}})]})}),s&&e.jsx(Fe,{severity:"error",sx:{mb:2},children:s}),h.length===0&&!n?e.jsx(Fe,{severity:"info",children:"Không có công trình nào được tìm thấy. Vui lòng thay đổi bộ lọc hoặc thử lại."}):e.jsx(Te,{columns:H,data:h})]})]})},ia=hs([{element:e.jsx(Ls,{}),children:[{element:e.jsx(be,{}),children:[{path:"/",Component:Ms,children:[{path:"/",element:e.jsx(rr,{})},{path:"/cong-trinh",element:e.jsx(be,{allowedRoles:["User","Manager"],children:e.jsx(ri,{})})},{path:"dang-ky-quy-doi",element:e.jsx(be,{allowedRoles:["User"],children:e.jsx(Vi,{})})},{path:"/cham-diem",element:e.jsx(be,{allowedRoles:["Manager","Admin"],children:e.jsx(_i,{})})},{path:"/cham-diem/user/:userId",element:e.jsx(be,{allowedRoles:["Manager","Admin"],children:e.jsx(Qi,{})})},{path:"/phan-cong",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(Ni,{})})},{path:"/cap-nhat-thong-tin",element:e.jsx(be,{children:e.jsx(Yi,{})})},{path:"/test",element:e.jsx(be,{allowedRoles:["User","Manager","Admin"],children:e.jsx(ci,{})})},{path:"/bao-cao",element:e.jsx(be,{allowedRoles:["User","Manager"],children:e.jsx(sa,{})})},{path:"/thong-ke",element:e.jsx(be,{allowedRoles:["Admin","Manager"],children:e.jsx(ra,{})})},{path:"/quan-ly-tai-khoan",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(Ei,{})})},{path:"/cau-hinh-he-thong",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(Ri,{})})},{path:"/cai-dat",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(ir,{})})},{path:"/cai-dat/loai-cong-trinh",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(bi,{})})},{path:"/cai-dat/cap-cong-trinh",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(yi,{})})},{path:"/cai-dat/vai-tro-tac-gia",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(pr,{})})},{path:"/cai-dat/muc-dich-quy-doi",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(ui,{})})},{path:"/cai-dat/he-so-quy-doi",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(Ar,{})})},{path:"/cai-dat/nganh-scimago",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(pi,{})})},{path:"/cai-dat/don-vi",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(yr,{})})},{path:"/cai-dat/nganh",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(Fr,{})})},{path:"/cai-dat/nam-hoc",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(Ai,{})})},{path:"/cai-dat/quan-ly-cache",element:e.jsx(be,{allowedRoles:["Admin"],children:e.jsx(na,{})})}]}]}]},{path:"/dang-ky",element:e.jsx(sr,{})},{path:"/dang-nhap",element:e.jsx(Gs,{})},{path:"/unauthorized",element:e.jsx(zi,{})},{path:"*",element:e.jsx(Ui,{})}]);us.createRoot(document.getElementById("root")).render(e.jsx(l.StrictMode,{children:e.jsx(ms,{theme:ps,children:e.jsx(Is,{children:e.jsx(gs,{router:ia})})})}));export{aa as __vite_legacy_guard};
