import{c as kt,u as bn,j as e,D as he,a as ue,b as ge,d as Xn,e as me,B as C,f as $n,r as l,g as vt,h as Cn,C as Yn,L as It,i as _n,R as Zn,A as Jn,M as et,k as Tt,l as St,S as Nt,Q as qt,m as $e,y as A,n as Lt,o as Pt,p as At,O as kn,q as Wt,s as Ae,T as L,t as Ke,G as U,v as vn,w as Dt,x as Rt,z as He,E as fe,F as ne,H as Ft,I as en,J as Ht,N as Kt,K as Mt,P as F,U as J,V as z,W as Et,X as Bt,Y as Ut,Z as Ne,_,$ as gn,a0 as hn,a1 as Se,a2 as nt,a3 as De,a4 as pe,a5 as Me,a6 as B,a7 as fn,a8 as jn,a9 as yn,aa as qe,ab as zt,ac as Z,ad as ve,ae as Ie,af as Vt,ag as Ot,ah as tt,ai as xe,aj as Ve,ak as Oe,al as Ce,am as Ee,an as Ze,ao as Je,ap as Ye,aq as st,ar as In,as as Gt,at as Qt,au as En,av as Xt,aw as $t,ax as Yt,ay as _t,az as Zt,aA as Jt,aB as Bn,aC as Be,aD as es,aE as Re,aF as nn,aG as rt,aH as it,aI as at,aJ as Xe,aK as le,aL as ot,aM as Un,aN as zn,aO as Vn,aP as On,aQ as ns,aR as ts,aS as ss,aT as Qe,aU as Gn,aV as rs,aW as is,aX as as,aY as os,aZ as ls,a_ as cs,a$ as un,b0 as lt,b1 as ds,b2 as hs,b3 as us,b4 as gs,b5 as ms}from"./vendor-CqIGymjd.js";function oa(){import.meta.url,import("_").catch(()=>1),async function*(){}().next()}(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const g of document.querySelectorAll('link[rel="modulepreload"]'))a(g);new MutationObserver(g=>{for(const j of g)if(j.type==="childList")for(const f of j.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&a(f)}).observe(document,{childList:!0,subtree:!0});function s(g){const j={};return g.integrity&&(j.integrity=g.integrity),g.referrerPolicy&&(j.referrerPolicy=g.referrerPolicy),g.crossOrigin==="use-credentials"?j.credentials="include":g.crossOrigin==="anonymous"?j.credentials="omit":j.credentials="same-origin",j}function a(g){if(g.ep)return;g.ep=!0;const j=s(g);fetch(g.href,j)}})();const ps=kt({cssVariables:{colorSchemeSelector:"data-toolpad-color-scheme"},colorSchemes:{light:!0,dark:!0}});function xs(n){const t=["-","","Unknown"];return t.includes(n.email)||t.includes(n.phoneNumber)||t.includes(n.specialization)||t.includes(n.academicTitle)||t.includes(n.officerRank)||t.includes(n.fieldName)||n.fieldId==="00000000-0000-0000-0000-000000000000"}function fs({open:n,onClose:t}){return bn().pathname==="/cap-nhat-thong-tin"?null:e.jsxs(he,{open:n,onClose:t,children:[e.jsx(ue,{children:"Câp nhật thông tin"}),e.jsx(ge,{children:e.jsx(Xn,{children:"Vui lòng cập nhật thông tin trước khi sử dụng hệ thống."})}),e.jsx(me,{children:e.jsx(C,{onClick:t,autoFocus:!0,children:"Câp nhật thông tin"})})]})}function js({open:n,onClose:t}){return e.jsxs(he,{open:n,onClose:t,children:[e.jsx(ue,{children:"Phiên đăng nhập đã hết hạn"}),e.jsx(ge,{children:e.jsx(Xn,{children:"Vui lòng đăng nhập lại để tiếp tục sử dụng hệ thống."})}),e.jsx(me,{children:e.jsx(C,{onClick:t,autoFocus:!0,children:"Đăng nhập lại"})})]})}const K=$n.create({baseURL:"/api",headers:{"Content-Type":"application/json"},timeout:1e4});K.interceptors.request.use(n=>{const t=localStorage.getItem("token");return t&&(n.headers.Authorization="Bearer ".concat(t)),n},n=>Promise.reject(n));const ys=async n=>(await K.get("/users/search?searchTerm=".concat(encodeURIComponent(n)))).data,_e=async n=>(await K.get("/users/".concat(n))).data,ws=async()=>(await K.get("/users")).data,ct=async()=>(await K.get("/users/me")).data,bs=async(n,t)=>(await K.put("/users/".concat(n),t)).data,Cs=async(n,t)=>(await K.put("/users/admin/".concat(n),t)).data,ks=async n=>(await K.delete("/users/".concat(n))).data,dt=async n=>(await K.get("/users/department/".concat(n))).data,vs=async n=>(await K.get("/users/conversionresult/".concat(n))).data,Is=async n=>{const t=new FormData;return t.append("file",n),(await K.post("/users/import",t,{headers:{"Content-Type":"multipart/form-data"}})).data},ht=l.createContext(void 0),Ts=({children:n})=>{const[t,s]=l.useState(null),[a,g]=l.useState(!0),j=async()=>{const T=localStorage.getItem("token");if(!T){s(null),g(!1);return}try{const m=await ct();if(m.success){const w=m.data;w.role=vt(T)["http://schemas.microsoft.com/ws/2008/06/identity/claims/role"],s(w)}}catch(m){console.error("Failed to fetch user info:",m),localStorage.removeItem("token"),localStorage.removeItem("expiration"),s(null)}finally{g(!1)}};l.useEffect(()=>{j()},[]);const f=()=>{localStorage.removeItem("token"),localStorage.removeItem("expiration"),s(null),window.location.href="/dang-nhap"};return e.jsx(ht.Provider,{value:{user:t,setUser:s,signOut:f,loading:a,refreshUserInfo:j},children:n})},Fe=()=>{const n=l.useContext(ht);if(!n)throw new Error("useAuth must be used within an AuthProvider");return n},Ss=[{kind:"header",title:"Chính"},{title:"Trang chủ",icon:e.jsx(Cn,{})},{segment:"cong-trinh",title:"Công trình",icon:e.jsx(Yn,{})},{segment:"dang-ky-quy-doi",title:"Đăng ký quy đổi",icon:e.jsx(It,{})},{kind:"header",title:"Báo cáo"},{segment:"bao-cao",title:"Báo cáo",icon:e.jsx(_n,{})}],Ns=[{kind:"header",title:"Chính"},{title:"Trang chủ",icon:e.jsx(Cn,{})},{segment:"cong-trinh",title:"Công trình",icon:e.jsx(Yn,{})},{segment:"cham-diem",title:"Chấm điểm công trình",icon:e.jsx(Zn,{})},{kind:"header",title:"Báo cáo"},{segment:"bao-cao",title:"Báo cáo",icon:e.jsx(_n,{})},{segment:"thong-ke",title:"Thống kê",icon:e.jsx(Jn,{})},{kind:"header",title:"Hệ thống"},{segment:"quan-ly-tai-khoan",title:"Quản lý tài khoản",icon:e.jsx(et,{})}],qs=[{kind:"header",title:"Chính"},{title:"Trang chủ",icon:e.jsx(Cn,{})},{segment:"cham-diem",title:"Chấm điểm công trình",icon:e.jsx(Zn,{})},{segment:"phan-cong",title:"Phân công chấm điểm",icon:e.jsx(Tt,{})},{kind:"header",title:"Báo cáo"},{segment:"thong-ke",title:"Thống kê",icon:e.jsx(Jn,{})},{kind:"header",title:"Hệ thống"},{segment:"quan-ly-tai-khoan",title:"Quản lý tài khoản",icon:e.jsx(et,{})},{segment:"cau-hinh-he-thong",title:"Cấu hình hệ thống",icon:e.jsx(St,{})},{segment:"cai-dat",title:"Quản lý danh mục",icon:e.jsx(Nt,{}),children:[{segment:"he-so-quy-doi",title:"Hệ số quy đổi"},{segment:"muc-dich-quy-doi",title:"Mục đích quy đổi"},{segment:"vai-tro-tac-gia",title:"Vai trò tác giả"},{kind:"divider"},{segment:"loai-cong-trinh",title:"Loại công trình"},{segment:"cap-cong-trinh",title:"Cấp công trình"},{segment:"nganh-scimago",title:"Ngành SCImago"},{kind:"divider"},{segment:"don-vi",title:"Đơn vị"},{segment:"nganh",title:"Ngành"},{segment:"nam-hoc",title:"Năm học"}]}],Ls={logo:e.jsx("img",{src:"/logo.png",alt:"SGU"}),title:"SGU - NCKH"};function Ps(){const[n,t]=l.useState(null),[s,a]=l.useState(!1),[g,j]=l.useState(!1),{user:f,loading:T}=Fe(),m=f==null?void 0:f.role,w=l.useMemo(()=>{switch(m){case"Admin":return qs;case"Manager":return Ns;case"User":return Ss;default:return[]}},[m]),d=new qt,y=bn(),b=$e();l.useEffect(()=>{A.dismiss()},[y]);const u=l.useMemo(()=>({signIn:()=>{b("/dang-nhap")},signOut:()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),t(null),b("/dang-nhap")}}),[]);return l.useEffect(()=>{f?(xs(f)&&y.pathname!=="/cap-nhat-thong-tin"?j(!0):j(!1),t({user:f})):T||t(null)},[f,T,y.pathname]),l.useEffect(()=>{const k=localStorage.getItem("expiration");if(!k)return;const P=new Date(k).getTime()-Date.now();if(P>0){const q=setTimeout(()=>{a(!0),u.signOut()},P);return()=>clearTimeout(q)}else a(!0),u.signOut()},[]),e.jsx(Lt,{navigation:w,branding:Ls,session:n,authentication:u,children:e.jsxs(Pt,{client:d,children:[e.jsx(At,{position:"top-right",autoClose:2e3}),e.jsx(kn,{}),e.jsx(js,{open:s,onClose:()=>b("/dang-nhap")}),e.jsx(fs,{open:g,onClose:()=>b("/cap-nhat-thong-tin")})]})})}const As={CN:"Cử nhân",ThS:"Thạc sĩ",TS:"Tiến sĩ",PGS_TS:"Phó Giáo sư, Tiến sĩ",GS_TS:"Giáo sư, Tiến sĩ",Unknown:"-"},tn=n=>As[n]||"-",Ws={GiaoVien:"Giáo viên",ChuyenVien:"Chuyên viên",ChuyenVienChinh:"Chuyên viên chính",ChuyenVienCaoCap:"Chuyên viên cao cấp",TroGiang:"Trợ giảng",GiangVien:"Giảng viên",GiangVienChinh:"Giảng viên chính",GiangVienCaoCap:"Giảng viên cao cấp",Unknown:"-"},sn=n=>Ws[n]||"-";function Ds(){const n=Wt();return!n||!n.user?null:e.jsxs(Ae,{sx:{maxWidth:350,padding:2},children:[n.user&&e.jsxs(Ae,{mb:1,children:[e.jsx(L,{variant:"h6",fontWeight:600,children:n.user.fullName}),e.jsx(L,{variant:"body2",children:n.user.fieldName}),e.jsx(L,{variant:"body2",fontWeight:300,children:n.user.userName}),e.jsx(Ke,{sx:{my:1}}),e.jsxs(U,{container:!0,spacing:2,children:[e.jsx(U,{item:!0,xs:6,children:e.jsx(L,{variant:"body2",children:"Email:"})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(L,{variant:"body2",children:n.user.email})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(L,{variant:"body2",children:"Học vị:"})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(L,{variant:"body2",children:tn(n.user.academicTitle)})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(L,{variant:"body2",children:"Ngạch viên chức:"})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(L,{variant:"body2",children:sn(n.user.officerRank)})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(L,{variant:"body2",children:"Đơn vị công tác:"})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(L,{variant:"body2",children:n.user.departmentName})})]}),e.jsx(vn,{href:"/cap-nhat-thong-tin",sx:{marginTop:2},children:"Chỉnh sửa thông tin"})]}),e.jsx(Ke,{}),e.jsx(Dt,{children:e.jsx(Rt,{})})]})}const Rs=async()=>(await K.get("/notifications/global")).data,Fs=async()=>(await K.get("/notifications/me")).data,Hs=async n=>(await K.put("/notifications/".concat(n))).data;function wn(n){return He.fromISO(n).setLocale("vi").toFormat("d LLLL yyyy, HH:mm")}function Ks(){const[n,t]=l.useState(null),s=!!n,a=fe(),{data:g,isLoading:j,refetch:f}=ne({queryKey:["notifications"],queryFn:Fs});l.useEffect(()=>{const b=new Ft().withUrl("/notification-hub?access_token=".concat(localStorage.getItem("token"))).withAutomaticReconnect().build();return b.on("ReceiveNotification",()=>{f()}),b.start().catch(console.error),()=>{b.stop()}},[f]);const T=(g==null?void 0:g.data)||[],m=T.filter(b=>!b.isRead).length,w=b=>{t(b.currentTarget)},d=()=>{t(null)},y=async b=>{try{await Hs(b),a.invalidateQueries({queryKey:["notifications"]}),f()}catch(u){console.error("Error marking notification as read",u)}finally{d()}};return e.jsxs(e.Fragment,{children:[e.jsx(en,{id:"notification-button","aria-controls":s?"notification-menu":void 0,"aria-haspopup":"true","aria-expanded":s?"true":void 0,onClick:w,children:e.jsx(Ht,{badgeContent:m,color:"error",children:e.jsx(Kt,{color:"primary"})})}),e.jsx(Mt,{id:"notification-menu",anchorEl:n,open:s,onClose:d,anchorOrigin:{vertical:"bottom",horizontal:"right"},transformOrigin:{vertical:"top",horizontal:"right"},PaperProps:{sx:{minWidth:300,maxHeight:400}},MenuListProps:{"aria-labelledby":"notification-button"},children:j?e.jsx(F,{sx:{p:1},children:e.jsx(J,{size:20})}):T.length>0?[...T].sort((b,u)=>b.isRead===u.isRead?0:b.isRead?1:-1).map(b=>e.jsxs(F,{sx:{display:"flex",flexDirection:"column",justifyContent:"space-between",alignItems:"flex-start",backgroundColor:b.isRead?"transparent":"action.selected"},children:[e.jsx(L,{variant:"body2",sx:{fontWeight:b.isRead?"normal":"bold",mr:1,flex:1},children:b.content}),e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",gap:2,children:[e.jsx(L,{variant:"body2",sx:{whiteSpace:"nowrap",fontSize:"0.7rem",color:"text.secondary"},children:wn(b.createdDate.toString())}),e.jsx(C,{size:"small",variant:"outlined",color:"primary",disabled:b.isRead,onClick:()=>y(b.id),children:b.isRead?"Đã đọc":"Đánh dấu đã đọc"})]})]},b.id)):e.jsx(F,{onClick:d,sx:{p:1},children:e.jsx(L,{variant:"body2",children:"Không có thông báo nào để hiển thị."})})})]})}function Ms(){return e.jsxs(z,{display:"flex",alignItems:"center",gap:2,children:[e.jsx(Ks,{}),e.jsx(Et,{slots:{popoverContent:Ds},localeText:{signOutLabel:"Đăng xuất"}})]})}function Es(){return e.jsx(Bt,{slots:{toolbarAccount:Ms},children:e.jsx(Ut,{children:e.jsx(kn,{})})})}const Bs=async n=>(await K.post("/auth/register",n)).data,Us=async n=>(await K.post("/auth/login",n)).data,zs=async(n,t)=>(await K.post("/auth/change-password",{currentPassword:n,newPassword:t})).data,Vs=Ne({username:_().min(0,"Mã số giảng viên là bắt buộc").max(9,"Mã số giảng viên không hợp lệ"),password:_().min(6,"Mật khẩu phải có ít nhất 6 ký tự")}),Os=gn(hn)(({theme:n})=>({display:"flex",flexDirection:"column",alignSelf:"center",width:"100%",padding:n.spacing(6),gap:n.spacing(2),margin:"auto",boxShadow:"0px 5px 15px rgba(0,0,0,0.05)",[n.breakpoints.up("sm")]:{width:"450px"}})),Gs=gn(Ae)(({theme:n})=>({padding:n.spacing(2),[n.breakpoints.up("sm")]:{padding:n.spacing(4)},"&::before":{content:'""',display:"block",position:"absolute",zIndex:-1,inset:0,backgroundImage:"radial-gradient(ellipse at 50% 50%, hsl(210, 100%, 97%), hsl(0, 0%, 100%))",backgroundRepeat:"no-repeat",...n.applyStyles("dark",{backgroundImage:"radial-gradient(at 50% 50%, hsla(210, 100%, 16%, 0.5), hsl(220, 30%, 5%))"})}}));function Qs(){var q,H;const{register:n,handleSubmit:t,formState:{errors:s}}=Se({resolver:qe(Vs),mode:"onTouched",shouldUnregister:!0}),{refreshUserInfo:a}=Fe(),[g,j]=l.useState(!1),[f,T]=l.useState(null),[m,w]=l.useState(!1),d=$e(),y=bn(),u=new URLSearchParams(y.search).get("registered")==="true",k=async v=>{var x,W;j(!0),T(null);try{const I=await Us({username:v.username,password:v.password});if(I.success){const p=I.data.token;localStorage.setItem("token",p),localStorage.setItem("expiration",I.data.expiration),await a(),d("/")}}catch(I){(W=(x=I.response)==null?void 0:x.data)!=null&&W.message?T(I.response.data.message):T("Đăng nhập thất bại: "+I.message)}finally{j(!1)}},P=()=>{w(v=>!v)};return e.jsxs(e.Fragment,{children:[e.jsx(nt,{enableColorScheme:!0}),e.jsx(Gs,{direction:"column",justifyContent:"space-between",sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2},children:e.jsx("form",{onSubmit:t(k),children:e.jsxs(Os,{variant:"outlined",children:[e.jsx("img",{src:"/logo.png",height:36,width:36,alt:"logo"}),e.jsx(L,{component:"h1",variant:"h4",fontWeight:600,children:"Đăng nhập"}),u&&e.jsx(De,{severity:"success",children:"Đăng ký thành công"}),f&&e.jsx(De,{severity:"error",children:f}),e.jsxs(pe,{fullWidth:!0,children:[e.jsx(Me,{htmlFor:"username",children:"Mã số giảng viên"}),e.jsx(B,{fullWidth:!0,id:"username",placeholder:"Nhập mã số giảng viên",...n("username"),error:!!s.username,helperText:(q=s.username)==null?void 0:q.message})]},"username"),e.jsxs(pe,{fullWidth:!0,children:[e.jsx(Me,{htmlFor:"password",children:"Mật khẩu"}),e.jsx(B,{fullWidth:!0,id:"password",placeholder:"Nhập mật khẩu",type:m?"text":"password",...n("password"),error:!!s.password,helperText:(H=s.password)==null?void 0:H.message,InputProps:{endAdornment:e.jsx(fn,{position:"end",children:e.jsx(en,{onClick:P,edge:"end","aria-label":"toggle password visibility",children:m?e.jsx(jn,{}):e.jsx(yn,{})})})}})]},"password"),e.jsx(z,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",gap:2,marginTop:3},children:e.jsx(C,{type:"submit",fullWidth:!0,variant:"contained",disabled:g,children:g?e.jsx(J,{size:24}):"Đăng nhập"})}),e.jsx(Ke,{sx:{marginY:2}}),e.jsxs(L,{sx:{textAlign:"center"},children:["Chưa có tài khoản?"," ",e.jsx(vn,{href:"/dang-ky",variant:"body2",sx:{alignSelf:"center"},children:"Đăng ký"})]})]})})})]})}const Ge=async()=>(await K.get("/departments")).data,ut=async n=>(await K.get("/departments/by-manager/".concat(n))).data,Xs=async n=>(await K.post("/departments",n)).data,$s=async(n,t)=>(await K.put("/departments/".concat(n),t)).data,Ys=async n=>(await K.delete("/departments/".concat(n))).data,rn=async()=>(await K.get("/fields")).data,_s=async n=>(await K.post("/fields",n)).data,Zs=async(n,t)=>(await K.put("/fields/".concat(n),t)).data,Js=async n=>(await K.delete("/fields/".concat(n))).data;var mn=(n=>(n[n.Unknown=0]="Unknown",n[n.CN=1]="CN",n[n.ThS=2]="ThS",n[n.TS=3]="TS",n[n.PGS_TS=4]="PGS_TS",n[n.GS_TS=5]="GS_TS",n))(mn||{}),pn=(n=>(n[n.Unknown=0]="Unknown",n[n.ChuyenVien=1]="ChuyenVien",n[n.ChuyenVienChinh=2]="ChuyenVienChinh",n[n.ChuyenVienCaoCap=3]="ChuyenVienCaoCap",n[n.TroGiang=4]="TroGiang",n[n.GiangVien=5]="GiangVien",n[n.GiangVienChinh=6]="GiangVienChinh",n[n.GiangVienCaoCap=7]="GiangVienCaoCap",n[n.GiaoVien=8]="GiaoVien",n))(pn||{});const er=gn(hn)(({theme:n})=>({display:"flex",flexDirection:"column",alignSelf:"center",width:"100%",padding:n.spacing(6),gap:n.spacing(2),margin:"auto",boxShadow:"0px 5px 15px rgba(0,0,0,0.05)",[n.breakpoints.up("sm")]:{width:"450px"}})),nr=gn(Ae)(({theme:n})=>({padding:n.spacing(2),[n.breakpoints.up("sm")]:{padding:n.spacing(4)},"&::before":{content:'""',display:"block",position:"absolute",zIndex:-1,inset:0,backgroundImage:"radial-gradient(ellipse at 50% 50%, hsl(210, 100%, 97%), hsl(0, 0%, 100%))",backgroundRepeat:"no-repeat",...n.applyStyles("dark",{backgroundImage:"radial-gradient(at 50% 50%, hsla(210, 100%, 16%, 0.5), hsl(220, 30%, 5%))"})}})),tr=Ne({username:_().min(8,"Mã số giảng viên là bắt buộc").max(9,"Mã số giảng viên không hợp lệ"),password:_().min(6,"Mật khẩu phải có ít nhất 6 ký tự"),confirmPassword:_().min(6,"Vui lòng xác nhận mật khẩu")}).refine(n=>n.password===n.confirmPassword,{message:"Mật khẩu không khớp",path:["confirmPassword"]}),sr=Ne({email:_().email("Email không hợp lệ"),fullname:_().min(2,"Họ và tên là bắt buộc"),phoneNumber:_().regex(/^(0|\+84)(3[2-9]|5[689]|7[06-9]|8[1-9]|9[0-9])\d{7}$/,"Vui lòng nhập số điện thoại"),specialization:_().min(1,"Chuyên ngành là bắt buộc"),academicTitle:_().min(1,"Vui lòng chọn học hàm / học vị"),officerRank:_().min(1,"Vui lòng chọn ngạch viên chức"),departmentId:_().min(1,"Vui lòng chọn phòng ban"),fieldId:_().min(1,"Vui lòng chọn lĩnh vực")}),rr=()=>{const[n,t]=l.useState(1),[s,a]=l.useState([]),[g,j]=l.useState([]),[f,T]=l.useState(null),[m,w]=l.useState(!1),[d,y]=l.useState(!1),[b,u]=l.useState(!1),k=n===1?0:50,P=Se({resolver:qe(tr),defaultValues:{username:"",password:"",confirmPassword:""}}),q=Se({resolver:qe(sr),defaultValues:{email:"",fullname:"",phoneNumber:"",specialization:"",academicTitle:"",officerRank:"",departmentId:"",fieldId:""}});l.useEffect(()=>{async function p(){const i=await Ge();a(i.data||[]);const r=await rn();j(r.data||[])}p()},[]);const H=()=>{t(2)},v=async p=>{w(!0),T(null);try{const i=P.getValues(),r={username:i.username,password:i.password,email:p.email,fullname:p.fullname,phoneNumber:p.phoneNumber,specialization:p.specialization,academicTitle:p.academicTitle||"",officerRank:p.officerRank||"",departmentId:p.departmentId,fieldId:p.fieldId},h=await Bs(r);h.success?window.location.href="/dang-nhap?registered=true":T(h.message||"Đăng ký không thành công. Vui lòng thử lại.")}catch(i){T("Có lỗi xảy ra. Vui lòng thử lại sau.")}finally{w(!1)}},x=()=>{t(1)},W=()=>{y(!d)},I=()=>{u(!b)};return e.jsxs(e.Fragment,{children:[e.jsx(nt,{enableColorScheme:!0}),e.jsx(nr,{direction:"column",justifyContent:"space-between",sx:{display:"flex",flexDirection:"column",alignItems:"center",gap:2,minHeight:"100vh"},children:e.jsxs(er,{variant:"outlined",children:[e.jsx("img",{src:"/logo.png",height:36,width:36,alt:"logo"}),e.jsx(L,{component:"h1",variant:"h4",fontWeight:600,children:"Đăng ký"}),e.jsx(zt,{variant:"determinate",value:k,sx:{width:"100%",maxWidth:450}}),f&&e.jsx(De,{severity:"error",children:f}),n===1?e.jsx("form",{onSubmit:P.handleSubmit(H),children:e.jsxs(Ae,{spacing:3,sx:{mt:2},children:[e.jsx(Z,{name:"username",control:P.control,render:({field:p,fieldState:i})=>{var r;return e.jsxs(pe,{fullWidth:!0,error:!!i.error,children:[e.jsx(Me,{htmlFor:"username",children:"Mã số giảng viên"}),e.jsx(B,{...p,id:"username",placeholder:"Nhập mã số giảng viên",fullWidth:!0,error:!!i.error,helperText:(r=i.error)==null?void 0:r.message})]})}},"username"),e.jsx(Z,{name:"password",control:P.control,render:({field:p,fieldState:i})=>{var r;return e.jsxs(pe,{fullWidth:!0,error:!!i.error,children:[e.jsx(Me,{htmlFor:"password",children:"Mật khẩu"}),e.jsx(B,{...p,id:"password",placeholder:"Nhập mật khẩu",type:d?"text":"password",fullWidth:!0,error:!!i.error,helperText:(r=i.error)==null?void 0:r.message,InputProps:{endAdornment:e.jsx(fn,{position:"end",children:e.jsx(en,{onClick:W,edge:"end",children:d?e.jsx(jn,{}):e.jsx(yn,{})})})}})]})}},"password"),e.jsx(Z,{name:"confirmPassword",control:P.control,render:({field:p,fieldState:i})=>{var r;return e.jsxs(pe,{fullWidth:!0,error:!!i.error,children:[e.jsx(Me,{htmlFor:"confirmPassword",children:"Xác nhận mật khẩu"}),e.jsx(B,{...p,id:"confirmPassword",placeholder:"Nhập lại mật khẩu",type:b?"text":"password",fullWidth:!0,error:!!i.error,helperText:(r=i.error)==null?void 0:r.message,InputProps:{endAdornment:e.jsx(fn,{position:"end",children:e.jsx(en,{onClick:I,edge:"end",children:b?e.jsx(jn,{}):e.jsx(yn,{})})})}})]})}},"confirmPassword"),e.jsx(C,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:m,children:"Tiếp tục"})]})}):e.jsx("form",{onSubmit:q.handleSubmit(v),children:e.jsxs(Ae,{spacing:3,sx:{mt:2},children:[e.jsx(Z,{name:"fullname",control:q.control,render:({field:p,fieldState:i})=>{var r;return e.jsxs(pe,{fullWidth:!0,error:!!i.error,children:[e.jsx(Me,{htmlFor:"fullname",children:"Họ và tên"}),e.jsx(B,{...p,id:"fullname",placeholder:"Nhập họ và tên",fullWidth:!0,error:!!i.error,helperText:(r=i.error)==null?void 0:r.message})]})}},"fullname"),e.jsx(Z,{name:"email",control:q.control,render:({field:p,fieldState:i})=>{var r;return e.jsxs(pe,{fullWidth:!0,error:!!i.error,children:[e.jsx(Me,{htmlFor:"email",children:"Email"}),e.jsx(B,{...p,id:"email",placeholder:"Nhập email",type:"email",fullWidth:!0,error:!!i.error,helperText:(r=i.error)==null?void 0:r.message})]})}},"email"),e.jsx(Z,{name:"phoneNumber",control:q.control,render:({field:p,fieldState:i})=>{var r;return e.jsxs(pe,{fullWidth:!0,error:!!i.error,children:[e.jsx(Me,{htmlFor:"phoneNumber",children:"SĐT"}),e.jsx(B,{...p,id:"phoneNumber",placeholder:"Nhập số điện thoại",fullWidth:!0,error:!!i.error,helperText:(r=i.error)==null?void 0:r.message})]})}},"phoneNumber"),e.jsx(Z,{name:"specialization",control:q.control,render:({field:p,fieldState:i})=>{var r;return e.jsxs(pe,{fullWidth:!0,error:!!i.error,children:[e.jsx(Me,{htmlFor:"specialization",children:"Chuyên ngành"}),e.jsx(B,{...p,id:"specialization",placeholder:"Nhập chuyên ngành",fullWidth:!0,error:!!i.error,helperText:(r=i.error)==null?void 0:r.message})]})}},"specialization"),e.jsx(Z,{name:"fieldId",control:q.control,render:({field:p,fieldState:i})=>e.jsxs(pe,{fullWidth:!0,error:!!i.error,children:[e.jsx(ve,{children:"Ngành"}),e.jsx(Ie,{...p,label:"Ngành",children:g.map(r=>e.jsx(F,{value:r.id,children:r.name},r.id))}),i.error&&e.jsx(L,{color:"error",variant:"caption",children:i.error.message})]})},"fieldId"),e.jsx(Z,{name:"departmentId",control:q.control,render:({field:p,fieldState:i})=>e.jsxs(pe,{fullWidth:!0,error:!!i.error,children:[e.jsx(ve,{children:"Đơn vị công tác"}),e.jsx(Ie,{...p,label:"Đơn vị công tác",children:s.map(r=>e.jsx(F,{value:r.id,children:r.name},r.id))}),i.error&&e.jsx(L,{color:"error",variant:"caption",children:i.error.message})]})},"departmentId"),e.jsx(Z,{name:"academicTitle",control:q.control,render:({field:p,fieldState:i})=>e.jsxs(pe,{fullWidth:!0,error:!!i.error,children:[e.jsx(ve,{children:"Học hàm / học vị"}),e.jsx(Ie,{...p,label:"Học hàm / học vị",children:Object.entries(mn).filter(([r])=>isNaN(Number(r))).map(([r])=>e.jsx(F,{value:r,children:tn(r)},r))}),i.error&&e.jsx(L,{color:"error",variant:"caption",children:i.error.message})]})},"academicTitle"),e.jsx(Z,{name:"officerRank",control:q.control,render:({field:p,fieldState:i})=>e.jsxs(pe,{fullWidth:!0,error:!!i.error,children:[e.jsx(ve,{children:"Ngạch viên chức"}),e.jsx(Ie,{...p,label:"Ngạch viên chức",children:Object.entries(pn).filter(([r])=>isNaN(Number(r))).map(([r])=>e.jsx(F,{value:r,children:sn(r)},r))}),i.error&&e.jsx(L,{color:"error",variant:"caption",children:i.error.message})]})},"officerRank"),e.jsxs(Ae,{direction:"row",spacing:2,children:[e.jsx(C,{variant:"outlined",onClick:x,fullWidth:!0,disabled:m,children:"Quay lại"}),e.jsx(C,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:m,children:m?e.jsx(J,{size:24}):"Đăng ký"})]})]})}),e.jsx(Ke,{sx:{marginY:2}}),e.jsxs(L,{sx:{textAlign:"center"},children:["Đã có tài khoản?"," ",e.jsx(vn,{href:"/dang-nhap",variant:"body2",sx:{alignSelf:"center"},children:"Đăng nhập"})]})]})})]})};function ir(){const{data:n,isLoading:t,isSuccess:s,error:a}=ne({queryKey:["global-notifications"],queryFn:Rs});return l.useEffect(()=>{s&&n&&A.success(n.message,{toastId:"fetch-global-notifications-success"})},[]),l.useEffect(()=>{a&&A.error("Có lỗi đã xảy ra: "+a.message)},[a]),t?e.jsx(J,{}):!(n!=null&&n.data)||!Array.isArray(n.data)?e.jsx("div",{children:"Không có thông báo nào để hiển thị."}):e.jsx(e.Fragment,{children:n.data.map(g=>e.jsx(De,{severity:"info",sx:{mb:2},children:e.jsx(L,{variant:"body1",children:g.content})},g.id))})}function ar(){const n=$e();return e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",gap:2,mb:4,children:[e.jsx(C,{variant:"outlined",onClick:()=>n("/settings/factors"),size:"large",sx:{width:250},children:"Hệ số chấm điểm"}),e.jsx(C,{variant:"outlined",onClick:()=>n("/settings/author-roles"),size:"large",sx:{width:250},children:"Vai trò tác giả"}),e.jsx(C,{variant:"outlined",onClick:()=>n("/settings/purposes"),size:"large",sx:{width:250},children:"Mục đích quy đổi"}),e.jsx(C,{variant:"outlined",onClick:()=>n("/settings/system-config"),size:"large",sx:{width:250},children:"Cấu hình hệ thống"})]}),e.jsxs(z,{display:"flex",gap:2,mb:4,children:[e.jsx(C,{variant:"outlined",onClick:()=>n("/settings/work-types"),size:"large",sx:{width:250},children:"Loại công trình"}),e.jsx(C,{variant:"outlined",onClick:()=>n("/settings/work-levels"),size:"large",sx:{width:250},children:"Cấp công trình"}),e.jsx(C,{variant:"outlined",onClick:()=>n("/settings/scimago-fields"),size:"large",sx:{width:250},children:"Ngành SCImago"})]}),e.jsxs(z,{display:"flex",gap:2,mb:4,children:[e.jsx(C,{variant:"outlined",onClick:()=>n("/settings/fields"),size:"large",sx:{width:250},children:"Ngành"}),e.jsx(C,{variant:"outlined",onClick:()=>n("/settings/departments"),size:"large",sx:{width:250},children:"Đơn vị"})]})]})}const Te=({columns:n,data:t})=>{const s={page:0,pageSize:10};return e.jsx(Vt,{rows:t,columns:n,initialState:{pagination:{paginationModel:s}},pageSizeOptions:[10,15,25],disableRowSelectionOnClick:!0,localeText:Ot.components.MuiDataGrid.defaultProps.localeText})},gt=async()=>(await K.get("/authorroles")).data,Tn=async n=>(await K.get("/authorroles/work-type/".concat(n))).data,or=async n=>(await K.post("/authorroles",n)).data,lr=async(n,t)=>(await K.put("/authorroles/".concat(n),t)).data,cr=async n=>(await K.delete("/authorroles/".concat(n))).data,Ue=async()=>(await K.get("/worktypes")).data,dr=async()=>(await K.get("/worktypes/with-details")).data,hr=async n=>(await K.post("/worktypes",n)).data,ur=async(n,t)=>(await K.put("/worktypes/".concat(n),t)).data,gr=async n=>(await K.delete("/worktypes/".concat(n))).data,mr=Ne({name:_().min(2,"Tên vai trò tác giả phải có ít nhất 2 ký tự"),workTypeId:_().uuid("Vui lòng chọn loại công trình"),isMainAuthor:tt()});function pr({open:n,handleClose:t,data:s}){const a=fe(),{data:g,isLoading:j}=ne({queryKey:["workTypes"],queryFn:Ue}),{control:f,handleSubmit:T,setValue:m,reset:w,formState:{errors:d}}=Se({resolver:qe(mr),defaultValues:{name:"",workTypeId:"",isMainAuthor:!1}});l.useEffect(()=>{s?(m("name",s.name),m("workTypeId",s.workTypeId),m("isMainAuthor",s.isMainAuthor)):w()},[s,m,w]);const y=xe({mutationFn:async u=>s!=null&&s.id?lr(s.id,u):or(u),onSuccess:()=>{a.invalidateQueries({queryKey:["authorRoles"]}),A.success(s!=null&&s.id?"Vai trò tác giả đã được cập nhật":"Vai trò tác giả đã được thêm"),t()},onError:u=>{console.error("API Error:",u),A.error("Đã xảy ra lỗi: "+u.message)}}),b=async u=>{await y.mutateAsync(u)};return e.jsxs(he,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:s?"Cập nhật Vai trò tác giả":"Thêm Vai trò tác giả"}),e.jsx(ge,{children:e.jsxs(U,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"name",control:f,render:({field:u})=>{var k;return e.jsx(B,{...u,label:"Tên vai trò tác giả",error:!!d.name,helperText:(k=d.name)==null?void 0:k.message,fullWidth:!0,disabled:y.isPending})}})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"workTypeId",control:f,render:({field:u})=>{var k,P;return e.jsx(B,{...u,select:!0,label:"Loại công trình",error:!!d.workTypeId,helperText:(k=d.workTypeId)==null?void 0:k.message,fullWidth:!0,disabled:y.isPending||j,children:j?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(P=g==null?void 0:g.data)==null?void 0:P.map(q=>e.jsx(F,{value:q.id,children:q.name},q.id))})}})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"isMainAuthor",control:f,render:({field:u})=>e.jsx(Ve,{control:e.jsx(Oe,{checked:u.value,onChange:u.onChange,disabled:y.isPending}),label:"Là tác giả chính"})})})]})}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,disabled:y.isPending,children:"Hủy"}),e.jsx(C,{onClick:T(b),variant:"contained",color:"primary",disabled:y.isPending||j,children:y.isPending?e.jsx(J,{size:24}):s?"Cập nhật":"Thêm mới"})]})]})}function xr(){var S;const n=fe(),[t,s]=l.useState(""),{data:a,isLoading:g}=ne({queryKey:["workTypes"],queryFn:Ue}),{data:j,error:f,isPending:T,isSuccess:m,dataUpdatedAt:w}=ne({queryKey:["authorRoles",t],queryFn:()=>t?Tn(t):gt()});l.useEffect(()=>{m&&j&&A.success(j.message,{toastId:"fetch-author-roles-success"})},[w,m,j]),l.useEffect(()=>{f&&A.error("Có lỗi đã xảy ra: "+f.message)},[f]);const d=o=>{s(o.target.value)},[y,b]=l.useState(!1),[u,k]=l.useState(null),P=o=>{k(o),b(!0)},q=()=>b(!1),H=o=>{P(o)},[v,x]=l.useState(!1),[W,I]=l.useState(null),p=o=>{I(o),x(!0)},i=()=>{I(null),x(!1)},r=xe({mutationFn:o=>cr(o),onSuccess:()=>{A.success("Xóa vai trò tác giả thành công!"),n.invalidateQueries({queryKey:["authorRoles"]}),x(!1)},onError:o=>{A.error("Lỗi khi xóa: "+o.message)}}),h=()=>{W&&r.mutate(W)},c=[{field:"stt",headerName:"STT",width:70,renderCell:o=>{const D=Array.from(o.api.getAllRowIds()).findIndex(V=>V===o.row.id);return e.jsx("div",{children:D+1})}},{field:"name",headerName:"Tên vai trò tác giả",type:"string",width:300},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:300},{field:"isMainAuthor",headerName:"Tác giả chính",width:150,renderCell:o=>o.row.isMainAuthor?e.jsx(Ee,{icon:e.jsx(Ze,{}),label:"Tác giả chính",color:"success",variant:"outlined"}):e.jsx(Ee,{icon:e.jsx(Je,{}),label:"Thành viên",color:"default",variant:"outlined"})},{field:"actions",headerName:"Thao tác",width:200,renderCell:o=>e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>H(o.row),sx:{marginRight:1},disabled:r.isPending,children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>p(o.row.id),disabled:r.isPending,children:"Xóa"})]})}];return T&&g?e.jsx(J,{}):f?e.jsxs("p",{children:["Lỗi: ",f.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:2},children:[e.jsx(L,{variant:"h4",children:"Quản lý vai trò tác giả"}),e.jsxs(z,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(pe,{sx:{minWidth:220},children:[e.jsx(ve,{id:"work-type-filter-label",children:"Lọc theo loại công trình"}),e.jsxs(Ie,{labelId:"work-type-filter-label",id:"work-type-filter",value:t,onChange:d,label:"Lọc theo loại công trình",children:[e.jsx(F,{value:"",children:"Tất cả"}),(S=a==null?void 0:a.data)==null?void 0:S.map(o=>e.jsx(F,{value:o.id,children:o.name},o.id))]})]}),e.jsx(C,{variant:"contained",onClick:()=>P(null),children:"Thêm vai trò tác giả"})]})]}),e.jsx(Ce,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(Te,{columns:c,data:(j==null?void 0:j.data)||[]})}),e.jsx(pr,{open:y,handleClose:q,data:u}),e.jsxs(he,{open:v,onClose:i,children:[e.jsx(ue,{children:"Xác nhận xóa"}),e.jsx(ge,{children:e.jsx(L,{children:"Bạn có chắc chắn muốn xóa vai trò tác giả này?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:i,disabled:r.isPending,children:"Hủy"}),e.jsx(C,{onClick:h,color:"error",variant:"contained",disabled:r.isPending,children:r.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const fr=Ne({name:_().min(2,"Tên phòng ban phải có ít nhất 2 ký tự")});function jr({open:n,handleClose:t,data:s}){var b;const a=fe(),{register:g,handleSubmit:j,setValue:f,reset:T,formState:{errors:m,isSubmitting:w}}=Se({resolver:qe(fr),defaultValues:{name:""}});l.useEffect(()=>{s?f("name",s.name):T()},[s,n,f,T]);const d=xe({mutationFn:async u=>s!=null&&s.id?$s(s.id,u):Xs(u),onSuccess:()=>{a.invalidateQueries({queryKey:["departments"]}),A.success(s!=null&&s.id?"Phòng ban đã được cập nhật":"Phòng ban đã được thêm"),t()},onError:u=>{console.error("API Error:",u)}}),y=async u=>{await d.mutateAsync(u)};return e.jsxs(he,{open:n,onClose:t,children:[e.jsx(ue,{children:s?"Cập nhật Phòng Ban":"Thêm Phòng Ban"}),e.jsx(ge,{children:e.jsx(B,{label:"Tên phòng ban",...g("name"),error:!!m.name,helperText:(b=m.name)==null?void 0:b.message,fullWidth:!0,margin:"dense",disabled:w})}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,disabled:w,children:"Hủy"}),e.jsx(C,{onClick:j(y),variant:"contained",color:"primary",disabled:w,children:w?"Đang lưu...":"Lưu"})]})]})}function yr(){const n=fe(),{data:t,error:s,isPending:a,isSuccess:g,dataUpdatedAt:j}=ne({queryKey:["departments"],queryFn:Ge});l.useEffect(()=>{g&&t&&A.success(t.message,{toastId:"fetch-departments-success"})},[j]),l.useEffect(()=>{s&&A.error("Có lỗi đã xảy ra: "+s.message)},[s]);const[f,T]=l.useState(!1),[m,w]=l.useState(null),d=p=>{w(p),T(!0)},y=()=>T(!1),b=p=>{d(p)},[u,k]=l.useState(!1),[P,q]=l.useState(null),H=p=>{q(p),k(!0)},v=()=>{q(null),k(!1)},x=xe({mutationFn:p=>Ys(p),onSuccess:()=>{A.success("Xóa đơn vị thành công!"),n.invalidateQueries({queryKey:["departments"]}),k(!1)},onError:p=>{A.error("Lỗi khi xóa: "+p.message)}}),W=()=>{P&&x.mutate(P)},I=[{field:"name",headerName:"Tên đơn vị",type:"string",width:500},{field:"actions",headerName:"",width:500,renderCell:p=>e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>b(p.row),sx:{marginRight:1},disabled:x.isPending,children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>H(p.row.id),disabled:x.isPending,children:"Xóa"})]})}];return a?e.jsx(J,{}):s?e.jsxs("p",{children:["Error: ",s.message]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{display:"flex",flexDirection:"column-reverse",alignItems:"flex-end",sx:{marginBottom:2},children:e.jsx(C,{variant:"contained",onClick:()=>d(null),children:"Thêm đơn vị"})}),e.jsx(Ce,{sx:{width:1010,marginX:"auto"},children:e.jsx(Te,{columns:I,data:(t==null?void 0:t.data)||[]})}),e.jsx(jr,{open:f,handleClose:y,data:m}),e.jsxs(he,{open:u,onClose:v,children:[e.jsx(ue,{children:"Xác nhận xóa"}),e.jsx(ge,{children:e.jsx(L,{children:"Bạn có chắc chắn muốn xóa đơn vị này?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:v,disabled:x.isPending,children:"Hủy"}),e.jsx(C,{onClick:W,color:"error",variant:"contained",disabled:x.isPending,children:x.isPending?"Đang xóa...":"Xóa"})]})]})]})}const wr=async()=>(await K.get("/factors")).data,br=async n=>(await K.get("/factors/work-type/".concat(n))).data,Cr=async n=>(await K.post("/factors",n)).data,kr=async(n,t)=>(await K.put("/factors/".concat(n),t)).data,vr=async n=>(await K.delete("/factors/".concat(n))).data;var te=(n=>(n[n.BaiBaoTopMuoi=1]="BaiBaoTopMuoi",n[n.BaiBaoTopBaMuoi=2]="BaiBaoTopBaMuoi",n[n.BaiBaoTopNamMuoi=3]="BaiBaoTopNamMuoi",n[n.BaiBaoTopConLai=4]="BaiBaoTopConLai",n[n.BaiBaoMotDiem=5]="BaiBaoMotDiem",n[n.BaiBaoNuaDiem=6]="BaiBaoNuaDiem",n[n.BaiBaoKhongBayNamDiem=7]="BaiBaoKhongBayNamDiem",n[n.HDSVDatGiaiKK=8]="HDSVDatGiaiKK",n[n.HDSVDatGiaiBa=9]="HDSVDatGiaiBa",n[n.HDSVDatGiaiNhi=10]="HDSVDatGiaiNhi",n[n.HDSVDatGiaiNhat=11]="HDSVDatGiaiNhat",n[n.HDSVConLai=12]="HDSVConLai",n[n.TacPhamNgheThuatCapTruong=13]="TacPhamNgheThuatCapTruong",n[n.TacPhamNgheThuatCapTinhThanhPho=14]="TacPhamNgheThuatCapTinhThanhPho",n[n.TacPhamNgheThuatCapQuocGia=15]="TacPhamNgheThuatCapQuocGia",n[n.TacPhamNgheThuatCapQuocTe=16]="TacPhamNgheThuatCapQuocTe",n[n.ThanhTichHuanLuyenCapQuocGia=17]="ThanhTichHuanLuyenCapQuocGia",n[n.ThanhTichHuanLuyenCapQuocTe=18]="ThanhTichHuanLuyenCapQuocTe",n[n.GiaiPhapHuuIchCapTinhThanhPho=19]="GiaiPhapHuuIchCapTinhThanhPho",n[n.GiaiPhapHuuIchCapQuocGia=20]="GiaiPhapHuuIchCapQuocGia",n[n.GiaiPhapHuuIchCapQuocTe=21]="GiaiPhapHuuIchCapQuocTe",n[n.KetQuaNghienCuu=22]="KetQuaNghienCuu",n[n.Sach=23]="Sach",n))(te||{});const an=n=>{if(n==null)return"-";switch(n){case te.BaiBaoTopMuoi:return"Top 10%";case te.BaiBaoTopBaMuoi:return"Top 30%";case te.BaiBaoTopNamMuoi:return"Top 50%";case te.BaiBaoTopConLai:return"Top còn lại";case te.BaiBaoMotDiem:return"Bài báo 1 điểm";case te.BaiBaoNuaDiem:return"Bài báo 0.5 điểm";case te.BaiBaoKhongBayNamDiem:return"Bài báo 0.75 điểm";case te.HDSVDatGiaiKK:return"HDSV đạt giải KK";case te.HDSVDatGiaiBa:return"HDSV đạt giải Ba";case te.HDSVDatGiaiNhi:return"HDSV đạt giải Nhì";case te.HDSVDatGiaiNhat:return"HDSV đạt giải Nhất";case te.HDSVConLai:return"HDSV còn lại";case te.TacPhamNgheThuatCapTruong:return"Tác phẩm nghệ thuật cấp trường";case te.TacPhamNgheThuatCapTinhThanhPho:return"Tác phẩm nghệ thuật cấp tỉnh/thành phố";case te.TacPhamNgheThuatCapQuocGia:return"Tác phẩm nghệ thuật cấp quốc gia";case te.TacPhamNgheThuatCapQuocTe:return"Tác phẩm nghệ thuật cấp quốc tế";case te.ThanhTichHuanLuyenCapQuocGia:return"Thành tích huấn luyện cấp quốc gia";case te.ThanhTichHuanLuyenCapQuocTe:return"Thành tích huấn luyện cấp quốc tế";case te.GiaiPhapHuuIchCapTinhThanhPho:return"Giải pháp hữu ích cấp tỉnh/thành phố";case te.GiaiPhapHuuIchCapQuocGia:return"Giải pháp hữu ích cấp quốc gia";case te.GiaiPhapHuuIchCapQuocTe:return"Giải pháp hữu ích cấp quốc tế";case te.KetQuaNghienCuu:return"Kết quả nghiên cứu";case te.Sach:return"Sách";default:return"-"}},mt=n=>{if(n==null)return"Chưa có mức điểm";switch(n){case te.BaiBaoTopMuoi:return"Bài báo khoa học thuộc top 10% tạp chí hàng đầu";case te.BaiBaoTopBaMuoi:return"Bài báo khoa học thuộc top 30% tạp chí hàng đầu";case te.BaiBaoTopNamMuoi:return"Bài báo khoa học thuộc top 50% tạp chí hàng đầu";case te.BaiBaoTopConLai:return"Bài báo khoa học thuộc top còn lại tạp chí hàng đầu";case te.BaiBaoMotDiem:return"Bài báo 1 điểm";case te.BaiBaoNuaDiem:return"Bài báo 0.5 điểm";case te.BaiBaoKhongBayNamDiem:return"Bài báo 0.75 điểm";case te.HDSVDatGiaiKK:return"Hướng dẫn đề tài NCKH đạt giải Khuyến khích";case te.HDSVDatGiaiBa:return"Hướng dẫn đề tài NCKH đạt giải Ba";case te.HDSVDatGiaiNhi:return"Hướng dẫn đề tài NCKH đạt giải Nhì";case te.HDSVDatGiaiNhat:return"Hướng dẫn đề tài NCKH đạt giải Nhất";case te.HDSVConLai:return"Hướng dẫn sinh viên NCKH còn lại";case te.TacPhamNgheThuatCapTruong:return"Tác phẩm nghệ thuật cấp trường";case te.TacPhamNgheThuatCapTinhThanhPho:return"Tác phẩm nghệ thuật cấp tỉnh/thành phố";case te.TacPhamNgheThuatCapQuocGia:return"Tác phẩm nghệ thuật cấp quốc gia";case te.TacPhamNgheThuatCapQuocTe:return"Tác phẩm nghệ thuật cấp quốc tế";case te.ThanhTichHuanLuyenCapQuocGia:return"Thành tích huấn luyện cấp quốc gia";case te.ThanhTichHuanLuyenCapQuocTe:return"Thành tích huấn luyện cấp quốc tế";case te.GiaiPhapHuuIchCapTinhThanhPho:return"Giải pháp hữu ích cấp tỉnh/thành phố";case te.GiaiPhapHuuIchCapQuocGia:return"Giải pháp hữu ích cấp quốc gia";case te.GiaiPhapHuuIchCapQuocTe:return"Giải pháp hữu ích cấp quốc tế";case te.KetQuaNghienCuu:return"Kết quả nghiên cứu";case te.Sach:return"Sách";default:return"-"}},pt=async()=>(await K.get("/worklevels")).data,Sn=async n=>(await K.get("/worklevels/work-type/".concat(n))).data,Ir=async n=>(await K.post("/worklevels",n)).data,Tr=async(n,t)=>(await K.put("/worklevels/".concat(n),t)).data,Sr=async n=>(await K.delete("/worklevels/".concat(n))).data,xt=async()=>(await K.get("/purposes")).data,Nn=async n=>(await K.get("/purposes/work-type/".concat(n))).data,Nr=async n=>(await K.post("/purposes",n)).data,qr=async(n,t)=>(await K.put("/purposes/".concat(n),t)).data,Lr=async n=>(await K.delete("/purposes/".concat(n))).data,Pr=Ne({name:_().min(1,"Tên hệ số không được để trống"),workTypeId:_().uuid("Vui lòng chọn loại công trình"),workLevelId:_().uuid("Vui lòng chọn cấp công trình").optional().nullable(),purposeId:_().uuid("Vui lòng chọn mục đích quy đổi"),authorRoleId:_().uuid("Vui lòng chọn vai trò tác giả").optional().nullable(),scoreLevel:Ye().int().min(1,"Vui lòng chọn mức điểm"),convertHour:Ye().min(0,"Giờ quy đổi phải là số dương"),maxAllowed:Ye().min(0,"Số tối đa phải là số dương")});function Ar({open:n,handleClose:t,data:s}){const a=fe(),[g,j]=l.useState(""),{data:f,isLoading:T}=ne({queryKey:["workTypes"],queryFn:Ue}),{data:m,isLoading:w}=ne({queryKey:["workLevels",g],queryFn:()=>Sn(g),enabled:!!g}),{data:d,isLoading:y}=ne({queryKey:["purposes",g],queryFn:()=>Nn(g),enabled:!!g}),{data:b,isLoading:u}=ne({queryKey:["authorRoles",g],queryFn:()=>Tn(g),enabled:!!g}),{control:k,handleSubmit:P,setValue:q,reset:H,watch:v,formState:{errors:x}}=Se({resolver:qe(Pr),defaultValues:{name:"",workTypeId:"",workLevelId:null,purposeId:"",authorRoleId:null,scoreLevel:te.BaiBaoTopMuoi,convertHour:0,maxAllowed:0}}),W=v("workTypeId");l.useEffect(()=>{W!==g&&j(W)},[W,g]),l.useEffect(()=>{s?(q("name",s.name||""),q("workTypeId",s.workTypeId),q("workLevelId",s.workLevelId),q("purposeId",s.purposeId),q("authorRoleId",s.authorRoleId||null),q("scoreLevel",s.scoreLevel),q("convertHour",s.convertHour),q("maxAllowed",s.maxAllowed),j(s.workTypeId)):H()},[s,q,H]),l.useEffect(()=>{g&&!s&&(q("workLevelId",null),q("purposeId",""),q("authorRoleId",null))},[g,q,s]);const I=xe({mutationFn:async i=>{const r={...i,workLevelId:i.workLevelId||void 0,authorRoleId:i.authorRoleId||void 0,name:i.name};return s!=null&&s.id?kr(s.id,r):Cr(r)},onSuccess:()=>{a.invalidateQueries({queryKey:["factors"]}),A.success(s!=null&&s.id?"Hệ số quy đổi đã được cập nhật":"Hệ số quy đổi đã được thêm"),t()},onError:i=>{console.error("API Error:",i),A.error("Đã xảy ra lỗi: "+i.message)}}),p=async i=>{await I.mutateAsync(i)};return e.jsxs(he,{open:n,onClose:t,maxWidth:"md",fullWidth:!0,children:[e.jsx(ue,{children:s?"Cập nhật Hệ số quy đổi":"Thêm Hệ số quy đổi"}),e.jsx(ge,{children:e.jsxs(U,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"name",control:k,render:({field:i})=>{var r;return e.jsx(B,{...i,label:"Tên hệ số",error:!!x.name,helperText:(r=x.name)==null?void 0:r.message,fullWidth:!0,disabled:I.isPending})}})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"workTypeId",control:k,render:({field:i})=>{var r,h;return e.jsx(B,{...i,select:!0,label:"Loại công trình",error:!!x.workTypeId,helperText:(r=x.workTypeId)==null?void 0:r.message,fullWidth:!0,disabled:I.isPending||T,children:T?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(h=f==null?void 0:f.data)==null?void 0:h.map(c=>e.jsx(F,{value:c.id,children:c.name},c.id))})}})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(Z,{name:"workLevelId",control:k,render:({field:i})=>{var r,h;return e.jsxs(B,{...i,select:!0,label:"Cấp công trình",error:!!x.workLevelId,helperText:(r=x.workLevelId)==null?void 0:r.message,fullWidth:!0,disabled:!g||I.isPending||w,value:i.value||"",children:[e.jsx(F,{value:"",children:"Không chọn"}),w?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(h=m==null?void 0:m.data)==null?void 0:h.map(c=>e.jsx(F,{value:c.id,children:c.name},c.id))]})}})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(Z,{name:"purposeId",control:k,render:({field:i})=>{var r,h;return e.jsx(B,{...i,select:!0,label:"Mục đích quy đổi",error:!!x.purposeId,helperText:(r=x.purposeId)==null?void 0:r.message,fullWidth:!0,disabled:!g||I.isPending||y,children:y?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(h=d==null?void 0:d.data)==null?void 0:h.map(c=>e.jsx(F,{value:c.id,children:c.name},c.id))})}})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(Z,{name:"authorRoleId",control:k,render:({field:i})=>{var r,h;return e.jsxs(B,{...i,select:!0,label:"Vai trò tác giả",error:!!x.authorRoleId,helperText:(r=x.authorRoleId)==null?void 0:r.message,fullWidth:!0,disabled:!g||I.isPending||u,value:i.value||"",children:[e.jsx(F,{value:"",children:"Không chọn"}),u?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(h=b==null?void 0:b.data)==null?void 0:h.map(c=>e.jsx(F,{value:c.id,children:c.name},c.id))]})}})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(Z,{name:"scoreLevel",control:k,render:({field:i})=>{var r;return e.jsx(B,{...i,select:!0,label:"Mức điểm",error:!!x.scoreLevel,helperText:(r=x.scoreLevel)==null?void 0:r.message,fullWidth:!0,disabled:I.isPending,onChange:h=>i.onChange(Number(h.target.value)),value:i.value,children:Object.values(te).filter(h=>typeof h=="number").map(h=>e.jsx(F,{value:h,children:mt(h)},h))})}})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(Z,{name:"convertHour",control:k,render:({field:i})=>{var r;return e.jsx(B,{...i,label:"Giờ quy đổi",type:"number",error:!!x.convertHour,helperText:(r=x.convertHour)==null?void 0:r.message,fullWidth:!0,disabled:I.isPending,inputProps:{step:.5,min:0},onChange:h=>i.onChange(Number(h.target.value))})}})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(Z,{name:"maxAllowed",control:k,render:({field:i})=>{var r;return e.jsx(B,{...i,label:"Số công trình tối đa được phép quy đổi",type:"number",error:!!x.maxAllowed,helperText:(r=x.maxAllowed)==null?void 0:r.message,fullWidth:!0,disabled:I.isPending,inputProps:{step:1,min:0},onChange:h=>i.onChange(Number(h.target.value))})}})})]})}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,disabled:I.isPending,children:"Hủy"}),e.jsx(C,{onClick:P(p),variant:"contained",color:"primary",disabled:I.isPending||T||!!g&&(w||y||u),children:I.isPending?e.jsx(J,{size:24}):s?"Cập nhật":"Thêm mới"})]})]})}function Wr(){var S;const n=fe(),[t,s]=l.useState(""),{data:a,isLoading:g}=ne({queryKey:["workTypes"],queryFn:Ue}),{data:j,error:f,isPending:T,isSuccess:m,dataUpdatedAt:w}=ne({queryKey:["factors",t],queryFn:()=>t?br(t):wr()});l.useEffect(()=>{m&&j&&A.success(j.message,{toastId:"fetch-factors-success"})},[w,m,j]),l.useEffect(()=>{f&&A.error("Có lỗi đã xảy ra: "+f.message)},[f]);const d=o=>{s(o.target.value)},[y,b]=l.useState(!1),[u,k]=l.useState(null),P=o=>{k(o),b(!0)},q=()=>b(!1),H=o=>{P(o)},[v,x]=l.useState(!1),[W,I]=l.useState(null),p=o=>{I(o),x(!0)},i=()=>{I(null),x(!1)},r=xe({mutationFn:o=>vr(o),onSuccess:()=>{A.success("Xóa hệ số quy đổi thành công!"),n.invalidateQueries({queryKey:["factors"]}),x(!1)},onError:o=>{A.error("Lỗi khi xóa: "+o.message)}}),h=()=>{W&&r.mutate(W)},c=[{field:"stt",headerName:"STT",width:70,renderCell:o=>{const D=Array.from(o.api.getAllRowIds()).findIndex(V=>V===o.row.id);return e.jsx("div",{children:D+1})}},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:180},{field:"workLevelName",headerName:"Cấp công trình",type:"string",width:150},{field:"purposeName",headerName:"Mục đích quy đổi",type:"string",width:150},{field:"name",headerName:"Tên hệ số",type:"string",width:200},{field:"scoreLevel",headerName:"Mức điểm",width:160,renderCell:o=>e.jsx("div",{children:an(o.row.scoreLevel)})},{field:"convertHour",headerName:"Giờ quy đổi",type:"number",width:120},{field:"maxAllowed",headerName:"Giới hạn đánh dấu",type:"number",width:150},{field:"actions",headerName:"Thao tác",width:200,renderCell:o=>e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>H(o.row),sx:{marginRight:1},disabled:r.isPending,children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>p(o.row.id),disabled:r.isPending,children:"Xóa"})]})}];return T&&g?e.jsx(J,{}):f?e.jsxs("p",{children:["Lỗi: ",f.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:2},children:[e.jsx(L,{variant:"h4",children:"Quản lý hệ số quy đổi"}),e.jsxs(z,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(pe,{sx:{minWidth:220},children:[e.jsx(ve,{id:"work-type-filter-label",children:"Lọc theo loại công trình"}),e.jsxs(Ie,{labelId:"work-type-filter-label",id:"work-type-filter",value:t,onChange:d,label:"Lọc theo loại công trình",children:[e.jsx(F,{value:"",children:"Tất cả"}),(S=a==null?void 0:a.data)==null?void 0:S.map(o=>e.jsx(F,{value:o.id,children:o.name},o.id))]})]}),e.jsx(C,{variant:"contained",onClick:()=>P(null),children:"Thêm hệ số quy đổi"})]})]}),e.jsx(Ce,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(Te,{columns:c,data:(j==null?void 0:j.data)||[]})}),e.jsx(Ar,{open:y,handleClose:q,data:u}),e.jsxs(he,{open:v,onClose:i,children:[e.jsx(ue,{children:"Xác nhận xóa"}),e.jsx(ge,{children:e.jsx(L,{children:"Bạn có chắc chắn muốn xóa hệ số quy đổi này?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:i,disabled:r.isPending,children:"Hủy"}),e.jsx(C,{onClick:h,color:"error",variant:"contained",disabled:r.isPending,children:r.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const Dr=Ne({name:_().min(2,"Tên ngành phải có ít nhất 2 ký tự")});function Rr({open:n,handleClose:t,data:s}){var b;const a=fe(),{register:g,handleSubmit:j,setValue:f,reset:T,formState:{errors:m,isSubmitting:w}}=Se({resolver:qe(Dr),defaultValues:{name:""}});l.useEffect(()=>{s?f("name",s.name):T()},[s,n,f,T]);const d=xe({mutationFn:async u=>s!=null&&s.id?Zs(s.id,u):_s(u),onSuccess:()=>{a.invalidateQueries({queryKey:["fields"]}),A.success(s!=null&&s.id?"Ngành đã được cập nhật":"Ngành đã được thêm"),t()},onError:u=>{console.error("API Error:",u)}}),y=async u=>{await d.mutateAsync(u)};return e.jsxs(he,{open:n,onClose:t,children:[e.jsx(ue,{children:s?"Cập nhật Ngành":"Thêm Ngành"}),e.jsx(ge,{children:e.jsx(B,{label:"Tên ngành",...g("name"),error:!!m.name,helperText:(b=m.name)==null?void 0:b.message,fullWidth:!0,margin:"dense",disabled:w})}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,disabled:w,children:"Hủy"}),e.jsx(C,{onClick:j(y),variant:"contained",color:"primary",disabled:w,children:w?"Đang lưu...":"Lưu"})]})]})}function Fr(){const n=fe(),{data:t,error:s,isPending:a,isSuccess:g,dataUpdatedAt:j}=ne({queryKey:["fields"],queryFn:rn});l.useEffect(()=>{g&&t&&A.success(t.message,{toastId:"fetch-fields-success"})},[j]),l.useEffect(()=>{s&&A.error("Có lỗi đã xảy ra: "+s.message)},[s]);const[f,T]=l.useState(!1),[m,w]=l.useState(null),d=p=>{w(p),T(!0)},y=()=>T(!1),b=p=>{d(p)},[u,k]=l.useState(!1),[P,q]=l.useState(null),H=p=>{q(p),k(!0)},v=()=>{q(null),k(!1)},x=xe({mutationFn:p=>Js(p),onSuccess:()=>{A.success("Xóa ngành thành công!"),n.invalidateQueries({queryKey:["fields"]}),k(!1)},onError:p=>{A.error("Lỗi khi xóa: "+p.message)}}),W=()=>{P&&x.mutate(P)},I=[{field:"name",headerName:"Tên ngành",type:"string",width:500},{field:"actions",headerName:"",width:500,renderCell:p=>e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>b(p.row),sx:{marginRight:1},disabled:x.isPending,children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>H(p.row.id),disabled:x.isPending,children:"Xóa"})]})}];return a?e.jsx(J,{}):s?e.jsxs("p",{children:["Error: ",s.message]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{display:"flex",flexDirection:"column-reverse",alignItems:"flex-end",sx:{marginBottom:2},children:e.jsx(C,{variant:"contained",onClick:()=>d(null),children:"Thêm ngành"})}),e.jsx(Ce,{sx:{width:1010,marginX:"auto"},children:e.jsx(Te,{columns:I,data:(t==null?void 0:t.data)||[]})}),e.jsx(Rr,{open:f,handleClose:y,data:m}),e.jsxs(he,{open:u,onClose:v,children:[e.jsx(ue,{children:"Xác nhận xóa"}),e.jsx(ge,{children:e.jsx(L,{children:"Bạn có chắc chắn muốn xóa ngành này?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:v,disabled:x.isPending,children:"Hủy"}),e.jsx(C,{onClick:W,color:"error",variant:"contained",disabled:x.isPending,children:x.isPending?"Đang xóa...":"Xóa"})]})]})]})}const on=async n=>(await K.get("/works/filter",{params:n})).data,Hr=async n=>(await K.post("/works",n)).data,Kr=async n=>(await K.delete("/works/".concat(n))).data,Mr=async(n,t,s)=>(await K.patch("/works/".concat(n,"/admin-update/").concat(t),s)).data,Er=async(n,t)=>(await K.patch("/works/".concat(n),t)).data,Br=async(n,t)=>(await K.patch("/works/authors/".concat(n,"/register"),t)).data,ft=n=>{if(!n)return"-";try{const t=typeof n=="string"?new Date(n):n;return st(t,"MM/yyyy",{locale:In})}catch(t){return"-"}};var ce=(n=>(n[n.HopLe=0]="HopLe",n[n.KhongHopLe=1]="KhongHopLe",n[n.ChuaXuLy=2]="ChuaXuLy",n))(ce||{});const qn=async()=>(await K.get("/scimagofields")).data,Ur=async n=>(await K.post("/scimagofields",n)).data,zr=async(n,t)=>(await K.put("/scimagofields/".concat(n),t)).data,Vr=async n=>(await K.delete("/scimagofields/".concat(n))).data;function Ln(){var m,w,d,y,b,u,k,P,q,H,v,x;const n=ne({queryKey:["workTypes"],queryFn:Ue}),t=ne({queryKey:["workLevels"],queryFn:pt}),s=ne({queryKey:["authorRoles"],queryFn:gt}),a=ne({queryKey:["purposes"],queryFn:xt}),g=ne({queryKey:["scimagoFields"],queryFn:qn}),j=ne({queryKey:["fields"],queryFn:rn}),f=n.isLoading||t.isLoading||s.isLoading||a.isLoading||g.isLoading||j.isLoading,T=((m=n.data)==null?void 0:m.data)&&((w=t.data)==null?void 0:w.data)&&((d=s.data)==null?void 0:d.data)&&((y=a.data)==null?void 0:y.data)&&((b=g.data)==null?void 0:b.data)&&((u=j.data)==null?void 0:u.data);return{workTypes:((k=n.data)==null?void 0:k.data)||[],workLevels:((P=t.data)==null?void 0:P.data)||[],authorRoles:((q=s.data)==null?void 0:q.data)||[],purposes:((H=a.data)==null?void 0:H.data)||[],scimagoFields:((v=g.data)==null?void 0:v.data)||[],fields:((x=j.data)==null?void 0:x.data)||[],isLoading:f,isDataReady:T}}function jt({userId:n,worksData:t,refetchWorks:s,isAuthorPage:a=!1}){const g=fe(),[j,f]=l.useState(null),[T,m]=l.useState(!1),[w,d]=l.useState(!1),[y,b]=l.useState(!1),[u,k]=l.useState(ce.ChuaXuLy),[P,q]=l.useState(""),[H,v]=l.useState(0),x=xe({mutationFn:N=>a?Er(N.workId,N.data):Mr(N.workId,N.userId,N.data),onSuccess:N=>{console.log("Dữ liệu trả về từ API:",N),console.log("Cập nhật thành công, đang invalidate queries"),a?g.invalidateQueries({queryKey:["works","my-works"]}):n&&g.invalidateQueries({queryKey:["works","user",n]})},onError:N=>{A.error("Lỗi khi cập nhật công trình: "+N.message)}}),W=xe({mutationFn:N=>Hr(N),onSuccess:()=>{A.success("Đã thêm công trình mới thành công"),g.invalidateQueries({queryKey:["works","my-works"]}),m(!1),s&&setTimeout(()=>{s()},100)},onError:N=>{A.error("Lỗi khi thêm công trình mới: "+N.message)}});return{selectedWork:j,openUpdateDialog:T,openStatusDialog:w,openNoteDialog:y,newStatus:u,newNote:P,activeTab:H,updateWorkMutation:x,createWorkMutation:W,handleOpenUpdateDialog:N=>{if(N){const O=localStorage.getItem("userId")||"",X=N.authors&&N.authors.length>0?{authorRoleId:N.authors[0].authorRoleId,purposeId:N.authors[0].purposeId,position:N.authors[0].position||1,scoreLevel:N.authors[0].scoreLevel,scImagoFieldId:N.authors[0].scImagoFieldId||"",fieldId:N.authors[0].fieldId||"",proofStatus:N.authors[0].proofStatus,note:N.authors[0].note||""}:N.author||{authorRoleId:"",purposeId:"",position:1,scoreLevel:void 0,scImagoFieldId:"",fieldId:"",proofStatus:ce.ChuaXuLy,note:""},M={...N,details:N.details||{},totalAuthors:N.totalAuthors||1,totalMainAuthors:N.totalMainAuthors||1,author:X,coAuthorUserIds:Array.isArray(N.coAuthorUserIds)?N.coAuthorUserIds.filter(E=>E.toString()!==O).map(E=>E.toString()):[]};f(M)}else f(null);v(0),m(!0)},handleCloseUpdateDialog:()=>{f(null),m(!1)},handleOpenStatusDialog:N=>{f(N),N.authors&&N.authors.length>0&&k(N.authors[0].proofStatus||ce.ChuaXuLy),d(!0)},handleCloseStatusDialog:()=>{f(null),d(!1)},handleOpenNoteDialog:N=>{f(N),N.authors&&N.authors.length>0&&q(N.authors[0].note||""),b(!0)},handleCloseNoteDialog:()=>{f(null),q(""),b(!1)},handleStatusChange:N=>{k(N)},handleNoteChange:N=>{q(N)},handleStatusSubmit:()=>{if(j&&j.authors&&j.authors.length>0&&n){console.log("Cập nhật trạng thái:",u);const N={workRequest:null,authorRequest:{proofStatus:u}};x.mutate({workId:j.id,userId:n,data:N},{onSuccess:O=>{var X;if(O.data&&t){const M=((X=t==null?void 0:t.data)==null?void 0:X.map(E=>E.id===O.data.id?O.data:E))||[];t&&(t.data=M),A.success("Cập nhật trạng thái thành công"),d(!1),s&&s()}}})}},handleNoteSubmit:()=>{if(j&&j.authors&&j.authors.length>0&&n){console.log("Cập nhật ghi chú:",P);const N=j.authors[0].proofStatus,O={workRequest:null,authorRequest:{note:P,proofStatus:N}};x.mutate({workId:j.id,userId:n,data:O},{onSuccess:X=>{var M;if(X.data&&t){const E=((M=t==null?void 0:t.data)==null?void 0:M.map(Q=>Q.id===X.data.id?X.data:Q))||[];t&&(t.data=E),A.success("Cập nhật ghi chú thành công"),b(!1),s&&s()}}})}},handleUpdateSubmit:N=>{var we;let O;if(N.timePublished)try{O=new Date(N.timePublished).toISOString().split("T")[0]}catch($){console.error("Lỗi khi chuyển đổi ngày tháng:",$)}const X=N.author.sCImagoFieldId||N.author.scImagoFieldId,M=Array.isArray(N.coAuthorUserIds)?N.coAuthorUserIds.filter($=>$):[],E=N.author.authorRoleId===""?null:N.author.authorRoleId,Q={workRequest:{title:(we=N.title)==null?void 0:we.trim(),timePublished:O,totalAuthors:N.totalAuthors?Number(N.totalAuthors):void 0,totalMainAuthors:N.totalMainAuthors?Number(N.totalMainAuthors):void 0,source:Number(N.source),workTypeId:N.workTypeId,workLevelId:N.workLevelId||null,details:N.details||{},coAuthorUserIds:M},authorRequest:{authorRoleId:E,purposeId:N.author.purposeId,position:N.author.position?parseInt(String(N.author.position)):void 0,scoreLevel:N.author.scoreLevel?Number(N.author.scoreLevel):null,scImagoFieldId:X||null,fieldId:N.author.fieldId||null,proofStatus:N.author.proofStatus,note:N.author.note}};if(j&&j.id)x.mutate({workId:j.id,userId:n||"",data:Q},{onSuccess:$=>{var de;if($.data&&t){const G=((de=t==null?void 0:t.data)==null?void 0:de.map(ee=>ee.id===$.data.id?$.data:ee))||[];t&&(t.data=G),A.success("Cập nhật công trình thành công"),m(!1),s&&s()}}});else if(a){const $={title:Q.workRequest.title,timePublished:Q.workRequest.timePublished,totalAuthors:Q.workRequest.totalAuthors,totalMainAuthors:Q.workRequest.totalMainAuthors,source:Q.workRequest.source,workTypeId:Q.workRequest.workTypeId,workLevelId:Q.workRequest.workLevelId,details:Q.workRequest.details,coAuthorUserIds:Q.workRequest.coAuthorUserIds,author:{authorRoleId:Q.authorRequest.authorRoleId,purposeId:Q.authorRequest.purposeId,position:Q.authorRequest.position,scoreLevel:Q.authorRequest.scoreLevel,scImagoFieldId:Q.authorRequest.scImagoFieldId,fieldId:Q.authorRequest.fieldId}};W.mutate($)}},setActiveTab:v}}const Or=async(n,t,s,a)=>{try{const g=new URLSearchParams;return g.append("workTypeId",n),t&&g.append("workLevelId",t),s&&g.append("authorRoleId",s),a&&g.append("purposeId",a),(await K.get("/scorelevels?".concat(g.toString()))).data.data}catch(g){return console.error("Lỗi khi lấy danh sách score levels:",g),[]}};var We=(n=>(n[n.QuanLyNhap=0]="QuanLyNhap",n[n.NguoiDungKeKhai=1]="NguoiDungKeKhai",n))(We||{});const Gr={"bài báo khoa học":{WoS:[{key:"Tên tạp chí khoa học",label:"Tên tạp chí khoa học",required:!0},{key:"Tên tạp chí khoa học",label:"Tên tạp chí khoa học",required:!0},{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quản xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Loại WoS",label:"Loại WoS",required:!0},{key:"Xếp hạng tạp chí",label:"Xếp hạng tạp chí",required:!0}],Scopus:[{key:"Tên tạp chí khoa học",label:"Tên tạp chí khoa học",required:!0},{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quản xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Xếp hạng tạp chí",label:"Xếp hạng tạp chí",required:!0}],default:[{key:"Tên tạp chí khoa học",label:"Tên tạp chí khoa học",required:!0},{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quản xuất bản",label:"Cơ quan xuất bản",required:!0}]},"báo cáo khoa học":{WoS:[{key:"Tên ấn phẩm",label:"Tên ấn phẩm",required:!0},{key:"Tên ấn phẩm",label:"Tên ấn phẩm",required:!0},{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quản xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Loại WoS",label:"Loại WoS",required:!0},{key:"Xếp hạng tạp chí",label:"Xếp hạng tạp chí",required:!0}],Scopus:[{key:"Tên ấn phẩm",label:"Tên ấn phẩm",required:!0},{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quản xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Xếp hạng tạp chí",label:"Xếp hạng tạp chí",required:!0}],default:[{key:"Tên ấn phẩm",label:"Tên ấn phẩm",required:!0},{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quản xuất bản",label:"Cơ quan xuất bản",required:!0}]},"đề tài":{default:[{key:"Mã số đề tài",label:"Mã số đề tài",required:!0},{key:"Sản phẩm thuộc đề tài",label:"Sản phẩm thuộc đề tài",required:!0},{key:"Xếp loại",label:"Xếp loại",required:!0}]},"giáo trình":{default:[{key:"Mã số giáo trình",label:"Mã số giáo trình",required:!0},{key:"Xếp loại",label:"Xếp loại",required:!0}]},"tài liệu giảng dạy":{default:[{key:"Mã số tài liệu",label:"Mã số tài liệu",required:!0},{key:"Xếp loại",label:"Xếp loại",required:!0}]},"hội thảo, hội nghị":{default:[{key:"Chi tiết",label:"Chi tiết",required:!0}]},"hướng dẫn sv nckh":{default:[{key:"Mã số đề tài của sinh viên",label:"Mã số đề tài của sinh viên",required:!0}]},"chương sách":{default:[{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quan xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Dạng tài liệu",label:"Dạng tài liệu",required:!0}]},"chuyên khảo":{default:[{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quan xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Dạng tài liệu",label:"Dạng tài liệu",required:!0}]},"giáo trình - sách":{default:[{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quan xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Dạng tài liệu",label:"Dạng tài liệu",required:!0}]},"tài liệu hướng dẫn":{default:[{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quan xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Dạng tài liệu",label:"Dạng tài liệu",required:!0}]},"tham khảo":{default:[{key:"Tập, số phát hành",label:"Tập, số phát hành",required:!0},{key:"Số trang",label:"Số trang",required:!0},{key:"Chỉ số xuất bản",label:"Chỉ số xuất bản",required:!0},{key:"Cơ quan xuất bản",label:"Cơ quan xuất bản",required:!0},{key:"Dạng tài liệu",label:"Dạng tài liệu",required:!0}]},khác:{default:[{key:"Chi tiết",label:"Chi tiết",required:!0}]}},Qr=Ne({title:_().min(2,"Tên công trình phải có ít nhất 2 ký tự"),timePublished:Xt().optional().nullable(),totalAuthors:En.number().min(1,"Số tác giả phải lớn hơn 0").optional().nullable(),totalMainAuthors:En.number().min(1,"Số tác giả chính phải lớn hơn 0").optional().nullable(),details:Qt(_()).refine(n=>!(!n||Object.keys(n).length===0),{message:"Thông tin chi tiết là bắt buộc"}),source:Ye(),workTypeId:_().uuid("ID loại công trình không hợp lệ"),workLevelId:_().uuid("ID cấp độ công trình không hợp lệ").optional().nullable(),coAuthorUserIds:Gt(_().uuid("ID đồng tác giả không hợp lệ")).optional().default([]),author:Ne({authorRoleId:_().uuid("ID vai trò tác giả không hợp lệ").optional().nullable(),purposeId:_().uuid("ID mục đích không hợp lệ"),position:Ye().min(1,"Vị trí tác giả phải lớn hơn 0").optional().nullable(),scoreLevel:Ye().min(0,"Mức điểm không hợp lệ").optional().nullable(),sCImagoFieldId:_().uuid("ID lĩnh vực SCImago không hợp lệ").optional().nullable(),fieldId:_().uuid("ID lĩnh vực không hợp lệ").optional().nullable()})});function Xr({initialData:n,onSubmit:t,isLoading:s,workTypes:a,fields:g,activeTab:j}){var Pn,An,Wn,Dn,Rn,Fn,Hn,Kn;const[f,T]=l.useState(""),[m,w]=l.useState([]),[d,y]=l.useState({}),[b,u]=l.useState(!1),[k,P]=l.useState([]),{user:q}=Fe(),H=q==null?void 0:q.id,{control:v,handleSubmit:x,formState:{errors:W},reset:I,setValue:p,watch:i}=Se({resolver:qe(Qr),mode:"onSubmit",defaultValues:n?{...n,timePublished:n.timePublished?new Date(n.timePublished):null,details:n.details||{},source:n.source,coAuthorUserIds:((Pn=n.coAuthorUserIds)==null?void 0:Pn.filter(R=>R.toString()!==H))||[],author:{authorRoleId:((An=n.author)==null?void 0:An.authorRoleId)||null,purposeId:((Wn=n.author)==null?void 0:Wn.purposeId)||"",position:((Dn=n.author)==null?void 0:Dn.position)||1,scoreLevel:(Fn=(Rn=n.author)==null?void 0:Rn.scoreLevel)!=null?Fn:null,sCImagoFieldId:((Hn=n.author)==null?void 0:Hn.scImagoFieldId)||null,fieldId:((Kn=n.author)==null?void 0:Kn.fieldId)||null}}:{title:"",timePublished:null,totalAuthors:null,totalMainAuthors:null,details:{},source:We.NguoiDungKeKhai,workTypeId:"",workLevelId:null,coAuthorUserIds:[],author:{authorRoleId:null,purposeId:"",position:1,scoreLevel:null,sCImagoFieldId:null,fieldId:null}}}),{workTypes:r,workLevels:h}=Ln(),c=i("workTypeId"),S=i("workLevelId"),o=i("author.authorRoleId"),D=i("author.purposeId");l.useEffect(()=>{n!=null&&n.details?y(n.details):y({})},[n]);const V=l.useMemo(()=>{var R;return(R=r.find(Y=>Y.id===c))==null?void 0:R.name},[c,r]),je=l.useMemo(()=>{var R;return(R=h.find(Y=>Y.id===S))==null?void 0:R.name},[S,h]),N=l.useMemo(()=>{if(!V)return[];const R=Gr[V.toLowerCase()];return R?R[je]||R.default:[]},[V,je]),O=(R,Y)=>{const se={...d,[R]:Y};y(se),p("details",se)},{data:X}=ne({queryKey:["workLevels",c],queryFn:()=>Sn(c),enabled:!!c}),{data:M}=ne({queryKey:["authorRoles",c],queryFn:()=>Tn(c),enabled:!!c}),{data:E}=ne({queryKey:["purposes",c],queryFn:()=>Nn(c),enabled:!!c}),{data:Q}=ne({queryKey:["scimagoFields"],queryFn:qn,enabled:!!c}),we=l.useMemo(()=>Q!=null&&Q.data?Q.data:[],[Q==null?void 0:Q.data]),{data:$,isLoading:de}=ne({queryKey:["searchUsers",f],queryFn:async()=>{const R=await ys(f);return console.log("Kết quả tìm kiếm người dùng:",R),R},enabled:f.length>0}),G=l.useMemo(()=>$!=null&&$.data?$.data.filter(R=>R.id!==H):[],[$==null?void 0:$.data,H]);l.useEffect(()=>{var R,Y,se,re,ie,ye,be,oe;n&&(console.log("initialData đã thay đổi:",n),console.log("coAuthorUserIds:",n.coAuthorUserIds),I({...n,timePublished:n.timePublished?new Date(n.timePublished):null,details:n.details||{},source:n.source,coAuthorUserIds:((R=n.coAuthorUserIds)==null?void 0:R.filter(ze=>ze.toString()!==H))||[],author:{authorRoleId:((Y=n.author)==null?void 0:Y.authorRoleId)||null,purposeId:((se=n.author)==null?void 0:se.purposeId)||"",position:((re=n.author)==null?void 0:re.position)||1,scoreLevel:(ye=(ie=n.author)==null?void 0:ie.scoreLevel)!=null?ye:null,sCImagoFieldId:((be=n.author)==null?void 0:be.scImagoFieldId)||null,fieldId:((oe=n.author)==null?void 0:oe.fieldId)||null}}),(async()=>{if(n.coAuthorUserIds&&n.coAuthorUserIds.length>0){u(!0);try{const ze=[];for(const Mn of n.coAuthorUserIds)if(Mn.toString()!==H){const xn=await _e(Mn);xn.success&&xn.data&&ze.push(xn.data)}w(ze)}catch(ze){console.error("Lỗi khi tải dữ liệu đồng tác giả:",ze)}finally{u(!1)}}else w([])})())},[n,I,H]),l.useEffect(()=>{if(!c){P([]);return}(async()=>{try{const Y=await Or(c,S||void 0,o||void 0,D||void 0);console.log("Đã lấy được danh sách mức điểm:",Y),P(Y),Y.length===0&&p("author.scoreLevel",null)}catch(Y){console.error("Lỗi khi lấy danh sách mức điểm:",Y),P([]),p("author.scoreLevel",null)}})()},[c,S,o,D,p]);const[ee,ae]=l.useState(!0);l.useEffect(()=>{c&&(X!=null&&X.data&&Array.isArray(X.data)?(ae(X.data.length>0),X.data.length===0&&p("workLevelId",null)):ae(!0))},[c,X,p]),l.useEffect(()=>{c&&!n&&(p("workLevelId",null),p("author.authorRoleId",null),p("author.purposeId",""),p("author.sCImagoFieldId",null))},[c,p,n]),l.useEffect(()=>{if(!m)return;console.log("Cập nhật coAuthorUserIds với:",m);const R=m.map(Y=>Y.id);console.log("Danh sách ID đồng tác giả cập nhật:",R),p("coAuthorUserIds",R,{shouldValidate:!0})},[m,p]),l.useEffect(()=>{const R=i("totalAuthors"),Y=i("totalMainAuthors");R!==null&&typeof R=="string"&&p("totalAuthors",Number(R)),Y!==null&&typeof Y=="string"&&p("totalMainAuthors",Number(Y))},[i,p]),l.useEffect(()=>{if(n!=null&&n.details)try{y(n.details)}catch(R){console.error("Lỗi khi parse details:",R),y({})}else y({})},[n]);const Le=(R,Y)=>{console.log("Đã chọn đồng tác giả:",Y);const se=Y.filter(ie=>ie.id!==H);w(se);const re=se.map(ie=>ie.id);console.log("Danh sách ID đồng tác giả cập nhật:",re),p("coAuthorUserIds",re,{shouldValidate:!0})},Ct=R=>{const Y={...R,timePublished:R.timePublished?new Date(R.timePublished).toISOString():null};t(Y)};return e.jsx("form",{onSubmit:x(Ct),children:e.jsxs(U,{container:!0,spacing:2,children:[j===0&&e.jsxs(e.Fragment,{children:[e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"title",control:v,render:({field:R})=>{var Y,se;return e.jsx(B,{...R,label:"Tên công trình",fullWidth:!0,error:!!W.title,helperText:(se=(Y=W.title)==null?void 0:Y.message)==null?void 0:se.toString(),disabled:n==null?void 0:n.isLocked})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"timePublished",control:v,render:({field:{value:R,onChange:Y}})=>{var se,re;return e.jsx($t,{dateAdapter:Yt,adapterLocale:In,children:e.jsx(_t,{label:"Thời gian xuất bản",value:R?new Date(R):null,onChange:ie=>Y(ie),slotProps:{textField:{fullWidth:!0,error:!!W.timePublished,helperText:(re=(se=W.timePublished)==null?void 0:se.message)==null?void 0:re.toString()}}})})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"workTypeId",control:v,render:({field:R})=>{var Y,se;return e.jsx(B,{...R,select:!0,label:"Loại công trình",fullWidth:!0,error:!!W.workTypeId,helperText:(se=(Y=W.workTypeId)==null?void 0:Y.message)==null?void 0:se.toString(),disabled:n==null?void 0:n.isLocked,children:a.map(re=>e.jsx(F,{value:re.id,children:re.name},re.id))})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"workLevelId",control:v,render:({field:R})=>{var Y,se,re;return e.jsx(B,{...R,select:!0,label:"Cấp công trình",fullWidth:!0,error:!!W.workLevelId,helperText:(se=(Y=W.workLevelId)==null?void 0:Y.message)==null?void 0:se.toString(),disabled:!c||!ee||(n==null?void 0:n.isLocked),children:(re=X==null?void 0:X.data)==null?void 0:re.map(ie=>e.jsx(F,{value:ie.id,children:ie.name},ie.id))})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"totalAuthors",control:v,render:({field:{value:R,onChange:Y,onBlur:se,...re}})=>{var ie,ye;return e.jsx(B,{...re,label:"Tổng số tác giả",type:"number",inputProps:{min:1,step:1},fullWidth:!0,error:!!W.totalAuthors,helperText:(ye=(ie=W.totalAuthors)==null?void 0:ie.message)==null?void 0:ye.toString(),value:R===null?"":R,onChange:be=>{const oe=be.target.value;Y(oe===""?null:Number(oe))},onBlur:se,disabled:n==null?void 0:n.isLocked})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"totalMainAuthors",control:v,render:({field:{value:R,onChange:Y,onBlur:se,...re}})=>{var ie,ye;return e.jsx(B,{...re,label:"Số tác giả chính",type:"number",inputProps:{min:1,step:1},fullWidth:!0,error:!!W.totalMainAuthors,helperText:(ye=(ie=W.totalMainAuthors)==null?void 0:ie.message)==null?void 0:ye.toString(),value:R===null?"":R,onChange:be=>{const oe=be.target.value;Y(oe===""?null:Number(oe))},onBlur:se,disabled:n==null?void 0:n.isLocked})}})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"coAuthorUserIds",control:v,render:()=>e.jsx(Zt,{multiple:!0,id:"coAuthorUserIds",options:G,getOptionLabel:R=>typeof R=="string"?R:"".concat(R.fullName," - ").concat(R.userName).concat(R.departmentName?" - ".concat(R.departmentName):""),isOptionEqualToValue:(R,Y)=>R.id===Y.id,value:m,onChange:Le,loading:de||b,disabled:n==null?void 0:n.isLocked,renderTags:(R,Y)=>R.map((se,re)=>{const ie=Y({index:re});return e.jsx(Ee,{...ie,label:"".concat(se.fullName," - ").concat(se.userName).concat(se.departmentName?" - ".concat(se.departmentName):""),size:"medium"})}),renderInput:R=>{var Y;return e.jsx(B,{...R,label:"Đồng tác giả",variant:"outlined",onChange:se=>T(se.target.value),placeholder:"Tìm kiếm đồng tác giả",error:!!W.coAuthorUserIds,helperText:((Y=W.coAuthorUserIds)==null?void 0:Y.message)||"Thêm các đồng tác giả (không bao gồm bạn)",InputProps:{...R.InputProps,endAdornment:e.jsxs(e.Fragment,{children:[de||b?e.jsx(J,{color:"inherit",size:20}):null,R.InputProps.endAdornment]})}})}})})}),N.length>0&&e.jsx(U,{item:!0,xs:12,children:e.jsx(U,{container:!0,spacing:2,children:N.map(R=>e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(B,{label:R.label,fullWidth:!0,value:d[R.key]||"",onChange:Y=>O(R.key,Y.target.value),required:R.required,error:R.required&&(!d[R.key]||d[R.key].trim()===""),helperText:R.required&&(!d[R.key]||d[R.key].trim()==="")?"Trường này là bắt buộc":"",disabled:n==null?void 0:n.isLocked})},R.key))})})]}),j===1&&e.jsxs(e.Fragment,{children:[e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"author.authorRoleId",control:v,render:({field:{value:R,onChange:Y,...se}})=>{var re,ie,ye,be,oe;return e.jsxs(B,{...se,select:!0,label:"Vai trò tác giả",fullWidth:!0,error:!!((re=W.author)!=null&&re.authorRoleId),helperText:(be=(ye=(ie=W.author)==null?void 0:ie.authorRoleId)==null?void 0:ye.message)==null?void 0:be.toString(),disabled:!c,value:R!=null?R:"",onChange:Pe=>{const ze=Pe.target.value===""?null:Pe.target.value;Y(ze)},children:[e.jsx(F,{value:"",children:"Chọn vai trò tác giả"}),(oe=M==null?void 0:M.data)==null?void 0:oe.map(Pe=>e.jsx(F,{value:Pe.id,children:Pe.name},Pe.id))]})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"author.purposeId",control:v,render:({field:R})=>{var Y,se,re,ie,ye;return e.jsx(B,{...R,select:!0,label:"Mục đích quy đổi",fullWidth:!0,error:!!((Y=W.author)!=null&&Y.purposeId),helperText:(ie=(re=(se=W.author)==null?void 0:se.purposeId)==null?void 0:re.message)==null?void 0:ie.toString(),disabled:!c,children:(ye=E==null?void 0:E.data)==null?void 0:ye.map(be=>e.jsx(F,{value:be.id,children:be.name},be.id))})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"author.position",control:v,render:({field:{value:R,onChange:Y,...se}})=>{var re,ie,ye,be;return e.jsx(B,{...se,label:"Vị trí tác giả",type:"number",fullWidth:!0,error:!!((re=W.author)!=null&&re.position),helperText:(be=(ye=(ie=W.author)==null?void 0:ie.position)==null?void 0:ye.message)==null?void 0:be.toString(),value:R===null?"":R,onChange:oe=>{const Pe=oe.target.value;Y(Pe===""?null:Number(Pe))}})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"author.scoreLevel",control:v,render:({field:{value:R,onChange:Y,...se}})=>{var re,ie,ye,be;return e.jsxs(B,{...se,select:!0,label:"Mức điểm",fullWidth:!0,error:!!((re=W.author)!=null&&re.scoreLevel),helperText:(be=(ye=(ie=W.author)==null?void 0:ie.scoreLevel)==null?void 0:ye.message)==null?void 0:be.toString(),disabled:k.length===0,value:R!=null?R:"",onChange:oe=>{const Pe=oe.target.value===""?null:Number(oe.target.value);Y(Pe)},children:[e.jsx(F,{value:"",children:"Chọn mức điểm"}),k.map(oe=>e.jsx(F,{value:oe,children:mt(oe)},oe))]})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"author.sCImagoFieldId",control:v,render:({field:{value:R,onChange:Y,...se}})=>{var re,ie,ye,be;return e.jsxs(B,{...se,select:!0,label:"Ngành SCImago",fullWidth:!0,error:!!((re=W.author)!=null&&re.sCImagoFieldId),helperText:(be=(ye=(ie=W.author)==null?void 0:ie.sCImagoFieldId)==null?void 0:ye.message)==null?void 0:be.toString(),disabled:!c,value:R!=null?R:"",onChange:oe=>{const Pe=oe.target.value===""?null:oe.target.value;Y(Pe)},children:[e.jsx(F,{value:"",children:"Chọn ngành SCImago"}),we.map(oe=>e.jsx(F,{value:oe.id,children:oe.name},oe.id))]})}})}),e.jsx(U,{item:!0,xs:6,children:e.jsx(Z,{name:"author.fieldId",control:v,render:({field:{value:R,onChange:Y,...se}})=>{var re,ie,ye,be;return e.jsxs(B,{...se,select:!0,label:"Ngành tính điểm",fullWidth:!0,error:!!((re=W.author)!=null&&re.fieldId),helperText:(be=(ye=(ie=W.author)==null?void 0:ie.fieldId)==null?void 0:ye.message)==null?void 0:be.toString(),value:R!=null?R:"",onChange:oe=>{const Pe=oe.target.value===""?null:oe.target.value;Y(Pe)},disabled:!1,children:[e.jsx(F,{value:"",children:"Chọn ngành tính điểm"}),g.map(oe=>e.jsx(F,{value:oe.id,children:oe.name},oe.id))]})}})})]}),e.jsx(U,{item:!0,xs:12,sx:{mt:2},children:e.jsx(C,{type:"submit",variant:"contained",color:"primary",fullWidth:!0,disabled:s,children:s?e.jsx(J,{size:24}):n?"Cập nhật":"Thêm mới"})})]})})}function yt({open:n,onClose:t,selectedWork:s,activeTab:a,setActiveTab:g,onSubmit:j,isPending:f,workTypes:T,workLevels:m,authorRoles:w,purposes:d,scimagoFields:y,fields:b}){var H;const{user:u}=Fe(),k=(H=s==null?void 0:s.authors)==null?void 0:H.find(v=>v.userId===(u==null?void 0:u.id)),P=k==null?void 0:k.proofStatus,q=s==null?void 0:s.isLocked;return l.useEffect(()=>{q&&P!==0&&g(1)},[q,P,g]),e.jsxs(he,{open:n,onClose:t,fullWidth:!0,maxWidth:"md",children:[e.jsx(ue,{children:s?"Cập nhật công trình":"Thêm công trình mới"}),e.jsxs(ge,{children:[e.jsx(z,{sx:{borderBottom:1,borderColor:"divider",mb:2},children:e.jsxs(Jt,{value:a,onChange:(v,x)=>{q&&P!==0&&x===0||g(x)},children:[e.jsx(Bn,{label:"Thông tin công trình",disabled:q&&P!==0,sx:{color:q&&P!==0?"text.disabled":"inherit","&.Mui-disabled":{color:"text.disabled"}}}),e.jsx(Bn,{label:"Thông tin tác giả"})]})}),T.length>0?e.jsx(Xr,{initialData:s,onSubmit:j,isLoading:f,workTypes:T,workLevels:m,authorRoles:w,purposes:d,scimagoFields:y,fields:b,activeTab:a,setActiveTab:g}):e.jsx(z,{sx:{display:"flex",justifyContent:"center",p:3},children:e.jsx(J,{})})]}),e.jsx(me,{children:e.jsx(C,{onClick:t,color:"inherit",children:"Đóng"})})]})}const $r=async()=>(await K.get("/systemConfigs/check")).data,Yr=async n=>(await K.get("/systemConfigs/year/".concat(n))).data,_r=async n=>(await K.post("/systemConfigs",n)).data,Zr=async(n,t)=>(await K.post("/systemConfigs/notify/".concat(t),n)).data,Jr=async(n,t)=>(await K.put("/systemConfigs/".concat(n),t)).data,ei=async n=>(await K.delete("/systemConfigs/".concat(n))).data;function ni(){const{data:n,isLoading:t}=ne({queryKey:["systemConfig"],queryFn:$r}),s=n==null?void 0:n.data,a=l.useMemo(()=>{if(!s)return!1;const f=He.now().setZone("Asia/Saigon"),T=He.fromISO(s.openTime,{zone:"utc"}).setZone("Asia/Saigon"),m=He.fromISO(s.closeTime,{zone:"utc"}).setZone("Asia/Saigon");return f>=T&&f<=m},[s]);return{systemConfig:s,isLoading:t,isSystemOpen:a,canEditWork:(f,T)=>T||a?f!==0:f===1,canDeleteWork:(f,T,m=!1)=>m?!1:T||a?f!==0:f===1}}const ln=async()=>(await K.get("/academicYears")).data,cn=async()=>(await K.get("/academicYears/current")).data,ti=async n=>(await K.post("/academicYears",n)).data,si=async(n,t)=>(await K.put("/academicYears/".concat(n),t)).data,ri=async n=>(await K.delete("/academicYears/".concat(n))).data;function ii(){var je,N;const n=fe(),[t,s]=l.useState({}),{user:a}=Fe(),{isSystemOpen:g,canEditWork:j,canDeleteWork:f}=ni(),{data:T}=ne({queryKey:["current-academic-year"],queryFn:cn}),{data:m,error:w,isPending:d,refetch:y}=ne({queryKey:["works","my-works"],queryFn:async()=>{var X;const O={academicYearId:(X=T==null?void 0:T.data)==null?void 0:X.id,isCurrentUser:!0};return on(O)},enabled:!!((je=T==null?void 0:T.data)!=null&&je.id),staleTime:0}),b=Ln(),{selectedWork:u,openUpdateDialog:k,activeTab:P,createWorkMutation:q,updateWorkMutation:H,handleOpenUpdateDialog:v,handleCloseUpdateDialog:x,handleUpdateSubmit:W,setActiveTab:I}=jt({userId:(N=a==null?void 0:a.id)!=null?N:"",worksData:m,refetchWorks:y,isAuthorPage:!0});l.useEffect(()=>{m!=null&&m.data&&m.data.length>0&&(async()=>{const X={};for(const M of m.data)if(M.coAuthorUserIds&&M.coAuthorUserIds.length>0){const E=[];for(const Q of M.coAuthorUserIds)try{const we=await _e(Q);we.success&&we.data&&E.push(we.data)}catch(we){console.error("Lỗi khi lấy thông tin đồng tác giả:",we)}X[M.id]=E}s(X)})()},[m]),l.useEffect(()=>{m&&m.message&&A.success(m.message,{toastId:"fetch-works-success"})},[m]),l.useEffect(()=>{w&&A.error("Có lỗi đã xảy ra: "+w.message,{toastId:"fetch-works-error"})},[w]);const[p,i]=l.useState(!1),[r,h]=l.useState(null),c=O=>{h(O),i(!0)},S=()=>{h(null),i(!1)},o=xe({mutationFn:O=>Kr(O),onSuccess:()=>{A.success("Xóa công trình thành công!"),n.invalidateQueries({queryKey:["works","my-works"]}),setTimeout(()=>{y()},100),i(!1)},onError:O=>{A.error("Lỗi khi xóa công trình: "+O.message)}}),D=async()=>{if(r)try{await o.mutateAsync(r)}catch(O){}},V=[{field:"stt",headerName:"STT",width:70,renderCell:O=>{const M=O.api.getAllRowIds().indexOf(O.id);return e.jsx("div",{children:M+1})}},{field:"title",headerName:"Tên công trình",type:"string",width:250},{field:"timePublished",headerName:"Thời gian xuất bản",type:"string",width:150,renderCell:O=>O.value?e.jsx("div",{children:ft(O.value)}):e.jsx("div",{children:"-"})},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:170},{field:"workLevelName",headerName:"Cấp công trình",type:"string",width:150},{field:"details",headerName:"Thông tin chi tiết",type:"string",width:300,renderCell:O=>{if(!O.row.details)return e.jsx("div",{children:"-"});const X=O.row.details,M=Object.entries(X).map(([E,Q])=>"".concat(E,": ").concat(String(Q))).join("\n");return e.jsx(Re,{title:e.jsx("div",{style:{whiteSpace:"pre-line",fontSize:"0.8rem"},children:M}),arrow:!0,children:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%"},children:Object.entries(X).map(([E,Q],we)=>e.jsxs("span",{children:[we>0&&"; ",e.jsx("b",{children:E}),": ",String(Q)]},we))})})}},{field:"totalAuthors",headerName:"Số tác giả",type:"number",width:140,align:"center",headerAlign:"left"},{field:"totalMainAuthors",headerName:"Số tác giả chính",type:"number",width:140,align:"center",headerAlign:"left"},{field:"coAuthors",headerName:"Đồng tác giả",type:"string",width:140,renderCell:O=>{const X=O.row.id,M=t[X]||[];if(M.length===0)return e.jsx("div",{children:"-"});const E="".concat(M.length," tác giả");return e.jsx(Re,{title:e.jsxs("div",{children:[e.jsx(L,{variant:"subtitle2",children:"Danh sách đồng tác giả:"}),M.map((Q,we)=>e.jsxs(L,{variant:"body2",children:["• ",Q.fullName," - ",Q.userName," - ",Q.departmentName||"Chưa có phòng ban"]},we))]}),children:e.jsx("div",{children:E})})}},{field:"authorRoleName",headerName:"Vai trò tác giả",type:"string",width:150,renderCell:O=>{var E;const M=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(a==null?void 0:a.id));return e.jsx("div",{children:M?M.authorRoleName:"-"})}},{field:"position",headerName:"Vị trí",type:"string",width:80,renderCell:O=>{var E;const M=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(a==null?void 0:a.id));return e.jsx("div",{children:(M==null?void 0:M.position)!==void 0&&(M==null?void 0:M.position)!==null?M.position:"-"})}},{field:"purposeName",headerName:"Mục đích quy đổi",type:"string",width:180,renderCell:O=>{var E;const M=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(a==null?void 0:a.id));return e.jsx("div",{children:M?M.purposeName:"-"})}},{field:"fieldName",headerName:"Ngành tính điểm",type:"string",width:150,renderCell:O=>{var E;const M=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(a==null?void 0:a.id));return e.jsx("div",{children:M?M.fieldName:"-"})}},{field:"scImagoFieldName",headerName:"Ngành SCImago",type:"string",width:180,renderCell:O=>{var E;const M=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(a==null?void 0:a.id));return e.jsx("div",{children:M?M.scImagoFieldName:"-"})}},{field:"scoreLevel",headerName:"Mức điểm",type:"string",width:150,renderCell:O=>{var E;const M=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(a==null?void 0:a.id));return!M||M.scoreLevel===void 0||M.scoreLevel===null?e.jsx("div",{children:"-"}):e.jsx("div",{children:an(M.scoreLevel)})}},{field:"workHour",headerName:"Giờ công trình",type:"string",width:120,renderCell:O=>{var E;const M=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(a==null?void 0:a.id));return e.jsx("div",{children:(M==null?void 0:M.workHour)!==void 0&&(M==null?void 0:M.workHour)!==null?M.workHour:"-"})}},{field:"authorHour",headerName:"Giờ tác giả",type:"string",width:120,renderCell:O=>{var E;const M=(E=O.row.authors)==null?void 0:E.find(Q=>Q.userId===(a==null?void 0:a.id));return e.jsx("div",{children:(M==null?void 0:M.authorHour)!==void 0&&(M==null?void 0:M.authorHour)!==null?M.authorHour:"-"})}},{field:"note",headerName:"Ghi chú",type:"string",width:150,renderCell:O=>{var Q;const M=(Q=O.row.authors)==null?void 0:Q.find(we=>we.userId===(a==null?void 0:a.id)),E=(M==null?void 0:M.note)||"";return E?e.jsx(Re,{title:e.jsx("div",{style:{whiteSpace:"pre-line",fontSize:"0.8rem"},children:E}),arrow:!0,children:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%"},children:E})}):e.jsx("div",{children:"-"})}},{field:"proofStatus",headerName:"Trạng thái",type:"string",width:140,renderCell:O=>{var Q;const M=(Q=O.row.authors)==null?void 0:Q.find(we=>we.userId===(a==null?void 0:a.id)),E=M==null?void 0:M.proofStatus;return E==null?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"}):E===ce.HopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Ze,{color:"success"}),"Hợp lệ"]}):E===ce.KhongHopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Je,{color:"error"}),"Không hợp lệ"]}):E===ce.ChuaXuLy?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(nn,{color:"action"}),"Chưa xử lý"]}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"})}},{field:"actions",headerName:"Thao tác",width:200,renderCell:O=>{var de,G;const X=O.row,M=(de=X.authors)==null?void 0:de.find(ee=>ee.userId===(a==null?void 0:a.id)),E=M==null?void 0:M.proofStatus,Q=X.isLocked,we=(G=X.authors)==null?void 0:G.some(ee=>ee.userId!==(a==null?void 0:a.id)&&ee.proofStatus===0);if(Q&&E===0)return e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>v(X),disabled:!0,sx:{mr:1},children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>c(X.id),disabled:!0,children:"Xóa"})]});if(Q)return e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>v(X),disabled:!1,sx:{mr:1},children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>c(X.id),disabled:!f(E,Q,we),children:"Xóa"})]});const $=j(E,Q);return e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>v(X),disabled:!$,sx:{mr:1},children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>c(X.id),disabled:!f(E,Q,we),children:"Xóa"})]})}}];return d?e.jsx(J,{}):w?e.jsxs("p",{children:["Lỗi: ",w.message]}):e.jsxs(Be,{maxWidth:"xl",children:[e.jsxs(z,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(L,{variant:"h6",children:"Danh sách công trình"}),e.jsx(z,{sx:{display:"flex",gap:2},children:e.jsx(C,{variant:"contained",color:"primary",onClick:()=>v(void 0),startIcon:e.jsx(es,{}),disabled:!g,children:"Thêm công trình"})})]}),d?e.jsx(z,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(J,{})}):e.jsx(Te,{columns:V,data:m.data||[]}),e.jsx(yt,{open:k,onClose:x,selectedWork:u,activeTab:P,setActiveTab:I,onSubmit:W,isPending:q.isPending||H.isPending,workTypes:b.workTypes,workLevels:b.workLevels,authorRoles:b.authorRoles,purposes:b.purposes,scimagoFields:b.scimagoFields,fields:b.fields}),e.jsxs(he,{open:p,onClose:S,children:[e.jsx(ue,{children:"Xác nhận xóa"}),e.jsx(ge,{children:e.jsx(L,{children:"Bạn có chắc chắn muốn xóa công trình này không?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:S,color:"inherit",children:"Hủy"}),e.jsx(C,{onClick:D,color:"error",variant:"contained",disabled:o.isPending,children:o.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const dn=$n.create({baseURL:"/api",headers:{"Content-Type":"application/json"},timeout:3e4});dn.interceptors.request.use(n=>{const t=localStorage.getItem("token");return t&&(n.headers.Authorization="Bearer ".concat(t)),n},n=>Promise.reject(n));const ai=async n=>{const t=new URLSearchParams;return n.userId&&t.append("userId",n.userId),n.departmentId&&t.append("departmentId",n.departmentId),n.academicYearId&&t.append("academicYearId",n.academicYearId),n.proofStatus!==void 0&&t.append("proofStatus",n.proofStatus.toString()),n.source!==void 0&&t.append("source",n.source.toString()),t.append("onlyRegisteredWorks",n.onlyRegisteredWorks.toString()),t.append("onlyRegisterableWorks",n.onlyRegisterableWorks.toString()),t.append("isCurrentUser",n.isCurrentUser.toString()),console.log("Gọi API với params:",t.toString()),(await dn.get("/works/filter?".concat(t.toString()))).data},oi=async()=>(await dn.get("/works/my-works")).data,li=async n=>{console.log("Gọi API getWorkById:",n);const t=await dn.get("/works/".concat(n));return console.log("Response from getWorkById:",t.data),t.data},ci=async()=>(await dn.get("/works/all-my-works")).data,di=()=>{var c,S;const[n,t]=l.useState(!1),[s,a]=l.useState(null),[g,j]=l.useState([]),[f,T]=l.useState([]),[m,w]=l.useState([]),[d,y]=l.useState(null),[b,u]=l.useState(null),[k,P]=l.useState({userId:"",departmentId:"",academicYearId:"",proofStatus:void 0,source:void 0,onlyRegisteredWorks:!1,onlyRegisterableWorks:!1,isCurrentUser:!0});l.useEffect(()=>{(async()=>{try{const[D,V]=await Promise.all([ln(),Ge()]);T(D.data||[]),w(V.data||[])}catch(D){a("Lỗi khi tải dữ liệu ban đầu"),console.error("Error fetching initial data:",D)}})()},[]);const q=o=>{const{name:D,value:V}=o.target;P(je=>({...je,[D]:V}))},H=o=>{const{name:D,checked:V}=o.target;P(je=>({...je,[D]:V}))},v=o=>{const{name:D,value:V}=o.target;P(D==="proofStatus"||D==="source"?je=>({...je,[D]:V===""?void 0:Number(V)}):je=>({...je,[D]:V}))},x=async()=>{var o;t(!0),a(null),u(null);try{const D=await ai(k);j(D.data||[]),u(JSON.stringify({success:D.success,message:D.message,count:((o=D.data)==null?void 0:o.length)||0},null,2))}catch(D){console.error("Error fetching works:",D),a("Lỗi khi tải danh sách công trình")}finally{t(!1)}},W=async()=>{var o;t(!0),a(null),u(null);try{const D=await oi();j(D.data||[]),u(JSON.stringify({success:D.success,message:D.message,count:((o=D.data)==null?void 0:o.length)||0},null,2))}catch(D){console.error("Error fetching my works:",D),a("Lỗi khi tải danh sách công trình của tôi")}finally{t(!1)}},I=async()=>{var o;t(!0),a(null),u(null);try{const D=await ci();j(D.data||[]),u(JSON.stringify({success:D.success,message:D.message,count:((o=D.data)==null?void 0:o.length)||0},null,2))}catch(D){console.error("Error fetching all my works:",D),a("Lỗi khi tải tất cả công trình của tôi")}finally{t(!1)}},p=async o=>{var D,V,je,N,O;t(!0),a(null),u(null);try{const X=await li(o);y(X.data),u(JSON.stringify({success:X.success,message:X.message,data:{id:(D=X.data)==null?void 0:D.id,title:(V=X.data)==null?void 0:V.title,authorsCount:((N=(je=X.data)==null?void 0:je.authors)==null?void 0:N.length)||0,coAuthorUserIds:((O=X.data)==null?void 0:O.coAuthorUserIds)||[]}},null,2))}catch(X){console.error("Error fetching work details:",X),a("Lỗi khi tải chi tiết công trình")}finally{t(!1)}},i=o=>o?new Date(o).toLocaleDateString("vi-VN"):"N/A",r=o=>{if(o===void 0)return"Không xác định";switch(o){case ce.ChuaXuLy:return"Chưa xử lý";case ce.HopLe:return"Hợp lệ";case ce.KhongHopLe:return"Không hợp lệ";default:return"Không xác định"}},h=o=>{if(o===void 0)return"Không xác định";switch(o){case We.NguoiDungKeKhai:return"Người dùng kê khai";case We.QuanLyNhap:return"Quản lý nhập";default:return"Không xác định"}};return e.jsxs(Be,{maxWidth:"xl",sx:{mt:4,mb:4},children:[e.jsx(L,{variant:"h4",gutterBottom:!0,children:"Kiểm thử API Works Controller"}),e.jsx(z,{mb:4,children:e.jsx(De,{severity:"info",children:"Trang này sử dụng để kiểm thử các API của WorksController. Nếu bạn đã đăng nhập với token hợp lệ, các API sẽ tự động sử dụng thông tin người dùng hiện tại."})}),e.jsxs(U,{container:!0,spacing:3,children:[e.jsx(U,{item:!0,xs:12,md:4,children:e.jsxs(Ce,{sx:{p:2,height:"100%"},children:[e.jsx(L,{variant:"h6",gutterBottom:!0,children:"Bộ lọc"}),e.jsx(Ve,{control:e.jsx(Oe,{checked:k.isCurrentUser,onChange:H,name:"isCurrentUser"}),label:"Sử dụng người dùng hiện tại"}),!k.isCurrentUser&&e.jsx(B,{fullWidth:!0,margin:"normal",label:"User ID",name:"userId",value:k.userId||"",onChange:q,size:"small",disabled:k.isCurrentUser}),e.jsxs(pe,{fullWidth:!0,margin:"normal",size:"small",children:[e.jsx(ve,{children:"Khoa/Phòng ban"}),e.jsxs(Ie,{name:"departmentId",value:k.departmentId||"",onChange:v,label:"Khoa/Phòng ban",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),m.map(o=>e.jsx(F,{value:o.id,children:o.name},o.id))]})]}),e.jsxs(pe,{fullWidth:!0,margin:"normal",size:"small",children:[e.jsx(ve,{children:"Năm học"}),e.jsxs(Ie,{name:"academicYearId",value:k.academicYearId||"",onChange:v,label:"Năm học",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),f.map(o=>e.jsx(F,{value:o.id,children:o.name},o.id))]})]}),e.jsxs(pe,{fullWidth:!0,margin:"normal",size:"small",children:[e.jsx(ve,{children:"Trạng thái minh chứng"}),e.jsxs(Ie,{name:"proofStatus",value:k.proofStatus!==void 0?k.proofStatus:"",onChange:v,label:"Trạng thái minh chứng",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),e.jsx(F,{value:ce.ChuaXuLy,children:"Chưa xử lý"}),e.jsx(F,{value:ce.HopLe,children:"Hợp lệ"}),e.jsx(F,{value:ce.KhongHopLe,children:"Không hợp lệ"})]})]}),e.jsxs(pe,{fullWidth:!0,margin:"normal",size:"small",children:[e.jsx(ve,{children:"Nguồn"}),e.jsxs(Ie,{name:"source",value:k.source!==void 0?k.source:"",onChange:v,label:"Nguồn",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),e.jsx(F,{value:We.NguoiDungKeKhai,children:"Người dùng kê khai"}),e.jsx(F,{value:We.QuanLyNhap,children:"Quản lý nhập"})]})]}),e.jsx(Ve,{control:e.jsx(Oe,{checked:k.onlyRegisteredWorks,onChange:H,name:"onlyRegisteredWorks"}),label:"Chỉ lấy công trình đăng ký quy đổi"}),e.jsx(Ve,{control:e.jsx(Oe,{checked:k.onlyRegisterableWorks,onChange:H,name:"onlyRegisterableWorks"}),label:"Chỉ lấy công trình có thể đăng ký quy đổi"}),e.jsxs(z,{mt:3,children:[e.jsx(C,{variant:"contained",color:"primary",fullWidth:!0,onClick:x,disabled:n,children:n?e.jsx(J,{size:24}):"Tìm kiếm theo bộ lọc"}),e.jsxs(z,{display:"flex",mt:2,gap:2,children:[e.jsx(C,{variant:"outlined",color:"primary",onClick:W,disabled:n,fullWidth:!0,children:"Lấy công trình của tôi"}),e.jsx(C,{variant:"outlined",color:"secondary",onClick:I,disabled:n,fullWidth:!0,children:"Tất cả công trình"})]})]})]})}),e.jsxs(U,{item:!0,xs:12,md:8,children:[e.jsxs(Ce,{sx:{p:2,mb:3},children:[e.jsxs(L,{variant:"h6",gutterBottom:!0,display:"flex",alignItems:"center",justifyContent:"space-between",children:[e.jsxs("span",{children:["Kết quả (",g.length," công trình)"]}),n&&e.jsx(J,{size:24})]}),s&&e.jsx(De,{severity:"error",sx:{mb:2},children:s}),b&&e.jsx(De,{severity:"success",sx:{mb:2},children:e.jsx("pre",{style:{whiteSpace:"pre-wrap",margin:0},children:b})}),g.length===0&&!n?e.jsx(De,{severity:"info",children:"Không có công trình nào được tìm thấy. Vui lòng thay đổi bộ lọc hoặc thử lại."}):e.jsx(rt,{children:e.jsxs(it,{size:"small",children:[e.jsx(at,{children:e.jsxs(Xe,{children:[e.jsx(le,{children:"STT"}),e.jsx(le,{children:"Tiêu đề"}),e.jsx(le,{children:"Loại công trình"}),e.jsx(le,{children:"Năm học"}),e.jsx(le,{children:"Nguồn"}),e.jsx(le,{children:"Đồng tác giả"}),e.jsx(le,{children:"Thao tác"})]})}),e.jsx(ot,{children:g.map((o,D)=>{var V;return e.jsxs(Xe,{hover:!0,children:[e.jsx(le,{children:D+1}),e.jsx(le,{children:o.title}),e.jsx(le,{children:o.workTypeName||"N/A"}),e.jsx(le,{children:o.academicYearName||"N/A"}),e.jsx(le,{children:h(o.source)}),e.jsx(le,{children:((V=o.coAuthorUserIds)==null?void 0:V.length)||0}),e.jsx(le,{children:e.jsx(C,{size:"small",onClick:()=>p(o.id),children:"Chi tiết"})})]},o.id)})})]})})]}),d&&e.jsxs(Ce,{sx:{p:2},children:[e.jsx(L,{variant:"h6",gutterBottom:!0,children:"Chi tiết công trình"}),e.jsxs(U,{container:!0,spacing:2,children:[e.jsx(U,{item:!0,xs:12,children:e.jsx(L,{variant:"h5",children:d.title})}),e.jsxs(U,{item:!0,xs:12,sm:6,children:[e.jsx(L,{variant:"subtitle2",children:"Loại công trình:"}),e.jsx(L,{variant:"body2",children:d.workTypeName||"N/A"})]}),e.jsxs(U,{item:!0,xs:12,sm:6,children:[e.jsx(L,{variant:"subtitle2",children:"Cấp công trình:"}),e.jsx(L,{variant:"body2",children:d.workLevelName||"N/A"})]}),e.jsxs(U,{item:!0,xs:12,sm:6,children:[e.jsx(L,{variant:"subtitle2",children:"Năm học:"}),e.jsx(L,{variant:"body2",children:d.academicYearName||"N/A"})]}),e.jsxs(U,{item:!0,xs:12,sm:6,children:[e.jsx(L,{variant:"subtitle2",children:"Ngày xuất bản:"}),e.jsx(L,{variant:"body2",children:i(d.timePublished)})]}),e.jsxs(U,{item:!0,xs:12,sm:6,children:[e.jsx(L,{variant:"subtitle2",children:"Nguồn:"}),e.jsx(L,{variant:"body2",children:h(d.source)})]}),e.jsxs(U,{item:!0,xs:12,sm:6,children:[e.jsx(L,{variant:"subtitle2",children:"Ngày tạo:"}),e.jsx(L,{variant:"body2",children:i(d.createdDate)})]}),e.jsxs(U,{item:!0,xs:12,children:[e.jsx(Ke,{sx:{my:2}}),e.jsx(L,{variant:"subtitle1",fontWeight:"bold",children:"Thông tin tác giả và đồng tác giả"})]}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(hn,{variant:"outlined",children:e.jsxs(Un,{children:[e.jsxs(L,{variant:"subtitle2",gutterBottom:!0,children:["Đồng tác giả (",((c=d.coAuthorUserIds)==null?void 0:c.length)||0,"):"]}),d.coAuthorUserIds&&d.coAuthorUserIds.length>0?e.jsx(zn,{dense:!0,children:d.coAuthorUserIds.map((o,D)=>e.jsx(Vn,{divider:D<d.coAuthorUserIds.length-1,children:e.jsx(On,{primary:"Đồng tác giả ".concat(D+1),secondary:o})},o))}):e.jsx(L,{variant:"body2",color:"text.secondary",children:"Không có đồng tác giả"})]})})}),e.jsx(U,{item:!0,xs:12,sm:6,children:e.jsx(hn,{variant:"outlined",children:e.jsxs(Un,{children:[e.jsxs(L,{variant:"subtitle2",gutterBottom:!0,children:["Tác giả (",((S=d.authors)==null?void 0:S.length)||0,"):"]}),d.authors&&d.authors.length>0?e.jsx(zn,{dense:!0,children:d.authors.map((o,D)=>{var V;return e.jsxs(Vn,{divider:D<d.authors.length-1,children:[e.jsx(On,{primary:o.authorRoleName||"Chưa có tên vai trò",secondary:"UserId: ".concat(o.userId||"N/A",", Trạng thái: ").concat(r(o.proofStatus))}),((V=o.authorRoleName)==null?void 0:V.includes("Chính"))&&e.jsx(Ee,{size:"small",color:"primary",label:"Tác giả chính"})]},o.id)})}):e.jsx(L,{variant:"body2",color:"text.secondary",children:"Không có thông tin tác giả"})]})})})]}),e.jsx(z,{mt:2,children:e.jsx(C,{variant:"outlined",onClick:()=>y(null),children:"Đóng chi tiết"})})]})]})]}),e.jsx(ns,{open:!!s,autoHideDuration:6e3,onClose:()=>a(null),message:s})]})},hi=Ne({name:_().min(2,"Tên mục đích quy đổi phải có ít nhất 2 ký tự"),workTypeId:_().uuid("Vui lòng chọn loại công trình")});function ui({open:n,handleClose:t,data:s}){var k,P,q;const a=fe(),{data:g,isLoading:j}=ne({queryKey:["workTypes"],queryFn:Ue}),{register:f,handleSubmit:T,setValue:m,reset:w,formState:{errors:d,isSubmitting:y}}=Se({resolver:qe(hi),defaultValues:{name:"",workTypeId:""}});l.useEffect(()=>{s?(m("name",s.name),m("workTypeId",s.workTypeId||"")):w()},[s,n,m,w]);const b=xe({mutationFn:async H=>s!=null&&s.id?qr(s.id,H):Nr(H),onSuccess:()=>{a.invalidateQueries({queryKey:["purposes"]}),A.success(s!=null&&s.id?"Mục đích quy đổi đã được cập nhật":"Mục đích quy đổi đã được thêm"),t()},onError:H=>{console.error("API Error:",H),A.error("Đã xảy ra lỗi: "+H.message)}}),u=async H=>{await b.mutateAsync(H)};return e.jsxs(he,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:s?"Cập nhật Mục đích quy đổi":"Thêm Mục đích quy đổi"}),e.jsxs(ge,{children:[e.jsx(B,{label:"Tên mục đích quy đổi",...f("name"),error:!!d.name,helperText:(k=d.name)==null?void 0:k.message,fullWidth:!0,margin:"dense",disabled:y}),e.jsx(B,{select:!0,label:"Loại công trình",...f("workTypeId"),error:!!d.workTypeId,helperText:(P=d.workTypeId)==null?void 0:P.message,fullWidth:!0,margin:"dense",disabled:y||j,children:j?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(q=g==null?void 0:g.data)==null?void 0:q.map(H=>e.jsx(F,{value:H.id,children:H.name},H.id))})]}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,disabled:y,children:"Hủy"}),e.jsx(C,{onClick:T(u),variant:"contained",color:"primary",disabled:y||j,children:y?e.jsx(J,{size:24}):s?"Cập nhật":"Thêm mới"})]})]})}function gi(){var S;const n=fe(),[t,s]=l.useState(""),{data:a,isLoading:g}=ne({queryKey:["workTypes"],queryFn:Ue}),{data:j,error:f,isPending:T,isSuccess:m,dataUpdatedAt:w}=ne({queryKey:["purposes",t],queryFn:()=>t?Nn(t):xt()});l.useEffect(()=>{m&&j&&A.success(j.message,{toastId:"fetch-purposes-success"})},[w,m,j]),l.useEffect(()=>{f&&A.error("Có lỗi đã xảy ra: "+f.message)},[f]);const d=o=>{s(o.target.value)},[y,b]=l.useState(!1),[u,k]=l.useState(null),P=o=>{k(o),b(!0)},q=()=>b(!1),H=o=>{P(o)},[v,x]=l.useState(!1),[W,I]=l.useState(null),p=o=>{I(o),x(!0)},i=()=>{I(null),x(!1)},r=xe({mutationFn:o=>Lr(o),onSuccess:()=>{A.success("Xóa mục đích quy đổi thành công!"),n.invalidateQueries({queryKey:["purposes"]}),x(!1)},onError:o=>{A.error("Lỗi khi xóa: "+o.message)}}),h=()=>{W&&r.mutate(W)},c=[{field:"stt",headerName:"STT",width:70,renderCell:o=>{const D=Array.from(o.api.getAllRowIds()).findIndex(V=>V===o.row.id);return e.jsx("div",{children:D+1})}},{field:"name",headerName:"Tên mục đích quy đổi",type:"string",width:400},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:400},{field:"actions",headerName:"Thao tác",width:200,renderCell:o=>e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>H(o.row),sx:{marginRight:1},disabled:r.isPending,children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>p(o.row.id),disabled:r.isPending,children:"Xóa"})]})}];return T&&g?e.jsx(J,{}):f?e.jsxs("p",{children:["Lỗi: ",f.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:2},children:[e.jsx(L,{variant:"h4",children:"Quản lý mục đích quy đổi"}),e.jsxs(z,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(pe,{sx:{minWidth:220},children:[e.jsx(ve,{id:"work-type-filter-label",children:"Lọc theo loại công trình"}),e.jsxs(Ie,{labelId:"work-type-filter-label",id:"work-type-filter",value:t,onChange:d,label:"Lọc theo loại công trình",children:[e.jsx(F,{value:"",children:"Tất cả"}),(S=a==null?void 0:a.data)==null?void 0:S.map(o=>e.jsx(F,{value:o.id,children:o.name},o.id))]})]}),e.jsx(C,{variant:"contained",onClick:()=>P(null),children:"Thêm mục đích quy đổi"})]})]}),e.jsx(Ce,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(Te,{columns:c,data:(j==null?void 0:j.data)||[]})}),e.jsx(ui,{open:y,handleClose:q,data:u}),e.jsxs(he,{open:v,onClose:i,children:[e.jsx(ue,{children:"Xác nhận xóa"}),e.jsx(ge,{children:e.jsx(L,{children:"Bạn có chắc chắn muốn xóa mục đích quy đổi này?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:i,disabled:r.isPending,children:"Hủy"}),e.jsx(C,{onClick:h,color:"error",variant:"contained",disabled:r.isPending,children:r.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const mi=Ne({name:_().min(2,"Tên ngành SCImago phải có ít nhất 2 ký tự")});function pi({open:n,handleClose:t,data:s}){var b;const a=fe(),{register:g,handleSubmit:j,setValue:f,reset:T,formState:{errors:m,isSubmitting:w}}=Se({resolver:qe(mi),defaultValues:{name:""}});l.useEffect(()=>{s?f("name",s.name):T()},[s,n,f,T]);const d=xe({mutationFn:async u=>s!=null&&s.id?zr(s.id,u):Ur(u),onSuccess:()=>{a.invalidateQueries({queryKey:["scimagoFields"]}),A.success(s!=null&&s.id?"Ngành SCImago đã được cập nhật":"Ngành SCImago đã được thêm"),t()},onError:u=>{console.error("API Error:",u),A.error("Đã xảy ra lỗi: "+u.message)}}),y=async u=>{await d.mutateAsync(u)};return e.jsxs(he,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:s?"Cập nhật Ngành SCImago":"Thêm Ngành SCImago"}),e.jsx(ge,{children:e.jsx(B,{label:"Tên ngành SCImago",...g("name"),error:!!m.name,helperText:(b=m.name)==null?void 0:b.message,fullWidth:!0,margin:"dense",disabled:w})}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,disabled:w,children:"Hủy"}),e.jsx(C,{onClick:j(y),variant:"contained",color:"primary",disabled:w,children:w?e.jsx(J,{size:24}):s?"Cập nhật":"Thêm mới"})]})]})}function xi(){const n=fe(),{data:t,error:s,isPending:a,isSuccess:g,dataUpdatedAt:j}=ne({queryKey:["scimagoFields"],queryFn:qn});l.useEffect(()=>{g&&t&&A.success(t.message,{toastId:"fetch-scimago-fields-success"})},[j,g,t]),l.useEffect(()=>{s&&A.error("Có lỗi đã xảy ra: "+s.message)},[s]);const[f,T]=l.useState(!1),[m,w]=l.useState(null),d=p=>{w(p),T(!0)},y=()=>T(!1),b=p=>{d(p)},[u,k]=l.useState(!1),[P,q]=l.useState(null),H=p=>{q(p),k(!0)},v=()=>{q(null),k(!1)},x=xe({mutationFn:p=>Vr(p),onSuccess:()=>{A.success("Xóa ngành SCImago thành công!"),n.invalidateQueries({queryKey:["scimagoFields"]}),k(!1)},onError:p=>{A.error("Lỗi khi xóa: "+p.message)}}),W=()=>{P&&x.mutate(P)},I=[{field:"stt",headerName:"STT",width:70,renderCell:p=>{const i=Array.from(p.api.getAllRowIds()).findIndex(r=>r===p.row.id);return e.jsx("div",{children:i+1})}},{field:"name",headerName:"Tên ngành SCImago",type:"string",width:400},{field:"actions",headerName:"Thao tác",width:200,renderCell:p=>e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>b(p.row),sx:{marginRight:1},disabled:x.isPending,children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>H(p.row.id),disabled:x.isPending,children:"Xóa"})]})}];return a?e.jsx(J,{}):s?e.jsxs("p",{children:["Lỗi: ",s.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:2},children:[e.jsx(L,{variant:"h4",children:"Quản lý ngành SCImago"}),e.jsx(z,{display:"flex",alignItems:"center",gap:2,children:e.jsx(C,{variant:"contained",onClick:()=>d(null),children:"Thêm ngành SCImago"})})]}),e.jsx(Ce,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(Te,{columns:I,data:(t==null?void 0:t.data)||[]})}),e.jsx(pi,{open:f,handleClose:y,data:m}),e.jsxs(he,{open:u,onClose:v,children:[e.jsx(ue,{children:"Xác nhận xóa"}),e.jsx(ge,{children:e.jsx(L,{children:"Bạn có chắc chắn muốn xóa ngành SCImago này?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:v,disabled:x.isPending,children:"Hủy"}),e.jsx(C,{onClick:W,color:"error",variant:"contained",disabled:x.isPending,children:x.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const fi=Ne({name:_().min(2,"Tên cấp công trình phải có ít nhất 2 ký tự"),workTypeId:_().uuid("Vui lòng chọn loại công trình")});function ji({open:n,handleClose:t,data:s}){const a=fe(),{data:g,isLoading:j}=ne({queryKey:["workTypes"],queryFn:Ue}),{control:f,handleSubmit:T,setValue:m,reset:w,formState:{errors:d}}=Se({resolver:qe(fi),defaultValues:{name:"",workTypeId:""}});l.useEffect(()=>{s?(m("name",s.name),m("workTypeId",s.workTypeId)):w()},[s,m,w]);const y=xe({mutationFn:async u=>s!=null&&s.id?Tr(s.id,u):Ir(u),onSuccess:()=>{a.invalidateQueries({queryKey:["workLevels"]}),A.success(s!=null&&s.id?"Cấp công trình đã được cập nhật":"Cấp công trình đã được thêm"),t()},onError:u=>{console.error("API Error:",u),A.error("Đã xảy ra lỗi: "+u.message)}}),b=async u=>{await y.mutateAsync(u)};return e.jsxs(he,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:s?"Cập nhật cấp công trình":"Thêm cấp công trình"}),e.jsx(ge,{children:e.jsx("form",{onSubmit:T(b),children:e.jsxs(U,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"name",control:f,render:({field:u})=>{var k;return e.jsx(B,{...u,label:"Tên cấp công trình",error:!!d.name,helperText:(k=d.name)==null?void 0:k.message,fullWidth:!0,disabled:y.isPending})}})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"workTypeId",control:f,render:({field:u})=>{var k,P;return e.jsx(B,{...u,select:!0,label:"Loại công trình",error:!!d.workTypeId,helperText:(k=d.workTypeId)==null?void 0:k.message,fullWidth:!0,disabled:y.isPending||j,children:j?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(P=g==null?void 0:g.data)==null?void 0:P.map(q=>e.jsx(F,{value:q.id,children:q.name},q.id))})}})})]})})}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,disabled:y.isPending,children:"Hủy"}),e.jsx(C,{onClick:T(b),disabled:y.isPending,variant:"contained",color:"primary",children:y.isPending?e.jsx(J,{size:24}):s?"Cập nhật":"Thêm mới"})]})]})}function yi(){var S;const n=fe(),[t,s]=l.useState(""),{data:a,isLoading:g}=ne({queryKey:["workTypes"],queryFn:Ue}),{data:j,error:f,isPending:T,isSuccess:m,dataUpdatedAt:w}=ne({queryKey:["workLevels",t],queryFn:()=>t?Sn(t):pt()});l.useEffect(()=>{m&&j&&A.success(j.message,{toastId:"fetch-work-levels-success"})},[w,m,j]),l.useEffect(()=>{f&&A.error("Có lỗi đã xảy ra: "+f.message)},[f]);const d=o=>{s(o.target.value)},[y,b]=l.useState(!1),[u,k]=l.useState(null),P=o=>{k(o),b(!0)},q=()=>b(!1),H=o=>{P(o)},[v,x]=l.useState(!1),[W,I]=l.useState(null),p=o=>{I(o),x(!0)},i=()=>{I(null),x(!1)},r=xe({mutationFn:o=>Sr(o),onSuccess:()=>{A.success("Xóa cấp công trình thành công!"),n.invalidateQueries({queryKey:["workLevels"]}),x(!1)},onError:o=>{A.error("Lỗi khi xóa: "+o.message)}}),h=()=>{W&&r.mutate(W)},c=[{field:"stt",headerName:"STT",width:70,renderCell:o=>{const D=Array.from(o.api.getAllRowIds()).findIndex(V=>V===o.row.id);return e.jsx("div",{children:D+1})}},{field:"name",headerName:"Tên cấp công trình",type:"string",width:300},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:300},{field:"actions",headerName:"Thao tác",width:200,renderCell:o=>e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>H(o.row),sx:{marginRight:1},disabled:r.isPending,children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>p(o.row.id),disabled:r.isPending,children:"Xóa"})]})}];return T&&g?e.jsx(J,{}):f?e.jsxs("p",{children:["Lỗi: ",f.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:2},children:[e.jsx(L,{variant:"h4",children:"Quản lý cấp công trình"}),e.jsxs(z,{display:"flex",alignItems:"center",gap:2,children:[e.jsxs(pe,{sx:{minWidth:220},children:[e.jsx(ve,{id:"work-type-filter-label",children:"Lọc theo loại công trình"}),e.jsxs(Ie,{labelId:"work-type-filter-label",id:"work-type-filter",value:t,onChange:d,label:"Lọc theo loại công trình",children:[e.jsx(F,{value:"",children:"Tất cả"}),(S=a==null?void 0:a.data)==null?void 0:S.map(o=>e.jsx(F,{value:o.id,children:o.name},o.id))]})]}),e.jsx(C,{variant:"contained",onClick:()=>P(null),children:"Thêm cấp công trình"})]})]}),e.jsx(Ce,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(Te,{columns:c,data:(j==null?void 0:j.data)||[]})}),e.jsx(ji,{open:y,handleClose:q,data:u}),e.jsxs(he,{open:v,onClose:i,children:[e.jsx(ue,{children:"Xác nhận xóa"}),e.jsx(ge,{children:e.jsx(L,{children:"Bạn có chắc chắn muốn xóa cấp công trình này?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:i,disabled:r.isPending,children:"Hủy"}),e.jsx(C,{onClick:h,disabled:r.isPending,color:"error",variant:"contained",children:r.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const wi=Ne({name:_().min(2,"Tên loại công trình phải có ít nhất 2 ký tự")});function bi({open:n,handleClose:t,data:s}){const a=fe(),{control:g,handleSubmit:j,setValue:f,reset:T,formState:{errors:m}}=Se({resolver:qe(wi),defaultValues:{name:""}});l.useEffect(()=>{s?f("name",s.name):T()},[s,f,T]);const w=xe({mutationFn:async y=>s!=null&&s.id?ur(s.id,y):hr(y),onSuccess:()=>{a.invalidateQueries({queryKey:["workTypes"]}),A.success(s!=null&&s.id?"Loại công trình đã được cập nhật":"Loại công trình đã được thêm"),t()},onError:y=>{console.error("API Error:",y),A.error("Đã xảy ra lỗi: "+y.message)}}),d=async y=>{await w.mutateAsync(y)};return e.jsxs(he,{open:n,onClose:t,maxWidth:"sm",fullWidth:!0,children:[e.jsx(ue,{children:s?"Cập nhật loại công trình":"Thêm loại công trình"}),e.jsx(ge,{children:e.jsxs(U,{container:!0,spacing:2,sx:{mt:1},children:[e.jsx(U,{item:!0,xs:12,children:e.jsx(Z,{name:"name",control:g,render:({field:y})=>{var b;return e.jsx(B,{...y,label:"Tên loại công trình",error:!!m.name,helperText:(b=m.name)==null?void 0:b.message,fullWidth:!0,disabled:w.isPending})}})}),s&&e.jsxs(U,{item:!0,xs:12,children:[e.jsx(L,{fontSize:12,fontStyle:"italic",sx:{fontWeight:"300"},children:"- Chỉnh sửa tên loại công trình chỉ ảnh hưởng đến tên hiển thị"}),e.jsx(L,{fontSize:12,fontStyle:"italic",sx:{fontWeight:"300"},children:"- Các cấp công trình, mục đích, và vai trò tác giả thuộc loại này không bị ảnh hưởng"})]})]})}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,disabled:w.isPending,children:"Hủy"}),e.jsx(C,{onClick:j(d),variant:"contained",color:"primary",disabled:w.isPending,children:w.isPending?e.jsx(J,{size:24}):s?"Cập nhật":"Thêm mới"})]})]})}function Ci(){const n=fe(),{data:t,error:s,isPending:a,isSuccess:g,dataUpdatedAt:j}=ne({queryKey:["workTypes","details"],queryFn:async()=>{const c=await dr();return c!=null&&c.data&&(console.log("WorkTypes with details:",c.data),c.data.forEach(S=>{console.log("WorkType ".concat(S.name," has ").concat(S.scImagoFieldCount," Scimago fields:"),S.scImagoFields)})),c}});l.useEffect(()=>{g&&(t!=null&&t.message)&&A.success(t.message)},[j,g,t]),l.useEffect(()=>{s&&A.error("Có lỗi đã xảy ra: "+s.message)},[s]);const[f,T]=l.useState(!1),[m,w]=l.useState(null),d=c=>{w(c),T(!0)},y=()=>T(!1),b=c=>{d(c)},[u,k]=l.useState(!1),[P,q]=l.useState(null),H=c=>{q(c),k(!0)},v=()=>{q(null),k(!1)},x=xe({mutationFn:c=>gr(c),onSuccess:()=>{A.success("Xóa loại công trình thành công!"),n.invalidateQueries({queryKey:["workTypes"]}),k(!1)},onError:c=>{A.error("Lỗi khi xóa: "+c.message)}}),W=()=>{P&&x.mutate(P)},I=(c,S)=>"".concat(c," ").concat(S),p=c=>!c||c.length===0?"Không có cấp công trình nào":c.map(S=>S.name).join("; "),i=c=>!c||c.length===0?"Không có mục đích quy đổi nào":c.map(S=>S.name).join("; "),r=c=>!c||c.length===0?"Không có vai trò tác giả nào":c.map(S=>S.name).join("; "),h=[{field:"stt",headerName:"STT",width:70,renderCell:c=>{const S=Array.from(c.api.getAllRowIds()).findIndex(o=>o===c.row.id);return e.jsx("div",{children:S+1})}},{field:"name",headerName:"Tên loại công trình",type:"string",width:200},{field:"workLevelCount",headerName:"Cấp công trình",width:130,renderCell:c=>{const S=c.row.workLevelCount||0;return e.jsx(Re,{title:p(c.row.workLevels),arrow:!0,children:e.jsx("span",{children:I(S,"cấp")})})}},{field:"purposeCount",headerName:"Mục đích quy đổi",width:150,renderCell:c=>{const S=c.row.purposeCount||0;return e.jsx(Re,{title:i(c.row.purposes),arrow:!0,children:e.jsx("span",{children:I(S,"mục đích")})})}},{field:"authorRoleCount",headerName:"Vai trò tác giả",width:140,renderCell:c=>{const S=c.row.authorRoleCount||0;return e.jsx(Re,{title:r(c.row.authorRoles),arrow:!0,children:e.jsx("span",{children:I(S,"vai trò")})})}},{field:"factorCount",headerName:"Hệ số quy đổi",width:140,renderCell:c=>{const S=c.row.factorCount||0;return e.jsx("span",{children:I(S,"hệ số")})}},{field:"scImagoFieldCount",headerName:"Ngành SCImago",width:140,renderCell:c=>{const S=c.row.scImagoFieldCount||0;return e.jsx("span",{children:I(S,"ngành")})}},{field:"actions",headerName:"Thao tác",width:200,renderCell:c=>e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>b(c.row),sx:{marginRight:1},disabled:x.isPending,children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>H(c.row.id),disabled:x.isPending,children:"Xóa"})]})}];return a?e.jsx(J,{}):s?e.jsxs("p",{children:["Error: ",s.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",alignItems:"center",sx:{marginBottom:2},children:[e.jsx(L,{variant:"h4",children:"Quản lý loại công trình"}),e.jsx(C,{variant:"contained",onClick:()=>d(null),children:"Thêm loại công trình"})]}),e.jsx(Ce,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(Te,{columns:h,data:(t==null?void 0:t.data)||[]})}),e.jsx(bi,{open:f,handleClose:y,data:m}),e.jsxs(he,{open:u,onClose:v,children:[e.jsx(ue,{children:"Xác nhận xóa"}),e.jsx(ge,{children:e.jsx(L,{children:"Bạn có chắc chắn muốn xóa loại công trình này?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:v,disabled:x.isPending,children:"Hủy"}),e.jsx(C,{onClick:W,color:"error",variant:"contained",disabled:x.isPending,children:x.isPending?e.jsx(J,{size:24}):"Xóa"})]})]})]})}const ki=async()=>(await K.get("/assignments")).data,vi=async n=>(await K.get("/assignments/user/".concat(n))).data,Ii=async n=>(await K.post("/assignments",n)).data,Ti=async n=>(await K.put("/assignments",n)).data,Si=async n=>(await K.delete("/assignments/user/".concat(n))).data;function Ni({open:n,handleClose:t,manager:s,onSuccess:a}){const{control:g,handleSubmit:j,reset:f}=Se({defaultValues:{assignments:[]}}),{fields:T,append:m,remove:w}=ts({control:g,name:"assignments"}),[d,y]=l.useState([]),[b,u]=l.useState(!1),[k,P]=l.useState(!1);l.useEffect(()=>{if(n){u(!0);async function H(){try{const v=await Ge();y(v.data||[])}catch(v){A.error("Lỗi khi tải đơn vị: "+v.message)}try{const v=await vi(s.managerId);if(!v||!v.data||Array.isArray(v.data)&&v.data.length===0)f({assignments:[]}),P(!0);else{const x=v.data.map(W=>({departmentId:W.departmentId}));f({assignments:x}),P(!1)}}catch(v){f({assignments:[]}),P(!0)}u(!1)}H()}},[n,s.managerId,f]);const q=async H=>{const v=H.assignments.map(x=>x.departmentId).filter(Boolean);if(v.length===0){A.error("Vui lòng chọn ít nhất 1 đơn vị");return}try{k?(await Ii({managerId:s.managerId,departmentIds:v}),A.success("Phân công thành công")):(await Ti({managerId:s.managerId,departmentIds:v}),A.success("Cập nhật phân công thành công")),a(),t()}catch(x){A.error("Lỗi khi lưu phân công: "+x.message)}};return e.jsxs(he,{open:n,onClose:t,fullWidth:!0,children:[e.jsx(ue,{children:"Phân công cho quản lý"}),e.jsx(ge,{children:b?e.jsx(z,{sx:{display:"flex",justifyContent:"center",my:4},children:e.jsx(J,{})}):e.jsxs(e.Fragment,{children:[e.jsx(B,{label:"Họ và tên",value:s.managerFullName,fullWidth:!0,margin:"dense",disabled:!0}),e.jsx(B,{label:"Đơn vị công tác",value:s.managerDepartmentName,fullWidth:!0,margin:"dense",disabled:!0}),T.map((H,v)=>e.jsxs(z,{sx:{display:"flex",alignItems:"center",mt:2},children:[e.jsx(Z,{control:g,name:"assignments.".concat(v,".departmentId"),defaultValue:H.departmentId,render:({field:x})=>e.jsxs(B,{select:!0,label:"Chọn đơn vị",value:x.value,onChange:x.onChange,fullWidth:!0,margin:"dense",children:[e.jsx(F,{value:"",children:"-- Chọn đơn vị --"}),d.map(W=>e.jsx(F,{value:W.id,children:W.name},W.id))]})}),e.jsx(en,{onClick:()=>w(v),sx:{ml:1},"aria-label":"delete",children:e.jsx(ss,{})})]},H.id)),e.jsx(C,{onClick:()=>m({departmentId:""}),sx:{mt:2},variant:"outlined",disabled:b,children:"Thêm đơn vị"})]})}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,children:"Hủy"}),e.jsx(C,{onClick:j(q),variant:"contained",children:"Lưu"})]})]})}function qi(){const n=fe(),{data:t,error:s,isPending:a,isSuccess:g,dataUpdatedAt:j,refetch:f}=ne({queryKey:["assignments"],queryFn:ki});l.useEffect(()=>{g&&t&&A.success(t.message||"Lấy dữ liệu phân công thành công",{toastId:"fetch-assignments-success"})},[j,g,t]),l.useEffect(()=>{s&&A.error("Có lỗi xảy ra: "+s.message)},[s]);const T=t!=null&&t.data?Li(t.data):[],[m,w]=l.useState(!1),[d,y]=l.useState(null),[b,u]=l.useState(!1),[k,P]=l.useState(null),q=i=>{y(i),w(!0)},H=()=>{w(!1),y(null)},v=xe({mutationFn:i=>Si(i),onSuccess:()=>{A.success("Đã bỏ phân công thành công"),n.invalidateQueries({queryKey:["assignments"]}),f()},onError:i=>{A.error("Có lỗi xảy ra khi bỏ phân công: "+i.message)}}),x=i=>{P(i),u(!0)},W=()=>{k&&(v.mutate(k),u(!1))},I=[{field:"managerFullName",headerName:"Họ và tên quản lý",width:200},{field:"managerDepartmentName",headerName:"Đơn vị công tác",width:200},{field:"assignedCount",headerName:"Số phân công",width:150},{field:"actions",headerName:"",width:300,renderCell:i=>e.jsxs(z,{children:[e.jsx(C,{variant:"contained",size:"small",onClick:()=>q(i.row),children:"Phân công"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>x(i.row.managerId),disabled:i.row.assignedCount===0,sx:{ml:1},children:"Bỏ phân công"})]})}];if(a)return e.jsx(J,{});if(s)return e.jsxs(L,{variant:"body1",children:["Error: ",s.message]});const p=T.map(i=>({id:i.managerId,...i}));return e.jsxs(e.Fragment,{children:[e.jsx(Ce,{sx:{width:"100%",marginX:"auto",padding:2},children:e.jsx(Te,{columns:I,data:p})}),d&&e.jsx(Ni,{open:m,handleClose:H,manager:d,onSuccess:()=>{n.invalidateQueries({queryKey:["assignments"]}),f()}}),e.jsxs(he,{open:b,onClose:()=>u(!1),children:[e.jsx(ue,{children:"Xác nhận bỏ phân công"}),e.jsx(ge,{children:e.jsxs(L,{children:["Bạn có chắc chắn muốn bỏ ",e.jsx("strong",{children:"tất cả"})," phân công cho quản lý này?"]})}),e.jsxs(me,{children:[e.jsx(C,{onClick:()=>u(!1),children:"Hủy"}),e.jsx(C,{onClick:W,color:"error",variant:"contained",children:v.isPending?"Đang xóa...":"Xóa"})]})]})]})}function Li(n){const t=new Map;return n.forEach(s=>{const{managerId:a,managerFullName:g,managerDepartmentName:j,departmentId:f,assignedDepartmentName:T}=s;t.has(a)||t.set(a,{managerId:a,managerFullName:g,managerDepartmentName:j,assignedDepartments:[],assignedCount:0}),f!=="00000000-0000-0000-0000-000000000000"&&T!=="Chưa phân công"&&t.get(a).assignedDepartments.push({departmentId:f,assignedDepartmentName:T})}),Array.from(t.values()).map(s=>({...s,assignedCount:s.assignedDepartments.length}))}const Pi=Ne({name:_().min(2,"Tên năm học phải có ít nhất 2 ký tự"),startDate:_(),endDate:_()}).refine(n=>new Date(n.endDate)>new Date(n.startDate),{message:"Ngày kết thúc phải sau ngày bắt đầu",path:["endDate"]});function Ai({open:n,handleClose:t,data:s}){var b,u,k;const a=fe(),{register:g,handleSubmit:j,setValue:f,reset:T,formState:{errors:m,isSubmitting:w}}=Se({resolver:qe(Pi),defaultValues:{name:"",startDate:"",endDate:""}});l.useEffect(()=>{s?(f("name",s.name),f("startDate",new Date(s.startDate).toISOString().split("T")[0]),f("endDate",new Date(s.endDate).toISOString().split("T")[0])):T()},[s,n,f,T]);const d=xe({mutationFn:async P=>s!=null&&s.id?si(s.id,P):ti(P),onSuccess:()=>{a.invalidateQueries({queryKey:["academic-years"]}),A.success(s!=null&&s.id?"Cập nhật thành công":"Thêm mới thành công"),t()},onError:P=>{A.error("Lỗi khi lưu: "+P.message)}}),y=async P=>{await d.mutateAsync({name:P.name,startDate:P.startDate,endDate:P.endDate})};return e.jsxs(he,{open:n,onClose:t,children:[e.jsx(ue,{children:s?"Cập nhật Năm Học":"Thêm Năm Học"}),e.jsxs(ge,{children:[e.jsx(B,{label:"Tên năm học",...g("name"),error:!!m.name,helperText:(b=m.name)==null?void 0:b.message,fullWidth:!0,margin:"dense"}),e.jsx(B,{label:"Ngày bắt đầu",type:"date",...g("startDate"),fullWidth:!0,margin:"dense",InputLabelProps:{shrink:!0},error:!!m.startDate,helperText:(u=m.startDate)==null?void 0:u.message}),e.jsx(B,{label:"Ngày kết thúc",type:"date",...g("endDate"),fullWidth:!0,margin:"dense",InputLabelProps:{shrink:!0},error:!!m.endDate,helperText:(k=m.endDate)==null?void 0:k.message})]}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,disabled:w,children:"Hủy"}),e.jsx(C,{onClick:j(y),variant:"contained",disabled:w,children:w?"Đang lưu...":"Lưu"})]})]})}function Wi(){const n=fe(),{data:t,error:s,isPending:a,isSuccess:g,dataUpdatedAt:j,refetch:f}=ne({queryKey:["academic-years"],queryFn:ln});l.useEffect(()=>{g&&t&&A.success(t.message,{toastId:"fetch-academic-years-success"})},[j]),l.useEffect(()=>{s&&A.error("Có lỗi xảy ra: "+s.message)},[s]);const[T,m]=l.useState(!1),[w,d]=l.useState(null),y=p=>{d(p),m(!0)},b=()=>{m(!1),f()},[u,k]=l.useState(!1),[P,q]=l.useState(null),H=p=>{q(p),k(!0)},v=()=>{q(null),k(!1)},x=xe({mutationFn:p=>ri(p),onSuccess:()=>{A.success("Xóa năm học thành công!"),n.invalidateQueries({queryKey:["academic-years"]}),k(!1),f()},onError:p=>{A.error("Lỗi khi xóa: "+p.message)}}),W=()=>{P&&x.mutate(P)},I=[{field:"name",headerName:"Tên năm học",width:200},{field:"startDate",headerName:"Bắt đầu",valueFormatter:p=>new Date(p).toLocaleDateString(),width:150},{field:"endDate",headerName:"Kết thúc",valueFormatter:p=>new Date(p).toLocaleDateString(),width:150},{field:"actions",headerName:"Hành động",width:300,renderCell:p=>e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>y(p.row),sx:{marginRight:1},children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>H(p.row.id),children:"Xóa"})]})}];return a?e.jsx(J,{}):s?e.jsxs("p",{children:["Error: ",s.message]}):e.jsxs(e.Fragment,{children:[e.jsx(z,{display:"flex",justifyContent:"flex-end",mb:2,children:e.jsx(C,{variant:"contained",onClick:()=>y(null),children:"Thêm năm học"})}),e.jsx(Ce,{sx:{width:1010,marginX:"auto"},children:e.jsx(Te,{columns:I,data:((t==null?void 0:t.data)||[]).slice().sort((p,i)=>i.name.localeCompare(p.name))})}),e.jsx(Ai,{open:T,handleClose:b,data:w}),e.jsxs(he,{open:u,onClose:v,children:[e.jsx(ue,{children:"Xác nhận xóa"}),e.jsx(ge,{children:e.jsx(L,{children:"Bạn có chắc chắn muốn xóa năm học này?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:v,children:"Hủy"}),e.jsx(C,{onClick:W,color:"error",variant:"contained",children:x.isPending?"Đang xóa...":"Xóa"})]})]})]})}const Di=n=>{const t=He.now().setZone("Asia/Saigon"),s=He.fromISO(n.openTime,{zone:"utc"}).setZone("Asia/Saigon"),a=He.fromISO(n.closeTime,{zone:"utc"}).setZone("Asia/Saigon");return t>=s&&t<=a},Ri=Qe.object({name:Qe.string().min(2,"Tên cấu hình là bắt buộc"),openTime:Qe.string().min(1,"Thời gian mở là bắt buộc"),openDate:Qe.string().min(1,"Ngày mở là bắt buộc"),closeTime:Qe.string().min(1,"Thời gian đóng là bắt buộc"),closeDate:Qe.string().min(1,"Ngày đóng là bắt buộc"),academicYearId:Qe.string()}).refine(n=>{const t=new Date("".concat(n.openDate,"T").concat(n.openTime));return new Date("".concat(n.closeDate,"T").concat(n.closeTime))>t},{message:"Thời gian kết thúc phải sau Thời gian bắt đầu",path:["closeDate"]});function Fi({open:n,handleClose:t,data:s}){var H;const a=fe(),{data:g,isLoading:j}=ne({queryKey:["academic-years"],queryFn:ln}),{register:f,handleSubmit:T,setValue:m,reset:w,control:d,formState:{errors:y,isSubmitting:b}}=Se({resolver:qe(Ri),defaultValues:{name:"",openTime:"",closeTime:"",academicYearId:""}}),[u,k]=l.useState(null);l.useEffect(()=>{(async()=>{const x=await cn();x&&x.data&&(k(x.data),m("academicYearId",x.data.id))})()},[m]),l.useEffect(()=>{var v;if(s){const x=He.fromISO(s.openTime),W=He.fromISO(s.closeTime);m("name",s.name),m("openDate",x.toFormat("yyyy-LL-dd")),m("openTime",x.toFormat("HH:mm")),m("closeDate",W.toFormat("yyyy-LL-dd")),m("closeTime",W.toFormat("HH:mm")),m("academicYearId",(v=u==null?void 0:u.id)!=null?v:s.academicYearId)}else w(),u&&m("academicYearId",u.id)},[s,n,m,w,u]);const P=xe({mutationFn:async v=>s!=null&&s.id?Jr(s.id,v):_r(v),onSuccess:()=>{a.invalidateQueries({queryKey:["system-configs"]}),A.success(s!=null&&s.id?"Cập nhật thành công":"Thêm mới thành công"),t()},onError:v=>{A.error("Lỗi khi lưu: "+v.message)}}),q=async v=>{const x=u==null?void 0:u.id;if(!x){A.error("Không tìm thấy năm học hiện tại, vui lòng thử lại sau.");return}await P.mutateAsync({name:v.name,openTime:Qn(v.openDate,v.openTime),closeTime:Qn(v.closeDate,v.closeTime),academicYearId:x})};return e.jsxs(he,{open:n,onClose:t,children:[e.jsx(ue,{children:s?"Cập nhật Cấu hình":"Thêm Cấu hình"}),e.jsxs(ge,{children:[e.jsx(B,{label:"Tên Cấu hình",...f("name"),error:!!y.name,helperText:(H=y.name)==null?void 0:H.message,fullWidth:!0,margin:"dense"}),e.jsx(Ke,{sx:{marginY:2}}),e.jsxs(z,{display:"flex",gap:2,alignItems:"center",marginBottom:2,children:[e.jsx(L,{minWidth:120,children:"Thời gian mở"}),e.jsx(Z,{control:d,name:"openTime",render:({field:v})=>{var x;return e.jsx(B,{...v,type:"time",error:!!y.openTime,helperText:(x=y.openTime)==null?void 0:x.message,fullWidth:!0,margin:"dense"})}}),e.jsx(Z,{control:d,name:"openDate",render:({field:v})=>{var x;return e.jsx(B,{...v,type:"date",error:!!y.openDate,helperText:(x=y.openDate)==null?void 0:x.message,fullWidth:!0,margin:"dense"})}})]}),e.jsxs(z,{display:"flex",gap:2,alignItems:"center",marginBottom:2,children:[e.jsx(L,{minWidth:120,children:"Thời gian đóng"}),e.jsx(Z,{control:d,name:"closeTime",render:({field:v})=>{var x;return e.jsx(B,{...v,type:"time",error:!!y.closeTime,helperText:(x=y.closeTime)==null?void 0:x.message,fullWidth:!0,margin:"dense"})}}),e.jsx(Z,{control:d,name:"closeDate",render:({field:v})=>{var x;return e.jsx(B,{...v,type:"date",error:!!y.closeDate,helperText:(x=y.closeDate)==null?void 0:x.message,fullWidth:!0,margin:"dense"})}})]}),e.jsx(Ke,{sx:{marginY:2}}),e.jsx(Z,{control:d,name:"academicYearId",render:({field:v})=>{var x,W;return e.jsx(B,{...v,select:!0,label:"Năm học",error:!!y.academicYearId,helperText:(x=y.academicYearId)==null?void 0:x.message,fullWidth:!0,disabled:!0,children:j?e.jsx(F,{disabled:!0,children:"Đang tải..."}):(W=g==null?void 0:g.data)==null?void 0:W.map(I=>e.jsx(F,{value:I.id,children:I.name},I.id))})}})]}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,disabled:b,children:"Hủy"}),e.jsx(C,{onClick:T(q),variant:"contained",disabled:b,children:b?"Đang lưu...":"Lưu"})]})]})}const Qn=(n,t)=>He.fromFormat("".concat(n," ").concat(t),"yyyy-LL-dd HH:mm").toISO();function Hi(){const n=fe(),[t,s]=l.useState(null);l.useEffect(()=>{(async()=>{const O=await cn();O&&O.data&&s(O.data)})()},[]);const{data:a,error:g,isPending:j,isSuccess:f,dataUpdatedAt:T,refetch:m}=ne({queryKey:["system-configs"],queryFn:()=>Yr((t==null?void 0:t.id)||""),enabled:!!(t!=null&&t.id)});l.useEffect(()=>{f&&a&&A.success(a.message,{toastId:"fetch-system-configs-success"})},[T]),l.useEffect(()=>{g&&A.error("Có lỗi xảy ra: "+g.message)},[g]);const w=l.useMemo(()=>!a||!a.data?!1:a.data.some(N=>Di(N)),[a]),[d,y]=l.useState(!1),[b,u]=l.useState(null),k=N=>{u(N),y(!0)},P=()=>{y(!1),m()},[q,H]=l.useState(!1),[v,x]=l.useState(null),W=N=>{x(N),H(!0)},I=()=>{x(null),H(!1)},p=xe({mutationFn:N=>ei(N),onSuccess:()=>{A.success("Xóa cấu hình thành công!"),n.invalidateQueries({queryKey:["system-configs"]}),m(),H(!1)},onError:N=>{A.error("Lỗi khi xóa: "+N.message)}}),i=()=>{v&&p.mutate(v)},[r,h]=l.useState(!1),[c,S]=l.useState(null),o=N=>{S(N),h(!0)},D=()=>{h(!1),S(null)},V=xe({mutationFn:()=>Zr(c,c==null?void 0:c.id),onSuccess:()=>{A.success("Đã tạo thông báo thành công."),h(!1),S(null),n.invalidateQueries({queryKey:["system-configs"]}),m()},onError:N=>{A.error("Lỗi khi tạo thông báo: "+N.message)}}),je=[{field:"name",headerName:"Tên cấu hình",width:200},{field:"academicYearName",headerName:"Năm học",width:200},{field:"openTime",headerName:"Thời gian mở",width:200,valueFormatter:N=>wn(N)},{field:"closeTime",headerName:"Thời gian đóng",width:200,valueFormatter:N=>wn(N)},{field:"isNotified",headerName:"Đã thông báo",type:"boolean",width:120},{field:"actions",headerName:"Hành động",width:400,renderCell:N=>{const O=N.row.isNotified;return e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>k(N.row),sx:{marginRight:1},disabled:O,children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>W(N.row.id),sx:{marginRight:1},disabled:O,children:"Xóa"}),e.jsx(C,{variant:"contained",color:"secondary",size:"small",onClick:()=>o(N.row),disabled:O,children:"Thông báo"})]})}}];return j?e.jsx(J,{}):g?e.jsxs("p",{children:["Error: ",g.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsxs(L,{variant:"body1",children:["Năm học hiện tại:"," ",e.jsx(L,{component:"span",variant:"body1",sx:{fontWeight:"bold"},color:"primary",children:t==null?void 0:t.name})]}),e.jsx(C,{variant:"contained",onClick:()=>k(null),children:"Thêm cấu hình"})]}),e.jsx(Ce,{sx:{width:1010,marginX:"auto"},children:e.jsx(Te,{columns:je,data:(a==null?void 0:a.data)||[]})}),w!==void 0&&e.jsx(z,{my:4,children:e.jsxs(L,{fontSize:24,variant:"body1",children:["Trạng thái hệ thống:"," ",e.jsx(L,{fontSize:24,component:"span",fontWeight:500,color:w?"primary":"red",children:w?"Đang mở":"Đang đóng"})]})}),e.jsx(Fi,{open:d,handleClose:P,data:b}),e.jsxs(he,{open:q,onClose:I,children:[e.jsx(ue,{children:"Xác nhận xóa"}),e.jsx(ge,{children:e.jsx(L,{children:"Bạn có chắc chắn muốn xóa cấu hình này?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:I,children:"Hủy"}),e.jsx(C,{onClick:i,color:"error",variant:"contained",children:p.isPending?"Đang xóa...":"Xóa"})]})]}),e.jsxs(he,{open:r,onClose:D,children:[e.jsx(ue,{children:"Xác nhận gửi thông báo"}),e.jsx(ge,{children:e.jsx(L,{children:"Sau khi thông báo, cấu hình này sẽ không thể chỉnh sửa hoặc xóa. Bạn có chắc chắn muốn tiếp tục?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:D,children:"Hủy"}),e.jsx(C,{onClick:()=>{c&&V.mutate()},variant:"contained",color:"secondary",children:V.isPending?"Đang gửi...":"Thông báo"})]})]})]})}const Ki={User:"Người dùng",Manager:"Quản lý",Admin:"Admin"},wt=n=>Ki[n]||"-";var bt=(n=>(n[n.User=1]="User",n[n.Manager=2]="Manager",n[n.Admin=3]="Admin",n))(bt||{});const Mi=Ne({userName:_().nonempty("Mã số viên chức không được để trống"),email:_().email("Email không hợp lệ"),phoneNumber:_().nonempty("Số điện thoại không được để trống"),fullName:_().nonempty("Họ và tên không được để trống"),academicTitle:_().nonempty("Học hàm không được để trống"),officerRank:_().nonempty("Ngạch công chức không được để trống"),departmentId:_().optional(),fieldId:_().optional(),specialization:_().optional(),role:_().nonempty("Quyền hạn không được để trống"),isApproved:tt()});function Ei({open:n,handleClose:t,data:s}){var H,v,x,W,I,p;const a=fe(),[g,j]=l.useState([]),[f,T]=l.useState([]);l.useEffect(()=>{async function i(){const r=await Ge();j(r.data||[]);const h=await rn();T(h.data||[])}i()},[]);const{register:m,handleSubmit:w,setValue:d,reset:y,control:b,formState:{errors:u,isSubmitting:k}}=Se({resolver:qe(Mi),defaultValues:{userName:"",email:"",phoneNumber:"",fullName:"",academicTitle:"",officerRank:"",departmentId:"",fieldId:"",specialization:"",role:"",isApproved:!1}});l.useEffect(()=>{var i,r,h,c,S,o;s?(d("userName",s.userName||""),d("email",s.email||""),d("phoneNumber",s.phoneNumber||""),d("fullName",s.fullName||""),d("academicTitle",(i=s.academicTitle)!=null?i:""),d("officerRank",(r=s.officerRank)!=null?r:""),d("departmentId",(h=s.departmentId)!=null?h:""),d("fieldId",(c=s.fieldId)!=null?c:""),d("specialization",s.specialization||""),d("role",(S=s.role)!=null?S:""),d("isApproved",(o=s.isApproved)!=null?o:!1)):y()},[s,n,d,y]);const P=xe({mutationFn:async i=>{if(s!=null&&s.id)return Cs(s.id,i)},onSuccess:()=>{a.invalidateQueries({queryKey:["users"]}),A.success("Người dùng đã được cập nhật"),t()},onError:i=>{console.error("API Error:",i),A.error("Lỗi khi cập nhật người dùng: "+i.message)}}),q=async i=>{await P.mutateAsync(i)};return e.jsxs(he,{open:n,onClose:t,fullWidth:!0,children:[e.jsx(ue,{children:"Cập nhật Người Dùng"}),e.jsxs(ge,{children:[e.jsx(B,{label:"Mã số viên chức",...m("userName"),error:!!u.userName,helperText:(H=u.userName)==null?void 0:H.message,fullWidth:!0,margin:"dense",disabled:!0}),e.jsx(B,{label:"Email",...m("email"),error:!!u.email,helperText:(v=u.email)==null?void 0:v.message,fullWidth:!0,margin:"dense",disabled:k}),e.jsx(B,{label:"Số điện thoại",...m("phoneNumber"),error:!!u.phoneNumber,helperText:(x=u.phoneNumber)==null?void 0:x.message,fullWidth:!0,margin:"dense",disabled:k}),e.jsx(B,{label:"Họ và tên",...m("fullName"),error:!!u.fullName,helperText:(W=u.fullName)==null?void 0:W.message,fullWidth:!0,margin:"dense",disabled:k}),e.jsx(Z,{name:"academicTitle",control:b,defaultValue:(I=s==null?void 0:s.academicTitle)!=null?I:"",render:({field:i})=>{var r;return e.jsx(B,{select:!0,label:"Học hàm",...i,error:!!u.academicTitle,helperText:(r=u.academicTitle)==null?void 0:r.message,fullWidth:!0,margin:"dense",disabled:k,children:Object.entries(mn).filter(([h])=>isNaN(Number(h))).map(([h])=>e.jsx(F,{value:h,children:tn(h)},h))})}}),e.jsx(Z,{name:"officerRank",control:b,render:({field:i})=>{var r;return e.jsx(B,{select:!0,label:"Ngạch công chức",...i,error:!!u.officerRank,helperText:(r=u.officerRank)==null?void 0:r.message,fullWidth:!0,margin:"dense",disabled:k,children:Object.entries(pn).filter(([h])=>isNaN(Number(h))).map(([h])=>e.jsx(F,{value:h,children:sn(h)},h))})}}),e.jsx(Z,{name:"departmentId",control:b,render:({field:i})=>{var r;return e.jsxs(B,{select:!0,label:"Đơn vị công tác",...i,error:!!u.departmentId,helperText:(r=u.departmentId)==null?void 0:r.message,fullWidth:!0,margin:"dense",disabled:k,children:[e.jsx(F,{value:"",children:"-- Chọn đơn vị --"}),g.map(h=>e.jsx(F,{value:h.id,children:h.name},h.id))]})}}),e.jsx(Z,{name:"fieldId",control:b,render:({field:i})=>{var r;return e.jsxs(B,{select:!0,label:"Ngành",...i,error:!!u.fieldId,helperText:(r=u.fieldId)==null?void 0:r.message,fullWidth:!0,margin:"dense",disabled:k,children:[e.jsx(F,{value:"",children:"-- Chọn ngành --"}),f.map(h=>e.jsx(F,{value:h.id,children:h.name},h.id))]})}}),e.jsx(B,{label:"Chuyên ngành",...m("specialization"),error:!!u.specialization,helperText:(p=u.specialization)==null?void 0:p.message,fullWidth:!0,margin:"dense",disabled:k}),e.jsx(Z,{name:"role",control:b,render:({field:i})=>{var r;return e.jsx(B,{select:!0,label:"Quyền hạn",...i,error:!!u.role,helperText:(r=u.role)==null?void 0:r.message,fullWidth:!0,margin:"dense",disabled:k,children:Object.entries(bt).filter(([h])=>isNaN(Number(h))).map(([h])=>e.jsx(F,{value:h,children:wt(h)},h))})}}),e.jsx(Z,{name:"isApproved",control:b,render:({field:i})=>e.jsx(Ve,{control:e.jsx(Oe,{...i,checked:i.value,onChange:r=>i.onChange(r.target.checked),color:"primary",disabled:k}),label:"Cho phép truy cập hệ thống"})})]}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,disabled:k,children:"Hủy"}),e.jsx(C,{onClick:w(q),variant:"contained",color:"primary",disabled:k,children:k?"Đang lưu...":"Lưu"})]})]})}function Bi(){const n=fe(),t=l.useRef(null),{data:s,error:a,isPending:g,isSuccess:j,dataUpdatedAt:f,refetch:T}=ne({queryKey:["users"],queryFn:ws});l.useEffect(()=>{j&&s&&A.success(s.message,{toastId:"fetch-users-success"})},[f]),l.useEffect(()=>{a&&A.error("Có lỗi đã xảy ra: "+a.message)},[a]);const[m,w]=l.useState(!1),[d,y]=l.useState(null),b=h=>{y(h),w(!0)},u=()=>{w(!1),T()},[k,P]=l.useState(!1),[q,H]=l.useState(null),v=h=>{H(h),P(!0)},x=()=>{H(null),P(!1)},W=xe({mutationFn:h=>ks(h),onSuccess:()=>{A.success("Xóa người dùng thành công!"),n.invalidateQueries({queryKey:["users"]}),T(),P(!1)},onError:h=>{A.error("Lỗi khi xóa: "+h.message)}}),I=()=>{q&&W.mutate(q)},p=()=>{var h;(h=t.current)==null||h.click()},i=async h=>{if(h.target.files&&h.target.files.length>0){const c=h.target.files[0];try{const S=await Is(c);A.success(S.message),n.invalidateQueries({queryKey:["users"]}),T()}catch(S){A.error("Lỗi khi nhập file: "+S.message)}}},r=[{field:"userName",headerName:"Mã số viên chức",type:"string",width:150},{field:"fullName",headerName:"Họ và tên",type:"string",width:200},{field:"email",headerName:"Email",type:"string",width:200},{field:"departmentName",headerName:"Đơn vị công tác",type:"string",width:180},{field:"fieldName",headerName:"Ngành",type:"string",width:180},{field:"phoneNumber",headerName:"Số điện thoại",type:"string",width:150},{field:"academicTitle",headerName:"Học hàm",type:"string",width:180,valueFormatter:h=>tn(h)},{field:"officerRank",headerName:"Ngạch công chức",type:"string",width:180,valueFormatter:h=>sn(h)},{field:"role",headerName:"Quyền hạn",type:"string",width:150,valueFormatter:h=>wt(h)},{field:"isApproved",headerName:"Đã duyệt",type:"boolean",width:120},{field:"actions",headerName:"",width:300,renderCell:h=>e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>b(h.row),sx:{marginRight:1},disabled:W.isPending,children:"Sửa"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>v(h.row.id),disabled:W.isPending,children:"Xóa"})]})}];return g?e.jsx(J,{}):a?e.jsxs("p",{children:["Error: ",a.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{sx:{marginBottom:2,display:"flex",justifyContent:"flex-end"},children:[e.jsx(C,{variant:"contained",color:"primary",onClick:p,children:"Nhập người dùng từ Excel"}),e.jsx("input",{type:"file",accept:".xls,.xlsx",style:{display:"none"},ref:t,onChange:i})]}),e.jsx(Ce,{sx:{width:"100%",marginX:"auto",padding:2},children:e.jsx(Te,{columns:r,data:(s==null?void 0:s.data)||[]})}),e.jsx(Ei,{open:m,handleClose:u,data:d}),e.jsxs(he,{open:k,onClose:x,children:[e.jsx(ue,{children:"Xác nhận xóa"}),e.jsx(ge,{children:e.jsx(L,{children:"Bạn có chắc chắn muốn xóa người dùng này?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:x,disabled:W.isPending,children:"Hủy"}),e.jsx(C,{onClick:I,color:"error",variant:"contained",disabled:W.isPending,children:W.isPending?"Đang xóa...":"Xóa"})]})]})]})}const Ui=()=>{const n=localStorage.getItem("token"),t=localStorage.getItem("expiration");return!n||!t?!1:new Date(t).getTime()>Date.now()};function ke({allowedRoles:n,children:t}){const{user:s,loading:a}=Fe();if(!a)return!Ui()||!s?e.jsx(Gn,{to:"/dang-nhap",replace:!0}):n&&!n.includes(s==null?void 0:s.role)?e.jsx(Gn,{to:"/unauthorized",replace:!0}):t?e.jsx(e.Fragment,{children:t}):e.jsx(kn,{})}const zi=()=>{const n=$e(),t=()=>{n("/")};return e.jsxs(Be,{maxWidth:"md",sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",textAlign:"center"},children:[e.jsx(L,{variant:"h1",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"404"}),e.jsx(L,{variant:"h5",gutterBottom:!0,children:"Tài nguyên bạn yêu cầu không tồn tại."}),e.jsx(C,{variant:"contained",color:"primary",onClick:t,children:"Trở về trang chủ"})]})},Vi=()=>{const n=$e(),t=()=>{n("/")};return e.jsxs(Be,{maxWidth:"md",sx:{display:"flex",flexDirection:"column",alignItems:"center",justifyContent:"center",height:"100vh",textAlign:"center"},children:[e.jsx(L,{variant:"h1",component:"h1",gutterBottom:!0,sx:{fontWeight:"bold"},children:"401"}),e.jsx(L,{variant:"h5",gutterBottom:!0,children:"Bạn không có quyền truy cập tài nguyên này."}),e.jsx(C,{variant:"contained",color:"primary",onClick:t,children:"Trở về trang chủ"})]})};function Oi(){var i;const n=fe(),[t,s]=l.useState({}),{user:a}=Fe(),[g,j]=l.useState([]),[f,T]=l.useState(new Map),{data:m}=ne({queryKey:["current-academic-year"],queryFn:cn}),{data:w,error:d,isPending:y,refetch:b}=ne({queryKey:["works","registerable-works"],queryFn:async()=>{var c;const r={academicYearId:(c=m==null?void 0:m.data)==null?void 0:c.id,isCurrentUser:!0},h=await on(r);return console.log("Dữ liệu từ API:",h.data),h},enabled:!!((i=m==null?void 0:m.data)!=null&&i.id),staleTime:0});l.useEffect(()=>{w!=null&&w.data&&w.data.length>0&&(async()=>{const h={};for(const c of w.data)if(c.coAuthorUserIds&&c.coAuthorUserIds.length>0){const S=[];for(const o of c.coAuthorUserIds)try{const D=await _e(o);D.success&&D.data&&S.push(D.data)}catch(D){console.error("Lỗi khi lấy thông tin đồng tác giả:",D)}h[c.id]=S}s(h)})()},[w]),l.useEffect(()=>{w!=null&&w.data&&(console.log("Cập nhật localWorks với dữ liệu:",w.data),j(w.data))},[w]);const u=l.useCallback(r=>r?f.has(r.id)?f.get(r.id):(console.log("Kiểm tra trạng thái đăng ký của author:",r),r.authorRegistration!=null):!1,[f]);l.useEffect(()=>{w&&w.message&&A.success(w.message,{toastId:"fetch-works-success"})},[w]),l.useEffect(()=>{d&&A.error("Có lỗi đã xảy ra: "+d.message,{toastId:"fetch-works-error"})},[d]);const[k,P]=l.useState(!1),[q,H]=l.useState(null),v=async r=>{var S;const h=g.find(o=>o.id===r),c=(S=h==null?void 0:h.authors)==null?void 0:S.find(o=>o.userId===(a==null?void 0:a.id));if(!c){A.error("Không tìm thấy thông tin tác giả");return}T(o=>{const D=new Map(o);return D.set(c.id,!1),D});try{await W.mutateAsync({authorId:c.id,registered:!1})}catch(o){}},x=()=>{H(null),P(!1)},W=xe({mutationFn:({authorId:r,registered:h})=>Br(r,h),onSuccess:(r,h)=>{const{authorId:c,registered:S}=h;A.success(S?"Đăng ký công trình thành công!":"Hủy đăng ký công trình thành công!"),j(o=>{const D=o.map(V=>{if(V.authors&&V.authors.length>0){const je=V.authors.findIndex(N=>N.id===c);if(je>=0){const N=[...V.authors];return N[je]={...N[je],registered:S},{...V,authors:N}}}return V});return console.log("Dữ liệu sau khi cập nhật:",D),D}),n.invalidateQueries({queryKey:["works","registerable-works"]}),setTimeout(()=>{b(),T(o=>{const D=new Map(o);return D.delete(c),D})},300)},onError:(r,h)=>{const{authorId:c}=h;T(S=>{const o=new Map(S);return o.delete(c),o}),A.error("Lỗi khi cập nhật trạng thái đăng ký: "+r.message),b()}}),I=async r=>{var c;const h=(c=r.authors)==null?void 0:c.find(S=>S.userId===(a==null?void 0:a.id));if(!h){A.error("Không tìm thấy thông tin tác giả");return}T(S=>{const o=new Map(S);return o.set(h.id,!0),o});try{await W.mutateAsync({authorId:h.id,registered:!0})}catch(S){}},p=[{field:"stt",headerName:"STT",width:70,renderCell:r=>{const c=r.api.getAllRowIds().indexOf(r.id);return e.jsx("div",{children:c+1})}},{field:"title",headerName:"Tên công trình",type:"string",width:150},{field:"timePublished",headerName:"Thời gian xuất bản",type:"string",width:150,renderCell:r=>r.value?e.jsx("div",{children:ft(r.value)}):e.jsx("div",{children:"-"})},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:170},{field:"workLevelName",headerName:"Cấp công trình",type:"string",width:150},{field:"totalAuthors",headerName:"Số tác giả",type:"number",width:140,align:"center",headerAlign:"left"},{field:"coAuthors",headerName:"Đồng tác giả",type:"string",width:140,renderCell:r=>{const h=r.row.id,c=t[h]||[];if(c.length===0)return e.jsx("div",{children:"-"});const S="".concat(c.length," tác giả");return e.jsx(Re,{title:e.jsxs("div",{children:[e.jsx(L,{variant:"subtitle2",children:"Danh sách đồng tác giả:"}),c.map((o,D)=>e.jsxs(L,{variant:"body2",children:["• ",o.fullName," - ",o.userName," - ",o.departmentName||"Chưa có phòng ban"]},D))]}),children:e.jsx("div",{children:S})})}},{field:"authorRoleName",headerName:"Vai trò tác giả",type:"string",width:150,renderCell:r=>{var S;const c=(S=r.row.authors)==null?void 0:S.find(o=>o.userId===(a==null?void 0:a.id));return e.jsx("div",{children:c?c.authorRoleName:"-"})}},{field:"position",headerName:"Vị trí",type:"string",width:80,renderCell:r=>{var S;const c=(S=r.row.authors)==null?void 0:S.find(o=>o.userId===(a==null?void 0:a.id));return e.jsx("div",{children:(c==null?void 0:c.position)!==void 0&&(c==null?void 0:c.position)!==null?c.position:"-"})}},{field:"purposeName",headerName:"Mục đích quy đổi",type:"string",width:180,renderCell:r=>{var S;const c=(S=r.row.authors)==null?void 0:S.find(o=>o.userId===(a==null?void 0:a.id));return e.jsx("div",{children:c?c.purposeName:"-"})}},{field:"scoreLevel",headerName:"Mức điểm",type:"string",width:150,renderCell:r=>{var S;const c=(S=r.row.authors)==null?void 0:S.find(o=>o.userId===(a==null?void 0:a.id));return!c||c.scoreLevel===void 0||c.scoreLevel===null?e.jsx("div",{children:"-"}):e.jsx("div",{children:an(c.scoreLevel)})}},{field:"authorHour",headerName:"Giờ tác giả",type:"string",width:120,renderCell:r=>{var S;const c=(S=r.row.authors)==null?void 0:S.find(o=>o.userId===(a==null?void 0:a.id));return e.jsx("div",{children:(c==null?void 0:c.authorHour)!==void 0&&(c==null?void 0:c.authorHour)!==null?c.authorHour:"-"})}},{field:"proofStatus",headerName:"Trạng thái",type:"string",width:140,renderCell:r=>{var o;const c=(o=r.row.authors)==null?void 0:o.find(D=>D.userId===(a==null?void 0:a.id)),S=c==null?void 0:c.proofStatus;return S==null?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"}):S===ce.HopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Ze,{color:"success"}),"Hợp lệ"]}):S===ce.KhongHopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Je,{color:"error"}),"Không hợp lệ"]}):S===ce.ChuaXuLy?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(nn,{color:"action"}),"Chưa xử lý"]}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"})}},{field:"actions",headerName:"Thao tác",width:250,renderCell:r=>{var D;const h=r.row,c=(D=h.authors)==null?void 0:D.find(V=>V.userId===(a==null?void 0:a.id)),S=u(c),o=f.has(c==null?void 0:c.id);return e.jsxs(z,{children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>I(h),disabled:S||o,sx:{marginRight:1,"&.Mui-disabled":{backgroundColor:"rgba(0, 0, 0, 0.12)",color:"rgba(0, 0, 0, 0.26)"}},children:o?e.jsx(J,{size:24}):"Đăng ký"}),e.jsx(C,{variant:"contained",color:"error",size:"small",onClick:()=>{H(h.id),P(!0)},disabled:!S||o,sx:{"&.Mui-disabled":{backgroundColor:"rgba(0, 0, 0, 0.12)",color:"rgba(0, 0, 0, 0.26)"}},children:o?e.jsx(J,{size:24}):"Hủy đăng ký"})]})}}];return y?e.jsx(J,{}):d?e.jsxs("p",{children:["Lỗi: ",d.message]}):e.jsxs(Be,{maxWidth:"xl",children:[e.jsxs(z,{sx:{display:"flex",justifyContent:"space-between",mb:2},children:[e.jsx(L,{variant:"h6",children:"Danh sách công trình có thể đăng ký"}),e.jsx(z,{sx:{display:"flex",gap:2}})]}),y?e.jsx(z,{sx:{display:"flex",justifyContent:"center",mt:4},children:e.jsx(J,{})}):e.jsx(Te,{columns:p,data:g}),e.jsxs(he,{open:k,onClose:x,children:[e.jsx(ue,{children:"Xác nhận hủy đăng ký"}),e.jsx(ge,{children:e.jsx(L,{children:"Bạn có chắc chắn muốn hủy đăng ký công trình này không?"})}),e.jsxs(me,{children:[e.jsx(C,{onClick:x,color:"inherit",children:"Hủy"}),e.jsx(C,{onClick:()=>{q&&(v(q),x())},color:"error",variant:"contained",disabled:W.isPending,children:W.isPending?e.jsx(J,{size:24}):"Hủy đăng ký"})]})]})]})}function Gi({open:n,onClose:t,status:s,onStatusChange:a,onSubmit:g,isPending:j}){return e.jsxs(he,{open:n,onClose:t,children:[e.jsx(ue,{children:"Cập nhật trạng thái công trình"}),e.jsxs(ge,{children:[e.jsxs(pe,{fullWidth:!0,margin:"normal",children:[e.jsx(ve,{id:"status-select-label",children:"Trạng thái"}),e.jsxs(Ie,{labelId:"status-select-label",value:s,onChange:a,label:"Trạng thái",children:[e.jsx(F,{value:ce.HopLe,children:"Hợp lệ"}),e.jsx(F,{value:ce.KhongHopLe,children:"Không hợp lệ"}),e.jsx(F,{value:ce.ChuaXuLy,children:"Chưa xử lý"})]})]}),e.jsx(L,{variant:"caption",color:"textSecondary",sx:{mt:1,display:"block"},children:"Dialog sẽ tự động đóng sau khi cập nhật thành công."})]}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,children:"Hủy"}),e.jsx(C,{onClick:g,variant:"contained",color:"primary",disabled:j,children:j?e.jsx(J,{size:24}):"Cập nhật"})]})]})}function Qi({open:n,onClose:t,note:s,onNoteChange:a,onSubmit:g,isPending:j}){return e.jsxs(he,{open:n,onClose:t,fullWidth:!0,maxWidth:"sm",children:[e.jsx(ue,{children:"Cập nhật ghi chú"}),e.jsxs(ge,{children:[e.jsx(B,{fullWidth:!0,multiline:!0,rows:4,margin:"normal",label:"Ghi chú",value:s,onChange:a}),e.jsx(L,{variant:"caption",color:"textSecondary",sx:{mt:1,display:"block"},children:"Dialog sẽ tự động đóng sau khi cập nhật thành công."})]}),e.jsxs(me,{children:[e.jsx(C,{onClick:t,children:"Hủy"}),e.jsx(C,{onClick:g,variant:"contained",color:"primary",disabled:j,children:j?e.jsx(J,{size:24}):"Cập nhật"})]})]})}function Xi(){var we;const{userId:n}=rs(),t=$e(),[s,a]=l.useState({}),g=Ln(),{data:j}=ne({queryKey:["current-academic-year"],queryFn:cn}),{data:f,isLoading:T,error:m}=ne({queryKey:["users",n],queryFn:()=>_e(n||""),enabled:!!n}),{data:w,isLoading:d,error:y,refetch:b}=ne({queryKey:["works","user",n],queryFn:async()=>{var de;const $={userId:n,academicYearId:(de=j==null?void 0:j.data)==null?void 0:de.id,isCurrentUser:!1};return on($)},enabled:!!n&&!!((we=j==null?void 0:j.data)!=null&&we.id)});l.useEffect(()=>{w!=null&&w.data&&w.data.length>0&&(async()=>{const de={};for(const G of w.data)if(G.coAuthorUserIds&&G.coAuthorUserIds.length>0){const ee=[];for(const ae of G.coAuthorUserIds)try{const Le=await _e(ae);Le.success&&Le.data&&ee.push(Le.data)}catch(Le){console.error("Lỗi khi lấy thông tin đồng tác giả:",Le)}de[G.id]=ee}a(de)})()},[w]);const{selectedWork:u,openUpdateDialog:k,openStatusDialog:P,openNoteDialog:q,newStatus:H,newNote:v,activeTab:x,updateWorkMutation:W,createWorkMutation:I,handleOpenUpdateDialog:p,handleCloseUpdateDialog:i,handleOpenStatusDialog:r,handleCloseStatusDialog:h,handleOpenNoteDialog:c,handleCloseNoteDialog:S,handleStatusChange:o,handleNoteChange:D,handleStatusSubmit:V,handleNoteSubmit:je,handleUpdateSubmit:N,setActiveTab:O}=jt({userId:n,worksData:w,refetchWorks:b,isAuthorPage:!1}),X=()=>{t(-1)},M=[{field:"stt",headerName:"STT",width:70,renderCell:$=>{const G=$.api.getAllRowIds().indexOf($.id);return e.jsx("div",{children:G+1})}},{field:"title",headerName:"Tên công trình",type:"string",width:250},{field:"timePublished",headerName:"Thời gian xuất bản",type:"string",width:150,renderCell:$=>{if(!$.value)return e.jsx("div",{children:"-"});try{const de=st(new Date($.value),"dd/MM/yyyy",{locale:In});return e.jsx("div",{children:de})}catch(de){return e.jsx("div",{children:$.value})}}},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:150},{field:"workLevelName",headerName:"Cấp công trình",type:"string",width:150},{field:"details",headerName:"Thông tin chi tiết",type:"string",width:300,renderCell:$=>{if(!$.row.details)return e.jsx("div",{children:"-"});const de=$.row.details,G=Object.entries(de).map(([ee,ae])=>"".concat(ee,": ").concat(String(ae))).join("\n");return e.jsx(Re,{title:e.jsx("div",{style:{whiteSpace:"pre-line",fontSize:"0.8rem"},children:G}),arrow:!0,children:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%"},children:Object.entries(de).map(([ee,ae],Le)=>e.jsxs("span",{children:[Le>0&&"; ",e.jsx("b",{children:ee}),": ",String(ae)]},Le))})})}},{field:"totalAuthors",headerName:"Số tác giả",type:"number",width:140,align:"center",headerAlign:"left"},{field:"totalMainAuthors",headerName:"Số tác giả chính",type:"number",width:140,align:"center",headerAlign:"left"},{field:"coAuthors",headerName:"Đồng tác giả",type:"string",width:140,renderCell:$=>{const de=$.row.id,G=s[de]||[];if(G.length===0)return e.jsx("div",{children:"-"});const ee="".concat(G.length," tác giả");return e.jsx(Re,{title:e.jsxs("div",{children:[e.jsx(L,{variant:"subtitle2",children:"Danh sách đồng tác giả:"}),G.map((ae,Le)=>e.jsxs(L,{variant:"body2",children:["• ",ae.fullName," - ",ae.userName," - ",ae.departmentName||"Chưa có phòng ban"]},Le))]}),children:e.jsx("div",{children:ee})})}},{field:"authorRoleName",headerName:"Vai trò tác giả",type:"string",width:150,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:G?G.authorRoleName:"-"})}},{field:"position",headerName:"Vị trí",type:"string",width:80,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:(G==null?void 0:G.position)!==void 0&&(G==null?void 0:G.position)!==null?G.position:"-"})}},{field:"purposeName",headerName:"Mục đích quy đổi",type:"string",width:180,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:G?G.purposeName:"-"})}},{field:"fieldName",headerName:"Ngành tính điểm",type:"string",width:150,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:G?G.fieldName:"-"})}},{field:"scImagoFieldName",headerName:"Ngành SCImago",type:"string",width:180,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:G?G.scImagoFieldName:"-"})}},{field:"scoreLevel",headerName:"Mức điểm",type:"string",width:120,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return!G||G.scoreLevel===void 0||G.scoreLevel===null?e.jsx("div",{children:"-"}):e.jsx("div",{children:an(G.scoreLevel)})}},{field:"workHour",headerName:"Giờ công trình",type:"string",width:120,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:(G==null?void 0:G.workHour)!==void 0&&(G==null?void 0:G.workHour)!==null?G.workHour:"-"})}},{field:"authorHour",headerName:"Giờ tác giả",type:"string",width:120,renderCell:$=>{var ee;const G=(ee=$.row.authors)==null?void 0:ee.find(ae=>ae.userId===n);return e.jsx("div",{children:(G==null?void 0:G.authorHour)!==void 0&&(G==null?void 0:G.authorHour)!==null?G.authorHour:"-"})}},{field:"note",headerName:"Ghi chú",type:"string",width:150,renderCell:$=>{var ae;const G=(ae=$.row.authors)==null?void 0:ae.find(Le=>Le.userId===n),ee=(G==null?void 0:G.note)||"";return ee?e.jsx(Re,{title:e.jsx("div",{style:{whiteSpace:"pre-line",fontSize:"0.8rem"},children:ee}),arrow:!0,children:e.jsx("div",{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",width:"100%"},children:ee})}):e.jsx("div",{children:"-"})}},{field:"proofStatus",headerName:"Trạng thái",type:"string",width:140,renderCell:$=>{var ae;const G=(ae=$.row.authors)==null?void 0:ae.find(Le=>Le.userId===n),ee=G==null?void 0:G.proofStatus;return ee==null?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"}):ee===ce.HopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Ze,{color:"success"}),"Hợp lệ"]}):ee===ce.KhongHopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Je,{color:"error"}),"Không hợp lệ"]}):ee===ce.ChuaXuLy?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(nn,{color:"action"}),"Chưa xử lý"]}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"})}},{field:"actions",headerName:"Thao tác",width:350,renderCell:$=>e.jsxs(z,{display:"flex",gap:1,alignItems:"center",height:"100%",children:[e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>p($.row),startIcon:e.jsx(as,{}),children:"Cập nhật"}),e.jsx(C,{variant:"contained",color:"info",size:"small",onClick:()=>r($.row),startIcon:e.jsx(os,{}),children:"Trạng thái"}),e.jsx(C,{variant:"contained",color:"secondary",size:"small",onClick:()=>c($.row),startIcon:e.jsx(ls,{}),children:"Ghi chú"})]})}];if(T||d)return e.jsx(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(J,{})});if(m||y)return e.jsx(z,{p:3,children:e.jsxs(L,{color:"error",children:[m?"Lỗi khi tải thông tin người dùng: "+m.message:"",y?"Lỗi khi tải danh sách công trình: "+y.message:""]})});const E=f==null?void 0:f.data,Q=(w==null?void 0:w.data)||[];return e.jsxs(Be,{maxWidth:"xl",children:[e.jsxs(z,{sx:{display:"flex",alignItems:"center",mb:2},children:[e.jsx(C,{variant:"outlined",startIcon:e.jsx(is,{}),onClick:X,sx:{mr:2},children:"Quay lại"}),e.jsxs(L,{variant:"h4",children:["Chấm điểm công trình - ",E==null?void 0:E.fullName]})]}),e.jsx(z,{sx:{mb:3},children:e.jsxs(Ce,{sx:{p:2},children:[e.jsx(L,{variant:"h6",gutterBottom:!0,children:"Thông tin người dùng"}),e.jsxs(z,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:[e.jsxs(L,{variant:"body1",children:[e.jsx("strong",{children:"Mã số viên chức:"})," ",E==null?void 0:E.userName]}),e.jsxs(L,{variant:"body1",children:[e.jsx("strong",{children:"Họ và tên:"})," ",E==null?void 0:E.fullName]}),e.jsxs(L,{variant:"body1",children:[e.jsx("strong",{children:"Đơn vị công tác:"})," ",(E==null?void 0:E.departmentName)||"Chưa có phòng ban"]}),e.jsxs(L,{variant:"body1",children:[e.jsx("strong",{children:"Ngành:"})," ",(E==null?void 0:E.fieldName)||"Chưa phân ngành"]})]})]})}),e.jsxs(z,{sx:{mb:2},children:[e.jsx(L,{variant:"h6",gutterBottom:!0,children:"Danh sách công trình"}),e.jsx(Ce,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(z,{sx:{height:600},children:e.jsx(Te,{columns:M,data:Q})})})]}),e.jsx(Gi,{open:P,onClose:h,status:H,onStatusChange:$=>o(Number($.target.value)),onSubmit:V,isPending:W.isPending}),e.jsx(Qi,{open:q,onClose:S,note:v,onNoteChange:$=>D($.target.value),onSubmit:je,isPending:W.isPending}),e.jsx(yt,{open:k,onClose:i,selectedWork:u,activeTab:x,setActiveTab:O,onSubmit:N,isPending:I.isPending||W.isPending,workTypes:g.workTypes,workLevels:g.workLevels,authorRoles:g.authorRoles,purposes:g.purposes,scimagoFields:g.scimagoFields,fields:g.fields})]})}const $i=Ne({fullName:_().min(1,"Họ tên không được để trống"),email:_().email("Email không hợp lệ"),phoneNumber:_().min(1,"Số điện thoại không được để trống").max(10,"Số điện thoại không hợp lệ"),specialization:_().min(1,"Chuyên ngành không được để trống"),departmentId:_().min(1,"Đơn vị công tác không được để trống"),fieldId:_().min(1,"Ngành không được để trống"),academicTitle:_().min(1,"Học hàm không được để trống"),officerRank:_().min(1,"Ngạch công chức không được để trống")}),Yi=Ne({currentPassword:_().min(1,"Mật khẩu hiện tại không được để trống"),newPassword:_().min(1,"Mật khẩu mới không được để trống"),confirmNewPassword:_().min(1,"Xác nhận mật khẩu mới không được để trống")}).refine(n=>n.newPassword===n.confirmNewPassword,{message:"Mật khẩu mới không khớp",path:["confirmNewPassword"]});function _i(){var i,r,h,c,S;const[n,t]=l.useState(null),{setUser:s,refreshUserInfo:a}=Fe(),[g,j]=l.useState([]),[f,T]=l.useState([]),{control:m,register:w,handleSubmit:d,reset:y,formState:{errors:b,isSubmitting:u}}=Se({resolver:qe($i)}),{register:k,handleSubmit:P,reset:q,formState:{errors:H,isSubmitting:v}}=Se({resolver:qe(Yi)}),{data:x,isLoading:W}=ne({queryKey:["user"],queryFn:ct});l.useEffect(()=>{x!=null&&x.success&&x.data&&(t(x.data),y({departmentId:x.data.departmentId==="00000000-0000-0000-0000-000000000000"?"":x.data.departmentId,fieldId:x.data.fieldId==="00000000-0000-0000-0000-000000000000"?"":x.data.fieldId,academicTitle:x.data.academicTitle==="Unknown"?"":x.data.academicTitle,officerRank:x.data.officerRank==="Unknown"?"":x.data.officerRank,fullName:x.data.fullName,email:x.data.email==="-"?"":x.data.email,phoneNumber:x.data.phoneNumber==="-"?"":x.data.phoneNumber,specialization:x.data.specialization==="-"?"":x.data.specialization}))},[x,y]),l.useEffect(()=>{async function o(){const D=await Ge();j(D.data||[]);const V=await rn();T(V.data||[])}o()},[]);const I=async o=>{try{if(!n)return;if((await bs(n.id,o)).success){const je=(await _e(n.id)).data;s(je)}await a(),A.success("Cập nhật hồ sơ thành công")}catch(D){A.error("Lỗi khi cập nhật hồ sơ")}},p=async o=>{try{await zs(o.currentPassword,o.newPassword),A.success("Đổi mật khẩu thành công"),q()}catch(D){A.error("Lỗi khi đổi mật khẩu")}};return!n||W?e.jsx(J,{}):e.jsxs(e.Fragment,{children:[e.jsx(L,{variant:"h4",fontWeight:500,sx:{my:3},children:"Cập nhật thông tin cá nhân"}),e.jsx(z,{maxWidth:"sm",children:e.jsxs("form",{onSubmit:d(I),noValidate:!0,children:[e.jsx(B,{label:"Họ và tên",fullWidth:!0,margin:"dense",...w("fullName"),error:!!b.fullName,helperText:(i=b.fullName)==null?void 0:i.message,disabled:u}),e.jsx(B,{label:"Email",fullWidth:!0,margin:"dense",...w("email"),error:!!b.email,helperText:(r=b.email)==null?void 0:r.message,disabled:u}),e.jsx(B,{label:"Số điện thoại",fullWidth:!0,margin:"dense",...w("phoneNumber"),disabled:u}),e.jsx(B,{label:"Chuyên ngành",fullWidth:!0,margin:"dense",...w("specialization"),disabled:u}),e.jsx(Z,{name:"departmentId",control:m,render:({field:o})=>{var D;return e.jsxs(B,{select:!0,label:"Đơn vị công tác",...o,error:!!b.departmentId,helperText:(D=b.departmentId)==null?void 0:D.message,fullWidth:!0,margin:"dense",disabled:u,children:[e.jsx(F,{value:"",children:"Chọn đơn vị"}),g.map(V=>e.jsx(F,{value:V.id,children:V.name},V.id))]})}}),e.jsx(Z,{name:"fieldId",control:m,render:({field:o})=>{var D;return e.jsxs(B,{select:!0,label:"Ngành",...o,error:!!b.fieldId,helperText:(D=b.fieldId)==null?void 0:D.message,fullWidth:!0,margin:"dense",disabled:u,children:[e.jsx(F,{value:"",children:"Chọn ngành"}),f.map(V=>e.jsx(F,{value:V.id,children:V.name},V.id))]})}}),e.jsx(Z,{name:"academicTitle",control:m,render:({field:o})=>{var D;return e.jsx(B,{select:!0,label:"Học hàm",...o,error:!!b.academicTitle,helperText:(D=b.academicTitle)==null?void 0:D.message,fullWidth:!0,margin:"dense",disabled:u,children:Object.entries(mn).filter(([V])=>isNaN(Number(V))).map(([V])=>e.jsx(F,{value:V,children:tn(V)},V))})}}),e.jsx(Z,{name:"officerRank",control:m,render:({field:o})=>{var D;return e.jsx(B,{select:!0,label:"Ngạch công chức",...o,error:!!b.officerRank,helperText:(D=b.officerRank)==null?void 0:D.message,fullWidth:!0,margin:"dense",disabled:u,children:Object.entries(pn).filter(([V])=>isNaN(Number(V))).map(([V])=>e.jsx(F,{value:V,children:sn(V)},V))})}}),e.jsx(C,{variant:"contained",type:"submit",fullWidth:!0,sx:{mt:2},disabled:u,children:u?"Đang tải...":"Cập nhật thông tin"})]})}),e.jsx(Ke,{sx:{my:3}}),e.jsxs(z,{maxWidth:"sm",sx:{mt:3},children:[e.jsx(L,{variant:"h4",fontWeight:500,sx:{mb:2},children:"Đổi mật khẩu"}),e.jsxs("form",{onSubmit:P(p),noValidate:!0,children:[e.jsx(B,{label:"Mật khẩu hiện tại",fullWidth:!0,margin:"dense",type:"password",...k("currentPassword"),error:!!H.currentPassword,helperText:(h=H.currentPassword)==null?void 0:h.message,disabled:v}),e.jsx(B,{label:"Mật khẩu mới",fullWidth:!0,margin:"dense",type:"password",...k("newPassword"),error:!!H.newPassword,helperText:(c=H.newPassword)==null?void 0:c.message,disabled:v}),e.jsx(B,{label:"Xác nhận mật khẩu mới",fullWidth:!0,margin:"dense",type:"password",...k("confirmNewPassword"),error:!!H.confirmNewPassword,helperText:(S=H.confirmNewPassword)==null?void 0:S.message,disabled:v}),e.jsx(C,{variant:"contained",type:"submit",fullWidth:!0,sx:{mt:2},disabled:v,children:v?"Đang tải...":"Đổi mật khẩu"})]})]})]})}function Zi(){const n=$e(),[t,s]=l.useState(""),{user:a}=Fe(),{data:g,isLoading:j,error:f}=ne({queryKey:["departments",a==null?void 0:a.role,a==null?void 0:a.id],queryFn:async()=>(a==null?void 0:a.role)==="Manager"?await ut(a.id):await Ge(),enabled:!!a}),{data:T,isLoading:m,error:w}=ne({queryKey:["users","department",t],queryFn:()=>dt(t),enabled:!!t}),d=k=>{s(k.target.value)},y=k=>{n("/cham-diem/user/".concat(k))},b=[{field:"userName",headerName:"Mã số viên chức",width:150},{field:"fullName",headerName:"Họ và tên",width:250},{field:"departmentName",headerName:"Đơn vị công tác",width:250},{field:"fieldName",headerName:"Ngành",width:200,renderCell:k=>e.jsx("div",{children:k.row.fieldName||"Chưa phân ngành"})},{field:"actions",headerName:"Thao tác",width:170,renderCell:k=>e.jsx(C,{variant:"contained",color:"primary",size:"small",onClick:()=>y(k.row.id),startIcon:e.jsx(cs,{}),children:"Xem công trình"})}];if(j)return e.jsx(z,{display:"flex",justifyContent:"center",alignItems:"center",height:"50vh",children:e.jsx(J,{})});if(f)return e.jsx(z,{p:3,children:e.jsxs(L,{color:"error",children:["Lỗi khi tải danh sách phòng ban: ",f.message]})});const u=(g==null?void 0:g.data)||[];return e.jsxs(Be,{maxWidth:"xl",children:[e.jsxs(z,{sx:{mb:4},children:[e.jsx(L,{variant:"h5",gutterBottom:!0,children:"Danh sách người dùng theo phòng ban"}),e.jsxs(pe,{fullWidth:!0,sx:{mt:2},children:[e.jsx(ve,{id:"department-select-label",children:"Chọn phòng ban"}),e.jsxs(Ie,{labelId:"department-select-label",id:"department-select",value:t,label:"Chọn phòng ban",onChange:d,children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Chọn phòng ban"})}),u.map(k=>e.jsx(F,{value:k.id,children:k.name},k.id))]})]})]}),t?m?e.jsx(z,{display:"flex",justifyContent:"center",py:4,children:e.jsx(J,{})}):w?e.jsxs(L,{color:"error",children:["Lỗi khi tải danh sách người dùng: ",w.message]}):e.jsxs(e.Fragment,{children:[e.jsx(L,{variant:"h6",mb:2,children:"Danh sách người dùng thuộc phòng ban"}),e.jsx(Ce,{sx:{width:"100%",overflow:"hidden"},children:e.jsx(z,{sx:{height:500},children:e.jsx(Te,{columns:b,data:(T==null?void 0:T.data)||[]})})})]}):e.jsx(L,{variant:"subtitle1",color:"text.secondary",textAlign:"center",py:4,children:"Vui lòng chọn phòng ban để xem danh sách người dùng"})]})}const Ji=async()=>(await K.get("/cache/keys")).data,ea=async n=>(await K.delete("/cache/clear/".concat(n))).data,na=async()=>(await K.delete("/cache/clear-all")).data;function ta(){const n=fe(),{data:t,error:s,isPending:a,isSuccess:g,dataUpdatedAt:j,refetch:f}=ne({queryKey:["cache-keys"],queryFn:Ji});l.useEffect(()=>{g&&t&&A.success("Tải danh sách cache thành công",{toastId:"fetch-caches"})},[j]),l.useEffect(()=>{s&&A.error("Lỗi khi fetch cache: "+s.message)},[s]);const T=xe({mutationFn:d=>ea(d),onSuccess:()=>{A.success("Đã xóa cache"),n.invalidateQueries({queryKey:["cache-keys"]}),f()},onError:d=>{A.error("Xóa thất bại: "+d.message)}}),m=xe({mutationFn:na,onSuccess:()=>{A.success("Xóa tất cả cache thành công"),n.invalidateQueries({queryKey:["cache-keys"]}),f()},onError:d=>{A.error("Xóa toàn bộ cache thất bại: "+d.message)}}),w=[{field:"key",headerName:"Cache Key",width:600},{field:"actions",headerName:"Hành động",width:200,renderCell:d=>e.jsx(C,{variant:"outlined",color:"error",size:"small",onClick:()=>T.mutate(d.row.key),disabled:T.isPending,children:"Xóa"})}];return a?e.jsx(J,{}):s?e.jsxs("p",{children:["Error: ",s.message]}):e.jsxs(e.Fragment,{children:[e.jsxs(z,{display:"flex",justifyContent:"space-between",mb:2,children:[e.jsx(L,{variant:"h6",children:"Quản lý Cache"}),e.jsx(C,{variant:"contained",color:"error",onClick:()=>m.mutate(),disabled:m.isPending,children:m.isPending?"Đang xóa...":"Xóa tất cả"})]}),e.jsx(Ce,{sx:{width:900,margin:"auto"},children:e.jsx(Te,{columns:w,data:((t==null?void 0:t.data)||[]).map(d=>({id:d,key:d}))})})]})}const sa=async n=>(console.log("Đang gọi API xuất Excel với filter:",n),(await K.get("/excel/export-by-user",{params:{academicYearId:n.academicYearId,proofStatus:n.proofStatus,source:n.source,onlyRegisteredWorks:n.onlyRegisteredWorks,onlyRegisterableWorks:n.onlyRegisterableWorks},responseType:"blob"})).data),ra=()=>{const[n,t]=l.useState(!1),[s,a]=l.useState(null),[g,j]=l.useState([]),[f,T]=l.useState([]),{user:m}=Fe(),[w,d]=l.useState({academicYearId:"",proofStatus:void 0,source:void 0,onlyRegisteredWorks:!1,onlyRegisterableWorks:!1,isCurrentUser:!0}),[y,b]=l.useState(null),[u,k]=l.useState(!1);l.useEffect(()=>{(async()=>{try{const h=await ln();T(h.data||[])}catch(h){a("Lỗi khi tải dữ liệu ban đầu"),console.error("Error fetching initial data:",h)}})()},[]);const P=r=>{const{name:h,checked:c}=r.target;d(S=>({...S,[h]:c}))},q=r=>{const{name:h,value:c}=r.target;d(h==="proofStatus"||h==="source"?S=>({...S,[h]:c===""?void 0:Number(c)}):S=>({...S,[h]:c}))},H=async()=>{t(!0),a(null);try{const r=await on(w);j(r.data||[])}catch(r){console.error("Error fetching works:",r),a("Lỗi khi tải danh sách công trình")}finally{t(!1)}},v=()=>{d({academicYearId:"",proofStatus:void 0,source:void 0,onlyRegisteredWorks:!1,onlyRegisterableWorks:!1,isCurrentUser:!0})},x=r=>{switch(r){case We.NguoiDungKeKhai:return"Người dùng kê khai";case We.QuanLyNhap:return"Quản lý nhập";default:return"N/A"}},W=r=>{switch(r){case ce.HopLe:return e.jsx(Re,{title:"Hợp lệ",children:e.jsx(Ee,{icon:e.jsx(Ze,{}),label:"Hợp lệ",color:"success",size:"small"})});case ce.KhongHopLe:return e.jsx(Re,{title:"Không hợp lệ",children:e.jsx(Ee,{icon:e.jsx(Je,{}),label:"Không hợp lệ",color:"error",size:"small"})});case ce.ChuaXuLy:return e.jsx(Re,{title:"Chưa xử lý",children:e.jsx(Ee,{icon:e.jsx(nn,{}),label:"Chưa xử lý",color:"warning",size:"small"})});default:return null}},I=[{field:"stt",headerName:"STT",width:70,renderCell:r=>{const c=r.api.getAllRowIds().indexOf(r.id);return e.jsx("div",{children:c+1})}},{field:"title",headerName:"Tên công trình",type:"string",width:250},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:170},{field:"workLevelName",headerName:"Cấp công trình",type:"string",width:150},{field:"source",headerName:"Nguồn",type:"string",width:150,renderCell:r=>e.jsx("div",{children:x(r.value)})},{field:"academicYearName",headerName:"Năm học",type:"string",width:150},{field:"proofStatus",headerName:"Trạng thái xác minh",type:"string",width:150,renderCell:r=>{var S;const c=(S=r.row.authors)==null?void 0:S.find(o=>o.userId===(m==null?void 0:m.id));return c?W(c.proofStatus):null}},{field:"isRegistered",headerName:"Trạng thái đăng ký",type:"string",width:150,renderCell:r=>{var o;const c=(o=r.row.authors)==null?void 0:o.find(D=>D.userId===(m==null?void 0:m.id)),S=(c==null?void 0:c.authorRegistration)!=null;return e.jsx(Ee,{label:S?"Đã đăng ký":"Chưa đăng ký",color:S?"success":"default",size:"small"})}}],p=async()=>{try{t(!0);const r=await sa(w),h=window.URL.createObjectURL(r),c=document.createElement("a");c.href=h,c.setAttribute("download","KeKhaiCongTrinh_".concat(new Date().toISOString().slice(0,10),".xlsx")),document.body.appendChild(c),c.click(),document.body.removeChild(c),window.URL.revokeObjectURL(h)}catch(r){console.error("Lỗi khi export:",r),a("Lỗi khi xuất file Excel")}finally{t(!1)}},i=async()=>{if(m!=null&&m.id)try{k(!0);const r=await vs(m.id);r.success&&b(r.data)}catch(r){console.error("Lỗi khi lấy kết quả quy đổi:",r)}finally{k(!1)}};return l.useEffect(()=>{i()},[m==null?void 0:m.id]),e.jsxs(Be,{maxWidth:"xl",sx:{mt:4,mb:4},children:[e.jsxs(Ce,{sx:{p:3,mb:3,borderRadius:2,boxShadow:3},children:[e.jsxs(Ae,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(L,{variant:"h6",display:"flex",alignItems:"center",color:"primary",children:[e.jsx(un,{sx:{mr:1}}),"Bộ lọc"]}),e.jsxs(Ae,{direction:"row",spacing:2,children:[e.jsx(C,{variant:"outlined",color:"primary",onClick:v,startIcon:e.jsx(lt,{}),children:"Đặt lại"}),e.jsx(C,{variant:"contained",color:"primary",onClick:H,disabled:n,startIcon:n?e.jsx(J,{size:20}):e.jsx(un,{}),children:"Tìm kiếm"})]})]}),e.jsx(Ke,{sx:{mb:3}}),e.jsxs(U,{container:!0,spacing:3,children:[e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(pe,{fullWidth:!0,size:"small",children:[e.jsx(ve,{children:"Năm học"}),e.jsxs(Ie,{name:"academicYearId",value:w.academicYearId||"",onChange:q,label:"Năm học",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),f.map(r=>e.jsx(F,{value:r.id,children:r.name},r.id))]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(pe,{fullWidth:!0,size:"small",children:[e.jsx(ve,{children:"Trạng thái xác minh"}),e.jsxs(Ie,{name:"proofStatus",value:w.proofStatus!==void 0?w.proofStatus:"",onChange:q,label:"Trạng thái xác minh",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),e.jsx(F,{value:ce.HopLe,children:"Hợp lệ"}),e.jsx(F,{value:ce.KhongHopLe,children:"Không hợp lệ"}),e.jsx(F,{value:ce.ChuaXuLy,children:"Chưa xử lý"})]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(pe,{fullWidth:!0,size:"small",children:[e.jsx(ve,{children:"Nguồn"}),e.jsxs(Ie,{name:"source",value:w.source!==void 0?w.source:"",onChange:q,label:"Nguồn",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),e.jsx(F,{value:We.NguoiDungKeKhai,children:"Người dùng kê khai"}),e.jsx(F,{value:We.QuanLyNhap,children:"Quản lý nhập"})]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(z,{display:"flex",flexDirection:"column",gap:2,children:[e.jsx(Ve,{control:e.jsx(Oe,{checked:w.onlyRegisteredWorks,onChange:P,name:"onlyRegisteredWorks"}),label:"Công trình đã đăng ký"}),e.jsx(Ve,{control:e.jsx(Oe,{checked:w.onlyRegisterableWorks,onChange:P,name:"onlyRegisterableWorks"}),label:"Công trình có thể đăng ký"})]})})]})]}),e.jsxs(Ce,{sx:{p:3,borderRadius:2,boxShadow:3,mb:4},children:[e.jsxs(Ae,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(L,{variant:"h6",display:"flex",alignItems:"center",children:[e.jsxs("span",{children:["Kết quả (",g.length," công trình)"]}),n&&e.jsx(J,{size:24,sx:{ml:2}})]}),e.jsx(C,{variant:"outlined",color:"primary",onClick:p,startIcon:e.jsx(ds,{}),disabled:g.length===0,children:"Xuất Excel"})]}),s&&e.jsx(De,{severity:"error",sx:{mb:2},children:s}),g.length===0&&!n?e.jsx(De,{severity:"info",children:"Không có công trình nào được tìm thấy. Vui lòng thay đổi bộ lọc hoặc thử lại."}):e.jsx(Te,{columns:I,data:g})]}),e.jsxs(Ce,{sx:{p:3,borderRadius:2,boxShadow:3},children:[e.jsx(Ae,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:e.jsxs(L,{variant:"h6",display:"flex",alignItems:"center",children:[e.jsx("span",{children:"Kết quả quy đổi"}),u&&e.jsx(J,{size:24,sx:{ml:2}})]})}),y?e.jsx(rt,{children:e.jsxs(it,{children:[e.jsx(at,{children:e.jsxs(Xe,{children:[e.jsx(le,{children:"Loại quy đổi"}),e.jsx(le,{align:"right",children:"Số lượng công trình"}),e.jsx(le,{align:"right",children:"Tổng giờ quy đổi"}),e.jsx(le,{align:"right",children:"Tổng giờ tính"})]})}),e.jsxs(ot,{children:[e.jsxs(Xe,{children:[e.jsx(le,{children:"Quy đổi giờ nghĩa vụ"}),e.jsx(le,{align:"right",children:y.conversionResults.dutyHourConversion.totalWorks}),e.jsx(le,{align:"right",children:y.conversionResults.dutyHourConversion.totalConvertedHours}),e.jsx(le,{align:"right",children:y.conversionResults.dutyHourConversion.totalCalculatedHours})]}),e.jsxs(Xe,{children:[e.jsx(le,{children:"Quy đổi vượt định mức"}),e.jsx(le,{align:"right",children:y.conversionResults.overLimitConversion.totalWorks}),e.jsx(le,{align:"right",children:y.conversionResults.overLimitConversion.totalConvertedHours}),e.jsx(le,{align:"right",children:y.conversionResults.overLimitConversion.totalCalculatedHours})]}),e.jsxs(Xe,{children:[e.jsx(le,{children:"Sản phẩm NCKH"}),e.jsx(le,{align:"right",children:y.conversionResults.researchProductConversion.totalWorks}),e.jsx(le,{align:"right",children:y.conversionResults.researchProductConversion.totalConvertedHours}),e.jsx(le,{align:"right",children:y.conversionResults.researchProductConversion.totalCalculatedHours})]}),e.jsxs(Xe,{children:[e.jsx(le,{children:e.jsx("strong",{children:"Tổng cộng"})}),e.jsx(le,{align:"right",children:e.jsx("strong",{children:y.conversionResults.totalWorks})}),e.jsx(le,{align:"right",children:"-"}),e.jsx(le,{align:"right",children:e.jsx("strong",{children:y.conversionResults.totalCalculatedHours})})]})]})]})}):e.jsx(De,{severity:"info",children:"Không có dữ liệu kết quả quy đổi"})]})]})},ia=()=>{const[n,t]=l.useState(!1),[s,a]=l.useState(null),[g,j]=l.useState([]),[f,T]=l.useState([]),[m,w]=l.useState([]),{user:d}=Fe(),[y,b]=l.useState({academicYearId:"",departmentId:"",userId:"",proofStatus:void 0,source:void 0,onlyRegisteredWorks:!1});l.useEffect(()=>{(async()=>{try{const[p,i]=await Promise.all([ln(),(d==null?void 0:d.role)==="Manager"?ut(d.id):Ge()]);T(p.data||[]),w(i.data||[])}catch(p){a("Lỗi khi tải dữ liệu ban đầu"),console.error("Error fetching initial data:",p)}})()},[d]);const{data:u}=ne({queryKey:["users","department",y.departmentId],queryFn:()=>dt(y.departmentId||""),enabled:!!y.departmentId}),k=(u==null?void 0:u.data)||[],P=I=>{const{name:p,checked:i}=I.target;b(r=>({...r,[p]:i}))},q=I=>{const{name:p,value:i}=I.target;b(p==="proofStatus"||p==="source"?r=>({...r,[p]:i===""?void 0:Number(i)}):r=>({...r,[p]:i})),p==="departmentId"&&b(r=>({...r,userId:""}))},H=async()=>{t(!0),a(null);try{const I=await on({...y,isCurrentUser:!1});j(I.data||[])}catch(I){console.error("Error fetching works:",I),a("Lỗi khi tải danh sách công trình")}finally{t(!1)}},v=()=>{b({academicYearId:"",departmentId:"",userId:"",proofStatus:void 0,source:void 0,onlyRegisteredWorks:!1})},x=I=>{switch(I){case We.NguoiDungKeKhai:return"Người dùng kê khai";case We.QuanLyNhap:return"Quản lý nhập";default:return"N/A"}},W=[{field:"stt",headerName:"STT",width:70,renderCell:I=>{const i=I.api.getAllRowIds().indexOf(I.id);return e.jsx("div",{children:i+1})}},{field:"title",headerName:"Tên công trình",type:"string",width:250},{field:"workTypeName",headerName:"Loại công trình",type:"string",width:170},{field:"workLevelName",headerName:"Cấp công trình",type:"string",width:150},{field:"source",headerName:"Nguồn",type:"string",width:150,renderCell:I=>e.jsx("div",{children:x(I.value)})},{field:"academicYearName",headerName:"Năm học",type:"string",width:150},{field:"departmentName",headerName:"Phòng ban",type:"string",width:200},{field:"authorRoleName",headerName:"Vai trò tác giả",type:"string",width:150,renderCell:I=>{var r;const i=(r=I.row.authors)==null?void 0:r.find(h=>h.userId===(d==null?void 0:d.id));return e.jsx("div",{children:i?i.authorRoleName:"-"})}},{field:"position",headerName:"Vị trí",type:"string",width:80,renderCell:I=>{var r;const i=(r=I.row.authors)==null?void 0:r.find(h=>h.userId===(d==null?void 0:d.id));return e.jsx("div",{children:(i==null?void 0:i.position)!==void 0&&(i==null?void 0:i.position)!==null?i.position:"-"})}},{field:"purposeName",headerName:"Mục đích quy đổi",type:"string",width:180,renderCell:I=>{var r;const i=(r=I.row.authors)==null?void 0:r.find(h=>h.userId===(d==null?void 0:d.id));return e.jsx("div",{children:i?i.purposeName:"-"})}},{field:"fieldName",headerName:"Ngành tính điểm",type:"string",width:150,renderCell:I=>{var r;const i=(r=I.row.authors)==null?void 0:r.find(h=>h.userId===(d==null?void 0:d.id));return e.jsx("div",{children:i?i.fieldName:"-"})}},{field:"scImagoFieldName",headerName:"Ngành SCImago",type:"string",width:180,renderCell:I=>{var r;const i=(r=I.row.authors)==null?void 0:r.find(h=>h.userId===(d==null?void 0:d.id));return e.jsx("div",{children:i?i.scImagoFieldName:"-"})}},{field:"scoreLevel",headerName:"Mức điểm",type:"string",width:150,renderCell:I=>{var r;const i=(r=I.row.authors)==null?void 0:r.find(h=>h.userId===(d==null?void 0:d.id));return!i||i.scoreLevel===void 0||i.scoreLevel===null?e.jsx("div",{children:"-"}):e.jsx("div",{children:an(i.scoreLevel)})}},{field:"workHour",headerName:"Giờ công trình",type:"string",width:120,renderCell:I=>{var r;const i=(r=I.row.authors)==null?void 0:r.find(h=>h.userId===(d==null?void 0:d.id));return e.jsx("div",{children:(i==null?void 0:i.workHour)!==void 0&&(i==null?void 0:i.workHour)!==null?i.workHour:"-"})}},{field:"authorHour",headerName:"Giờ tác giả",type:"string",width:120,renderCell:I=>{var r;const i=(r=I.row.authors)==null?void 0:r.find(h=>h.userId===(d==null?void 0:d.id));return e.jsx("div",{children:(i==null?void 0:i.authorHour)!==void 0&&(i==null?void 0:i.authorHour)!==null?i.authorHour:"-"})}},{field:"proofStatus",headerName:"Trạng thái",type:"string",width:140,renderCell:I=>{var h;const i=(h=I.row.authors)==null?void 0:h.find(c=>c.userId===(d==null?void 0:d.id)),r=i==null?void 0:i.proofStatus;return r==null?e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"}):r===ce.HopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Ze,{color:"success"}),"Hợp lệ"]}):r===ce.KhongHopLe?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(Je,{color:"error"}),"Không hợp lệ"]}):r===ce.ChuaXuLy?e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx(nn,{color:"action"}),"Chưa xử lý"]}):e.jsx("div",{style:{display:"flex",alignItems:"center",gap:"4px"},children:"-"})}},{field:"isRegistered",headerName:"Trạng thái đăng ký",type:"string",width:150,renderCell:I=>{const p=I.row.authors&&I.row.authors[0],i=(p==null?void 0:p.authorRegistration)!=null;return e.jsx(Ee,{label:i?"Đã đăng ký":"Chưa đăng ký",color:i?"success":"default",size:"small"})}}];return e.jsxs(Be,{maxWidth:"xl",sx:{mt:4,mb:4},children:[e.jsxs(Ce,{sx:{p:3,mb:3,borderRadius:2,boxShadow:3},children:[e.jsxs(Ae,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:[e.jsxs(L,{variant:"h6",display:"flex",alignItems:"center",color:"primary",children:[e.jsx(un,{sx:{mr:1}}),"Bộ lọc"]}),e.jsxs(Ae,{direction:"row",spacing:2,children:[e.jsx(C,{variant:"outlined",color:"primary",onClick:v,startIcon:e.jsx(lt,{}),children:"Đặt lại"}),e.jsx(C,{variant:"contained",color:"primary",onClick:H,disabled:n,startIcon:n?e.jsx(J,{size:20}):e.jsx(un,{}),children:"Tìm kiếm"})]})]}),e.jsx(Ke,{sx:{mb:3}}),e.jsxs(U,{container:!0,spacing:3,children:[e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(pe,{fullWidth:!0,size:"small",children:[e.jsx(ve,{children:"Năm học"}),e.jsxs(Ie,{name:"academicYearId",value:y.academicYearId||"",onChange:q,label:"Năm học",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),f.map(I=>e.jsx(F,{value:I.id,children:I.name},I.id))]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(pe,{fullWidth:!0,size:"small",children:[e.jsx(ve,{children:"Phòng ban"}),e.jsxs(Ie,{name:"departmentId",value:y.departmentId||"",onChange:q,label:"Phòng ban",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),m.map(I=>e.jsx(F,{value:I.id,children:I.name},I.id))]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(pe,{fullWidth:!0,size:"small",children:[e.jsx(ve,{children:"Người dùng"}),e.jsxs(Ie,{name:"userId",value:y.userId||"",onChange:q,label:"Người dùng",disabled:!y.departmentId,children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),k.map(I=>e.jsxs(F,{value:I.id,children:[I.userName," - ",I.fullName]},I.id))]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(pe,{fullWidth:!0,size:"small",children:[e.jsx(ve,{children:"Trạng thái xác minh"}),e.jsxs(Ie,{name:"proofStatus",value:y.proofStatus!==void 0?y.proofStatus:"",onChange:q,label:"Trạng thái xác minh",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),e.jsx(F,{value:ce.HopLe,children:"Hợp lệ"}),e.jsx(F,{value:ce.KhongHopLe,children:"Không hợp lệ"}),e.jsx(F,{value:ce.ChuaXuLy,children:"Chưa xử lý"})]})]})}),e.jsx(U,{item:!0,xs:12,sm:6,md:3,children:e.jsxs(pe,{fullWidth:!0,size:"small",children:[e.jsx(ve,{children:"Nguồn"}),e.jsxs(Ie,{name:"source",value:y.source!==void 0?y.source:"",onChange:q,label:"Nguồn",children:[e.jsx(F,{value:"",children:e.jsx("em",{children:"Không chọn"})}),e.jsx(F,{value:We.NguoiDungKeKhai,children:"Người dùng kê khai"}),e.jsx(F,{value:We.QuanLyNhap,children:"Quản lý nhập"})]})]})}),e.jsx(U,{item:!0,xs:12,children:e.jsx(Ve,{control:e.jsx(Oe,{checked:y.onlyRegisteredWorks,onChange:P,name:"onlyRegisteredWorks"}),label:"Chỉ hiển thị công trình đã đăng ký"})})]})]}),e.jsxs(Ce,{sx:{p:3,borderRadius:2,boxShadow:3},children:[e.jsx(Ae,{direction:"row",justifyContent:"space-between",alignItems:"center",mb:2,children:e.jsxs(L,{variant:"h6",display:"flex",alignItems:"center",children:[e.jsxs("span",{children:["Kết quả (",g.length," công trình)"]}),n&&e.jsx(J,{size:24,sx:{ml:2}})]})}),s&&e.jsx(De,{severity:"error",sx:{mb:2},children:s}),g.length===0&&!n?e.jsx(De,{severity:"info",children:"Không có công trình nào được tìm thấy. Vui lòng thay đổi bộ lọc hoặc thử lại."}):e.jsx(Te,{columns:W,data:g})]})]})},aa=hs([{element:e.jsx(Ps,{}),children:[{element:e.jsx(ke,{}),children:[{path:"/",Component:Es,children:[{path:"/",element:e.jsx(ir,{})},{path:"/cong-trinh",element:e.jsx(ke,{allowedRoles:["User","Manager"],children:e.jsx(ii,{})})},{path:"dang-ky-quy-doi",element:e.jsx(ke,{allowedRoles:["User"],children:e.jsx(Oi,{})})},{path:"/cham-diem",element:e.jsx(ke,{allowedRoles:["Manager","Admin"],children:e.jsx(Zi,{})})},{path:"/cham-diem/user/:userId",element:e.jsx(ke,{allowedRoles:["Manager","Admin"],children:e.jsx(Xi,{})})},{path:"/phan-cong",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(qi,{})})},{path:"/cap-nhat-thong-tin",element:e.jsx(ke,{children:e.jsx(_i,{})})},{path:"/test",element:e.jsx(ke,{allowedRoles:["User","Manager","Admin"],children:e.jsx(di,{})})},{path:"/bao-cao",element:e.jsx(ke,{allowedRoles:["User","Manager"],children:e.jsx(ra,{})})},{path:"/thong-ke",element:e.jsx(ke,{allowedRoles:["Admin","Manager"],children:e.jsx(ia,{})})},{path:"/quan-ly-tai-khoan",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(Bi,{})})},{path:"/cau-hinh-he-thong",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(Hi,{})})},{path:"/cai-dat",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(ar,{})})},{path:"/cai-dat/loai-cong-trinh",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(Ci,{})})},{path:"/cai-dat/cap-cong-trinh",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(yi,{})})},{path:"/cai-dat/vai-tro-tac-gia",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(xr,{})})},{path:"/cai-dat/muc-dich-quy-doi",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(gi,{})})},{path:"/cai-dat/he-so-quy-doi",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(Wr,{})})},{path:"/cai-dat/nganh-scimago",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(xi,{})})},{path:"/cai-dat/don-vi",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(yr,{})})},{path:"/cai-dat/nganh",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(Fr,{})})},{path:"/cai-dat/nam-hoc",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(Wi,{})})},{path:"/cai-dat/quan-ly-cache",element:e.jsx(ke,{allowedRoles:["Admin"],children:e.jsx(ta,{})})}]}]}]},{path:"/dang-ky",element:e.jsx(rr,{})},{path:"/dang-nhap",element:e.jsx(Qs,{})},{path:"/unauthorized",element:e.jsx(Vi,{})},{path:"*",element:e.jsx(zi,{})}]);us.createRoot(document.getElementById("root")).render(e.jsx(l.StrictMode,{children:e.jsx(gs,{theme:ps,children:e.jsx(Ts,{children:e.jsx(ms,{router:aa})})})}));export{oa as __vite_legacy_guard};
